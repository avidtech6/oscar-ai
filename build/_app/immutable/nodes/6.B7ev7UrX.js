var fA=Object.defineProperty;var pA=(p,e,t)=>e in p?fA(p,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):p[e]=t;var $=(p,e,t)=>(pA(p,typeof e!="symbol"?e+"":e,t),t),Xm=(p,e,t)=>{if(!e.has(p))throw TypeError("Cannot "+t)};var n=(p,e,t)=>(Xm(p,e,"read from private field"),t?t.call(p):e.get(p)),m=(p,e,t)=>{if(e.has(p))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(p):e.set(p,t)},w=(p,e,t,s)=>(Xm(p,e,"write to private field"),s?s.call(p,t):e.set(p,t),t);var Ae=(p,e,t,s)=>({set _(i){w(p,e,i,t)},get _(){return n(p,e,s)}}),E=(p,e,t)=>(Xm(p,e,"access private method"),t);import{s as gA,n as yp,d as ht,r as Iy,q as Yi,a as xe,i as ke,b as X,u as vi,l as nt,m as mA,g as wt,c as rt,e as mt,o as ne,f as Ot,j as vt,h as at,t as Nt,p as bA,v as yA}from"../chunks/scheduler.DKaqMhG1.js";import{e as qy}from"../chunks/each.C2d3_RSt.js";import{S as wA,i as vA}from"../chunks/index.DlqHU1Qv.js";import{s as AA}from"../chunks/settings.a3gRd5qY.js";import{_ as _A}from"../chunks/preload-helper.BQ24v_F8.js";import{c as xf,g as SA}from"../chunks/_commonjsHelpers.Cpj98o6Y.js";const rs=typeof process=="object"&&process+""=="[object process]"&&!process.versions.nw&&!(process.versions.electron&&process.type&&process.type!=="browser"),eb=[.001,0,0,.001,0,0],$m=1.35,Bs={ANY:1,DISPLAY:2,PRINT:4,ANNOTATIONS_FORMS:16,ANNOTATIONS_STORAGE:32,ANNOTATIONS_DISABLE:64,IS_EDITING:128,OPLIST:256},Gn={DISABLE:0,ENABLE:1,ENABLE_FORMS:2,ENABLE_STORAGE:3},kc="pdfjs_internal_editor_",Et={DISABLE:-1,NONE:0,FREETEXT:3,HIGHLIGHT:9,STAMP:13,INK:15,POPUP:16,SIGNATURE:101,COMMENT:102},Mt={RESIZE:1,CREATE:2,FREETEXT_SIZE:11,FREETEXT_COLOR:12,FREETEXT_OPACITY:13,INK_COLOR:21,INK_THICKNESS:22,INK_OPACITY:23,HIGHLIGHT_COLOR:31,HIGHLIGHT_THICKNESS:32,HIGHLIGHT_FREE:33,HIGHLIGHT_SHOW_ALL:34,DRAW_STEP:41},EA={PRINT:4,MODIFY_CONTENTS:8,COPY:16,MODIFY_ANNOTATIONS:32,FILL_INTERACTIVE_FORMS:256,COPY_FOR_ACCESSIBILITY:512,ASSEMBLE:1024,PRINT_HIGH_QUALITY:2048},sb={TRIANGLES:1,LATTICE:2},_e={FILL:0,STROKE:1,FILL_STROKE:2,INVISIBLE:3,FILL_STROKE_MASK:3,ADD_TO_PATH_FLAG:4},Nf={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3},be={TEXT:1,LINK:2,FREETEXT:3,LINE:4,SQUARE:5,CIRCLE:6,POLYGON:7,POLYLINE:8,HIGHLIGHT:9,UNDERLINE:10,SQUIGGLY:11,STRIKEOUT:12,STAMP:13,CARET:14,INK:15,POPUP:16,FILEATTACHMENT:17,SOUND:18,MOVIE:19,WIDGET:20,SCREEN:21,PRINTERMARK:22,TRAPNET:23,WATERMARK:24,THREED:25,REDACT:26},No={SOLID:1,DASHED:2,BEVELED:3,INSET:4,UNDERLINE:5},Fm={ERRORS:0,WARNINGS:1,INFOS:5},Tc={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotation:80,endAnnotation:81,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91,setStrokeTransparent:92,setFillTransparent:93,rawFillPath:94},ec={moveTo:0,lineTo:1,curveTo:2,quadraticCurveTo:3,closePath:4},CA={NEED_PASSWORD:1,INCORRECT_PASSWORD:2};let Om=Fm.WARNINGS;function xA(p){Number.isInteger(p)&&(Om=p)}function kA(){return Om}function Nm(p){Om>=Fm.INFOS&&console.info(`Info: ${p}`)}function At(p){Om>=Fm.WARNINGS&&console.warn(`Warning: ${p}`)}function zt(p){throw new Error(p)}function Bt(p,e){p||zt(e)}function TA(p){switch(p==null?void 0:p.protocol){case"http:":case"https:":case"ftp:":case"mailto:":case"tel:":return!0;default:return!1}}function z0(p,e=null,t=null){if(!p)return null;if(t&&typeof p=="string"){if(t.addDefaultProtocol&&p.startsWith("www.")){const i=p.match(/\./g);(i==null?void 0:i.length)>=2&&(p=`http://${p}`)}if(t.tryConvertEncoding)try{p=LA(p)}catch{}}const s=e?URL.parse(p,e):URL.parse(p);return TA(s)?s:null}function U0(p,e,t=!1){const s=URL.parse(p);return s?(s.hash=e,s.href):t&&z0(p,"http://example.com")?p.split("#",1)[0]+`${e?`#${e}`:""}`:""}function _t(p,e,t,s=!1){return Object.defineProperty(p,e,{value:t,enumerable:!s,configurable:!0,writable:!1}),t}const Lo=function(){function e(t,s){this.message=t,this.name=s}return e.prototype=new Error,e.constructor=e,e}();class Ky extends Lo{constructor(e,t){super(e,"PasswordException"),this.code=t}}class Ym extends Lo{constructor(e,t){super(e,"UnknownErrorException"),this.details=t}}class ib extends Lo{constructor(e){super(e,"InvalidPDFException")}}class wp extends Lo{constructor(e,t,s){super(e,"ResponseException"),this.status=t,this.missing=s}}class PA extends Lo{constructor(e){super(e,"FormatError")}}class Xr extends Lo{constructor(e){super(e,"AbortException")}}function DA(p){(typeof p!="object"||(p==null?void 0:p.length)===void 0)&&zt("Invalid argument for bytesToString");const e=p.length,t=8192;if(e<t)return String.fromCharCode.apply(null,p);const s=[];for(let i=0;i<e;i+=t){const r=Math.min(i+t,e),a=p.subarray(i,r);s.push(String.fromCharCode.apply(null,a))}return s.join("")}function Bm(p){typeof p!="string"&&zt("Invalid argument for stringToBytes");const e=p.length,t=new Uint8Array(e);for(let s=0;s<e;++s)t[s]=p.charCodeAt(s)&255;return t}function IA(p){return String.fromCharCode(p>>24&255,p>>16&255,p>>8&255,p&255)}function MA(){const p=new Uint8Array(4);return p[0]=1,new Uint32Array(p.buffer,0,1)[0]===1}function RA(){try{return new Function(""),!0}catch{return!1}}class Te{static get isLittleEndian(){return _t(this,"isLittleEndian",MA())}static get isEvalSupported(){return _t(this,"isEvalSupported",RA())}static get isOffscreenCanvasSupported(){return _t(this,"isOffscreenCanvasSupported",typeof OffscreenCanvas<"u")}static get isImageDecoderSupported(){return _t(this,"isImageDecoderSupported",typeof ImageDecoder<"u")}static get isFloat16ArraySupported(){return _t(this,"isFloat16ArraySupported",typeof Float16Array<"u")}static get isSanitizerSupported(){return _t(this,"isSanitizerSupported",typeof Sanitizer<"u")}static get platform(){const{platform:e,userAgent:t}=navigator;return _t(this,"platform",{isAndroid:t.includes("Android"),isLinux:e.includes("Linux"),isMac:e.includes("Mac"),isWindows:e.includes("Win"),isFirefox:t.includes("Firefox")})}static get isCSSRoundSupported(){var e,t;return _t(this,"isCSSRoundSupported",(t=(e=globalThis.CSS)==null?void 0:e.supports)==null?void 0:t.call(e,"width: round(1.5px, 1px)"))}}const qm=Array.from(Array(256).keys(),p=>p.toString(16).padStart(2,"0"));var Jo,Bf,Rc,nb;class ct{static makeHexColor(e,t,s){return`#${qm[e]}${qm[t]}${qm[s]}`}static domMatrixToTransform(e){return[e.a,e.b,e.c,e.d,e.e,e.f]}static scaleMinMax(e,t){let s;e[0]?(e[0]<0&&(s=t[0],t[0]=t[2],t[2]=s),t[0]*=e[0],t[2]*=e[0],e[3]<0&&(s=t[1],t[1]=t[3],t[3]=s),t[1]*=e[3],t[3]*=e[3]):(s=t[0],t[0]=t[1],t[1]=s,s=t[2],t[2]=t[3],t[3]=s,e[1]<0&&(s=t[1],t[1]=t[3],t[3]=s),t[1]*=e[1],t[3]*=e[1],e[2]<0&&(s=t[0],t[0]=t[2],t[2]=s),t[0]*=e[2],t[2]*=e[2]),t[0]+=e[4],t[1]+=e[5],t[2]+=e[4],t[3]+=e[5]}static transform(e,t){return[e[0]*t[0]+e[2]*t[1],e[1]*t[0]+e[3]*t[1],e[0]*t[2]+e[2]*t[3],e[1]*t[2]+e[3]*t[3],e[0]*t[4]+e[2]*t[5]+e[4],e[1]*t[4]+e[3]*t[5]+e[5]]}static multiplyByDOMMatrix(e,t){return[e[0]*t.a+e[2]*t.b,e[1]*t.a+e[3]*t.b,e[0]*t.c+e[2]*t.d,e[1]*t.c+e[3]*t.d,e[0]*t.e+e[2]*t.f+e[4],e[1]*t.e+e[3]*t.f+e[5]]}static applyTransform(e,t,s=0){const i=e[s],r=e[s+1];e[s]=i*t[0]+r*t[2]+t[4],e[s+1]=i*t[1]+r*t[3]+t[5]}static applyTransformToBezier(e,t,s=0){const i=t[0],r=t[1],a=t[2],o=t[3],l=t[4],h=t[5];for(let c=0;c<6;c+=2){const d=e[s+c],u=e[s+c+1];e[s+c]=d*i+u*a+l,e[s+c+1]=d*r+u*o+h}}static applyInverseTransform(e,t){const s=e[0],i=e[1],r=t[0]*t[3]-t[1]*t[2];e[0]=(s*t[3]-i*t[2]+t[2]*t[5]-t[4]*t[3])/r,e[1]=(-s*t[1]+i*t[0]+t[4]*t[1]-t[5]*t[0])/r}static axialAlignedBoundingBox(e,t,s){const i=t[0],r=t[1],a=t[2],o=t[3],l=t[4],h=t[5],c=e[0],d=e[1],u=e[2],f=e[3];let y=i*c+l,g=y,v=i*u+l,b=v,A=o*d+h,_=A,x=o*f+h,k=x;if(r!==0||a!==0){const T=r*c,P=r*u,F=a*d,R=a*f;y+=F,b+=F,v+=R,g+=R,A+=T,k+=T,x+=P,_+=P}s[0]=Math.min(s[0],y,v,g,b),s[1]=Math.min(s[1],A,x,_,k),s[2]=Math.max(s[2],y,v,g,b),s[3]=Math.max(s[3],A,x,_,k)}static inverseTransform(e){const t=e[0]*e[3]-e[1]*e[2];return[e[3]/t,-e[1]/t,-e[2]/t,e[0]/t,(e[2]*e[5]-e[4]*e[3])/t,(e[4]*e[1]-e[5]*e[0])/t]}static singularValueDecompose2dScale(e,t){const s=e[0],i=e[1],r=e[2],a=e[3],o=s**2+i**2,l=s*r+i*a,h=r**2+a**2,c=(o+h)/2,d=Math.sqrt(c**2-(o*h-l**2));t[0]=Math.sqrt(c+d||1),t[1]=Math.sqrt(c-d||1)}static normalizeRect(e){const t=e.slice(0);return e[0]>e[2]&&(t[0]=e[2],t[2]=e[0]),e[1]>e[3]&&(t[1]=e[3],t[3]=e[1]),t}static intersect(e,t){const s=Math.max(Math.min(e[0],e[2]),Math.min(t[0],t[2])),i=Math.min(Math.max(e[0],e[2]),Math.max(t[0],t[2]));if(s>i)return null;const r=Math.max(Math.min(e[1],e[3]),Math.min(t[1],t[3])),a=Math.min(Math.max(e[1],e[3]),Math.max(t[1],t[3]));return r>a?null:[s,r,i,a]}static pointBoundingBox(e,t,s){s[0]=Math.min(s[0],e),s[1]=Math.min(s[1],t),s[2]=Math.max(s[2],e),s[3]=Math.max(s[3],t)}static rectBoundingBox(e,t,s,i,r){r[0]=Math.min(r[0],e,s),r[1]=Math.min(r[1],t,i),r[2]=Math.max(r[2],e,s),r[3]=Math.max(r[3],t,i)}static bezierBoundingBox(e,t,s,i,r,a,o,l,h){h[0]=Math.min(h[0],e,o),h[1]=Math.min(h[1],t,l),h[2]=Math.max(h[2],e,o),h[3]=Math.max(h[3],t,l),E(this,Rc,nb).call(this,e,s,r,o,t,i,a,l,3*(-e+3*(s-r)+o),6*(e-2*s+r),3*(s-e),h),E(this,Rc,nb).call(this,e,s,r,o,t,i,a,l,3*(-t+3*(i-a)+l),6*(t-2*i+a),3*(i-t),h)}}Jo=new WeakSet,Bf=function(e,t,s,i,r,a,o,l,h,c){if(h<=0||h>=1)return;const d=1-h,u=h*h,f=u*h,y=d*(d*(d*e+3*h*t)+3*u*s)+f*i,g=d*(d*(d*r+3*h*a)+3*u*o)+f*l;c[0]=Math.min(c[0],y),c[1]=Math.min(c[1],g),c[2]=Math.max(c[2],y),c[3]=Math.max(c[3],g)},Rc=new WeakSet,nb=function(e,t,s,i,r,a,o,l,h,c,d,u){if(Math.abs(h)<1e-12){Math.abs(c)>=1e-12&&E(this,Jo,Bf).call(this,e,t,s,i,r,a,o,l,-d/c,u);return}const f=c**2-4*d*h;if(f<0)return;const y=Math.sqrt(f),g=2*h;E(this,Jo,Bf).call(this,e,t,s,i,r,a,o,l,(-c+y)/g,u),E(this,Jo,Bf).call(this,e,t,s,i,r,a,o,l,(-c-y)/g,u)},m(ct,Jo),m(ct,Rc);function LA(p){return decodeURIComponent(escape(p))}let Km=null,Zy=null;function FA(p){return Km||(Km=/([\u00a0\u00b5\u037e\u0eb3\u2000-\u200a\u202f\u2126\ufb00-\ufb04\ufb06\ufb20-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufba1\ufba4-\ufba9\ufbae-\ufbb1\ufbd3-\ufbdc\ufbde-\ufbe7\ufbea-\ufbf8\ufbfc-\ufbfd\ufc00-\ufc5d\ufc64-\ufcf1\ufcf5-\ufd3d\ufd88\ufdf4\ufdfa-\ufdfb\ufe71\ufe77\ufe79\ufe7b\ufe7d]+)|(\ufb05+)/gu,Zy=new Map([["ﬅ","ſt"]])),p.replaceAll(Km,(e,t,s)=>t?t.normalize("NFKC"):Zy.get(s))}function H0(){if(typeof crypto.randomUUID=="function")return crypto.randomUUID();const p=new Uint8Array(32);return crypto.getRandomValues(p),DA(p)}const Go="pdfjs_internal_id_";function OA(p,e,t){if(!Array.isArray(t)||t.length<2)return!1;const[s,i,...r]=t;if(!p(s)&&!Number.isInteger(s)||!e(i))return!1;const a=r.length;let o=!0;switch(i.name){case"XYZ":if(a<2||a>3)return!1;break;case"Fit":case"FitB":return a===0;case"FitH":case"FitBH":case"FitV":case"FitBV":if(a>1)return!1;break;case"FitR":if(a!==4)return!1;o=!1;break;default:return!1}for(const l of r)if(!(typeof l=="number"||o&&l===null))return!1;return!0}function Ve(p,e,t){return Math.min(Math.max(p,e),t)}typeof Math.sumPrecise!="function"&&(Math.sumPrecise=function(p){return p.reduce((e,t)=>e+t,0)});class Pc{static textContent(e){const t=[],s={items:t,styles:Object.create(null)};function i(r){var l;if(!r)return;let a=null;const o=r.name;if(o==="#text")a=r.value;else if(Pc.shouldBuildText(o))(l=r==null?void 0:r.attributes)!=null&&l.textContent?a=r.attributes.textContent:r.value&&(a=r.value);else return;if(a!==null&&t.push({str:a}),!!r.children)for(const h of r.children)i(h)}return i(e),s}static shouldBuildText(e){return!(e==="textarea"||e==="input"||e==="option"||e==="select")}}class j0{static setupStorage(e,t,s,i,r){const a=i.getValue(t,{value:null});switch(s.name){case"textarea":if(a.value!==null&&(e.textContent=a.value),r==="print")break;e.addEventListener("input",o=>{i.setValue(t,{value:o.target.value})});break;case"input":if(s.attributes.type==="radio"||s.attributes.type==="checkbox"){if(a.value===s.attributes.xfaOn?e.setAttribute("checked",!0):a.value===s.attributes.xfaOff&&e.removeAttribute("checked"),r==="print")break;e.addEventListener("change",o=>{i.setValue(t,{value:o.target.checked?o.target.getAttribute("xfaOn"):o.target.getAttribute("xfaOff")})})}else{if(a.value!==null&&e.setAttribute("value",a.value),r==="print")break;e.addEventListener("input",o=>{i.setValue(t,{value:o.target.value})})}break;case"select":if(a.value!==null){e.setAttribute("value",a.value);for(const o of s.children)o.attributes.value===a.value?o.attributes.selected=!0:o.attributes.hasOwnProperty("selected")&&delete o.attributes.selected}e.addEventListener("input",o=>{const l=o.target.options,h=l.selectedIndex===-1?"":l[l.selectedIndex].value;i.setValue(t,{value:h})});break}}static setAttributes({html:e,element:t,storage:s=null,intent:i,linkService:r}){const{attributes:a}=t,o=e instanceof HTMLAnchorElement;a.type==="radio"&&(a.name=`${a.name}-${i}`);for(const[l,h]of Object.entries(a))if(h!=null)switch(l){case"class":h.length&&e.setAttribute(l,h.join(" "));break;case"dataId":break;case"id":e.setAttribute("data-element-id",h);break;case"style":Object.assign(e.style,h);break;case"textContent":e.textContent=h;break;default:(!o||l!=="href"&&l!=="newWindow")&&e.setAttribute(l,h)}o&&r.addLinkAttributes(e,a.href,a.newWindow),s&&a.dataId&&this.setupStorage(e,a.dataId,t,s)}static render(e){var d,u;const t=e.annotationStorage,s=e.linkService,i=e.xfaHtml,r=e.intent||"display",a=document.createElement(i.name);i.attributes&&this.setAttributes({html:a,element:i,intent:r,linkService:s});const o=r!=="richText",l=e.div;if(l.append(a),e.viewport){const f=`matrix(${e.viewport.transform.join(",")})`;l.style.transform=f}o&&l.setAttribute("class","xfaLayer xfaFont");const h=[];if(i.children.length===0){if(i.value){const f=document.createTextNode(i.value);a.append(f),o&&Pc.shouldBuildText(i.name)&&h.push(f)}return{textDivs:h}}const c=[[i,-1,a]];for(;c.length>0;){const[f,y,g]=c.at(-1);if(y+1===f.children.length){c.pop();continue}const v=f.children[++c.at(-1)[1]];if(v===null)continue;const{name:b}=v;if(b==="#text"){const _=document.createTextNode(v.value);h.push(_),g.append(_);continue}const A=(d=v==null?void 0:v.attributes)!=null&&d.xmlns?document.createElementNS(v.attributes.xmlns,b):document.createElement(b);if(g.append(A),v.attributes&&this.setAttributes({html:A,element:v,storage:t,intent:r,linkService:s}),((u=v.children)==null?void 0:u.length)>0)c.push([v,-1,A]);else if(v.value){const _=document.createTextNode(v.value);o&&Pc.shouldBuildText(b)&&h.push(_),A.append(_)}}for(const f of l.querySelectorAll(".xfaNonInteractive input, .xfaNonInteractive textarea"))f.setAttribute("readOnly",!0);return{textDivs:h}}static update(e){const t=`matrix(${e.viewport.transform.join(",")})`;e.div.style.transform=t,e.div.hidden=!1}}const Ji="http://www.w3.org/2000/svg",Jr=class Jr{};$(Jr,"CSS",96),$(Jr,"PDF",72),$(Jr,"PDF_TO_CSS_UNITS",Jr.CSS/Jr.PDF);let $r=Jr;async function vf(p,e="text"){if(ac(p,document.baseURI)){const t=await fetch(p);if(!t.ok)throw new Error(t.statusText);switch(e){case"arraybuffer":return t.arrayBuffer();case"blob":return t.blob();case"json":return t.json()}return t.text()}return new Promise((t,s)=>{const i=new XMLHttpRequest;i.open("GET",p,!0),i.responseType=e,i.onreadystatechange=()=>{if(i.readyState===XMLHttpRequest.DONE){if(i.status===200||i.status===0){switch(e){case"arraybuffer":case"blob":case"json":t(i.response);return}t(i.responseText);return}s(new Error(i.statusText))}},i.send(null)})}class Af{constructor({viewBox:e,userUnit:t,scale:s,rotation:i,offsetX:r=0,offsetY:a=0,dontFlip:o=!1}){this.viewBox=e,this.userUnit=t,this.scale=s,this.rotation=i,this.offsetX=r,this.offsetY=a,s*=t;const l=(e[2]+e[0])/2,h=(e[3]+e[1])/2;let c,d,u,f;switch(i%=360,i<0&&(i+=360),i){case 180:c=-1,d=0,u=0,f=1;break;case 90:c=0,d=1,u=1,f=0;break;case 270:c=0,d=-1,u=-1,f=0;break;case 0:c=1,d=0,u=0,f=-1;break;default:throw new Error("PageViewport: Invalid rotation, must be a multiple of 90 degrees.")}o&&(u=-u,f=-f);let y,g,v,b;c===0?(y=Math.abs(h-e[1])*s+r,g=Math.abs(l-e[0])*s+a,v=(e[3]-e[1])*s,b=(e[2]-e[0])*s):(y=Math.abs(l-e[0])*s+r,g=Math.abs(h-e[1])*s+a,v=(e[2]-e[0])*s,b=(e[3]-e[1])*s),this.transform=[c*s,d*s,u*s,f*s,y-c*s*l-u*s*h,g-d*s*l-f*s*h],this.width=v,this.height=b}get rawDims(){const e=this.viewBox;return _t(this,"rawDims",{pageWidth:e[2]-e[0],pageHeight:e[3]-e[1],pageX:e[0],pageY:e[1]})}clone({scale:e=this.scale,rotation:t=this.rotation,offsetX:s=this.offsetX,offsetY:i=this.offsetY,dontFlip:r=!1}={}){return new Af({viewBox:this.viewBox.slice(),userUnit:this.userUnit,scale:e,rotation:t,offsetX:s,offsetY:i,dontFlip:r})}convertToViewportPoint(e,t){const s=[e,t];return ct.applyTransform(s,this.transform),s}convertToViewportRectangle(e){const t=[e[0],e[1]];ct.applyTransform(t,this.transform);const s=[e[2],e[3]];return ct.applyTransform(s,this.transform),[t[0],t[1],s[0],s[1]]}convertToPdfPoint(e,t){const s=[e,t];return ct.applyInverseTransform(s,this.transform),s}}class My extends Lo{constructor(e,t=0){super(e,"RenderingCancelledException"),this.extraDelay=t}}function zm(p){const e=p.length;let t=0;for(;t<e&&p[t].trim()==="";)t++;return p.substring(t,t+5).toLowerCase()==="data:"}function Ry(p){return typeof p=="string"&&/\.pdf$/i.test(p)}function NA(p){return[p]=p.split(/[#?]/,1),p.substring(p.lastIndexOf("/")+1)}function BA(p,e="document.pdf"){if(typeof p!="string")return e;if(zm(p))return At('getPdfFilenameFromUrl: ignore "data:"-URL for performance reasons.'),e;const s=(o=>{try{return new URL(o)}catch{try{return new URL(decodeURIComponent(o))}catch{try{return new URL(o,"https://foo.bar")}catch{try{return new URL(decodeURIComponent(o),"https://foo.bar")}catch{return null}}}}})(p);if(!s)return e;const i=o=>{try{let l=decodeURIComponent(o);return l.includes("/")?(l=l.split("/").at(-1),l.test(/^\.pdf$/i)?l:o):l}catch{return o}},r=/\.pdf$/i,a=s.pathname.split("/").at(-1);if(r.test(a))return i(a);if(s.searchParams.size>0){const o=Array.from(s.searchParams.values()).reverse();for(const h of o)if(r.test(h))return i(h);const l=Array.from(s.searchParams.keys()).reverse();for(const h of l)if(r.test(h))return i(h)}if(s.hash){const l=/[^/?#=]+\.pdf\b(?!.*\.pdf\b)/i.exec(s.hash);if(l)return i(l[0])}return e}class Jy{constructor(){$(this,"started",Object.create(null));$(this,"times",[])}time(e){e in this.started&&At(`Timer is already running for ${e}`),this.started[e]=Date.now()}timeEnd(e){e in this.started||At(`Timer has not been started for ${e}`),this.times.push({name:e,start:this.started[e],end:Date.now()}),delete this.started[e]}toString(){const e=[];let t=0;for(const{name:s}of this.times)t=Math.max(s.length,t);for(const{name:s,start:i,end:r}of this.times)e.push(`${s.padEnd(t)} ${r-i}ms
`);return e.join("")}}function ac(p,e){const t=e?URL.parse(p,e):URL.parse(p);return(t==null?void 0:t.protocol)==="http:"||(t==null?void 0:t.protocol)==="https:"}function ii(p){p.preventDefault()}function ue(p){p.preventDefault(),p.stopPropagation()}function zA(p){console.log("Deprecated API usage: "+p)}var Lc;class vp{static toDateObject(e){if(e instanceof Date)return e;if(!e||typeof e!="string")return null;n(this,Lc)||w(this,Lc,new RegExp("^D:(\\d{4})(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?([Z|+|-])?(\\d{2})?'?(\\d{2})?'?"));const t=n(this,Lc).exec(e);if(!t)return null;const s=parseInt(t[1],10);let i=parseInt(t[2],10);i=i>=1&&i<=12?i-1:0;let r=parseInt(t[3],10);r=r>=1&&r<=31?r:1;let a=parseInt(t[4],10);a=a>=0&&a<=23?a:0;let o=parseInt(t[5],10);o=o>=0&&o<=59?o:0;let l=parseInt(t[6],10);l=l>=0&&l<=59?l:0;const h=t[7]||"Z";let c=parseInt(t[8],10);c=c>=0&&c<=23?c:0;let d=parseInt(t[9],10)||0;return d=d>=0&&d<=59?d:0,h==="-"?(a+=c,o+=d):h==="+"&&(a-=c,o-=d),new Date(Date.UTC(s,i,r,a,o,l))}}Lc=new WeakMap,m(vp,Lc,void 0);function UA(p,{scale:e=1,rotation:t=0}){const{width:s,height:i}=p.attributes.style,r=[0,0,parseInt(s),parseInt(i)];return new Af({viewBox:r,userUnit:1,scale:e,rotation:t})}function _f(p){if(p.startsWith("#")){const e=parseInt(p.slice(1),16);return[(e&16711680)>>16,(e&65280)>>8,e&255]}return p.startsWith("rgb(")?p.slice(4,-1).split(",").map(e=>parseInt(e)):p.startsWith("rgba(")?p.slice(5,-1).split(",").map(e=>parseInt(e)).slice(0,3):(At(`Not a valid color format: "${p}"`),[0,0,0])}function HA(p){const e=document.createElement("span");e.style.visibility="hidden",e.style.colorScheme="only light",document.body.append(e);for(const t of p.keys()){e.style.color=t;const s=window.getComputedStyle(e).color;p.set(t,_f(s))}e.remove()}function oe(p){const{a:e,b:t,c:s,d:i,e:r,f:a}=p.getTransform();return[e,t,s,i,r,a]}function _i(p){const{a:e,b:t,c:s,d:i,e:r,f:a}=p.getTransform().invertSelf();return[e,t,s,i,r,a]}function Io(p,e,t=!1,s=!0){if(e instanceof Af){const{pageWidth:i,pageHeight:r}=e.rawDims,{style:a}=p,o=Te.isCSSRoundSupported,l=`var(--total-scale-factor) * ${i}px`,h=`var(--total-scale-factor) * ${r}px`,c=o?`round(down, ${l}, var(--scale-round-x))`:`calc(${l})`,d=o?`round(down, ${h}, var(--scale-round-y))`:`calc(${h})`;!t||e.rotation%180===0?(a.width=c,a.height=d):(a.width=d,a.height=c)}s&&p.setAttribute("data-main-rotation",e.rotation)}class Ki{constructor(){const{pixelRatio:e}=Ki;this.sx=e,this.sy=e}get scaled(){return this.sx!==1||this.sy!==1}get symmetric(){return this.sx===this.sy}limitCanvas(e,t,s,i,r=-1){let a=1/0,o=1/0,l=1/0;s=Ki.capPixels(s,r),s>0&&(a=Math.sqrt(s/(e*t))),i!==-1&&(o=i/e,l=i/t);const h=Math.min(a,o,l);return this.sx>h||this.sy>h?(this.sx=h,this.sy=h,!0):!1}static get pixelRatio(){return globalThis.devicePixelRatio||1}static capPixels(e,t){if(t>=0){const s=Math.ceil(window.screen.availWidth*window.screen.availHeight*this.pixelRatio**2*(1+t/100));return e>0?Math.min(e,s):s}return e}}const rb=["image/apng","image/avif","image/bmp","image/gif","image/jpeg","image/png","image/svg+xml","image/webp","image/x-icon"];class jA{static get isDarkMode(){var e;return _t(this,"isDarkMode",!!((e=window==null?void 0:window.matchMedia)!=null&&e.call(window,"(prefers-color-scheme: dark)").matches))}}class VA{static get commentForegroundColor(){const e=document.createElement("span");e.classList.add("comment","sidebar");const{style:t}=e;t.width=t.height="0",t.display="none",t.color="var(--comment-fg-color)",document.body.append(e);const{color:s}=window.getComputedStyle(e);return e.remove(),_t(this,"commentForegroundColor",_f(s))}}function WA(p,e,t,s){s=Math.min(Math.max(s??1,0),1);const i=255*(1-s);return p=Math.round(p*s+i),e=Math.round(e*s+i),t=Math.round(t*s+i),[p,e,t]}function Qy(p,e){const t=p[0]/255,s=p[1]/255,i=p[2]/255,r=Math.max(t,s,i),a=Math.min(t,s,i),o=(r+a)/2;if(r===a)e[0]=e[1]=0;else{const l=r-a;switch(e[1]=o<.5?l/(r+a):l/(2-r-a),r){case t:e[0]=((s-i)/l+(s<i?6:0))*60;break;case s:e[0]=((i-t)/l+2)*60;break;case i:e[0]=((t-s)/l+4)*60;break}}e[2]=o}function ab(p,e){const t=p[0],s=p[1],i=p[2],r=(1-Math.abs(2*i-1))*s,a=r*(1-Math.abs(t/60%2-1)),o=i-r/2;switch(Math.floor(t/60)){case 0:e[0]=r+o,e[1]=a+o,e[2]=o;break;case 1:e[0]=a+o,e[1]=r+o,e[2]=o;break;case 2:e[0]=o,e[1]=r+o,e[2]=a+o;break;case 3:e[0]=o,e[1]=a+o,e[2]=r+o;break;case 4:e[0]=a+o,e[1]=o,e[2]=r+o;break;case 5:case 6:e[0]=r+o,e[1]=o,e[2]=a+o;break}}function t0(p){return p<=.03928?p/12.92:((p+.055)/1.055)**2.4}function e0(p,e,t){ab(p,t),t.map(t0);const s=.2126*t[0]+.7152*t[1]+.0722*t[2];ab(e,t),t.map(t0);const i=.2126*t[0]+.7152*t[1]+.0722*t[2];return s>i?(s+.05)/(i+.05):(i+.05)/(s+.05)}const s0=new Map;function GA(p,e){const t=p[0]+p[1]*256+p[2]*65536+e[0]*16777216+e[1]*4294967296+e[2]*1099511627776;let s=s0.get(t);if(s)return s;const i=new Float32Array(9),r=i.subarray(0,3),a=i.subarray(3,6);Qy(p,a);const o=i.subarray(6,9);Qy(e,o);const l=o[2]<.5,h=l?12:4.5;if(a[2]=l?Math.sqrt(a[2]):1-Math.sqrt(1-a[2]),e0(a,o,r)<h){let c,d;l?(c=a[2],d=1):(c=0,d=a[2]);const u=.005;for(;d-c>u;){const f=a[2]=(c+d)/2;l===e0(a,o,r)<h?c=f:d=f}a[2]=l?d:c}return ab(a,r),s=ct.makeHexColor(Math.round(r[0]*255),Math.round(r[1]*255),Math.round(r[2]*255)),s0.set(t,s),s}function V0({html:p,dir:e,className:t},s){const i=document.createDocumentFragment();if(typeof p=="string"){const r=document.createElement("p");r.dir=e||"auto";const a=p.split(/(?:\r\n?|\n)/);for(let o=0,l=a.length;o<l;++o){const h=a[o];r.append(document.createTextNode(h)),o<l-1&&r.append(document.createElement("br"))}i.append(r)}else j0.render({xfaHtml:p,div:i,intent:"richText"});i.firstElementChild.classList.add("richText",t),s.append(i)}function W0(p){const e=new Path2D;if(!p)return e;for(let t=0,s=p.length;t<s;)switch(p[t++]){case ec.moveTo:e.moveTo(p[t++],p[t++]);break;case ec.lineTo:e.lineTo(p[t++],p[t++]);break;case ec.curveTo:e.bezierCurveTo(p[t++],p[t++],p[t++],p[t++],p[t++],p[t++]);break;case ec.quadraticCurveTo:e.quadraticCurveTo(p[t++],p[t++],p[t++],p[t++]);break;case ec.closePath:e.closePath();break;default:At(`Unrecognized drawing path operator: ${p[t-1]}`);break}return e}var nn,ai,Qo,Xn,ea,Mp,G0,Rp,X0;const Rt=class Rt{constructor(){m(this,Mp);m(this,Rp)}get pagesNumber(){return n(Rt,Xn)}set pagesNumber(e){n(Rt,Xn)!==e&&(w(Rt,Xn,e),e===0&&(w(Rt,ai,null),w(Rt,nn,null)))}addListener(e){n(Rt,ea).push(e)}removeListener(e){const t=n(Rt,ea).indexOf(e);t>=0&&n(Rt,ea).splice(t,1)}movePages(e,t,s){E(this,Rp,X0).call(this,!0);const i=n(Rt,ai),r=n(Rt,nn);n(Rt,Qo).set(r);const a=t.length,o=new Uint32Array(a);let l=0;for(let f=0;f<a;f++){const y=t[f]-1;o[f]=i[y],y<s&&(l+=1)}const h=n(Rt,Xn);let c=s-l;const d=h-a;c=Ve(c,0,d);for(let f=0,y=0;f<h;f++)e.has(f+1)||(i[y++]=i[f]);i.copyWithin(c+a,c,d),i.set(o,c);let u=!1;for(let f=0,y=h;f<y;f++){const g=i[f];u||(u=g!==f+1),r[g-1]=f+1}E(this,Mp,G0).call(this),u||(this.pagesNumber=0)}hasBeenAltered(){return n(Rt,ai)!==null}getPageMappingForSaving(){return{pageIndices:n(Rt,nn)?n(Rt,nn).map(e=>e-1):null}}getPrevPageNumber(e){return n(Rt,Qo)[n(Rt,ai)[e-1]-1]}getPageNumber(e){var t;return((t=n(Rt,nn))==null?void 0:t[e-1])??e}getPageId(e){var t;return((t=n(Rt,ai))==null?void 0:t[e-1])??e}static get instance(){return _t(this,"instance",new Rt)}getMapping(){return n(Rt,ai).subarray(0,this.pagesNumber)}};nn=new WeakMap,ai=new WeakMap,Qo=new WeakMap,Xn=new WeakMap,ea=new WeakMap,Mp=new WeakSet,G0=function(){for(const e of n(Rt,ea))e()},Rp=new WeakSet,X0=function(e){if(n(Rt,ai))return;const t=n(Rt,Xn),s=new Uint32Array(3*t),i=w(Rt,ai,s.subarray(0,t)),r=w(Rt,nn,s.subarray(t,2*t));if(e)for(let a=0;a<t;a++)i[a]=r[a]=a+1;w(Rt,Qo,s.subarray(2*t))},m(Rt,nn,null),m(Rt,ai,null),m(Rt,Qo,null),m(Rt,Xn,0),m(Rt,ea,[]);let Dc=Rt;var $n,Yn,js,Vs,Fc,qn,tl,el,Oc,Lp,$0,Fp,Y0,Op,q0,Kn,Bo,sa,oc;const en=class en{constructor(e){m(this,Fp);m(this,Op);m(this,Kn);m(this,sa);m(this,$n,null);m(this,Yn,null);m(this,js,void 0);m(this,Vs,null);m(this,Fc,null);m(this,qn,null);m(this,tl,null);m(this,el,null);w(this,js,e),n(en,Oc)||w(en,Oc,Object.freeze({freetext:"pdfjs-editor-remove-freetext-button",highlight:"pdfjs-editor-remove-highlight-button",ink:"pdfjs-editor-remove-ink-button",stamp:"pdfjs-editor-remove-stamp-button",signature:"pdfjs-editor-remove-signature-button"}))}render(){const e=w(this,$n,document.createElement("div"));e.classList.add("editToolbar","hidden"),e.setAttribute("role","toolbar");const t=n(this,js)._uiManager._signal;t instanceof AbortSignal&&!t.aborted&&(e.addEventListener("contextmenu",ii,{signal:t}),e.addEventListener("pointerdown",E(en,Lp,$0),{signal:t}));const s=w(this,Vs,document.createElement("div"));s.className="buttons",e.append(s);const i=n(this,js).toolbarPosition;if(i){const{style:r}=e,a=n(this,js)._uiManager.direction==="ltr"?1-i[0]:i[0];r.insetInlineEnd=`${100*a}%`,r.top=`calc(${100*i[1]}% + var(--editor-toolbar-vert-offset))`}return e}get div(){return n(this,$n)}hide(){var e;n(this,$n).classList.add("hidden"),(e=n(this,Yn))==null||e.hideDropdown()}show(){var e,t;n(this,$n).classList.remove("hidden"),(e=n(this,Fc))==null||e.shown(),(t=n(this,qn))==null||t.shown()}addDeleteButton(){const{editorType:e,_uiManager:t}=n(this,js),s=document.createElement("button");s.classList.add("basic","deleteButton"),s.tabIndex=0,s.setAttribute("data-l10n-id",n(en,Oc)[e]),E(this,Kn,Bo).call(this,s)&&s.addEventListener("click",i=>{t.delete()},{signal:t._signal}),n(this,Vs).append(s)}async addAltText(e){const t=await e.render();E(this,Kn,Bo).call(this,t),n(this,Vs).append(t,n(this,sa,oc)),w(this,Fc,e)}addComment(e,t=null){if(n(this,qn))return;const s=e.renderForToolbar();if(!s)return;E(this,Kn,Bo).call(this,s);const i=w(this,tl,n(this,sa,oc));t?(n(this,Vs).insertBefore(s,t),n(this,Vs).insertBefore(i,t)):n(this,Vs).append(s,i),w(this,qn,e),e.toolbar=this}addColorPicker(e){if(n(this,Yn))return;w(this,Yn,e);const t=e.renderButton();E(this,Kn,Bo).call(this,t),n(this,Vs).append(t,n(this,sa,oc))}async addEditSignatureButton(e){const t=w(this,el,await e.renderEditButton(n(this,js)));E(this,Kn,Bo).call(this,t),n(this,Vs).append(t,n(this,sa,oc))}removeButton(e){var t,s;switch(e){case"comment":(t=n(this,qn))==null||t.removeToolbarCommentButton(),w(this,qn,null),(s=n(this,tl))==null||s.remove(),w(this,tl,null);break}}async addButton(e,t){switch(e){case"colorPicker":t&&this.addColorPicker(t);break;case"altText":t&&await this.addAltText(t);break;case"editSignature":t&&await this.addEditSignatureButton(t);break;case"delete":this.addDeleteButton();break;case"comment":t&&this.addComment(t);break}}async addButtonBefore(e,t,s){if(!t&&e==="comment")return;const i=n(this,Vs).querySelector(s);i&&e==="comment"&&this.addComment(t,i)}updateEditSignatureButton(e){n(this,el)&&(n(this,el).title=e)}remove(){var e;n(this,$n).remove(),(e=n(this,Yn))==null||e.destroy(),w(this,Yn,null)}};$n=new WeakMap,Yn=new WeakMap,js=new WeakMap,Vs=new WeakMap,Fc=new WeakMap,qn=new WeakMap,tl=new WeakMap,el=new WeakMap,Oc=new WeakMap,Lp=new WeakSet,$0=function(e){e.stopPropagation()},Fp=new WeakSet,Y0=function(e){n(this,js)._focusEventsAllowed=!1,ue(e)},Op=new WeakSet,q0=function(e){n(this,js)._focusEventsAllowed=!0,ue(e)},Kn=new WeakSet,Bo=function(e){const t=n(this,js)._uiManager._signal;return!(t instanceof AbortSignal)||t.aborted?!1:(e.addEventListener("focusin",E(this,Fp,Y0).bind(this),{capture:!0,signal:t}),e.addEventListener("focusout",E(this,Op,q0).bind(this),{capture:!0,signal:t}),e.addEventListener("contextmenu",ii,{signal:t}),!0)},sa=new WeakSet,oc=function(){const e=document.createElement("div");return e.className="divider",e},m(en,Lp),m(en,Oc,null);let ob=en;var Nc,ia,rn,Np,K0,Bp,Z0,Bc,lb;class XA{constructor(e){m(this,Np);m(this,Bp);m(this,Bc);m(this,Nc,null);m(this,ia,null);m(this,rn,void 0);w(this,rn,e)}show(e,t,s){const[i,r]=E(this,Bp,Z0).call(this,t,s),{style:a}=n(this,ia)||w(this,ia,E(this,Np,K0).call(this));e.append(n(this,ia)),a.insetInlineEnd=`${100*i}%`,a.top=`calc(${100*r}% + var(--editor-toolbar-vert-offset))`}hide(){n(this,ia).remove()}}Nc=new WeakMap,ia=new WeakMap,rn=new WeakMap,Np=new WeakSet,K0=function(){const e=w(this,ia,document.createElement("div"));e.className="editToolbar",e.setAttribute("role","toolbar");const t=n(this,rn)._signal;t instanceof AbortSignal&&!t.aborted&&e.addEventListener("contextmenu",ii,{signal:t});const s=w(this,Nc,document.createElement("div"));return s.className="buttons",e.append(s),n(this,rn).hasCommentManager()&&E(this,Bc,lb).call(this,"commentButton","pdfjs-comment-floating-button","pdfjs-comment-floating-button-label",()=>{n(this,rn).commentSelection("floating_button")}),E(this,Bc,lb).call(this,"highlightButton","pdfjs-highlight-floating-button1","pdfjs-highlight-floating-button-label",()=>{n(this,rn).highlightSelection("floating_button")}),e},Bp=new WeakSet,Z0=function(e,t){let s=0,i=0;for(const r of e){const a=r.y+r.height;if(a<s)continue;const o=r.x+(t?r.width:0);if(a>s){i=o,s=a;continue}t?o>i&&(i=o):o<i&&(i=o)}return[t?1-i:i,s]},Bc=new WeakSet,lb=function(e,t,s,i){const r=document.createElement("button");r.classList.add("basic",e),r.tabIndex=0,r.setAttribute("data-l10n-id",t);const a=document.createElement("span");r.append(a),a.className="visuallyHidden",a.setAttribute("data-l10n-id",s);const o=n(this,rn)._signal;o instanceof AbortSignal&&!o.aborted&&(r.addEventListener("contextmenu",ii,{signal:o}),r.addEventListener("click",i,{signal:o})),n(this,Nc).append(r)};function J0(p,e,t){for(const s of t)e.addEventListener(s,p[s].bind(p))}var na,ra,sl,aa;const Vt=class Vt{static initializeAndAddPointerId(e){(n(Vt,ra)||w(Vt,ra,new Set)).add(e)}static setPointer(e,t){n(Vt,na)||w(Vt,na,t),n(Vt,aa)??w(Vt,aa,e)}static setTimeStamp(e){w(Vt,sl,e)}static isSamePointerId(e){return n(Vt,na)===e}static isSamePointerIdOrRemove(e){var t;return n(Vt,na)===e?!0:((t=n(Vt,ra))==null||t.delete(e),!1)}static isSamePointerType(e){return n(Vt,aa)===e}static isInitializedAndDifferentPointerType(e){return n(Vt,aa)!==null&&!Vt.isSamePointerType(e)}static isSameTimeStamp(e){return n(Vt,sl)===e}static isUsingMultiplePointers(){var e;return((e=n(Vt,ra))==null?void 0:e.size)>=1}static clearPointerType(){w(Vt,aa,null)}static clearPointerIds(){w(Vt,na,NaN),w(Vt,ra,null)}static clearTimeStamp(){w(Vt,sl,NaN)}};na=new WeakMap,ra=new WeakMap,sl=new WeakMap,aa=new WeakMap,m(Vt,na,NaN),m(Vt,ra,null),m(Vt,sl,NaN),m(Vt,aa,null);let $e=Vt;var zp;class $A{constructor(){m(this,zp,0)}get id(){return`${kc}${Ae(this,zp)._++}`}}zp=new WeakMap;var il,zc,Ye,nl,zf;const Hy=class Hy{constructor(){m(this,nl);m(this,il,H0());m(this,zc,0);m(this,Ye,null)}static get _isSVGFittingCanvas(){const e='data:image/svg+xml;charset=UTF-8,<svg viewBox="0 0 1 1" width="1" height="1" xmlns="http://www.w3.org/2000/svg"><rect width="1" height="1" style="fill:red;"/></svg>',s=new OffscreenCanvas(1,3).getContext("2d",{willReadFrequently:!0}),i=new Image;i.src=e;const r=i.decode().then(()=>(s.drawImage(i,0,0,1,1,0,0,1,3),new Uint32Array(s.getImageData(0,0,1,1).data.buffer)[0]===0));return _t(this,"_isSVGFittingCanvas",r)}async getFromFile(e){const{lastModified:t,name:s,size:i,type:r}=e;return E(this,nl,zf).call(this,`${t}_${s}_${i}_${r}`,e)}async getFromUrl(e){return E(this,nl,zf).call(this,e,e)}async getFromBlob(e,t){const s=await t;return E(this,nl,zf).call(this,e,s)}async getFromId(e){n(this,Ye)||w(this,Ye,new Map);const t=n(this,Ye).get(e);if(!t)return null;if(t.bitmap)return t.refCounter+=1,t;if(t.file)return this.getFromFile(t.file);if(t.blobPromise){const{blobPromise:s}=t;return delete t.blobPromise,this.getFromBlob(t.id,s)}return this.getFromUrl(t.url)}getFromCanvas(e,t){n(this,Ye)||w(this,Ye,new Map);let s=n(this,Ye).get(e);if(s!=null&&s.bitmap)return s.refCounter+=1,s;const i=new OffscreenCanvas(t.width,t.height);return i.getContext("2d").drawImage(t,0,0),s={bitmap:i.transferToImageBitmap(),id:`image_${n(this,il)}_${Ae(this,zc)._++}`,refCounter:1,isSvg:!1},n(this,Ye).set(e,s),n(this,Ye).set(s.id,s),s}getSvgUrl(e){const t=n(this,Ye).get(e);return t!=null&&t.isSvg?t.svgUrl:null}deleteId(e){var i;n(this,Ye)||w(this,Ye,new Map);const t=n(this,Ye).get(e);if(!t||(t.refCounter-=1,t.refCounter!==0))return;const{bitmap:s}=t;if(!t.url&&!t.file){const r=new OffscreenCanvas(s.width,s.height);r.getContext("bitmaprenderer").transferFromImageBitmap(s),t.blobPromise=r.convertToBlob()}(i=s.close)==null||i.call(s),t.bitmap=null}isValidId(e){return e.startsWith(`image_${n(this,il)}_`)}};il=new WeakMap,zc=new WeakMap,Ye=new WeakMap,nl=new WeakSet,zf=async function(e,t){n(this,Ye)||w(this,Ye,new Map);let s=n(this,Ye).get(e);if(s===null)return null;if(s!=null&&s.bitmap)return s.refCounter+=1,s;try{s||(s={bitmap:null,id:`image_${n(this,il)}_${Ae(this,zc)._++}`,refCounter:0,isSvg:!1});let i;if(typeof t=="string"?(s.url=t,i=await vf(t,"blob")):t instanceof File?i=s.file=t:t instanceof Blob&&(i=t),i.type==="image/svg+xml"){const r=Hy._isSVGFittingCanvas,a=new FileReader,o=new Image,l=new Promise((h,c)=>{o.onload=()=>{s.bitmap=o,s.isSvg=!0,h()},a.onload=async()=>{const d=s.svgUrl=a.result;o.src=await r?`${d}#svgView(preserveAspectRatio(none))`:d},o.onerror=a.onerror=c});a.readAsDataURL(i),await l}else s.bitmap=await createImageBitmap(i);s.refCounter=1}catch(i){At(i),s=null}return n(this,Ye).set(e,s),s&&n(this,Ye).set(s.id,s),s};let hb=Hy;var fe,Zn,Uc,re;class YA{constructor(e=128){m(this,fe,[]);m(this,Zn,!1);m(this,Uc,void 0);m(this,re,-1);w(this,Uc,e)}add({cmd:e,undo:t,post:s,mustExec:i,type:r=NaN,overwriteIfSameType:a=!1,keepUndo:o=!1}){if(i&&e(),n(this,Zn))return;const l={cmd:e,undo:t,post:s,type:r};if(n(this,re)===-1){n(this,fe).length>0&&(n(this,fe).length=0),w(this,re,0),n(this,fe).push(l);return}if(a&&n(this,fe)[n(this,re)].type===r){o&&(l.undo=n(this,fe)[n(this,re)].undo),n(this,fe)[n(this,re)]=l;return}const h=n(this,re)+1;h===n(this,Uc)?n(this,fe).splice(0,1):(w(this,re,h),h<n(this,fe).length&&n(this,fe).splice(h)),n(this,fe).push(l)}undo(){if(n(this,re)===-1)return;w(this,Zn,!0);const{undo:e,post:t}=n(this,fe)[n(this,re)];e(),t==null||t(),w(this,Zn,!1),w(this,re,n(this,re)-1)}redo(){if(n(this,re)<n(this,fe).length-1){w(this,re,n(this,re)+1),w(this,Zn,!0);const{cmd:e,post:t}=n(this,fe)[n(this,re)];e(),t==null||t(),w(this,Zn,!1)}}hasSomethingToUndo(){return n(this,re)!==-1}hasSomethingToRedo(){return n(this,re)<n(this,fe).length-1}cleanType(e){if(n(this,re)!==-1){for(let t=n(this,re);t>=0;t--)if(n(this,fe)[t].type!==e){n(this,fe).splice(t+1,n(this,re)-t),w(this,re,t);return}n(this,fe).length=0,w(this,re,-1)}}destroy(){w(this,fe,null)}}fe=new WeakMap,Zn=new WeakMap,Uc=new WeakMap,re=new WeakMap;var Up,Q0;class Sf{constructor(e){m(this,Up);this.buffer=[],this.callbacks=new Map,this.allKeys=new Set;const{isMac:t}=Te.platform;for(const[s,i,r={}]of e)for(const a of s){const o=a.startsWith("mac+");t&&o?(this.callbacks.set(a.slice(4),{callback:i,options:r}),this.allKeys.add(a.split("+").at(-1))):!t&&!o&&(this.callbacks.set(a,{callback:i,options:r}),this.allKeys.add(a.split("+").at(-1)))}}exec(e,t){if(!this.allKeys.has(t.key))return;const s=this.callbacks.get(E(this,Up,Q0).call(this,t));if(!s)return;const{callback:i,options:{bubbles:r=!1,args:a=[],checker:o=null}}=s;o&&!o(e,t)||(i.bind(e,...a,t)(),r||ue(t))}}Up=new WeakSet,Q0=function(e){e.altKey&&this.buffer.push("alt"),e.ctrlKey&&this.buffer.push("ctrl"),e.metaKey&&this.buffer.push("meta"),e.shiftKey&&this.buffer.push("shift"),this.buffer.push(e.key);const t=this.buffer.join("+");return this.buffer.length=0,t};const Hp=class Hp{get _colors(){const e=new Map([["CanvasText",null],["Canvas",null]]);return HA(e),_t(this,"_colors",e)}convert(e){const t=_f(e);if(!window.matchMedia("(forced-colors: active)").matches)return t;for(const[s,i]of this._colors)if(i.every((r,a)=>r===t[a]))return Hp._colorsMapping.get(s);return t}getHexCode(e){const t=this._colors.get(e);return t?ct.makeHexColor(...t):e}};$(Hp,"_colorsMapping",new Map([["CanvasText",[0,0,0]],["Canvas",[255,255,255]]]));let cb=Hp;var rl,ys,al,ae,pe,ol,Ws,ll,Gs,qe,Jn,Qn,hl,tr,Ci,Xs,oa,Hc,jc,cl,Vc,xi,er,dl,sr,ki,jp,ir,ul,Wc,nr,la,fl,rr,Gc,we,Ut,an,ar,or,Xc,pl,$c,lr,Ti,on,Yc,qc,$s,gl,Uf,Kc,db,Vp,tw,Wp,ew,ha,lc,Gp,sw,Xp,iw,$p,nw,Zc,ub,Yp,rw,qp,aw,Kp,ow,Zp,lw,Ne,ts,oi,Qi,Jp,hw,Qp,cw,Jc,fb,tg,dw,ca,hc,Qc,pb;const $o=class $o{constructor(e,t,s,i,r,a,o,l,h,c,d,u,f,y,g,v){m(this,gl);m(this,Kc);m(this,Vp);m(this,Wp);m(this,ha);m(this,Gp);m(this,Xp);m(this,$p);m(this,Zc);m(this,Yp);m(this,qp);m(this,Kp);m(this,Zp);m(this,Ne);m(this,oi);m(this,Jp);m(this,Qp);m(this,Jc);m(this,tg);m(this,ca);m(this,Qc);m(this,rl,new AbortController);m(this,ys,null);m(this,al,null);m(this,ae,new Map);m(this,pe,new Map);m(this,ol,null);m(this,Ws,null);m(this,ll,null);m(this,Gs,new YA);m(this,qe,null);m(this,Jn,null);m(this,Qn,null);m(this,hl,0);m(this,tr,new Set);m(this,Ci,null);m(this,Xs,null);m(this,oa,new Set);$(this,"_editorUndoBar",null);m(this,Hc,!1);m(this,jc,!1);m(this,cl,!1);m(this,Vc,null);m(this,xi,null);m(this,er,null);m(this,dl,null);m(this,sr,!1);m(this,ki,null);m(this,jp,new $A);m(this,ir,!1);m(this,ul,!1);m(this,Wc,!1);m(this,nr,null);m(this,la,null);m(this,fl,null);m(this,rr,null);m(this,Gc,null);m(this,we,Et.NONE);m(this,Ut,new Set);m(this,an,null);m(this,ar,null);m(this,or,null);m(this,Xc,null);m(this,pl,null);m(this,$c,{isEditing:!1,isEmpty:!0,hasSomethingToUndo:!1,hasSomethingToRedo:!1,hasSelectedEditor:!1,hasSelectedText:!1});m(this,lr,[0,0]);m(this,Ti,null);m(this,on,null);m(this,Yc,null);m(this,qc,null);m(this,$s,null);const b=this._signal=n(this,rl).signal;w(this,on,e),w(this,Yc,t),w(this,qc,s),w(this,ol,i),w(this,qe,r),w(this,ar,a),w(this,pl,l),this._eventBus=o,o._on("editingaction",this.onEditingAction.bind(this),{signal:b}),o._on("pagechanging",this.onPageChanging.bind(this),{signal:b}),o._on("scalechanging",this.onScaleChanging.bind(this),{signal:b}),o._on("rotationchanging",this.onRotationChanging.bind(this),{signal:b}),o._on("setpreference",this.onSetPreference.bind(this),{signal:b}),o._on("switchannotationeditorparams",A=>this.updateParams(A.type,A.value),{signal:b}),o._on("pagesedited",this.onPagesEdited.bind(this),{signal:b}),window.addEventListener("pointerdown",()=>{w(this,ul,!0)},{capture:!0,signal:b}),window.addEventListener("pointerup",()=>{w(this,ul,!1)},{capture:!0,signal:b}),E(this,Gp,sw).call(this),E(this,Zp,lw).call(this),E(this,Zc,ub).call(this),w(this,Ws,l.annotationStorage),w(this,Vc,l.filterFactory),w(this,or,h),w(this,dl,c||null),w(this,Hc,d),w(this,jc,u),w(this,cl,f),w(this,Gc,y||null),this.viewParameters={realScale:$r.PDF_TO_CSS_UNITS,rotation:0},this.isShiftKeyDown=!1,this._editorUndoBar=g||null,this._supportsPinchToZoom=v!==!1,r==null||r.setSidebarUiManager(this)}static get _keyboardManager(){const e=$o.prototype,t=a=>n(a,on).contains(document.activeElement)&&document.activeElement.tagName!=="BUTTON"&&a.hasSomethingToControl(),s=(a,{target:o})=>{if(o instanceof HTMLInputElement){const{type:l}=o;return l!=="text"&&l!=="number"}return!0},i=this.TRANSLATE_SMALL,r=this.TRANSLATE_BIG;return _t(this,"_keyboardManager",new Sf([[["ctrl+a","mac+meta+a"],e.selectAll,{checker:s}],[["ctrl+z","mac+meta+z"],e.undo,{checker:s}],[["ctrl+y","ctrl+shift+z","mac+meta+shift+z","ctrl+shift+Z","mac+meta+shift+Z"],e.redo,{checker:s}],[["Backspace","alt+Backspace","ctrl+Backspace","shift+Backspace","mac+Backspace","mac+alt+Backspace","mac+ctrl+Backspace","Delete","ctrl+Delete","shift+Delete","mac+Delete"],e.delete,{checker:s}],[["Enter","mac+Enter"],e.addNewEditorFromKeyboard,{checker:(a,{target:o})=>!(o instanceof HTMLButtonElement)&&n(a,on).contains(o)&&!a.isEnterHandled}],[[" ","mac+ "],e.addNewEditorFromKeyboard,{checker:(a,{target:o})=>!(o instanceof HTMLButtonElement)&&n(a,on).contains(document.activeElement)}],[["Escape","mac+Escape"],e.unselectAll],[["ArrowLeft","mac+ArrowLeft"],e.translateSelectedEditors,{args:[-i,0],checker:t}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],e.translateSelectedEditors,{args:[-r,0],checker:t}],[["ArrowRight","mac+ArrowRight"],e.translateSelectedEditors,{args:[i,0],checker:t}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],e.translateSelectedEditors,{args:[r,0],checker:t}],[["ArrowUp","mac+ArrowUp"],e.translateSelectedEditors,{args:[0,-i],checker:t}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],e.translateSelectedEditors,{args:[0,-r],checker:t}],[["ArrowDown","mac+ArrowDown"],e.translateSelectedEditors,{args:[0,i],checker:t}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],e.translateSelectedEditors,{args:[0,r],checker:t}]]))}destroy(){var e,t,s,i,r,a,o,l,h;(e=n(this,$s))==null||e.resolve(),w(this,$s,null),(t=n(this,rl))==null||t.abort(),w(this,rl,null),this._signal=null;for(const c of n(this,pe).values())c.destroy();n(this,pe).clear(),n(this,ae).clear(),n(this,oa).clear(),(s=n(this,rr))==null||s.clear(),w(this,ys,null),n(this,Ut).clear(),n(this,Gs).destroy(),(i=n(this,ol))==null||i.destroy(),(r=n(this,qe))==null||r.destroy(),(a=n(this,ar))==null||a.destroy(),(o=n(this,ki))==null||o.hide(),w(this,ki,null),(l=n(this,fl))==null||l.destroy(),w(this,fl,null),w(this,al,null),n(this,xi)&&(clearTimeout(n(this,xi)),w(this,xi,null)),n(this,Ti)&&(clearTimeout(n(this,Ti)),w(this,Ti,null)),(h=this._editorUndoBar)==null||h.destroy(),w(this,pl,null)}combinedSignal(e){return AbortSignal.any([this._signal,e.signal])}get mlManager(){return n(this,Gc)}get useNewAltTextFlow(){return n(this,jc)}get useNewAltTextWhenAddingImage(){return n(this,cl)}get hcmFilter(){return _t(this,"hcmFilter",n(this,or)?n(this,Vc).addHCMFilter(n(this,or).foreground,n(this,or).background):"none")}get direction(){return _t(this,"direction",getComputedStyle(n(this,on)).direction)}get _highlightColors(){return _t(this,"_highlightColors",n(this,dl)?new Map(n(this,dl).split(",").map(e=>(e=e.split("=").map(t=>t.trim()),e[1]=e[1].toUpperCase(),e))):null)}get highlightColors(){const{_highlightColors:e}=this;if(!e)return _t(this,"highlightColors",null);const t=new Map,s=!!n(this,or);for(const[i,r]of e){const a=i.endsWith("_HCM");if(s&&a){t.set(i.replace("_HCM",""),r);continue}!s&&!a&&t.set(i,r)}return _t(this,"highlightColors",t)}get highlightColorNames(){return _t(this,"highlightColorNames",this.highlightColors?new Map(Array.from(this.highlightColors,e=>e.reverse())):null)}getNonHCMColor(e){if(!this._highlightColors)return e;const t=this.highlightColorNames.get(e);return this._highlightColors.get(t)||e}getNonHCMColorName(e){return this.highlightColorNames.get(e)||e}setCurrentDrawingSession(e){e?(this.unselectAll(),this.disableUserSelect(!0)):this.disableUserSelect(!1),w(this,Qn,e)}setMainHighlightColorPicker(e){w(this,fl,e)}editAltText(e,t=!1){var s;(s=n(this,ol))==null||s.editAltText(this,e,t)}hasCommentManager(){return!!n(this,qe)}editComment(e,t,s,i){var r;(r=n(this,qe))==null||r.showDialog(this,e,t,s,i)}selectComment(e,t){const s=n(this,pe).get(e),i=s==null?void 0:s.getEditorByUID(t);i==null||i.toggleComment(!0,!0)}updateComment(e){var t;(t=n(this,qe))==null||t.updateComment(e.getData())}updatePopupColor(e){var t;(t=n(this,qe))==null||t.updatePopupColor(e)}removeComment(e){var t;(t=n(this,qe))==null||t.removeComments([e.uid])}deleteComment(e,t){const s=()=>{e.comment=t},i=()=>{var r;(r=this._editorUndoBar)==null||r.show(s,"comment"),this.toggleComment(null),e.comment=null};this.addCommands({cmd:i,undo:s,mustExec:!0})}toggleComment(e,t,s=void 0){var i;(i=n(this,qe))==null||i.toggleCommentPopup(e,t,s)}makeCommentColor(e,t){var s;return e&&((s=n(this,qe))==null?void 0:s.makeCommentColor(e,t))||null}getCommentDialogElement(){var e;return((e=n(this,qe))==null?void 0:e.dialogElement)||null}async waitForEditorsRendered(e){if(n(this,pe).has(e-1))return;const{resolve:t,promise:s}=Promise.withResolvers(),i=r=>{r.pageNumber===e&&(this._eventBus._off("editorsrendered",i),t())};this._eventBus.on("editorsrendered",i),await s}getSignature(e){var t;(t=n(this,ar))==null||t.getSignature({uiManager:this,editor:e})}get signatureManager(){return n(this,ar)}switchToMode(e,t){this._eventBus.on("annotationeditormodechanged",t,{once:!0,signal:this._signal}),this._eventBus.dispatch("showannotationeditorui",{source:this,mode:e})}setPreference(e,t){this._eventBus.dispatch("setpreference",{source:this,name:e,value:t})}onSetPreference({name:e,value:t}){switch(e){case"enableNewAltTextWhenAddingImage":w(this,cl,t);break}}onPagesEdited({pagesMapper:e}){for(const i of n(this,ae).values())i.updatePageIndex(e.getPrevPageNumber(i.pageIndex+1)-1);const t=n(this,pe),s=w(this,pe,new Map);for(const[i,r]of t){const a=e.getPrevPageNumber(i+1)-1;if(a===-1){r.destroy();continue}s.set(a,r),r.updatePageIndex(a)}}onPageChanging({pageNumber:e}){w(this,hl,e-1)}focusMainContainer(){n(this,on).focus()}findParent(e,t){for(const s of n(this,pe).values()){const{x:i,y:r,width:a,height:o}=s.div.getBoundingClientRect();if(e>=i&&e<=i+a&&t>=r&&t<=r+o)return s}return null}disableUserSelect(e=!1){n(this,Yc).classList.toggle("noUserSelect",e)}addShouldRescale(e){n(this,oa).add(e)}removeShouldRescale(e){n(this,oa).delete(e)}onScaleChanging({scale:e}){var t;this.commitOrRemove(),this.viewParameters.realScale=e*$r.PDF_TO_CSS_UNITS;for(const s of n(this,oa))s.onScaleChanging();(t=n(this,Qn))==null||t.onScaleChanging()}onRotationChanging({pagesRotation:e}){this.commitOrRemove(),this.viewParameters.rotation=e}highlightSelection(e="",t=!1){const s=document.getSelection();if(!s||s.isCollapsed)return;const{anchorNode:i,anchorOffset:r,focusNode:a,focusOffset:o}=s,l=s.toString(),c=E(this,gl,Uf).call(this,s).closest(".textLayer"),d=this.getSelectionBoxes(c);if(!d)return;s.empty();const u=E(this,Kc,db).call(this,c),f=n(this,we)===Et.NONE,y=()=>{const g=u==null?void 0:u.createAndAddNewEditor({x:0,y:0},!1,{methodOfCreation:e,boxes:d,anchorNode:i,anchorOffset:r,focusNode:a,focusOffset:o,text:l});f&&this.showAllEditors("highlight",!0,!0),t&&(g==null||g.editComment())};if(f){this.switchToMode(Et.HIGHLIGHT,y);return}y()}commentSelection(e=""){this.highlightSelection(e,!0)}getAndRemoveDataFromAnnotationStorage(e){if(!n(this,Ws))return null;const t=`${kc}${e}`,s=n(this,Ws).getRawValue(t);return s&&n(this,Ws).remove(t),s}addToAnnotationStorage(e){!e.isEmpty()&&n(this,Ws)&&!n(this,Ws).has(e.id)&&n(this,Ws).setValue(e.id,e)}a11yAlert(e,t=null){const s=n(this,qc);s&&(s.setAttribute("data-l10n-id",e),t?s.setAttribute("data-l10n-args",JSON.stringify(t)):s.removeAttribute("data-l10n-args"))}blur(){if(this.isShiftKeyDown=!1,n(this,sr)&&(w(this,sr,!1),E(this,ha,lc).call(this,"main_toolbar")),!this.hasSelection)return;const{activeElement:e}=document;for(const t of n(this,Ut))if(t.div.contains(e)){w(this,la,[t,e]),t._focusEventsAllowed=!1;break}}focus(){if(!n(this,la))return;const[e,t]=n(this,la);w(this,la,null),t.addEventListener("focusin",()=>{e._focusEventsAllowed=!0},{once:!0,signal:this._signal}),t.focus()}addEditListeners(){E(this,Zc,ub).call(this),this.setEditingState(!0)}removeEditListeners(){E(this,Yp,rw).call(this),this.setEditingState(!1)}dragOver(e){for(const{type:t}of e.dataTransfer.items)for(const s of n(this,Xs))if(s.isHandlingMimeForPasting(t)){e.dataTransfer.dropEffect="copy",e.preventDefault();return}}drop(e){for(const t of e.dataTransfer.items)for(const s of n(this,Xs))if(s.isHandlingMimeForPasting(t.type)){s.paste(t,this.currentLayer),e.preventDefault();return}}copy(e){var s;if(e.preventDefault(),(s=n(this,ys))==null||s.commitOrRemove(),!this.hasSelection)return;const t=[];for(const i of n(this,Ut)){const r=i.serialize(!0);r&&t.push(r)}t.length!==0&&e.clipboardData.setData("application/pdfjs",JSON.stringify(t))}cut(e){this.copy(e),this.delete()}async paste(e){e.preventDefault();const{clipboardData:t}=e;for(const r of t.items)for(const a of n(this,Xs))if(a.isHandlingMimeForPasting(r.type)){a.paste(r,this.currentLayer);return}let s=t.getData("application/pdfjs");if(!s)return;try{s=JSON.parse(s)}catch(r){At(`paste: "${r.message}".`);return}if(!Array.isArray(s))return;this.unselectAll();const i=this.currentLayer;try{const r=[];for(const l of s){const h=await i.deserialize(l);if(!h)return;r.push(h)}const a=()=>{for(const l of r)E(this,Jc,fb).call(this,l);E(this,Qc,pb).call(this,r)},o=()=>{for(const l of r)l.remove()};this.addCommands({cmd:a,undo:o,mustExec:!0})}catch(r){At(`paste: "${r.message}".`)}}keydown(e){!this.isShiftKeyDown&&e.key==="Shift"&&(this.isShiftKeyDown=!0),n(this,we)!==Et.NONE&&!this.isEditorHandlingKeyboard&&$o._keyboardManager.exec(this,e)}keyup(e){this.isShiftKeyDown&&e.key==="Shift"&&(this.isShiftKeyDown=!1,n(this,sr)&&(w(this,sr,!1),E(this,ha,lc).call(this,"main_toolbar")))}onEditingAction({name:e}){switch(e){case"undo":case"redo":case"delete":case"selectAll":this[e]();break;case"highlightSelection":this.highlightSelection("context_menu");break;case"commentSelection":this.commentSelection("context_menu");break}}setEditingState(e){e?(E(this,Xp,iw).call(this),E(this,qp,aw).call(this),E(this,Ne,ts).call(this,{isEditing:n(this,we)!==Et.NONE,isEmpty:E(this,ca,hc).call(this),hasSomethingToUndo:n(this,Gs).hasSomethingToUndo(),hasSomethingToRedo:n(this,Gs).hasSomethingToRedo(),hasSelectedEditor:!1})):(E(this,$p,nw).call(this),E(this,Kp,ow).call(this),E(this,Ne,ts).call(this,{isEditing:!1}),this.disableUserSelect(!1))}registerEditorTypes(e){if(!n(this,Xs)){w(this,Xs,e);for(const t of n(this,Xs))E(this,oi,Qi).call(this,t.defaultPropertiesToUpdate)}}getId(){return n(this,jp).id}get currentLayer(){return n(this,pe).get(n(this,hl))}getLayer(e){return n(this,pe).get(e)}get currentPageIndex(){return n(this,hl)}addLayer(e){n(this,pe).set(e.pageIndex,e),n(this,ir)?e.enable():e.disable()}removeLayer(e){n(this,pe).delete(e.pageIndex)}async updateMode(e,t=null,s=!1,i=!1,r=!1,a=!1){var o,l,h,c,d,u;if(n(this,we)!==e&&!(n(this,$s)&&(await n(this,$s).promise,!n(this,$s)))){if(w(this,$s,Promise.withResolvers()),(o=n(this,Qn))==null||o.commitOrRemove(),n(this,we)===Et.POPUP&&((l=n(this,qe))==null||l.hideSidebar()),(h=n(this,qe))==null||h.destroyPopup(),w(this,we,e),e===Et.NONE){this.setEditingState(!1),E(this,Qp,cw).call(this);for(const f of n(this,ae).values())f.hideStandaloneCommentButton();(c=this._editorUndoBar)==null||c.hide(),this.toggleComment(null),n(this,$s).resolve();return}for(const f of n(this,ae).values())f.addStandaloneCommentButton();e===Et.SIGNATURE&&await((d=n(this,ar))==null?void 0:d.loadSignatures()),s&&$e.clearPointerType(),this.setEditingState(!0),await E(this,Jp,hw).call(this),this.unselectAll();for(const f of n(this,pe).values())f.updateMode(e);if(e===Et.POPUP){n(this,al)||w(this,al,await n(this,pl).getAnnotationsByType(new Set(n(this,Xs).map(g=>g._editorType))));const f=new Set,y=[];for(const g of n(this,ae).values()){const{annotationElementId:v,hasComment:b,deleted:A}=g;v&&f.add(v),b&&!A&&y.push(g.getData())}for(const g of n(this,al)){const{id:v,popupRef:b,contentsObj:A}=g;b&&(A!=null&&A.str)&&!f.has(v)&&!n(this,tr).has(v)&&y.push(g)}(u=n(this,qe))==null||u.showSidebar(y)}if(!t){i&&this.addNewEditorFromKeyboard(),n(this,$s).resolve();return}for(const f of n(this,ae).values())f.uid===t?(this.setSelected(f),a?f.editComment():r?f.enterInEditMode():f.focus()):f.unselect();n(this,$s).resolve()}}addNewEditorFromKeyboard(){this.currentLayer.canCreateNewEmptyEditor()&&this.currentLayer.addNewEditor()}updateToolbar(e){e.mode!==n(this,we)&&this._eventBus.dispatch("switchannotationeditormode",{source:this,...e})}updateParams(e,t){if(n(this,Xs)){switch(e){case Mt.CREATE:this.currentLayer.addNewEditor(t);return;case Mt.HIGHLIGHT_SHOW_ALL:this._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:{type:"highlight",action:"toggle_visibility"}}}),(n(this,Xc)||w(this,Xc,new Map)).set(e,t),this.showAllEditors("highlight",t);break}if(this.hasSelection)for(const s of n(this,Ut))s.updateParams(e,t);else for(const s of n(this,Xs))s.updateDefaultParams(e,t)}}showAllEditors(e,t,s=!1){var r;for(const a of n(this,ae).values())a.editorType===e&&a.show(t);(((r=n(this,Xc))==null?void 0:r.get(Mt.HIGHLIGHT_SHOW_ALL))??!0)!==t&&E(this,oi,Qi).call(this,[[Mt.HIGHLIGHT_SHOW_ALL,t]])}enableWaiting(e=!1){if(n(this,Wc)!==e){w(this,Wc,e);for(const t of n(this,pe).values())e?t.disableClick():t.enableClick(),t.div.classList.toggle("waiting",e)}}*getEditors(e){for(const t of n(this,ae).values())t.pageIndex===e&&(yield t)}getEditor(e){return n(this,ae).get(e)}addEditor(e){n(this,ae).set(e.id,e)}removeEditor(e){var t,s;e.div.contains(document.activeElement)&&(n(this,xi)&&clearTimeout(n(this,xi)),w(this,xi,setTimeout(()=>{this.focusMainContainer(),w(this,xi,null)},0))),n(this,ae).delete(e.id),e.annotationElementId&&((t=n(this,rr))==null||t.delete(e.annotationElementId)),this.unselect(e),(!e.annotationElementId||!n(this,tr).has(e.annotationElementId))&&((s=n(this,Ws))==null||s.remove(e.id))}addDeletedAnnotationElement(e){n(this,tr).add(e.annotationElementId),this.addChangedExistingAnnotation(e),e.deleted=!0}isDeletedAnnotationElement(e){return n(this,tr).has(e)}removeDeletedAnnotationElement(e){n(this,tr).delete(e.annotationElementId),this.removeChangedExistingAnnotation(e),e.deleted=!1}setActiveEditor(e){n(this,ys)!==e&&(w(this,ys,e),e&&E(this,oi,Qi).call(this,e.propertiesToUpdate))}updateUI(e){n(this,tg,dw)===e&&E(this,oi,Qi).call(this,e.propertiesToUpdate)}updateUIForDefaultProperties(e){E(this,oi,Qi).call(this,e.defaultPropertiesToUpdate)}toggleSelected(e){if(n(this,Ut).has(e)){n(this,Ut).delete(e),e.unselect(),E(this,Ne,ts).call(this,{hasSelectedEditor:this.hasSelection});return}n(this,Ut).add(e),e.select(),E(this,oi,Qi).call(this,e.propertiesToUpdate),E(this,Ne,ts).call(this,{hasSelectedEditor:!0})}setSelected(e){var t;this.updateToolbar({mode:e.mode,editId:e.uid}),(t=n(this,Qn))==null||t.commitOrRemove();for(const s of n(this,Ut))s!==e&&s.unselect();n(this,Ut).clear(),n(this,Ut).add(e),e.select(),E(this,oi,Qi).call(this,e.propertiesToUpdate),E(this,Ne,ts).call(this,{hasSelectedEditor:!0})}isSelected(e){return n(this,Ut).has(e)}get firstSelectedEditor(){return n(this,Ut).values().next().value}unselect(e){e.unselect(),n(this,Ut).delete(e),E(this,Ne,ts).call(this,{hasSelectedEditor:this.hasSelection})}get hasSelection(){return n(this,Ut).size!==0}get isEnterHandled(){return n(this,Ut).size===1&&this.firstSelectedEditor.isEnterHandled}undo(){var e;n(this,Gs).undo(),E(this,Ne,ts).call(this,{hasSomethingToUndo:n(this,Gs).hasSomethingToUndo(),hasSomethingToRedo:!0,isEmpty:E(this,ca,hc).call(this)}),(e=this._editorUndoBar)==null||e.hide()}redo(){n(this,Gs).redo(),E(this,Ne,ts).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:n(this,Gs).hasSomethingToRedo(),isEmpty:E(this,ca,hc).call(this)})}addCommands(e){n(this,Gs).add(e),E(this,Ne,ts).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:!1,isEmpty:E(this,ca,hc).call(this)})}cleanUndoStack(e){n(this,Gs).cleanType(e)}delete(){var r;this.commitOrRemove();const e=(r=this.currentLayer)==null?void 0:r.endDrawingSession(!0);if(!this.hasSelection&&!e)return;const t=e?[e]:[...n(this,Ut)],s=()=>{var a;(a=this._editorUndoBar)==null||a.show(i,t.length===1?t[0].editorType:t.length);for(const o of t)o.remove()},i=()=>{for(const a of t)E(this,Jc,fb).call(this,a)};this.addCommands({cmd:s,undo:i,mustExec:!0})}commitOrRemove(){var e;(e=n(this,ys))==null||e.commitOrRemove()}hasSomethingToControl(){return n(this,ys)||this.hasSelection}selectAll(){for(const e of n(this,Ut))e.commit();E(this,Qc,pb).call(this,n(this,ae).values())}unselectAll(){var e;if(!(n(this,ys)&&(n(this,ys).commitOrRemove(),n(this,we)!==Et.NONE))&&!((e=n(this,Qn))!=null&&e.commitOrRemove())&&this.hasSelection){for(const t of n(this,Ut))t.unselect();n(this,Ut).clear(),E(this,Ne,ts).call(this,{hasSelectedEditor:!1})}}translateSelectedEditors(e,t,s=!1){if(s||this.commitOrRemove(),!this.hasSelection)return;n(this,lr)[0]+=e,n(this,lr)[1]+=t;const[i,r]=n(this,lr),a=[...n(this,Ut)],o=1e3;n(this,Ti)&&clearTimeout(n(this,Ti)),w(this,Ti,setTimeout(()=>{w(this,Ti,null),n(this,lr)[0]=n(this,lr)[1]=0,this.addCommands({cmd:()=>{for(const l of a)n(this,ae).has(l.id)&&(l.translateInPage(i,r),l.translationDone())},undo:()=>{for(const l of a)n(this,ae).has(l.id)&&(l.translateInPage(-i,-r),l.translationDone())},mustExec:!1})},o));for(const l of a)l.translateInPage(e,t),l.translationDone()}setUpDragSession(){if(this.hasSelection){this.disableUserSelect(!0),w(this,Ci,new Map);for(const e of n(this,Ut))n(this,Ci).set(e,{savedX:e.x,savedY:e.y,savedPageIndex:e.pageIndex,newX:0,newY:0,newPageIndex:-1})}}endDragSession(){if(!n(this,Ci))return!1;this.disableUserSelect(!1);const e=n(this,Ci);w(this,Ci,null);let t=!1;for(const[{x:i,y:r,pageIndex:a},o]of e)o.newX=i,o.newY=r,o.newPageIndex=a,t||(t=i!==o.savedX||r!==o.savedY||a!==o.savedPageIndex);if(!t)return!1;const s=(i,r,a,o)=>{if(n(this,ae).has(i.id)){const l=n(this,pe).get(o);l?i._setParentAndPosition(l,r,a):(i.pageIndex=o,i.x=r,i.y=a)}};return this.addCommands({cmd:()=>{for(const[i,{newX:r,newY:a,newPageIndex:o}]of e)s(i,r,a,o)},undo:()=>{for(const[i,{savedX:r,savedY:a,savedPageIndex:o}]of e)s(i,r,a,o)},mustExec:!0}),!0}dragSelectedEditors(e,t){if(n(this,Ci))for(const s of n(this,Ci).keys())s.drag(e,t)}rebuild(e){if(e.parent===null){const t=this.getLayer(e.pageIndex);t?(t.changeParent(e),t.addOrRebuild(e)):(this.addEditor(e),this.addToAnnotationStorage(e),e.rebuild())}else e.parent.addOrRebuild(e)}get isEditorHandlingKeyboard(){var e;return((e=this.getActive())==null?void 0:e.shouldGetKeyboardEvents())||n(this,Ut).size===1&&this.firstSelectedEditor.shouldGetKeyboardEvents()}isActive(e){return n(this,ys)===e}getActive(){return n(this,ys)}getMode(){return n(this,we)}isEditingMode(){return n(this,we)!==Et.NONE}get imageManager(){return _t(this,"imageManager",new hb)}getSelectionBoxes(e){if(!e)return null;const t=document.getSelection();for(let h=0,c=t.rangeCount;h<c;h++)if(!e.contains(t.getRangeAt(h).commonAncestorContainer))return null;const{x:s,y:i,width:r,height:a}=e.getBoundingClientRect();let o;switch(e.getAttribute("data-main-rotation")){case"90":o=(h,c,d,u)=>({x:(c-i)/a,y:1-(h+d-s)/r,width:u/a,height:d/r});break;case"180":o=(h,c,d,u)=>({x:1-(h+d-s)/r,y:1-(c+u-i)/a,width:d/r,height:u/a});break;case"270":o=(h,c,d,u)=>({x:1-(c+u-i)/a,y:(h-s)/r,width:u/a,height:d/r});break;default:o=(h,c,d,u)=>({x:(h-s)/r,y:(c-i)/a,width:d/r,height:u/a});break}const l=[];for(let h=0,c=t.rangeCount;h<c;h++){const d=t.getRangeAt(h);if(!d.collapsed)for(const{x:u,y:f,width:y,height:g}of d.getClientRects())y===0||g===0||l.push(o(u,f,y,g))}return l.length===0?null:l}addChangedExistingAnnotation({annotationElementId:e,id:t}){(n(this,ll)||w(this,ll,new Map)).set(e,t)}removeChangedExistingAnnotation({annotationElementId:e}){var t;(t=n(this,ll))==null||t.delete(e)}renderAnnotationElement(e){var i;const t=(i=n(this,ll))==null?void 0:i.get(e.data.id);if(!t)return;const s=n(this,Ws).getRawValue(t);s&&(n(this,we)===Et.NONE&&!s.hasBeenModified||s.renderAnnotationElement(e))}setMissingCanvas(e,t,s){var r;const i=(r=n(this,rr))==null?void 0:r.get(e);i&&(i.setCanvas(t,s),n(this,rr).delete(e))}addMissingCanvas(e,t){(n(this,rr)||w(this,rr,new Map)).set(e,t)}};rl=new WeakMap,ys=new WeakMap,al=new WeakMap,ae=new WeakMap,pe=new WeakMap,ol=new WeakMap,Ws=new WeakMap,ll=new WeakMap,Gs=new WeakMap,qe=new WeakMap,Jn=new WeakMap,Qn=new WeakMap,hl=new WeakMap,tr=new WeakMap,Ci=new WeakMap,Xs=new WeakMap,oa=new WeakMap,Hc=new WeakMap,jc=new WeakMap,cl=new WeakMap,Vc=new WeakMap,xi=new WeakMap,er=new WeakMap,dl=new WeakMap,sr=new WeakMap,ki=new WeakMap,jp=new WeakMap,ir=new WeakMap,ul=new WeakMap,Wc=new WeakMap,nr=new WeakMap,la=new WeakMap,fl=new WeakMap,rr=new WeakMap,Gc=new WeakMap,we=new WeakMap,Ut=new WeakMap,an=new WeakMap,ar=new WeakMap,or=new WeakMap,Xc=new WeakMap,pl=new WeakMap,$c=new WeakMap,lr=new WeakMap,Ti=new WeakMap,on=new WeakMap,Yc=new WeakMap,qc=new WeakMap,$s=new WeakMap,gl=new WeakSet,Uf=function({anchorNode:e}){return e.nodeType===Node.TEXT_NODE?e.parentElement:e},Kc=new WeakSet,db=function(e){const{currentLayer:t}=this;if(t.hasTextLayer(e))return t;for(const s of n(this,pe).values())if(s.hasTextLayer(e))return s;return null},Vp=new WeakSet,tw=function(){const e=document.getSelection();if(!e||e.isCollapsed)return;const s=E(this,gl,Uf).call(this,e).closest(".textLayer"),i=this.getSelectionBoxes(s);i&&(n(this,ki)||w(this,ki,new XA(this)),n(this,ki).show(s,i,this.direction==="ltr"))},Wp=new WeakSet,ew=function(){var r,a,o;const e=document.getSelection();if(!e||e.isCollapsed){n(this,an)&&((r=n(this,ki))==null||r.hide(),w(this,an,null),E(this,Ne,ts).call(this,{hasSelectedText:!1}));return}const{anchorNode:t}=e;if(t===n(this,an))return;const i=E(this,gl,Uf).call(this,e).closest(".textLayer");if(!i){n(this,an)&&((a=n(this,ki))==null||a.hide(),w(this,an,null),E(this,Ne,ts).call(this,{hasSelectedText:!1}));return}if((o=n(this,ki))==null||o.hide(),w(this,an,t),E(this,Ne,ts).call(this,{hasSelectedText:!0}),!(n(this,we)!==Et.HIGHLIGHT&&n(this,we)!==Et.NONE)&&(n(this,we)===Et.HIGHLIGHT&&this.showAllEditors("highlight",!0,!0),w(this,sr,this.isShiftKeyDown),!this.isShiftKeyDown)){const l=n(this,we)===Et.HIGHLIGHT?E(this,Kc,db).call(this,i):null;if(l==null||l.toggleDrawing(),n(this,ul)){const h=new AbortController,c=this.combinedSignal(h),d=u=>{u.type==="pointerup"&&u.button!==0||(h.abort(),l==null||l.toggleDrawing(!0),u.type==="pointerup"&&E(this,ha,lc).call(this,"main_toolbar"))};window.addEventListener("pointerup",d,{signal:c}),window.addEventListener("blur",d,{signal:c})}else l==null||l.toggleDrawing(!0),E(this,ha,lc).call(this,"main_toolbar")}},ha=new WeakSet,lc=function(e=""){n(this,we)===Et.HIGHLIGHT?this.highlightSelection(e):n(this,Hc)&&E(this,Vp,tw).call(this)},Gp=new WeakSet,sw=function(){document.addEventListener("selectionchange",E(this,Wp,ew).bind(this),{signal:this._signal})},Xp=new WeakSet,iw=function(){if(n(this,er))return;w(this,er,new AbortController);const e=this.combinedSignal(n(this,er));window.addEventListener("focus",this.focus.bind(this),{signal:e}),window.addEventListener("blur",this.blur.bind(this),{signal:e})},$p=new WeakSet,nw=function(){var e;(e=n(this,er))==null||e.abort(),w(this,er,null)},Zc=new WeakSet,ub=function(){if(n(this,nr))return;w(this,nr,new AbortController);const e=this.combinedSignal(n(this,nr));window.addEventListener("keydown",this.keydown.bind(this),{signal:e}),window.addEventListener("keyup",this.keyup.bind(this),{signal:e})},Yp=new WeakSet,rw=function(){var e;(e=n(this,nr))==null||e.abort(),w(this,nr,null)},qp=new WeakSet,aw=function(){if(n(this,Jn))return;w(this,Jn,new AbortController);const e=this.combinedSignal(n(this,Jn));document.addEventListener("copy",this.copy.bind(this),{signal:e}),document.addEventListener("cut",this.cut.bind(this),{signal:e}),document.addEventListener("paste",this.paste.bind(this),{signal:e})},Kp=new WeakSet,ow=function(){var e;(e=n(this,Jn))==null||e.abort(),w(this,Jn,null)},Zp=new WeakSet,lw=function(){const e=this._signal;document.addEventListener("dragover",this.dragOver.bind(this),{signal:e}),document.addEventListener("drop",this.drop.bind(this),{signal:e})},Ne=new WeakSet,ts=function(e){Object.entries(e).some(([s,i])=>n(this,$c)[s]!==i)&&(this._eventBus.dispatch("annotationeditorstateschanged",{source:this,details:Object.assign(n(this,$c),e)}),n(this,we)===Et.HIGHLIGHT&&e.hasSelectedEditor===!1&&E(this,oi,Qi).call(this,[[Mt.HIGHLIGHT_FREE,!0]]))},oi=new WeakSet,Qi=function(e){this._eventBus.dispatch("annotationeditorparamschanged",{source:this,details:e})},Jp=new WeakSet,hw=async function(){if(!n(this,ir)){w(this,ir,!0);const e=[];for(const t of n(this,pe).values())e.push(t.enable());await Promise.all(e);for(const t of n(this,ae).values())t.enable()}},Qp=new WeakSet,cw=function(){if(this.unselectAll(),n(this,ir)){w(this,ir,!1);for(const e of n(this,pe).values())e.disable();for(const e of n(this,ae).values())e.disable()}},Jc=new WeakSet,fb=function(e){const t=n(this,pe).get(e.pageIndex);t?t.addOrRebuild(e):(this.addEditor(e),this.addToAnnotationStorage(e))},tg=new WeakSet,dw=function(){let e=null;for(e of n(this,Ut));return e},ca=new WeakSet,hc=function(){if(n(this,ae).size===0)return!0;if(n(this,ae).size===1)for(const e of n(this,ae).values())return e.isEmpty();return!1},Qc=new WeakSet,pb=function(e){for(const t of n(this,Ut))t.unselect();n(this,Ut).clear();for(const t of e)t.isEmpty()||(n(this,Ut).add(t),t.select());E(this,Ne,ts).call(this,{hasSelectedEditor:this.hasSelection})},$($o,"TRANSLATE_SMALL",1),$($o,"TRANSLATE_BIG",10);let Mo=$o;var Pe,Pi,li,ml,Di,ws,bl,Ii,ls,ln,da,Mi,hr,ua,cc,yl,Hf;const es=class es{constructor(e){m(this,ua);m(this,yl);m(this,Pe,null);m(this,Pi,!1);m(this,li,null);m(this,ml,null);m(this,Di,null);m(this,ws,null);m(this,bl,!1);m(this,Ii,null);m(this,ls,null);m(this,ln,null);m(this,da,null);m(this,Mi,!1);w(this,ls,e),w(this,Mi,e._uiManager.useNewAltTextFlow),n(es,hr)||w(es,hr,Object.freeze({added:"pdfjs-editor-new-alt-text-added-button","added-label":"pdfjs-editor-new-alt-text-added-button-label",missing:"pdfjs-editor-new-alt-text-missing-button","missing-label":"pdfjs-editor-new-alt-text-missing-button-label",review:"pdfjs-editor-new-alt-text-to-review-button","review-label":"pdfjs-editor-new-alt-text-to-review-button-label"}))}static initialize(e){es._l10n??(es._l10n=e)}async render(){const e=w(this,li,document.createElement("button"));e.className="altText",e.tabIndex="0";const t=w(this,ml,document.createElement("span"));e.append(t),n(this,Mi)?(e.classList.add("new"),e.setAttribute("data-l10n-id",n(es,hr).missing),t.setAttribute("data-l10n-id",n(es,hr)["missing-label"])):(e.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button"),t.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button-label"));const s=n(this,ls)._uiManager._signal;e.addEventListener("contextmenu",ii,{signal:s}),e.addEventListener("pointerdown",r=>r.stopPropagation(),{signal:s});const i=r=>{r.preventDefault(),n(this,ls)._uiManager.editAltText(n(this,ls)),n(this,Mi)&&n(this,ls)._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_clicked",data:{label:n(this,ua,cc)}})};return e.addEventListener("click",i,{capture:!0,signal:s}),e.addEventListener("keydown",r=>{r.target===e&&r.key==="Enter"&&(w(this,bl,!0),i(r))},{signal:s}),await E(this,yl,Hf).call(this),e}finish(){n(this,li)&&(n(this,li).focus({focusVisible:n(this,bl)}),w(this,bl,!1))}isEmpty(){return n(this,Mi)?n(this,Pe)===null:!n(this,Pe)&&!n(this,Pi)}hasData(){return n(this,Mi)?n(this,Pe)!==null||!!n(this,ln):this.isEmpty()}get guessedText(){return n(this,ln)}async setGuessedText(e){n(this,Pe)===null&&(w(this,ln,e),w(this,da,await es._l10n.get("pdfjs-editor-new-alt-text-generated-alt-text-with-disclaimer",{generatedAltText:e})),E(this,yl,Hf).call(this))}toggleAltTextBadge(e=!1){var t;if(!n(this,Mi)||n(this,Pe)){(t=n(this,Ii))==null||t.remove(),w(this,Ii,null);return}if(!n(this,Ii)){const s=w(this,Ii,document.createElement("div"));s.className="noAltTextBadge",n(this,ls).div.append(s)}n(this,Ii).classList.toggle("hidden",!e)}serialize(e){let t=n(this,Pe);return!e&&n(this,ln)===t&&(t=n(this,da)),{altText:t,decorative:n(this,Pi),guessedText:n(this,ln),textWithDisclaimer:n(this,da)}}get data(){return{altText:n(this,Pe),decorative:n(this,Pi)}}set data({altText:e,decorative:t,guessedText:s,textWithDisclaimer:i,cancel:r=!1}){s&&(w(this,ln,s),w(this,da,i)),!(n(this,Pe)===e&&n(this,Pi)===t)&&(r||(w(this,Pe,e),w(this,Pi,t)),E(this,yl,Hf).call(this))}toggle(e=!1){n(this,li)&&(!e&&n(this,ws)&&(clearTimeout(n(this,ws)),w(this,ws,null)),n(this,li).disabled=!e)}shown(){n(this,ls)._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_displayed",data:{label:n(this,ua,cc)}})}destroy(){var e,t;(e=n(this,li))==null||e.remove(),w(this,li,null),w(this,ml,null),w(this,Di,null),(t=n(this,Ii))==null||t.remove(),w(this,Ii,null)}};Pe=new WeakMap,Pi=new WeakMap,li=new WeakMap,ml=new WeakMap,Di=new WeakMap,ws=new WeakMap,bl=new WeakMap,Ii=new WeakMap,ls=new WeakMap,ln=new WeakMap,da=new WeakMap,Mi=new WeakMap,hr=new WeakMap,ua=new WeakSet,cc=function(){return n(this,Pe)&&"added"||n(this,Pe)===null&&this.guessedText&&"review"||"missing"},yl=new WeakSet,Hf=async function(){var i,r,a;const e=n(this,li);if(!e)return;if(n(this,Mi)){if(e.classList.toggle("done",!!n(this,Pe)),e.setAttribute("data-l10n-id",n(es,hr)[n(this,ua,cc)]),(i=n(this,ml))==null||i.setAttribute("data-l10n-id",n(es,hr)[`${n(this,ua,cc)}-label`]),!n(this,Pe)){(r=n(this,Di))==null||r.remove();return}}else{if(!n(this,Pe)&&!n(this,Pi)){e.classList.remove("done"),(a=n(this,Di))==null||a.remove();return}e.classList.add("done"),e.setAttribute("data-l10n-id","pdfjs-editor-alt-text-edit-button")}let t=n(this,Di);if(!t){w(this,Di,t=document.createElement("span")),t.className="tooltip",t.setAttribute("role","tooltip"),t.id=`alt-text-tooltip-${n(this,ls).id}`;const o=100,l=n(this,ls)._uiManager._signal;l.addEventListener("abort",()=>{clearTimeout(n(this,ws)),w(this,ws,null)},{once:!0}),e.addEventListener("mouseenter",()=>{w(this,ws,setTimeout(()=>{w(this,ws,null),n(this,Di).classList.add("show"),n(this,ls)._reportTelemetry({action:"alt_text_tooltip"})},o))},{signal:l}),e.addEventListener("mouseleave",()=>{var h;n(this,ws)&&(clearTimeout(n(this,ws)),w(this,ws,null)),(h=n(this,Di))==null||h.classList.remove("show")},{signal:l})}n(this,Pi)?t.setAttribute("data-l10n-id","pdfjs-editor-alt-text-decorative-tooltip"):(t.removeAttribute("data-l10n-id"),t.textContent=n(this,Pe)),t.parentNode||e.append(t);const s=n(this,ls).getElementForAltText();s==null||s.setAttribute("aria-describedby",t.id)},m(es,hr,null),$(es,"_l10n",null);let Ap=es;var Be,Ys,fa,Jt,td,cr,qs,dr,ur,pa,ed,gb;class kf{constructor(e){m(this,ed);m(this,Be,null);m(this,Ys,null);m(this,fa,!1);m(this,Jt,null);m(this,td,null);m(this,cr,null);m(this,qs,null);m(this,dr,null);m(this,ur,!1);m(this,pa,null);w(this,Jt,e)}renderForToolbar(){const e=w(this,Ys,document.createElement("button"));return e.className="comment",E(this,ed,gb).call(this,e,!1)}renderForStandalone(){const e=w(this,Be,document.createElement("button"));e.className="annotationCommentButton";const t=n(this,Jt).commentButtonPosition;if(t){const{style:s}=e;s.insetInlineEnd=`calc(${100*(n(this,Jt)._uiManager.direction==="ltr"?1-t[0]:t[0])}% - var(--comment-button-dim))`,s.top=`calc(${100*t[1]}% - var(--comment-button-dim))`;const i=n(this,Jt).commentButtonColor;i&&(s.backgroundColor=i)}return E(this,ed,gb).call(this,e,!0)}focusButton(){setTimeout(()=>{var e;(e=n(this,Be)??n(this,Ys))==null||e.focus()},0)}onUpdatedColor(){if(!n(this,Be))return;const e=n(this,Jt).commentButtonColor;e&&(n(this,Be).style.backgroundColor=e),n(this,Jt)._uiManager.updatePopupColor(n(this,Jt))}get commentButtonWidth(){var e;return(((e=n(this,Be))==null?void 0:e.getBoundingClientRect().width)??0)/n(this,Jt).parent.boundingClientRect.width}get commentPopupPositionInLayer(){if(n(this,pa))return n(this,pa);if(!n(this,Be))return null;const{x:e,y:t,height:s}=n(this,Be).getBoundingClientRect(),{x:i,y:r,width:a,height:o}=n(this,Jt).parent.boundingClientRect;return[(e-i)/a,(t+s-r)/o]}set commentPopupPositionInLayer(e){w(this,pa,e)}hasDefaultPopupPosition(){return n(this,pa)===null}removeStandaloneCommentButton(){var e;(e=n(this,Be))==null||e.remove(),w(this,Be,null)}removeToolbarCommentButton(){var e;(e=n(this,Ys))==null||e.remove(),w(this,Ys,null)}setCommentButtonStates({selected:e,hasPopup:t}){n(this,Be)&&(n(this,Be).classList.toggle("selected",e),n(this,Be).ariaExpanded=t)}edit(e){const t=this.commentPopupPositionInLayer;let s,i;if(t)[s,i]=t;else{[s,i]=n(this,Jt).commentButtonPosition;const{width:c,height:d,x:u,y:f}=n(this,Jt);s=u+s*c,i=f+i*d}const r=n(this,Jt).parent.boundingClientRect,{x:a,y:o,width:l,height:h}=r;n(this,Jt)._uiManager.editComment(n(this,Jt),a+s*l,o+i*h,{...e,parentDimensions:r})}finish(){n(this,Ys)&&(n(this,Ys).focus({focusVisible:n(this,fa)}),w(this,fa,!1))}isDeleted(){return n(this,ur)||n(this,qs)===""}isEmpty(){return n(this,qs)===null}hasBeenEdited(){return this.isDeleted()||n(this,qs)!==n(this,td)}serialize(){return this.data}get data(){return{text:n(this,qs),richText:n(this,cr),date:n(this,dr),deleted:this.isDeleted()}}set data(e){if(e!==n(this,qs)&&w(this,cr,null),e===null){w(this,qs,""),w(this,ur,!0);return}w(this,qs,e),w(this,dr,new Date),w(this,ur,!1)}restoreData({text:e,richText:t,date:s}){w(this,qs,e),w(this,cr,t),w(this,dr,s),w(this,ur,!1)}setInitialText(e,t=null){w(this,td,e),this.data=e,w(this,dr,null),w(this,cr,t)}shown(){}destroy(){var e,t;(e=n(this,Ys))==null||e.remove(),w(this,Ys,null),(t=n(this,Be))==null||t.remove(),w(this,Be,null),w(this,qs,""),w(this,cr,null),w(this,dr,null),w(this,Jt,null),w(this,fa,!1),w(this,ur,!1)}}Be=new WeakMap,Ys=new WeakMap,fa=new WeakMap,Jt=new WeakMap,td=new WeakMap,cr=new WeakMap,qs=new WeakMap,dr=new WeakMap,ur=new WeakMap,pa=new WeakMap,ed=new WeakSet,gb=function(e,t){if(!n(this,Jt)._uiManager.hasCommentManager())return null;e.tabIndex="0",e.ariaHasPopup="dialog",t?(e.ariaControls="commentPopup",e.setAttribute("data-l10n-id","pdfjs-show-comment-button")):(e.ariaControlsElements=[n(this,Jt)._uiManager.getCommentDialogElement()],e.setAttribute("data-l10n-id","pdfjs-editor-add-comment-button"));const s=n(this,Jt)._uiManager._signal;if(!(s instanceof AbortSignal)||s.aborted)return e;e.addEventListener("contextmenu",ii,{signal:s}),t&&(e.addEventListener("focusin",r=>{n(this,Jt)._focusEventsAllowed=!1,ue(r)},{capture:!0,signal:s}),e.addEventListener("focusout",r=>{n(this,Jt)._focusEventsAllowed=!0,ue(r)},{capture:!0,signal:s})),e.addEventListener("pointerdown",r=>r.stopPropagation(),{signal:s});const i=r=>{r.preventDefault(),e===n(this,Ys)?this.edit():n(this,Jt).toggleComment(!0)};return e.addEventListener("click",i,{capture:!0,signal:s}),e.addEventListener("keydown",r=>{r.target===e&&r.key==="Enter"&&(w(this,fa,!0),i(r))},{signal:s}),e.addEventListener("pointerenter",()=>{n(this,Jt).toggleComment(!1,!0)},{signal:s}),e.addEventListener("pointerleave",()=>{n(this,Jt).toggleComment(!1,!1)},{signal:s}),e};var wl,ga,sd,id,nd,rd,ad,hn,ma,cn,ba,dn,eg,uw,sg,fw,ig,pw;const jy=class jy{constructor({container:e,isPinchingDisabled:t=null,isPinchingStopped:s=null,onPinchStart:i=null,onPinching:r=null,onPinchEnd:a=null,signal:o}){m(this,eg);m(this,sg);m(this,ig);m(this,wl,void 0);m(this,ga,!1);m(this,sd,null);m(this,id,void 0);m(this,nd,void 0);m(this,rd,void 0);m(this,ad,void 0);m(this,hn,null);m(this,ma,void 0);m(this,cn,null);m(this,ba,void 0);m(this,dn,null);w(this,wl,e),w(this,sd,s),w(this,id,t),w(this,nd,i),w(this,rd,r),w(this,ad,a),w(this,ba,new AbortController),w(this,ma,AbortSignal.any([o,n(this,ba).signal])),e.addEventListener("touchstart",E(this,eg,uw).bind(this),{passive:!1,signal:n(this,ma)})}get MIN_TOUCH_DISTANCE_TO_PINCH(){return 35/Ki.pixelRatio}destroy(){var e,t;(e=n(this,ba))==null||e.abort(),w(this,ba,null),(t=n(this,hn))==null||t.abort(),w(this,hn,null)}};wl=new WeakMap,ga=new WeakMap,sd=new WeakMap,id=new WeakMap,nd=new WeakMap,rd=new WeakMap,ad=new WeakMap,hn=new WeakMap,ma=new WeakMap,cn=new WeakMap,ba=new WeakMap,dn=new WeakMap,eg=new WeakSet,uw=function(e){var i,r,a;if((i=n(this,id))!=null&&i.call(this))return;if(e.touches.length===1){if(n(this,hn))return;const o=w(this,hn,new AbortController),l=AbortSignal.any([n(this,ma),o.signal]),h=n(this,wl),c={capture:!0,signal:l,passive:!1},d=u=>{var f;u.pointerType==="touch"&&((f=n(this,hn))==null||f.abort(),w(this,hn,null))};h.addEventListener("pointerdown",u=>{u.pointerType==="touch"&&(ue(u),d(u))},c),h.addEventListener("pointerup",d,c),h.addEventListener("pointercancel",d,c);return}if(!n(this,dn)){w(this,dn,new AbortController);const o=AbortSignal.any([n(this,ma),n(this,dn).signal]),l=n(this,wl),h={signal:o,capture:!1,passive:!1};l.addEventListener("touchmove",E(this,sg,fw).bind(this),h);const c=E(this,ig,pw).bind(this);l.addEventListener("touchend",c,h),l.addEventListener("touchcancel",c,h),h.capture=!0,l.addEventListener("pointerdown",ue,h),l.addEventListener("pointermove",ue,h),l.addEventListener("pointercancel",ue,h),l.addEventListener("pointerup",ue,h),(r=n(this,nd))==null||r.call(this)}if(ue(e),e.touches.length!==2||(a=n(this,sd))!=null&&a.call(this)){w(this,cn,null);return}let[t,s]=e.touches;t.identifier>s.identifier&&([t,s]=[s,t]),w(this,cn,{touch0X:t.screenX,touch0Y:t.screenY,touch1X:s.screenX,touch1Y:s.screenY})},sg=new WeakSet,fw=function(e){var x;if(!n(this,cn)||e.touches.length!==2)return;ue(e);let[t,s]=e.touches;t.identifier>s.identifier&&([t,s]=[s,t]);const{screenX:i,screenY:r}=t,{screenX:a,screenY:o}=s,l=n(this,cn),{touch0X:h,touch0Y:c,touch1X:d,touch1Y:u}=l,f=d-h,y=u-c,g=a-i,v=o-r,b=Math.hypot(g,v)||1,A=Math.hypot(f,y)||1;if(!n(this,ga)&&Math.abs(A-b)<=jy.MIN_TOUCH_DISTANCE_TO_PINCH)return;if(l.touch0X=i,l.touch0Y=r,l.touch1X=a,l.touch1Y=o,!n(this,ga)){w(this,ga,!0);return}const _=[(i+a)/2,(r+o)/2];(x=n(this,rd))==null||x.call(this,_,A,b)},ig=new WeakSet,pw=function(e){var t;e.touches.length>=2||(n(this,dn)&&(n(this,dn).abort(),w(this,dn,null),(t=n(this,ad))==null||t.call(this)),n(this,cn)&&(ue(e),w(this,cn,null),w(this,ga,!1)))};let _p=jy;var ya,hi,se,Ht,un,vl,fr,od,ze,wa,fn,Ks,pr,ld,va,vs,hd,Aa,pn,Ri,Al,_l,Zs,_a,cd,ng,dd,mb,ud,bb,Sl,jf,rg,gw,ag,mw,fd,yb,El,Vf,pd,wb,og,bw,lg,yw,hg,ww,gd,vb,cg,vw,md,Ab,dg,Aw,ug,_w,fg,Sw,bd,_b,Sa,dc;const St=class St{constructor(e){m(this,dd);m(this,Sl);m(this,rg);m(this,ag);m(this,fd);m(this,El);m(this,pd);m(this,og);m(this,lg);m(this,hg);m(this,gd);m(this,cg);m(this,md);m(this,dg);m(this,ug);m(this,fg);m(this,bd);m(this,Sa);m(this,ya,null);m(this,hi,null);m(this,se,null);m(this,Ht,null);m(this,un,null);m(this,vl,!1);m(this,fr,null);m(this,od,"");m(this,ze,null);m(this,wa,null);m(this,fn,null);m(this,Ks,null);m(this,pr,null);m(this,ld,"");m(this,va,!1);m(this,vs,null);m(this,hd,!1);m(this,Aa,!1);m(this,pn,!1);m(this,Ri,null);m(this,Al,0);m(this,_l,0);m(this,Zs,null);m(this,_a,null);$(this,"isSelected",!1);$(this,"_isCopy",!1);$(this,"_editToolbar",null);$(this,"_initialOptions",Object.create(null));$(this,"_initialData",null);$(this,"_isVisible",!0);$(this,"_uiManager",null);$(this,"_focusEventsAllowed",!0);m(this,cd,!1);m(this,ng,St._zIndex++);this.parent=e.parent,this.id=e.id,this.width=this.height=null,this.pageIndex=e.parent.pageIndex,this.name=e.name,this.div=null,this._uiManager=e.uiManager,this.annotationElementId=null,this._willKeepAspectRatio=!1,this._initialOptions.isCentered=e.isCentered,this._structTreeParentId=null,this.annotationElementId=e.annotationElementId||null,this.creationDate=e.creationDate||new Date,this.modificationDate=e.modificationDate||null,this.canAddComment=!0;const{rotation:t,rawDims:{pageWidth:s,pageHeight:i,pageX:r,pageY:a}}=this.parent.viewport;this.rotation=t,this.pageRotation=(360+t-this._uiManager.viewParameters.rotation)%360,this.pageDimensions=[s,i],this.pageTranslation=[r,a];const[o,l]=this.parentDimensions;this.x=e.x/o,this.y=e.y/l,this.isAttachedToDOM=!1,this.deleted=!1}static get _resizerKeyboardManager(){const e=St.prototype._resizeWithKeyboard,t=Mo.TRANSLATE_SMALL,s=Mo.TRANSLATE_BIG;return _t(this,"_resizerKeyboardManager",new Sf([[["ArrowLeft","mac+ArrowLeft"],e,{args:[-t,0]}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],e,{args:[-s,0]}],[["ArrowRight","mac+ArrowRight"],e,{args:[t,0]}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],e,{args:[s,0]}],[["ArrowUp","mac+ArrowUp"],e,{args:[0,-t]}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],e,{args:[0,-s]}],[["ArrowDown","mac+ArrowDown"],e,{args:[0,t]}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],e,{args:[0,s]}],[["Escape","mac+Escape"],St.prototype._stopResizingWithKeyboard]]))}updatePageIndex(e){this.pageIndex=e}get editorType(){return Object.getPrototypeOf(this).constructor._type}get mode(){return Object.getPrototypeOf(this).constructor._editorType}static get isDrawer(){return!1}static get _defaultLineColor(){return _t(this,"_defaultLineColor",this._colorManager.getHexCode("CanvasText"))}static deleteAnnotationElement(e){const t=new qA({id:e.parent.getNextId(),parent:e.parent,uiManager:e._uiManager});t.annotationElementId=e.annotationElementId,t.deleted=!0,t._uiManager.addToAnnotationStorage(t)}static initialize(e,t){if(St._l10n??(St._l10n=e),St._l10nResizer||(St._l10nResizer=Object.freeze({topLeft:"pdfjs-editor-resizer-top-left",topMiddle:"pdfjs-editor-resizer-top-middle",topRight:"pdfjs-editor-resizer-top-right",middleRight:"pdfjs-editor-resizer-middle-right",bottomRight:"pdfjs-editor-resizer-bottom-right",bottomMiddle:"pdfjs-editor-resizer-bottom-middle",bottomLeft:"pdfjs-editor-resizer-bottom-left",middleLeft:"pdfjs-editor-resizer-middle-left"})),St._borderLineWidth!==-1)return;const s=getComputedStyle(document.documentElement);St._borderLineWidth=parseFloat(s.getPropertyValue("--outline-width"))||0}static updateDefaultParams(e,t){}static get defaultPropertiesToUpdate(){return[]}static isHandlingMimeForPasting(e){return!1}static paste(e,t){zt("Not implemented")}get propertiesToUpdate(){return[]}get _isDraggable(){return n(this,cd)}set _isDraggable(e){var t;w(this,cd,e),(t=this.div)==null||t.classList.toggle("draggable",e)}get uid(){return this.annotationElementId||this.id}get isEnterHandled(){return!0}center(){const[e,t]=this.pageDimensions;switch(this.parentRotation){case 90:this.x-=this.height*t/(e*2),this.y+=this.width*e/(t*2);break;case 180:this.x+=this.width/2,this.y+=this.height/2;break;case 270:this.x+=this.height*t/(e*2),this.y-=this.width*e/(t*2);break;default:this.x-=this.width/2,this.y-=this.height/2;break}this.fixAndSetPosition()}addCommands(e){this._uiManager.addCommands(e)}get currentLayer(){return this._uiManager.currentLayer}setInBackground(){this.div.style.zIndex=0}setInForeground(){this.div.style.zIndex=n(this,ng)}setParent(e){var t;e!==null?(this.pageIndex=e.pageIndex,this.pageDimensions=e.pageDimensions):(E(this,Sa,dc).call(this),(t=n(this,Ks))==null||t.remove(),w(this,Ks,null)),this.parent=e}focusin(e){this._focusEventsAllowed&&(n(this,va)?w(this,va,!1):this.parent.setSelected(this))}focusout(e){var s;if(!this._focusEventsAllowed||!this.isAttachedToDOM)return;const t=e.relatedTarget;t!=null&&t.closest(`#${this.id}`)||(e.preventDefault(),(s=this.parent)!=null&&s.isMultipleSelection||this.commitOrRemove())}commitOrRemove(){this.isEmpty()?this.remove():this.commit()}commit(){this.isInEditMode()&&this.addToAnnotationStorage()}addToAnnotationStorage(){this._uiManager.addToAnnotationStorage(this)}setAt(e,t,s,i){const[r,a]=this.parentDimensions;[s,i]=this.screenToPageTranslation(s,i),this.x=(e+s)/r,this.y=(t+i)/a,this.fixAndSetPosition()}_moveAfterPaste(e,t){const[s,i]=this.parentDimensions;this.setAt(e*s,t*i,this.width*s,this.height*i),this._onTranslated()}translate(e,t){E(this,dd,mb).call(this,this.parentDimensions,e,t)}translateInPage(e,t){n(this,vs)||w(this,vs,[this.x,this.y,this.width,this.height]),E(this,dd,mb).call(this,this.pageDimensions,e,t),this.div.scrollIntoView({block:"nearest"})}translationDone(){this._onTranslated(this.x,this.y)}drag(e,t){n(this,vs)||w(this,vs,[this.x,this.y,this.width,this.height]);const{div:s,parentDimensions:[i,r]}=this;if(this.x+=e/i,this.y+=t/r,this.parent&&(this.x<0||this.x>1||this.y<0||this.y>1)){const{x:d,y:u}=this.div.getBoundingClientRect();this.parent.findNewParent(this,d,u)&&(this.x-=Math.floor(this.x),this.y-=Math.floor(this.y))}let{x:a,y:o}=this;const[l,h]=this.getBaseTranslation();a+=l,o+=h;const{style:c}=s;c.left=`${(100*a).toFixed(2)}%`,c.top=`${(100*o).toFixed(2)}%`,this._onTranslating(a,o),s.scrollIntoView({block:"nearest"})}_onTranslating(e,t){}_onTranslated(e,t){}get _hasBeenMoved(){return!!n(this,vs)&&(n(this,vs)[0]!==this.x||n(this,vs)[1]!==this.y)}get _hasBeenResized(){return!!n(this,vs)&&(n(this,vs)[2]!==this.width||n(this,vs)[3]!==this.height)}getBaseTranslation(){const[e,t]=this.parentDimensions,{_borderLineWidth:s}=St,i=s/e,r=s/t;switch(this.rotation){case 90:return[-i,r];case 180:return[i,r];case 270:return[i,-r];default:return[-i,-r]}}get _mustFixPosition(){return!0}fixAndSetPosition(e=this.rotation){const{div:{style:t},pageDimensions:[s,i]}=this;let{x:r,y:a,width:o,height:l}=this;if(o*=s,l*=i,r*=s,a*=i,this._mustFixPosition)switch(e){case 0:r=Ve(r,0,s-o),a=Ve(a,0,i-l);break;case 90:r=Ve(r,0,s-l),a=Ve(a,o,i);break;case 180:r=Ve(r,o,s),a=Ve(a,l,i);break;case 270:r=Ve(r,l,s),a=Ve(a,0,i-o);break}this.x=r/=s,this.y=a/=i;const[h,c]=this.getBaseTranslation();r+=h,a+=c,t.left=`${(100*r).toFixed(2)}%`,t.top=`${(100*a).toFixed(2)}%`,this.moveInDOM()}screenToPageTranslation(e,t){var s;return E(s=St,ud,bb).call(s,e,t,this.parentRotation)}pageTranslationToScreen(e,t){var s;return E(s=St,ud,bb).call(s,e,t,360-this.parentRotation)}get parentScale(){return this._uiManager.viewParameters.realScale}get parentRotation(){return(this._uiManager.viewParameters.rotation+this.pageRotation)%360}get parentDimensions(){const{parentScale:e,pageDimensions:[t,s]}=this;return[t*e,s*e]}setDims(){const{div:{style:e},width:t,height:s}=this;e.width=`${(100*t).toFixed(2)}%`,e.height=`${(100*s).toFixed(2)}%`}getInitialTranslation(){return[0,0]}_onResized(){}static _round(e){return Math.round(e*1e4)/1e4}_onResizing(){}altTextFinish(){var e;(e=n(this,se))==null||e.finish()}get toolbarButtons(){return null}async addEditToolbar(){if(this._editToolbar||n(this,Aa))return this._editToolbar;this._editToolbar=new ob(this),this.div.append(this._editToolbar.render());const{toolbarButtons:e}=this;if(e)for(const[t,s]of e)await this._editToolbar.addButton(t,s);return this.hasComment||this._editToolbar.addButton("comment",this.addCommentButton()),this._editToolbar.addButton("delete"),this._editToolbar}addCommentButtonInToolbar(){var e;(e=this._editToolbar)==null||e.addButtonBefore("comment",this.addCommentButton(),".deleteButton")}removeCommentButtonFromToolbar(){var e;(e=this._editToolbar)==null||e.removeButton("comment")}removeEditToolbar(){var e,t;(e=this._editToolbar)==null||e.remove(),this._editToolbar=null,(t=n(this,se))==null||t.destroy()}addContainer(e){var s;const t=(s=this._editToolbar)==null?void 0:s.div;t?t.before(e):this.div.append(e)}getClientDimensions(){return this.div.getBoundingClientRect()}createAltText(){return n(this,se)||(Ap.initialize(St._l10n),w(this,se,new Ap(this)),n(this,ya)&&(n(this,se).data=n(this,ya),w(this,ya,null))),n(this,se)}get altTextData(){var e;return(e=n(this,se))==null?void 0:e.data}set altTextData(e){n(this,se)&&(n(this,se).data=e)}get guessedAltText(){var e;return(e=n(this,se))==null?void 0:e.guessedText}async setGuessedAltText(e){var t;await((t=n(this,se))==null?void 0:t.setGuessedText(e))}serializeAltText(e){var t;return(t=n(this,se))==null?void 0:t.serialize(e)}hasAltText(){return!!n(this,se)&&!n(this,se).isEmpty()}hasAltTextData(){var e;return((e=n(this,se))==null?void 0:e.hasData())??!1}focusCommentButton(){var e;(e=n(this,Ht))==null||e.focusButton()}addCommentButton(){return this.canAddComment?n(this,Ht)||w(this,Ht,new kf(this)):null}addStandaloneCommentButton(){if(this._uiManager.hasCommentManager()){if(n(this,un)){this._uiManager.isEditingMode()&&n(this,un).classList.remove("hidden");return}this.hasComment&&(w(this,un,n(this,Ht).renderForStandalone()),this.div.append(n(this,un)))}}removeStandaloneCommentButton(){n(this,Ht).removeStandaloneCommentButton(),w(this,un,null)}hideStandaloneCommentButton(){var e;(e=n(this,un))==null||e.classList.add("hidden")}get comment(){if(!n(this,Ht))return null;const{data:{richText:e,text:t,date:s,deleted:i}}=n(this,Ht);return{text:t,richText:e,date:s,deleted:i,color:this.getNonHCMColor(),opacity:this.opacity??1}}set comment(e){n(this,Ht)||w(this,Ht,new kf(this)),typeof e=="object"&&e!==null?n(this,Ht).restoreData(e):n(this,Ht).data=e,this.hasComment?(this.removeCommentButtonFromToolbar(),this.addStandaloneCommentButton(),this._uiManager.updateComment(this)):(this.addCommentButtonInToolbar(),this.removeStandaloneCommentButton(),this._uiManager.removeComment(this))}setCommentData({comment:e,popupRef:t,richText:s}){if(!t||(n(this,Ht)||w(this,Ht,new kf(this)),n(this,Ht).setInitialText(e,s),!this.annotationElementId))return;const i=this._uiManager.getAndRemoveDataFromAnnotationStorage(this.annotationElementId);i&&this.updateFromAnnotationLayer(i)}get hasEditedComment(){var e;return(e=n(this,Ht))==null?void 0:e.hasBeenEdited()}get hasDeletedComment(){var e;return(e=n(this,Ht))==null?void 0:e.isDeleted()}get hasComment(){return!!n(this,Ht)&&!n(this,Ht).isEmpty()&&!n(this,Ht).isDeleted()}async editComment(e){n(this,Ht)||w(this,Ht,new kf(this)),n(this,Ht).edit(e)}toggleComment(e,t=void 0){this.hasComment&&this._uiManager.toggleComment(this,e,t)}setSelectedCommentButton(e){n(this,Ht).setSelectedButton(e)}addComment(e){if(this.hasEditedComment){const[,,,i]=e.rect,[r]=this.pageDimensions,[a]=this.pageTranslation,o=a+r+1,l=i-100,h=o+180;e.popup={contents:this.comment.text,deleted:this.comment.deleted,rect:[o,l,h,i]}}}updateFromAnnotationLayer({popup:{contents:e,deleted:t}}){n(this,Ht).data=t?null:e}get parentBoundingClientRect(){return this.parent.boundingClientRect}render(){var a;const e=this.div=document.createElement("div");e.setAttribute("data-editor-rotation",(360-this.rotation)%360),e.className=this.name,e.setAttribute("id",this.id),e.tabIndex=n(this,vl)?-1:0,e.setAttribute("role","application"),this.defaultL10nId&&e.setAttribute("data-l10n-id",this.defaultL10nId),this._isVisible||e.classList.add("hidden"),this.setInForeground(),E(this,md,Ab).call(this);const[t,s]=this.parentDimensions;this.parentRotation%180!==0&&(e.style.maxWidth=`${(100*s/t).toFixed(2)}%`,e.style.maxHeight=`${(100*t/s).toFixed(2)}%`);const[i,r]=this.getInitialTranslation();return this.translate(i,r),J0(this,e,["keydown","pointerdown","dblclick"]),this.isResizable&&this._uiManager._supportsPinchToZoom&&(n(this,_a)||w(this,_a,new _p({container:e,isPinchingDisabled:()=>!this.isSelected,onPinchStart:E(this,og,bw).bind(this),onPinching:E(this,lg,yw).bind(this),onPinchEnd:E(this,hg,ww).bind(this),signal:this._uiManager._signal}))),this.addStandaloneCommentButton(),(a=this._uiManager._editorUndoBar)==null||a.hide(),e}pointerdown(e){const{isMac:t}=Te.platform;if(e.button!==0||e.ctrlKey&&t){e.preventDefault();return}if(w(this,va,!0),this._isDraggable){E(this,cg,vw).call(this,e);return}E(this,gd,vb).call(this,e)}_onStartDragging(){}_onStopDragging(){}moveInDOM(){n(this,Ri)&&clearTimeout(n(this,Ri)),w(this,Ri,setTimeout(()=>{var e;w(this,Ri,null),(e=this.parent)==null||e.moveEditorInDOM(this)},0))}_setParentAndPosition(e,t,s){e.changeParent(this),this.x=t,this.y=s,this.fixAndSetPosition(),this._onTranslated()}getRect(e,t,s=this.rotation){const i=this.parentScale,[r,a]=this.pageDimensions,[o,l]=this.pageTranslation,h=e/i,c=t/i,d=this.x*r,u=this.y*a,f=this.width*r,y=this.height*a;switch(s){case 0:return[d+h+o,a-u-c-y+l,d+h+f+o,a-u-c+l];case 90:return[d+c+o,a-u+h+l,d+c+y+o,a-u+h+f+l];case 180:return[d-h-f+o,a-u+c+l,d-h+o,a-u+c+y+l];case 270:return[d-c-y+o,a-u-h-f+l,d-c+o,a-u-h+l];default:throw new Error("Invalid rotation")}}getRectInCurrentCoords(e,t){const[s,i,r,a]=e,o=r-s,l=a-i;switch(this.rotation){case 0:return[s,t-a,o,l];case 90:return[s,t-i,l,o];case 180:return[r,t-i,o,l];case 270:return[r,t-a,l,o];default:throw new Error("Invalid rotation")}}getPDFRect(){return this.getRect(0,0)}getNonHCMColor(){return this.color&&St._colorManager.convert(this._uiManager.getNonHCMColor(this.color))}onUpdatedColor(){var e;(e=n(this,Ht))==null||e.onUpdatedColor()}getData(){const{comment:{text:e,color:t,date:s,opacity:i,deleted:r,richText:a},uid:o,pageIndex:l,creationDate:h,modificationDate:c}=this;return{id:o,pageIndex:l,rect:this.getPDFRect(),richText:a,contentsObj:{str:e},creationDate:h,modificationDate:s||c,popupRef:!r,color:t,opacity:i}}onceAdded(e){}isEmpty(){return!1}enableEditMode(){return this.isInEditMode()?!1:(this.parent.setEditingState(!1),w(this,Aa,!0),!0)}disableEditMode(){return this.isInEditMode()?(this.parent.setEditingState(!0),w(this,Aa,!1),!0):!1}isInEditMode(){return n(this,Aa)}shouldGetKeyboardEvents(){return n(this,pn)}needsToBeRebuilt(){return this.div&&!this.isAttachedToDOM}get isOnScreen(){const{top:e,left:t,bottom:s,right:i}=this.getClientDimensions(),{innerHeight:r,innerWidth:a}=window;return t<a&&i>0&&e<r&&s>0}rebuild(){E(this,md,Ab).call(this)}rotate(e){}resize(){}serializeDeleted(){var e;return{id:this.annotationElementId,deleted:!0,pageIndex:this.pageIndex,popupRef:((e=this._initialData)==null?void 0:e.popupRef)||""}}serialize(e=!1,t=null){var s;return{annotationType:this.mode,pageIndex:this.pageIndex,rect:this.getPDFRect(),rotation:this.rotation,structTreeParentId:this._structTreeParentId,popupRef:((s=this._initialData)==null?void 0:s.popupRef)||""}}static async deserialize(e,t,s){const i=new this.prototype.constructor({parent:t,id:t.getNextId(),uiManager:s,annotationElementId:e.annotationElementId,creationDate:e.creationDate,modificationDate:e.modificationDate});i.rotation=e.rotation,w(i,ya,e.accessibilityData),i._isCopy=e.isCopy||!1;const[r,a]=i.pageDimensions,[o,l,h,c]=i.getRectInCurrentCoords(e.rect,a);return i.x=o/r,i.y=l/a,i.width=h/r,i.height=c/a,i}get hasBeenModified(){return!!this.annotationElementId&&(this.deleted||this.serialize()!==null)}remove(){var e,t,s;if((e=n(this,pr))==null||e.abort(),w(this,pr,null),this.isEmpty()||this.commit(),this.parent?this.parent.remove(this):this._uiManager.removeEditor(this),this.hideCommentPopup(),n(this,Ri)&&(clearTimeout(n(this,Ri)),w(this,Ri,null)),E(this,Sa,dc).call(this),this.removeEditToolbar(),n(this,Zs)){for(const i of n(this,Zs).values())clearTimeout(i);w(this,Zs,null)}this.parent=null,(t=n(this,_a))==null||t.destroy(),w(this,_a,null),(s=n(this,Ks))==null||s.remove(),w(this,Ks,null)}get isResizable(){return!1}makeResizable(){this.isResizable&&(E(this,rg,gw).call(this),n(this,ze).classList.remove("hidden"))}get toolbarPosition(){return null}get commentButtonPosition(){return this._uiManager.direction==="ltr"?[1,0]:[0,0]}get commentButtonPositionInPage(){const{commentButtonPosition:[e,t]}=this,[s,i,r,a]=this.getPDFRect();return[St._round(s+(r-s)*e),St._round(i+(a-i)*(1-t))]}get commentButtonColor(){return this._uiManager.makeCommentColor(this.getNonHCMColor(),this.opacity)}get commentPopupPosition(){return n(this,Ht).commentPopupPositionInLayer}set commentPopupPosition(e){n(this,Ht).commentPopupPositionInLayer=e}hasDefaultPopupPosition(){return n(this,Ht).hasDefaultPopupPosition()}get commentButtonWidth(){return n(this,Ht).commentButtonWidth}get elementBeforePopup(){return this.div}setCommentButtonStates(e){var t;(t=n(this,Ht))==null||t.setCommentButtonStates(e)}keydown(e){if(!this.isResizable||e.target!==this.div||e.key!=="Enter")return;this._uiManager.setSelected(this),w(this,fn,{savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height});const t=n(this,ze).children;if(!n(this,hi)){w(this,hi,Array.from(t));const a=E(this,dg,Aw).bind(this),o=E(this,ug,_w).bind(this),l=this._uiManager._signal;for(const h of n(this,hi)){const c=h.getAttribute("data-resizer-name");h.setAttribute("role","spinbutton"),h.addEventListener("keydown",a,{signal:l}),h.addEventListener("blur",o,{signal:l}),h.addEventListener("focus",E(this,fg,Sw).bind(this,c),{signal:l}),h.setAttribute("data-l10n-id",St._l10nResizer[c])}}const s=n(this,hi)[0];let i=0;for(const a of t){if(a===s)break;i++}const r=(360-this.rotation+this.parentRotation)%360/90*(n(this,hi).length/4);if(r!==i){if(r<i)for(let o=0;o<i-r;o++)n(this,ze).append(n(this,ze).firstElementChild);else if(r>i)for(let o=0;o<r-i;o++)n(this,ze).firstElementChild.before(n(this,ze).lastElementChild);let a=0;for(const o of t){const h=n(this,hi)[a++].getAttribute("data-resizer-name");o.setAttribute("data-l10n-id",St._l10nResizer[h])}}E(this,bd,_b).call(this,0),w(this,pn,!0),n(this,ze).firstElementChild.focus({focusVisible:!0}),e.preventDefault(),e.stopImmediatePropagation()}_resizeWithKeyboard(e,t){n(this,pn)&&E(this,pd,wb).call(this,n(this,ld),{deltaX:e,deltaY:t,fromKeyboard:!0})}_stopResizingWithKeyboard(){E(this,Sa,dc).call(this),this.div.focus()}select(){var e,t,s;if(this.isSelected&&this._editToolbar){this._editToolbar.show();return}if(this.isSelected=!0,this.makeResizable(),(e=this.div)==null||e.classList.add("selectedEditor"),!this._editToolbar){this.addEditToolbar().then(()=>{var i,r;(i=this.div)!=null&&i.classList.contains("selectedEditor")&&((r=this._editToolbar)==null||r.show())});return}(t=this._editToolbar)==null||t.show(),(s=n(this,se))==null||s.toggleAltTextBadge(!1)}focus(){this.div&&!this.div.contains(document.activeElement)&&setTimeout(()=>{var e;return(e=this.div)==null?void 0:e.focus({preventScroll:!0})},0)}unselect(){var e,t,s,i,r;this.isSelected&&(this.isSelected=!1,(e=n(this,ze))==null||e.classList.add("hidden"),(t=this.div)==null||t.classList.remove("selectedEditor"),(s=this.div)!=null&&s.contains(document.activeElement)&&this._uiManager.currentLayer.div.focus({preventScroll:!0}),(i=this._editToolbar)==null||i.hide(),(r=n(this,se))==null||r.toggleAltTextBadge(!0),this.hideCommentPopup())}hideCommentPopup(){this.hasComment&&this._uiManager.toggleComment(null)}updateParams(e,t){}disableEditing(){}enableEditing(){}get canChangeContent(){return!1}enterInEditMode(){this.canChangeContent&&(this.enableEditMode(),this.div.focus())}dblclick(e){e.target.nodeName!=="BUTTON"&&(this.enterInEditMode(),this.parent.updateToolbar({mode:this.constructor._editorType,editId:this.uid}))}getElementForAltText(){return this.div}get contentDiv(){return this.div}get isEditing(){return n(this,hd)}set isEditing(e){w(this,hd,e),this.parent&&(e?(this.parent.setSelected(this),this.parent.setActiveEditor(this)):this.parent.setActiveEditor(null))}static get MIN_SIZE(){return 16}static canCreateNewEmptyEditor(){return!0}get telemetryInitialData(){return{action:"added"}}get telemetryFinalData(){return null}_reportTelemetry(e,t=!1){if(t){n(this,Zs)||w(this,Zs,new Map);const{action:s}=e;let i=n(this,Zs).get(s);i&&clearTimeout(i),i=setTimeout(()=>{this._reportTelemetry(e),n(this,Zs).delete(s),n(this,Zs).size===0&&w(this,Zs,null)},St._telemetryTimeout),n(this,Zs).set(s,i);return}e.type||(e.type=this.editorType),this._uiManager._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:e}})}show(e=this._isVisible){this.div.classList.toggle("hidden",!e),this._isVisible=e}enable(){this.div&&(this.div.tabIndex=0),w(this,vl,!1)}disable(){this.div&&(this.div.tabIndex=-1),w(this,vl,!0)}updateFakeAnnotationElement(e){if(!n(this,Ks)&&!this.deleted){w(this,Ks,e.addFakeAnnotation(this));return}if(this.deleted){n(this,Ks).remove(),w(this,Ks,null);return}(this.hasEditedComment||this._hasBeenMoved||this._hasBeenResized)&&n(this,Ks).updateEdited({rect:this.getPDFRect(),popup:this.comment})}renderAnnotationElement(e){if(this.deleted)return e.hide(),null;let t=e.container.querySelector(".annotationContent");if(!t)t=document.createElement("div"),t.classList.add("annotationContent",this.editorType),e.container.prepend(t);else if(t.nodeName==="CANVAS"){const s=t;t=document.createElement("div"),t.classList.add("annotationContent",this.editorType),s.before(t)}return t}resetAnnotationElement(e){const{firstElementChild:t}=e.container;(t==null?void 0:t.nodeName)==="DIV"&&t.classList.contains("annotationContent")&&t.remove()}};ya=new WeakMap,hi=new WeakMap,se=new WeakMap,Ht=new WeakMap,un=new WeakMap,vl=new WeakMap,fr=new WeakMap,od=new WeakMap,ze=new WeakMap,wa=new WeakMap,fn=new WeakMap,Ks=new WeakMap,pr=new WeakMap,ld=new WeakMap,va=new WeakMap,vs=new WeakMap,hd=new WeakMap,Aa=new WeakMap,pn=new WeakMap,Ri=new WeakMap,Al=new WeakMap,_l=new WeakMap,Zs=new WeakMap,_a=new WeakMap,cd=new WeakMap,ng=new WeakMap,dd=new WeakSet,mb=function([e,t],s,i){[s,i]=this.screenToPageTranslation(s,i),this.x+=s/e,this.y+=i/t,this._onTranslating(this.x,this.y),this.fixAndSetPosition()},ud=new WeakSet,bb=function(e,t,s){switch(s){case 90:return[t,-e];case 180:return[-e,-t];case 270:return[-t,e];default:return[e,t]}},Sl=new WeakSet,jf=function(e){switch(e){case 90:{const[t,s]=this.pageDimensions;return[0,-t/s,s/t,0]}case 180:return[-1,0,0,-1];case 270:{const[t,s]=this.pageDimensions;return[0,t/s,-s/t,0]}default:return[1,0,0,1]}},rg=new WeakSet,gw=function(){if(n(this,ze))return;w(this,ze,document.createElement("div")),n(this,ze).classList.add("resizers");const e=this._willKeepAspectRatio?["topLeft","topRight","bottomRight","bottomLeft"]:["topLeft","topMiddle","topRight","middleRight","bottomRight","bottomMiddle","bottomLeft","middleLeft"],t=this._uiManager._signal;for(const s of e){const i=document.createElement("div");n(this,ze).append(i),i.classList.add("resizer",s),i.setAttribute("data-resizer-name",s),i.addEventListener("pointerdown",E(this,ag,mw).bind(this,s),{signal:t}),i.addEventListener("contextmenu",ii,{signal:t}),i.tabIndex=-1}this.div.prepend(n(this,ze))},ag=new WeakSet,mw=function(e,t){var c;t.preventDefault();const{isMac:s}=Te.platform;if(t.button!==0||t.ctrlKey&&s)return;(c=n(this,se))==null||c.toggle(!1);const i=this._isDraggable;this._isDraggable=!1,w(this,wa,[t.screenX,t.screenY]);const r=new AbortController,a=this._uiManager.combinedSignal(r);this.parent.togglePointerEvents(!1),window.addEventListener("pointermove",E(this,pd,wb).bind(this,e),{passive:!0,capture:!0,signal:a}),window.addEventListener("touchmove",ue,{passive:!1,signal:a}),window.addEventListener("contextmenu",ii,{signal:a}),w(this,fn,{savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height});const o=this.parent.div.style.cursor,l=this.div.style.cursor;this.div.style.cursor=this.parent.div.style.cursor=window.getComputedStyle(t.target).cursor;const h=()=>{var d;r.abort(),this.parent.togglePointerEvents(!0),(d=n(this,se))==null||d.toggle(!0),this._isDraggable=i,this.parent.div.style.cursor=o,this.div.style.cursor=l,E(this,El,Vf).call(this)};window.addEventListener("pointerup",h,{signal:a}),window.addEventListener("blur",h,{signal:a})},fd=new WeakSet,yb=function(e,t,s,i){this.width=s,this.height=i,this.x=e,this.y=t,this.setDims(),this.fixAndSetPosition(),this._onResized()},El=new WeakSet,Vf=function(){if(!n(this,fn))return;const{savedX:e,savedY:t,savedWidth:s,savedHeight:i}=n(this,fn);w(this,fn,null);const r=this.x,a=this.y,o=this.width,l=this.height;r===e&&a===t&&o===s&&l===i||this.addCommands({cmd:E(this,fd,yb).bind(this,r,a,o,l),undo:E(this,fd,yb).bind(this,e,t,s,i),mustExec:!0})},pd=new WeakSet,wb=function(e,t){const[s,i]=this.parentDimensions,r=this.x,a=this.y,o=this.width,l=this.height,h=St.MIN_SIZE/s,c=St.MIN_SIZE/i,d=E(this,Sl,jf).call(this,this.rotation),u=(G,U)=>[d[0]*G+d[2]*U,d[1]*G+d[3]*U],f=E(this,Sl,jf).call(this,360-this.rotation),y=(G,U)=>[f[0]*G+f[2]*U,f[1]*G+f[3]*U];let g,v,b=!1,A=!1;switch(e){case"topLeft":b=!0,g=(G,U)=>[0,0],v=(G,U)=>[G,U];break;case"topMiddle":g=(G,U)=>[G/2,0],v=(G,U)=>[G/2,U];break;case"topRight":b=!0,g=(G,U)=>[G,0],v=(G,U)=>[0,U];break;case"middleRight":A=!0,g=(G,U)=>[G,U/2],v=(G,U)=>[0,U/2];break;case"bottomRight":b=!0,g=(G,U)=>[G,U],v=(G,U)=>[0,0];break;case"bottomMiddle":g=(G,U)=>[G/2,U],v=(G,U)=>[G/2,0];break;case"bottomLeft":b=!0,g=(G,U)=>[0,U],v=(G,U)=>[G,0];break;case"middleLeft":A=!0,g=(G,U)=>[0,U/2],v=(G,U)=>[G,U/2];break}const _=g(o,l),x=v(o,l);let k=u(...x);const T=St._round(r+k[0]),P=St._round(a+k[1]);let F=1,R=1,B,j;if(t.fromKeyboard)({deltaX:B,deltaY:j}=t);else{const{screenX:G,screenY:U}=t,[it,Y]=n(this,wa);[B,j]=this.screenToPageTranslation(G-it,U-Y),n(this,wa)[0]=G,n(this,wa)[1]=U}if([B,j]=y(B/s,j/i),b){const G=Math.hypot(o,l);F=R=Math.max(Math.min(Math.hypot(x[0]-_[0]-B,x[1]-_[1]-j)/G,1/o,1/l),h/o,c/l)}else A?F=Ve(Math.abs(x[0]-_[0]-B),h,1)/o:R=Ve(Math.abs(x[1]-_[1]-j),c,1)/l;const I=St._round(o*F),L=St._round(l*R);k=u(...v(I,L));const S=T-k[0],N=P-k[1];n(this,vs)||w(this,vs,[this.x,this.y,this.width,this.height]),this.width=I,this.height=L,this.x=S,this.y=N,this.setDims(),this.fixAndSetPosition(),this._onResizing()},og=new WeakSet,bw=function(){var e;w(this,fn,{savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height}),(e=n(this,se))==null||e.toggle(!1),this.parent.togglePointerEvents(!1)},lg=new WeakSet,yw=function(e,t,s){let r=.7*(s/t)+1-.7;if(r===1)return;const a=E(this,Sl,jf).call(this,this.rotation),o=(T,P)=>[a[0]*T+a[2]*P,a[1]*T+a[3]*P],[l,h]=this.parentDimensions,c=this.x,d=this.y,u=this.width,f=this.height,y=St.MIN_SIZE/l,g=St.MIN_SIZE/h;r=Math.max(Math.min(r,1/u,1/f),y/u,g/f);const v=St._round(u*r),b=St._round(f*r);if(v===u&&b===f)return;n(this,vs)||w(this,vs,[c,d,u,f]);const A=o(u/2,f/2),_=St._round(c+A[0]),x=St._round(d+A[1]),k=o(v/2,b/2);this.x=_-k[0],this.y=x-k[1],this.width=v,this.height=b,this.setDims(),this.fixAndSetPosition(),this._onResizing()},hg=new WeakSet,ww=function(){var e;(e=n(this,se))==null||e.toggle(!0),this.parent.togglePointerEvents(!0),E(this,El,Vf).call(this)},gd=new WeakSet,vb=function(e){const{isMac:t}=Te.platform;e.ctrlKey&&!t||e.shiftKey||e.metaKey&&t?this.parent.toggleSelected(this):this.parent.setSelected(this)},cg=new WeakSet,vw=function(e){const{isSelected:t}=this;this._uiManager.setUpDragSession();let s=!1;const i=new AbortController,r=this._uiManager.combinedSignal(i),a={capture:!0,passive:!1,signal:r},o=h=>{i.abort(),w(this,fr,null),w(this,va,!1),this._uiManager.endDragSession()||E(this,gd,vb).call(this,h),s&&this._onStopDragging()};t&&(w(this,Al,e.clientX),w(this,_l,e.clientY),w(this,fr,e.pointerId),w(this,od,e.pointerType),window.addEventListener("pointermove",h=>{s||(s=!0,this._uiManager.toggleComment(this,!0,!1),this._onStartDragging());const{clientX:c,clientY:d,pointerId:u}=h;if(u!==n(this,fr)){ue(h);return}const[f,y]=this.screenToPageTranslation(c-n(this,Al),d-n(this,_l));w(this,Al,c),w(this,_l,d),this._uiManager.dragSelectedEditors(f,y)},a),window.addEventListener("touchmove",ue,a),window.addEventListener("pointerdown",h=>{h.pointerType===n(this,od)&&(n(this,_a)||h.isPrimary)&&o(h),ue(h)},a));const l=h=>{if(!n(this,fr)||n(this,fr)===h.pointerId){o(h);return}ue(h)};window.addEventListener("pointerup",l,{signal:r}),window.addEventListener("blur",l,{signal:r})},md=new WeakSet,Ab=function(){if(n(this,pr)||!this.div)return;w(this,pr,new AbortController);const e=this._uiManager.combinedSignal(n(this,pr));this.div.addEventListener("focusin",this.focusin.bind(this),{signal:e}),this.div.addEventListener("focusout",this.focusout.bind(this),{signal:e})},dg=new WeakSet,Aw=function(e){St._resizerKeyboardManager.exec(this,e)},ug=new WeakSet,_w=function(e){var t;n(this,pn)&&((t=e.relatedTarget)==null?void 0:t.parentNode)!==n(this,ze)&&E(this,Sa,dc).call(this)},fg=new WeakSet,Sw=function(e){w(this,ld,n(this,pn)?e:"")},bd=new WeakSet,_b=function(e){if(n(this,hi))for(const t of n(this,hi))t.tabIndex=e},Sa=new WeakSet,dc=function(){w(this,pn,!1),E(this,bd,_b).call(this,-1),E(this,El,Vf).call(this)},m(St,ud),$(St,"_l10n",null),$(St,"_l10nResizer",null),$(St,"_borderLineWidth",-1),$(St,"_colorManager",new cb),$(St,"_zIndex",1),$(St,"_telemetryTimeout",1e3);let Qt=St;class qA extends Qt{constructor(e){super(e),this.annotationElementId=e.annotationElementId,this.deleted=!0}serialize(){return this.serializeDeleted()}}const i0=3285377520,Us=4294901760,Si=65535;class Ew{constructor(e){this.h1=e?e&4294967295:i0,this.h2=e?e&4294967295:i0}update(e){let t,s;if(typeof e=="string"){t=new Uint8Array(e.length*2),s=0;for(let g=0,v=e.length;g<v;g++){const b=e.charCodeAt(g);b<=255?t[s++]=b:(t[s++]=b>>>8,t[s++]=b&255)}}else if(ArrayBuffer.isView(e))t=e.slice(),s=t.byteLength;else throw new Error("Invalid data format, must be a string or TypedArray.");const i=s>>2,r=s-i*4,a=new Uint32Array(t.buffer,0,i);let o=0,l=0,h=this.h1,c=this.h2;const d=3432918353,u=461845907,f=d&Si,y=u&Si;for(let g=0;g<i;g++)g&1?(o=a[g],o=o*d&Us|o*f&Si,o=o<<15|o>>>17,o=o*u&Us|o*y&Si,h^=o,h=h<<13|h>>>19,h=h*5+3864292196):(l=a[g],l=l*d&Us|l*f&Si,l=l<<15|l>>>17,l=l*u&Us|l*y&Si,c^=l,c=c<<13|c>>>19,c=c*5+3864292196);switch(o=0,r){case 3:o^=t[i*4+2]<<16;case 2:o^=t[i*4+1]<<8;case 1:o^=t[i*4],o=o*d&Us|o*f&Si,o=o<<15|o>>>17,o=o*u&Us|o*y&Si,i&1?h^=o:c^=o}this.h1=h,this.h2=c}hexdigest(){let e=this.h1,t=this.h2;return e^=t>>>1,e=e*3981806797&Us|e*36045&Si,t=t*4283543511&Us|((t<<16|e>>>16)*2950163797&Us)>>>16,e^=t>>>1,e=e*444984403&Us|e*60499&Si,t=t*3301882366&Us|((t<<16|e>>>16)*3120437893&Us)>>>16,e^=t>>>1,(e>>>0).toString(16).padStart(8,"0")+(t>>>0).toString(16).padStart(8,"0")}}const Sb=Object.freeze({map:null,hash:"",transfer:void 0});var Ea,Ca,gn,Ue,pg,Cw;class Ly{constructor(){m(this,pg);m(this,Ea,!1);m(this,Ca,null);m(this,gn,null);m(this,Ue,new Map);this.onSetModified=null,this.onResetModified=null,this.onAnnotationEditor=null}getValue(e,t){const s=n(this,Ue).get(e);return s===void 0?t:Object.assign(t,s)}getRawValue(e){return n(this,Ue).get(e)}remove(e){const t=n(this,Ue).get(e);if(t!==void 0&&(t instanceof Qt&&n(this,gn).delete(t.annotationElementId),n(this,Ue).delete(e),n(this,Ue).size===0&&this.resetModified(),typeof this.onAnnotationEditor=="function")){for(const s of n(this,Ue).values())if(s instanceof Qt)return;this.onAnnotationEditor(null)}}setValue(e,t){const s=n(this,Ue).get(e);let i=!1;if(s!==void 0)for(const[r,a]of Object.entries(t))s[r]!==a&&(i=!0,s[r]=a);else i=!0,n(this,Ue).set(e,t);i&&E(this,pg,Cw).call(this),t instanceof Qt&&((n(this,gn)||w(this,gn,new Map)).set(t.annotationElementId,t),typeof this.onAnnotationEditor=="function"&&this.onAnnotationEditor(t.constructor._type))}has(e){return n(this,Ue).has(e)}get size(){return n(this,Ue).size}resetModified(){n(this,Ea)&&(w(this,Ea,!1),typeof this.onResetModified=="function"&&this.onResetModified())}get print(){return new xw(this)}get serializable(){if(n(this,Ue).size===0)return Sb;const e=new Map,t=new Ew,s=[],i=Object.create(null);let r=!1;for(const[a,o]of n(this,Ue)){const l=o instanceof Qt?o.serialize(!1,i):o;o.page&&(o.pageIndex=o.page._pageIndex,delete o.page),l&&(e.set(a,l),t.update(`${a}:${JSON.stringify(l)}`),r||(r=!!l.bitmap))}if(r)for(const a of e.values())a.bitmap&&s.push(a.bitmap);return e.size>0?{map:e,hash:t.hexdigest(),transfer:s}:Sb}get editorStats(){let e=null;const t=new Map;let s=0,i=0;for(const r of n(this,Ue).values()){if(!(r instanceof Qt)){r.popup&&(r.popup.deleted?i+=1:s+=1);continue}r.isCommentDeleted?i+=1:r.hasEditedComment&&(s+=1);const a=r.telemetryFinalData;if(!a)continue;const{type:o}=a;t.has(o)||t.set(o,Object.getPrototypeOf(r).constructor),e||(e=Object.create(null));const l=e[o]||(e[o]=new Map);for(const[h,c]of Object.entries(a)){if(h==="type")continue;let d=l.get(h);d||(d=new Map,l.set(h,d));const u=d.get(c)??0;d.set(c,u+1)}}if((i>0||s>0)&&(e||(e=Object.create(null)),e.comments={deleted:i,edited:s}),!e)return null;for(const[r,a]of t)e[r]=a.computeTelemetryFinalData(e[r]);return e}resetModifiedIds(){w(this,Ca,null)}updateEditor(e,t){var i;const s=(i=n(this,gn))==null?void 0:i.get(e);return s?(s.updateFromAnnotationLayer(t),!0):!1}getEditor(e){var t;return((t=n(this,gn))==null?void 0:t.get(e))||null}get modifiedIds(){if(n(this,Ca))return n(this,Ca);const e=[];if(n(this,gn))for(const t of n(this,gn).values())t.serialize()&&e.push(t.annotationElementId);return w(this,Ca,{ids:new Set(e),hash:e.join(",")})}[Symbol.iterator](){return n(this,Ue).entries()}}Ea=new WeakMap,Ca=new WeakMap,gn=new WeakMap,Ue=new WeakMap,pg=new WeakSet,Cw=function(){n(this,Ea)||(w(this,Ea,!0),typeof this.onSetModified=="function"&&this.onSetModified())};var yd;class xw extends Ly{constructor(t){super();m(this,yd,void 0);const{map:s,hash:i,transfer:r}=t.serializable,a=structuredClone(s,r?{transfer:r}:null);w(this,yd,{map:a,hash:i,transfer:r})}get print(){zt("Should not call PrintAnnotationStorage.print")}get serializable(){return n(this,yd)}get modifiedIds(){return _t(this,"modifiedIds",{ids:new Set,hash:""})}}yd=new WeakMap;var Cl;class KA{constructor({ownerDocument:e=globalThis.document,styleElement:t=null}){m(this,Cl,new Set);this._document=e,this.nativeFontFaces=new Set,this.styleElement=null,this.loadingRequests=[],this.loadTestFontId=0}addNativeFontFace(e){this.nativeFontFaces.add(e),this._document.fonts.add(e)}removeNativeFontFace(e){this.nativeFontFaces.delete(e),this._document.fonts.delete(e)}insertRule(e){this.styleElement||(this.styleElement=this._document.createElement("style"),this._document.documentElement.getElementsByTagName("head")[0].append(this.styleElement));const t=this.styleElement.sheet;t.insertRule(e,t.cssRules.length)}clear(){for(const e of this.nativeFontFaces)this._document.fonts.delete(e);this.nativeFontFaces.clear(),n(this,Cl).clear(),this.styleElement&&(this.styleElement.remove(),this.styleElement=null)}async loadSystemFont({systemFontInfo:e,disableFontFace:t,_inspectFont:s}){if(!(!e||n(this,Cl).has(e.loadedName))){if(Bt(!t,"loadSystemFont shouldn't be called when `disableFontFace` is set."),this.isFontLoadingAPISupported){const{loadedName:i,src:r,style:a}=e,o=new FontFace(i,r,a);this.addNativeFontFace(o);try{await o.load(),n(this,Cl).add(i),s==null||s(e)}catch{At(`Cannot load system font: ${e.baseFontName}, installing it could help to improve PDF rendering.`),this.removeNativeFontFace(o)}return}zt("Not implemented: loadSystemFont without the Font Loading API.")}}async bind(e){if(e.attached||e.missingFile&&!e.systemFontInfo)return;if(e.attached=!0,e.systemFontInfo){await this.loadSystemFont(e);return}if(this.isFontLoadingAPISupported){const s=e.createNativeFontFace();if(s){this.addNativeFontFace(s);try{await s.loaded}catch(i){throw At(`Failed to load font '${s.family}': '${i}'.`),e.disableFontFace=!0,i}}return}const t=e.createFontFaceRule();if(t){if(this.insertRule(t),this.isSyncFontLoadingSupported)return;await new Promise(s=>{const i=this._queueLoadingCallback(s);this._prepareFontLoadEvent(e,i)})}}get isFontLoadingAPISupported(){var t;const e=!!((t=this._document)!=null&&t.fonts);return _t(this,"isFontLoadingAPISupported",e)}get isSyncFontLoadingSupported(){return _t(this,"isSyncFontLoadingSupported",rs||Te.platform.isFirefox)}_queueLoadingCallback(e){function t(){for(Bt(!i.done,"completeRequest() cannot be called twice."),i.done=!0;s.length>0&&s[0].done;){const r=s.shift();setTimeout(r.callback,0)}}const{loadingRequests:s}=this,i={done:!1,complete:t,callback:e};return s.push(i),i}get _loadTestFont(){const e=atob("T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQAFQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAAALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgAAAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACMAooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4DIP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAAAAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUAAQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgABAAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABYAAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAAAC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAAAAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQACAQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTjFQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA==");return _t(this,"_loadTestFont",e)}_prepareFontLoadEvent(e,t){function s(x,k){return x.charCodeAt(k)<<24|x.charCodeAt(k+1)<<16|x.charCodeAt(k+2)<<8|x.charCodeAt(k+3)&255}function i(x,k,T,P){const F=x.substring(0,k),R=x.substring(k+T);return F+P+R}let r,a;const o=this._document.createElement("canvas");o.width=1,o.height=1;const l=o.getContext("2d");let h=0;function c(x,k){if(++h>30){At("Load test font never loaded."),k();return}if(l.font="30px "+x,l.fillText(".",0,20),l.getImageData(0,0,1,1).data[3]>0){k();return}setTimeout(c.bind(null,x,k))}const d=`lt${Date.now()}${this.loadTestFontId++}`;let u=this._loadTestFont;u=i(u,976,d.length,d);const y=16,g=1482184792;let v=s(u,y);for(r=0,a=d.length-3;r<a;r+=4)v=v-g+s(d,r)|0;r<d.length&&(v=v-g+s(d+"XXX",r)|0),u=i(u,y,4,IA(v));const b=`url(data:font/opentype;base64,${btoa(u)});`,A=`@font-face {font-family:"${d}";src:${b}}`;this.insertRule(A);const _=this._document.createElement("div");_.style.visibility="hidden",_.style.width=_.style.height="10px",_.style.position="absolute",_.style.top=_.style.left="0px";for(const x of[e.loadedName,d]){const k=this._document.createElement("span");k.textContent="Hi",k.style.fontFamily=x,_.append(k)}this._document.body.append(_),c(d,()=>{_.remove(),t.complete()})}}Cl=new WeakMap;var Wt;class ZA{constructor(e,t=null,s,i){m(this,Wt,void 0);this.compiledGlyphs=Object.create(null),w(this,Wt,e),this._inspectFont=t,s&&Object.assign(this,s),i&&(this.charProcOperatorList=i)}createNativeFontFace(){var t;if(!this.data||this.disableFontFace)return null;let e;if(!this.cssFontInfo)e=new FontFace(this.loadedName,this.data,{});else{const s={weight:this.cssFontInfo.fontWeight};this.cssFontInfo.italicAngle&&(s.style=`oblique ${this.cssFontInfo.italicAngle}deg`),e=new FontFace(this.cssFontInfo.fontFamily,this.data,s)}return(t=this._inspectFont)==null||t.call(this,this),e}createFontFaceRule(){var s;if(!this.data||this.disableFontFace)return null;const e=`url(data:${this.mimetype};base64,${this.data.toBase64()});`;let t;if(!this.cssFontInfo)t=`@font-face {font-family:"${this.loadedName}";src:${e}}`;else{let i=`font-weight: ${this.cssFontInfo.fontWeight};`;this.cssFontInfo.italicAngle&&(i+=`font-style: oblique ${this.cssFontInfo.italicAngle}deg;`),t=`@font-face {font-family:"${this.cssFontInfo.fontFamily}";${i}src:${e}}`}return(s=this._inspectFont)==null||s.call(this,this,e),t}getPathGenerator(e,t){if(this.compiledGlyphs[t]!==void 0)return this.compiledGlyphs[t];const s=this.loadedName+"_path_"+t;let i;try{i=e.get(s)}catch(a){At(`getPathGenerator - ignoring character: "${a}".`)}const r=W0(i==null?void 0:i.path);return this.fontExtraProperties||e.delete(s),this.compiledGlyphs[t]=r}get black(){return n(this,Wt).black}get bold(){return n(this,Wt).bold}get disableFontFace(){return n(this,Wt).disableFontFace??!1}set disableFontFace(e){_t(this,"disableFontFace",!!e)}get fontExtraProperties(){return n(this,Wt).fontExtraProperties??!1}get isInvalidPDFjsFont(){return n(this,Wt).isInvalidPDFjsFont}get isType3Font(){return n(this,Wt).isType3Font}get italic(){return n(this,Wt).italic}get missingFile(){return n(this,Wt).missingFile}get remeasure(){return n(this,Wt).remeasure}get vertical(){return n(this,Wt).vertical}get ascent(){return n(this,Wt).ascent}get defaultWidth(){return n(this,Wt).defaultWidth}get descent(){return n(this,Wt).descent}get bbox(){return n(this,Wt).bbox}set bbox(e){_t(this,"bbox",e)}get fontMatrix(){return n(this,Wt).fontMatrix}get fallbackName(){return n(this,Wt).fallbackName}get loadedName(){return n(this,Wt).loadedName}get mimetype(){return n(this,Wt).mimetype}get name(){return n(this,Wt).name}get data(){return n(this,Wt).data}clearData(){n(this,Wt).clearData()}get cssFontInfo(){return n(this,Wt).cssFontInfo}get systemFontInfo(){return n(this,Wt).systemFontInfo}get defaultVMetrics(){return n(this,Wt).defaultVMetrics}}Wt=new WeakMap;var xl,kl,wd,Tl,Wf;const Yo=class Yo{constructor(e){m(this,Tl);m(this,xl,void 0);m(this,kl,void 0);m(this,wd,void 0);w(this,xl,e),w(this,kl,new DataView(n(this,xl))),w(this,wd,new TextDecoder)}static write(e){const t=new TextEncoder,s={};let i=0;for(const h of Yo.strings){const c=t.encode(e[h]);s[h]=c,i+=4+c.length}const r=new ArrayBuffer(i),a=new Uint8Array(r),o=new DataView(r);let l=0;for(const h of Yo.strings){const c=s[h],d=c.length;o.setUint32(l,d),a.set(c,l+4),l+=4+d}return Bt(l===r.byteLength,"CssFontInfo.write: Buffer overflow"),r}get fontFamily(){return E(this,Tl,Wf).call(this,0)}get fontWeight(){return E(this,Tl,Wf).call(this,1)}get italicAngle(){return E(this,Tl,Wf).call(this,2)}};xl=new WeakMap,kl=new WeakMap,wd=new WeakMap,Tl=new WeakSet,Wf=function(e){Bt(e<Yo.strings.length,"Invalid string index");let t=0;for(let i=0;i<e;i++)t+=n(this,kl).getUint32(t)+4;const s=n(this,kl).getUint32(t);return n(this,wd).decode(new Uint8Array(n(this,xl),t+4,s))},$(Yo,"strings",["fontFamily","fontWeight","italicAngle"]);let Sp=Yo;var gr,Li,xa,ka,uc;const qo=class qo{constructor(e){m(this,ka);m(this,gr,void 0);m(this,Li,void 0);m(this,xa,void 0);w(this,gr,e),w(this,Li,new DataView(n(this,gr))),w(this,xa,new TextDecoder)}static write(e){const t=new TextEncoder,s={};let i=0;for(const u of qo.strings){const f=t.encode(e[u]);s[u]=f,i+=4+f.length}i+=4;let r,a,o=1+i;e.style&&(r=t.encode(e.style.style),a=t.encode(e.style.weight),o+=4+r.length+4+a.length);const l=new ArrayBuffer(o),h=new Uint8Array(l),c=new DataView(l);let d=0;c.setUint8(d++,e.guessFallback?1:0),c.setUint32(d,0),d+=4,i=0;for(const u of qo.strings){const f=s[u],y=f.length;i+=4+y,c.setUint32(d,y),h.set(f,d+4),d+=4+y}return c.setUint32(d-i-4,i),e.style&&(c.setUint32(d,r.length),h.set(r,d+4),d+=4+r.length,c.setUint32(d,a.length),h.set(a,d+4),d+=4+a.length),Bt(d<=l.byteLength,"SubstitionInfo.write: Buffer overflow"),l.transferToFixedLength(d)}get guessFallback(){return n(this,Li).getUint8(0)!==0}get css(){return E(this,ka,uc).call(this,0)}get loadedName(){return E(this,ka,uc).call(this,1)}get baseFontName(){return E(this,ka,uc).call(this,2)}get src(){return E(this,ka,uc).call(this,3)}get style(){let e=1;e+=4+n(this,Li).getUint32(e);const t=n(this,Li).getUint32(e),s=n(this,xa).decode(new Uint8Array(n(this,gr),e+4,t));e+=4+t;const i=n(this,Li).getUint32(e),r=n(this,xa).decode(new Uint8Array(n(this,gr),e+4,i));return{style:s,weight:r}}};gr=new WeakMap,Li=new WeakMap,xa=new WeakMap,ka=new WeakSet,uc=function(e){Bt(e<qo.strings.length,"Invalid string index");let t=5;for(let i=0;i<e;i++)t+=n(this,Li).getUint32(t)+4;const s=n(this,Li).getUint32(t);return n(this,xa).decode(new Uint8Array(n(this,gr),t+4,s))},$(qo,"strings",["css","loadedName","baseFontName","src"]);let Ep=qo;var Pl,Dl,Il,Ml,As,Fi,vd,Gt,_s,ni,Rl,Gf,Ta,fc;const Ct=class Ct{constructor({data:e,extra:t}){m(this,_s);m(this,Rl);m(this,Ta);m(this,Fi,void 0);m(this,vd,void 0);m(this,Gt,void 0);w(this,Fi,e),w(this,vd,new TextDecoder),w(this,Gt,new DataView(n(this,Fi))),t&&Object.assign(this,t)}get black(){return E(this,_s,ni).call(this,0)}get bold(){return E(this,_s,ni).call(this,1)}get disableFontFace(){return E(this,_s,ni).call(this,2)}get fontExtraProperties(){return E(this,_s,ni).call(this,3)}get isInvalidPDFjsFont(){return E(this,_s,ni).call(this,4)}get isType3Font(){return E(this,_s,ni).call(this,5)}get italic(){return E(this,_s,ni).call(this,6)}get missingFile(){return E(this,_s,ni).call(this,7)}get remeasure(){return E(this,_s,ni).call(this,8)}get vertical(){return E(this,_s,ni).call(this,9)}get ascent(){return E(this,Rl,Gf).call(this,0)}get defaultWidth(){return E(this,Rl,Gf).call(this,1)}get descent(){return E(this,Rl,Gf).call(this,2)}get bbox(){let e=n(Ct,Dl);if(n(this,Gt).getUint8(e)===0)return;e+=1;const s=[];for(let i=0;i<4;i++)s.push(n(this,Gt).getInt16(e,!0)),e+=2;return s}get fontMatrix(){let e=n(Ct,Il);if(n(this,Gt).getUint8(e)===0)return;e+=1;const s=[];for(let i=0;i<6;i++)s.push(n(this,Gt).getFloat64(e,!0)),e+=8;return s}get defaultVMetrics(){let e=n(Ct,Ml);if(n(this,Gt).getUint8(e)===0)return;e+=1;const s=[];for(let i=0;i<3;i++)s.push(n(this,Gt).getInt16(e,!0)),e+=2;return s}get fallbackName(){return E(this,Ta,fc).call(this,0)}get loadedName(){return E(this,Ta,fc).call(this,1)}get mimetype(){return E(this,Ta,fc).call(this,2)}get name(){return E(this,Ta,fc).call(this,3)}get data(){let e=n(Ct,As);const t=n(this,Gt).getUint32(e);e+=4+t;const s=n(this,Gt).getUint32(e);e+=4+s;const i=n(this,Gt).getUint32(e);e+=4+i;const r=n(this,Gt).getUint32(e);if(r!==0)return new Uint8Array(n(this,Fi),e+4,r)}clearData(){let e=n(Ct,As);const t=n(this,Gt).getUint32(e);e+=4+t;const s=n(this,Gt).getUint32(e);e+=4+s;const i=n(this,Gt).getUint32(e);e+=4+i;const r=n(this,Gt).getUint32(e);new Uint8Array(n(this,Fi),e+4,r).fill(0),n(this,Gt).setUint32(e,0)}get cssFontInfo(){let e=n(Ct,As);const t=n(this,Gt).getUint32(e);e+=4+t;const s=n(this,Gt).getUint32(e);e+=4+s;const i=n(this,Gt).getUint32(e);if(i===0)return null;const r=new Uint8Array(i);return r.set(new Uint8Array(n(this,Fi),e+4,i)),new Sp(r.buffer)}get systemFontInfo(){let e=n(Ct,As);const t=n(this,Gt).getUint32(e);e+=4+t;const s=n(this,Gt).getUint32(e);if(s===0)return null;const i=new Uint8Array(s);return i.set(new Uint8Array(n(this,Fi),e+4,s)),new Ep(i.buffer)}static write(e){const t=e.systemFontInfo?Ep.write(e.systemFontInfo):null,s=e.cssFontInfo?Sp.write(e.cssFontInfo):null,i=new TextEncoder,r={};let a=0;for(const g of Ct.strings)r[g]=i.encode(e[g]),a+=4+r[g].length;const o=n(Ct,As)+4+a+4+(t?t.byteLength:0)+4+(s?s.byteLength:0)+4+(e.data?e.data.length:0),l=new ArrayBuffer(o),h=new Uint8Array(l),c=new DataView(l);let d=0;const u=Ct.bools.length;let f=0,y=0;for(let g=0;g<u;g++){const v=e[Ct.bools[g]];f|=(v===void 0?0:v?2:1)<<y,y+=2,(y===8||g===u-1)&&(c.setUint8(d++,f),f=0,y=0)}Bt(d===n(Ct,Pl),"FontInfo.write: Boolean properties offset mismatch");for(const g of Ct.numbers)c.setFloat64(d,e[g]),d+=8;if(Bt(d===n(Ct,Dl),"FontInfo.write: Number properties offset mismatch"),e.bbox){c.setUint8(d++,4);for(const g of e.bbox)c.setInt16(d,g,!0),d+=2}else c.setUint8(d++,0),d+=2*4;if(Bt(d===n(Ct,Il),"FontInfo.write: BBox properties offset mismatch"),e.fontMatrix){c.setUint8(d++,6);for(const g of e.fontMatrix)c.setFloat64(d,g,!0),d+=8}else c.setUint8(d++,0),d+=8*6;if(Bt(d===n(Ct,Ml),"FontInfo.write: FontMatrix properties offset mismatch"),e.defaultVMetrics){c.setUint8(d++,1);for(const g of e.defaultVMetrics)c.setInt16(d,g,!0),d+=2}else c.setUint8(d++,0),d+=3*2;Bt(d===n(Ct,As),"FontInfo.write: DefaultVMetrics properties offset mismatch"),c.setUint32(n(Ct,As),0),d+=4;for(const g of Ct.strings){const v=r[g],b=v.length;c.setUint32(d,b),h.set(v,d+4),d+=4+b}if(c.setUint32(n(Ct,As),d-n(Ct,As)-4),!t)c.setUint32(d,0),d+=4;else{const g=t.byteLength;c.setUint32(d,g),Bt(d+4+g<=l.byteLength,"FontInfo.write: Buffer overflow at systemFontInfo"),h.set(new Uint8Array(t),d+4),d+=4+g}if(!s)c.setUint32(d,0),d+=4;else{const g=s.byteLength;c.setUint32(d,g),Bt(d+4+g<=l.byteLength,"FontInfo.write: Buffer overflow at cssFontInfo"),h.set(new Uint8Array(s),d+4),d+=4+g}return e.data===void 0?(c.setUint32(d,0),d+=4):(c.setUint32(d,e.data.length),h.set(e.data,d+4),d+=4+e.data.length),Bt(d<=l.byteLength,"FontInfo.write: Buffer overflow"),l.transferToFixedLength(d)}};Pl=new WeakMap,Dl=new WeakMap,Il=new WeakMap,Ml=new WeakMap,As=new WeakMap,Fi=new WeakMap,vd=new WeakMap,Gt=new WeakMap,_s=new WeakSet,ni=function(e){Bt(e<Ct.bools.length,"Invalid boolean index");const t=Math.floor(e/4),s=e*2%8,i=n(this,Gt).getUint8(t)>>s&3;return i===0?void 0:i===2},Rl=new WeakSet,Gf=function(e){return Bt(e<Ct.numbers.length,"Invalid number index"),n(this,Gt).getFloat64(n(Ct,Pl)+e*8)},Ta=new WeakSet,fc=function(e){Bt(e<Ct.strings.length,"Invalid string index");let t=n(Ct,As)+4;for(let r=0;r<e;r++)t+=n(this,Gt).getUint32(t)+4;const s=n(this,Gt).getUint32(t),i=new Uint8Array(s);return i.set(new Uint8Array(n(this,Fi),t+4,s)),n(this,vd).decode(i)},$(Ct,"bools",["black","bold","disableFontFace","fontExtraProperties","isInvalidPDFjsFont","isType3Font","italic","missingFile","remeasure","vertical"]),$(Ct,"numbers",["ascent","defaultWidth","descent"]),$(Ct,"strings",["fallbackName","loadedName","mimetype","name"]),m(Ct,Pl,Math.ceil(Ct.bools.length*2/8)),m(Ct,Dl,n(Ct,Pl)+Ct.numbers.length*8),m(Ct,Il,n(Ct,Dl)+1+2*4),m(Ct,Ml,n(Ct,Il)+1+8*6),m(Ct,As,n(Ct,Ml)+1+2*3);let Eb=Ct;var Ad,_d,Sd,Ed,Cd,xd,kd,Td;const Kt=class Kt{constructor(e){this.buffer=e,this.view=new DataView(e),this.data=new Uint8Array(e)}static write(e){let t,s=null,i=[],r=[],a=[],o=[],l=null,h=null;switch(e[0]){case"RadialAxial":t=e[1]==="axial"?1:2,s=e[2],a=e[3],t===1?i.push(...e[4],...e[5]):i.push(e[4][0],e[4][1],e[6],e[5][0],e[5][1],e[7]);break;case"Mesh":t=3,l=e[1],i=e[2],r=e[3],o=e[4]||[],s=e[6],h=e[7];break;default:throw new Error(`Unsupported pattern type: ${e[0]}`)}const c=Math.floor(i.length/2),d=Math.floor(r.length/3),u=a.length,f=o.length;let y=0;for(const k of o)y+=1,y=Math.ceil(y/4)*4,y+=4+k.coords.length*4,y+=4+k.colors.length*4,k.verticesPerRow!==void 0&&(y+=4);const g=20+c*8+d*3+u*8+(s?16:0)+(h?3:0)+y,v=new ArrayBuffer(g),b=new DataView(v),A=new Uint8Array(v);b.setUint8(n(Kt,Ad),t),b.setUint8(n(Kt,_d),s?1:0),b.setUint8(n(Kt,Sd),h?1:0),b.setUint8(n(Kt,Ed),l),b.setUint32(n(Kt,Cd),c,!0),b.setUint32(n(Kt,xd),d,!0),b.setUint32(n(Kt,kd),u,!0),b.setUint32(n(Kt,Td),f,!0);let _=20;new Float32Array(v,_,c*2).set(i),_+=c*8,A.set(r,_),_+=d*3;for(const[k,T]of a)b.setFloat32(_,k,!0),_+=4,b.setUint32(_,parseInt(T.slice(1),16),!0),_+=4;if(s)for(const k of s)b.setFloat32(_,k,!0),_+=4;h&&(A.set(h,_),_+=3);for(let k=0;k<o.length;k++){const T=o[k];b.setUint8(_,T.type),_+=1,_=Math.ceil(_/4)*4,b.setUint32(_,T.coords.length,!0),_+=4,new Int32Array(v,_,T.coords.length).set(T.coords),_+=T.coords.length*4,b.setUint32(_,T.colors.length,!0),_+=4,new Int32Array(v,_,T.colors.length).set(T.colors),_+=T.colors.length*4,T.verticesPerRow!==void 0&&(b.setUint32(_,T.verticesPerRow,!0),_+=4)}return v}getIR(){const e=this.view,t=this.data[n(Kt,Ad)],s=!!this.data[n(Kt,_d)],i=!!this.data[n(Kt,Sd)],r=e.getUint32(n(Kt,Cd),!0),a=e.getUint32(n(Kt,xd),!0),o=e.getUint32(n(Kt,kd),!0),l=e.getUint32(n(Kt,Td),!0);let h=20;const c=new Float32Array(this.buffer,h,r*2);h+=r*8;const d=new Uint8Array(this.buffer,h,a*3);h+=a*3;const u=[];for(let v=0;v<o;++v){const b=e.getFloat32(h,!0);h+=4;const A=e.getUint32(h,!0);h+=4,u.push([b,`#${A.toString(16).padStart(6,"0")}`])}let f=null;if(s){f=[];for(let v=0;v<4;++v)f.push(e.getFloat32(h,!0)),h+=4}let y=null;i&&(y=new Uint8Array(this.buffer,h,3),h+=3);const g=[];for(let v=0;v<l;++v){const b=e.getUint8(h);h+=1,h=Math.ceil(h/4)*4;const A=e.getUint32(h,!0);h+=4;const _=new Int32Array(this.buffer,h,A);h+=A*4;const x=e.getUint32(h,!0);h+=4;const k=new Int32Array(this.buffer,h,x);h+=x*4;const T={type:b,coords:_,colors:k};b===sb.LATTICE&&(T.verticesPerRow=e.getUint32(h,!0),h+=4),g.push(T)}if(t===1)return["RadialAxial","axial",f,u,Array.from(c.slice(0,2)),Array.from(c.slice(2,4)),null,null];if(t===2)return["RadialAxial","radial",f,u,[c[0],c[1]],[c[3],c[4]],c[2],c[5]];if(t===3){const v=this.data[n(Kt,Ed)];let b=null;if(c.length>0){let A=c[0],_=c[0],x=c[1],k=c[1];for(let T=0;T<c.length;T+=2){const P=c[T],F=c[T+1];A=A>P?P:A,x=x>F?F:x,_=_<P?P:_,k=k<F?F:k}b=[A,x,_,k]}return["Mesh",v,c,d,g,b,f,y]}throw new Error(`Unsupported pattern kind: ${t}`)}};Ad=new WeakMap,_d=new WeakMap,Sd=new WeakMap,Ed=new WeakMap,Cd=new WeakMap,xd=new WeakMap,kd=new WeakMap,Td=new WeakMap,m(Kt,Ad,0),m(Kt,_d,1),m(Kt,Sd,2),m(Kt,Ed,3),m(Kt,Cd,4),m(Kt,xd,8),m(Kt,kd,12),m(Kt,Td,16);let Cb=Kt;var Ll;class JA{constructor(e){m(this,Ll,void 0);w(this,Ll,e)}static write(e){let t,s;return Te.isFloat16ArraySupported?(s=new ArrayBuffer(e.length*2),t=new Float16Array(s)):(s=new ArrayBuffer(e.length*4),t=new Float32Array(s)),t.set(e),s}get path(){return Te.isFloat16ArraySupported?new Float16Array(n(this,Ll)):new Float32Array(n(this,Ll))}}Ll=new WeakMap;function QA(p){if(p instanceof URL)return p.href;if(typeof p=="string"){if(rs)return p;const e=URL.parse(p,window.location);if(e)return e.href}throw new Error("Invalid PDF url data: either string or URL-object is expected in the url property.")}function t_(p){if(rs&&typeof Buffer<"u"&&p instanceof Buffer)throw new Error("Please provide binary data as `Uint8Array`, rather than `Buffer`.");if(p instanceof Uint8Array&&p.byteLength===p.buffer.byteLength)return p;if(typeof p=="string")return Bm(p);if(p instanceof ArrayBuffer||ArrayBuffer.isView(p)||typeof p=="object"&&!isNaN(p==null?void 0:p.length))return new Uint8Array(p);throw new Error("Invalid PDF binary data: either TypedArray, string, or array-like object is expected in the data property.")}function Tf(p){if(typeof p!="string")return null;if(p.endsWith("/"))return p;throw new Error(`Invalid factory url: "${p}" must include trailing slash.`)}const xb=p=>typeof p=="object"&&Number.isInteger(p==null?void 0:p.num)&&p.num>=0&&Number.isInteger(p==null?void 0:p.gen)&&p.gen>=0,e_=p=>typeof p=="object"&&typeof(p==null?void 0:p.name)=="string",s_=OA.bind(null,xb,e_);var mn,gg;class i_{constructor(){m(this,mn,new Map);m(this,gg,Promise.resolve())}postMessage(e,t){const s={data:structuredClone(e,t?{transfer:t}:null)};n(this,gg).then(()=>{for(const[i]of n(this,mn))i.call(this,s)})}addEventListener(e,t,s=null){let i=null;if((s==null?void 0:s.signal)instanceof AbortSignal){const{signal:r}=s;if(r.aborted){At("LoopbackPort - cannot use an `aborted` signal.");return}const a=()=>this.removeEventListener(e,t);i=()=>r.removeEventListener("abort",a),r.addEventListener("abort",a)}n(this,mn).set(t,i)}removeEventListener(e,t){const s=n(this,mn).get(t);s==null||s(),n(this,mn).delete(t)}terminate(){for(const[,e]of n(this,mn))e==null||e();n(this,mn).clear()}}mn=new WeakMap,gg=new WeakMap;const Pf={DATA:1,ERROR:2},me={CANCEL:1,CANCEL_COMPLETE:2,CLOSE:3,ENQUEUE:4,ERROR:5,PULL:6,PULL_COMPLETE:7,START_COMPLETE:8};function n0(){}function as(p){if(p instanceof Xr||p instanceof ib||p instanceof Ky||p instanceof wp||p instanceof Ym)return p;switch(p instanceof Error||typeof p=="object"&&p!==null||zt('wrapReason: Expected "reason" to be a (possibly cloned) Error.'),p.name){case"AbortException":return new Xr(p.message);case"InvalidPDFException":return new ib(p.message);case"PasswordException":return new Ky(p.message,p.code);case"ResponseException":return new wp(p.message,p.status,p.missing);case"UnknownErrorException":return new Ym(p.message,p.details)}return new Ym(p.message,p.toString())}var Fl,mg,kw,bg,Tw,yg,Pw,Ol,Xf;class pc{constructor(e,t,s){m(this,mg);m(this,bg);m(this,yg);m(this,Ol);m(this,Fl,new AbortController);this.sourceName=e,this.targetName=t,this.comObj=s,this.callbackId=1,this.streamId=1,this.streamSinks=Object.create(null),this.streamControllers=Object.create(null),this.callbackCapabilities=Object.create(null),this.actionHandler=Object.create(null),s.addEventListener("message",E(this,mg,kw).bind(this),{signal:n(this,Fl).signal})}on(e,t){const s=this.actionHandler;if(s[e])throw new Error(`There is already an actionName called "${e}"`);s[e]=t}send(e,t,s){this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:e,data:t},s)}sendWithPromise(e,t,s){const i=this.callbackId++,r=Promise.withResolvers();this.callbackCapabilities[i]=r;try{this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:e,callbackId:i,data:t},s)}catch(a){r.reject(a)}return r.promise}sendWithStream(e,t,s,i){const r=this.streamId++,a=this.sourceName,o=this.targetName,l=this.comObj;return new ReadableStream({start:h=>{const c=Promise.withResolvers();return this.streamControllers[r]={controller:h,startCall:c,pullCall:null,cancelCall:null,isClosed:!1},l.postMessage({sourceName:a,targetName:o,action:e,streamId:r,data:t,desiredSize:h.desiredSize},i),c.promise},pull:h=>{const c=Promise.withResolvers();return this.streamControllers[r].pullCall=c,l.postMessage({sourceName:a,targetName:o,stream:me.PULL,streamId:r,desiredSize:h.desiredSize}),c.promise},cancel:h=>{Bt(h instanceof Error,"cancel must have a valid reason");const c=Promise.withResolvers();return this.streamControllers[r].cancelCall=c,this.streamControllers[r].isClosed=!0,l.postMessage({sourceName:a,targetName:o,stream:me.CANCEL,streamId:r,reason:as(h)}),c.promise}},s)}destroy(){var e;(e=n(this,Fl))==null||e.abort(),w(this,Fl,null)}}Fl=new WeakMap,mg=new WeakSet,kw=function({data:e}){if(e.targetName!==this.sourceName)return;if(e.stream){E(this,yg,Pw).call(this,e);return}if(e.callback){const s=e.callbackId,i=this.callbackCapabilities[s];if(!i)throw new Error(`Cannot resolve callback ${s}`);if(delete this.callbackCapabilities[s],e.callback===Pf.DATA)i.resolve(e.data);else if(e.callback===Pf.ERROR)i.reject(as(e.reason));else throw new Error("Unexpected callback case");return}const t=this.actionHandler[e.action];if(!t)throw new Error(`Unknown action from worker: ${e.action}`);if(e.callbackId){const s=this.sourceName,i=e.sourceName,r=this.comObj;Promise.try(t,e.data).then(function(a){r.postMessage({sourceName:s,targetName:i,callback:Pf.DATA,callbackId:e.callbackId,data:a})},function(a){r.postMessage({sourceName:s,targetName:i,callback:Pf.ERROR,callbackId:e.callbackId,reason:as(a)})});return}if(e.streamId){E(this,bg,Tw).call(this,e);return}t(e.data)},bg=new WeakSet,Tw=function(e){const t=e.streamId,s=this.sourceName,i=e.sourceName,r=this.comObj,a=this,o=this.actionHandler[e.action],l={enqueue(h,c=1,d){if(this.isCancelled)return;const u=this.desiredSize;this.desiredSize-=c,u>0&&this.desiredSize<=0&&(this.sinkCapability=Promise.withResolvers(),this.ready=this.sinkCapability.promise),r.postMessage({sourceName:s,targetName:i,stream:me.ENQUEUE,streamId:t,chunk:h},d)},close(){this.isCancelled||(this.isCancelled=!0,r.postMessage({sourceName:s,targetName:i,stream:me.CLOSE,streamId:t}),delete a.streamSinks[t])},error(h){Bt(h instanceof Error,"error must have a valid reason"),!this.isCancelled&&(this.isCancelled=!0,r.postMessage({sourceName:s,targetName:i,stream:me.ERROR,streamId:t,reason:as(h)}))},sinkCapability:Promise.withResolvers(),onPull:null,onCancel:null,isCancelled:!1,desiredSize:e.desiredSize,ready:null};l.sinkCapability.resolve(),l.ready=l.sinkCapability.promise,this.streamSinks[t]=l,Promise.try(o,e.data,l).then(function(){r.postMessage({sourceName:s,targetName:i,stream:me.START_COMPLETE,streamId:t,success:!0})},function(h){r.postMessage({sourceName:s,targetName:i,stream:me.START_COMPLETE,streamId:t,reason:as(h)})})},yg=new WeakSet,Pw=function(e){const t=e.streamId,s=this.sourceName,i=e.sourceName,r=this.comObj,a=this.streamControllers[t],o=this.streamSinks[t];switch(e.stream){case me.START_COMPLETE:e.success?a.startCall.resolve():a.startCall.reject(as(e.reason));break;case me.PULL_COMPLETE:e.success?a.pullCall.resolve():a.pullCall.reject(as(e.reason));break;case me.PULL:if(!o){r.postMessage({sourceName:s,targetName:i,stream:me.PULL_COMPLETE,streamId:t,success:!0});break}o.desiredSize<=0&&e.desiredSize>0&&o.sinkCapability.resolve(),o.desiredSize=e.desiredSize,Promise.try(o.onPull||n0).then(function(){r.postMessage({sourceName:s,targetName:i,stream:me.PULL_COMPLETE,streamId:t,success:!0})},function(h){r.postMessage({sourceName:s,targetName:i,stream:me.PULL_COMPLETE,streamId:t,reason:as(h)})});break;case me.ENQUEUE:if(Bt(a,"enqueue should have stream controller"),a.isClosed)break;a.controller.enqueue(e.chunk);break;case me.CLOSE:if(Bt(a,"close should have stream controller"),a.isClosed)break;a.isClosed=!0,a.controller.close(),E(this,Ol,Xf).call(this,a,t);break;case me.ERROR:Bt(a,"error should have stream controller"),a.controller.error(as(e.reason)),E(this,Ol,Xf).call(this,a,t);break;case me.CANCEL_COMPLETE:e.success?a.cancelCall.resolve():a.cancelCall.reject(as(e.reason)),E(this,Ol,Xf).call(this,a,t);break;case me.CANCEL:if(!o)break;const l=as(e.reason);Promise.try(o.onCancel||n0,l).then(function(){r.postMessage({sourceName:s,targetName:i,stream:me.CANCEL_COMPLETE,streamId:t,success:!0})},function(h){r.postMessage({sourceName:s,targetName:i,stream:me.CANCEL_COMPLETE,streamId:t,reason:as(h)})}),o.sinkCapability.reject(l),o.isCancelled=!0,delete this.streamSinks[t];break;default:throw new Error("Unexpected stream case")}},Ol=new WeakSet,Xf=async function(e,t){var s,i,r;await Promise.allSettled([(s=e.startCall)==null?void 0:s.promise,(i=e.pullCall)==null?void 0:i.promise,(r=e.cancelCall)==null?void 0:r.promise]),delete this.streamControllers[t]};var Pd;class Dw{constructor({enableHWA:e=!1}){m(this,Pd,!1);w(this,Pd,e)}create(e,t){if(e<=0||t<=0)throw new Error("Invalid canvas size");const s=this._createCanvas(e,t);return{canvas:s,context:s.getContext("2d",{willReadFrequently:!n(this,Pd)})}}reset(e,t,s){if(!e.canvas)throw new Error("Canvas is not specified");if(t<=0||s<=0)throw new Error("Invalid canvas size");e.canvas.width=t,e.canvas.height=s}destroy(e){if(!e.canvas)throw new Error("Canvas is not specified");e.canvas.width=0,e.canvas.height=0,e.canvas=null,e.context=null}_createCanvas(e,t){zt("Abstract method `_createCanvas` called.")}}Pd=new WeakMap;class n_ extends Dw{constructor({ownerDocument:e=globalThis.document,enableHWA:t=!1}){super({enableHWA:t}),this._document=e}_createCanvas(e,t){const s=this._document.createElement("canvas");return s.width=e,s.height=t,s}}class Iw{constructor({baseUrl:e=null,isCompressed:t=!0}){this.baseUrl=e,this.isCompressed=t}async fetch({name:e}){if(!this.baseUrl)throw new Error("Ensure that the `cMapUrl` and `cMapPacked` API parameters are provided.");if(!e)throw new Error("CMap name must be specified.");const t=this.baseUrl+e+(this.isCompressed?".bcmap":"");return this._fetch(t).then(s=>({cMapData:s,isCompressed:this.isCompressed})).catch(s=>{throw new Error(`Unable to load ${this.isCompressed?"binary ":""}CMap at: ${t}`)})}async _fetch(e){zt("Abstract method `_fetch` called.")}}class r0 extends Iw{async _fetch(e){const t=await vf(e,this.isCompressed?"arraybuffer":"text");return t instanceof ArrayBuffer?new Uint8Array(t):Bm(t)}}class Mw{addFilter(e){return"none"}addHCMFilter(e,t){return"none"}addAlphaFilter(e){return"none"}addLuminosityFilter(e){return"none"}addHighlightHCMFilter(e,t,s,i,r){return"none"}destroy(e=!1){}}var Pa,Nl,bn,yn,Ke,Da,Ia,De,Xe,Ma,gc,mr,zo,Bl,$f,br,Uo,wg,Rw,Dd,kb,yr,Ho,Ra,mc,La,bc,Id,Tb,Fa,yc;class r_ extends Mw{constructor({docId:t,ownerDocument:s=globalThis.document}){super();m(this,De);m(this,Ma);m(this,mr);m(this,Bl);m(this,br);m(this,wg);m(this,Dd);m(this,yr);m(this,Ra);m(this,La);m(this,Id);m(this,Fa);m(this,Pa,void 0);m(this,Nl,void 0);m(this,bn,void 0);m(this,yn,void 0);m(this,Ke,void 0);m(this,Da,void 0);m(this,Ia,0);w(this,yn,t),w(this,Ke,s)}addFilter(t){if(!t)return"none";let s=n(this,De,Xe).get(t);if(s)return s;const[i,r,a]=E(this,Bl,$f).call(this,t),o=t.length===1?i:`${i}${r}${a}`;if(s=n(this,De,Xe).get(o),s)return n(this,De,Xe).set(t,s),s;const l=`g_${n(this,yn)}_transfer_map_${Ae(this,Ia)._++}`,h=E(this,br,Uo).call(this,l);n(this,De,Xe).set(t,h),n(this,De,Xe).set(o,h);const c=E(this,yr,Ho).call(this,l);return E(this,La,bc).call(this,i,r,a,c),h}addHCMFilter(t,s){var y;const i=`${t}-${s}`,r="base";let a=n(this,Ma,gc).get(r);if((a==null?void 0:a.key)===i||(a?((y=a.filter)==null||y.remove(),a.key=i,a.url="none",a.filter=null):(a={key:i,url:"none",filter:null},n(this,Ma,gc).set(r,a)),!t||!s))return a.url;const o=E(this,Fa,yc).call(this,t);t=ct.makeHexColor(...o);const l=E(this,Fa,yc).call(this,s);if(s=ct.makeHexColor(...l),n(this,mr,zo).style.color="",t==="#000000"&&s==="#ffffff"||t===s)return a.url;const h=new Array(256);for(let g=0;g<=255;g++){const v=g/255;h[g]=v<=.03928?v/12.92:((v+.055)/1.055)**2.4}const c=h.join(","),d=`g_${n(this,yn)}_hcm_filter`,u=a.filter=E(this,yr,Ho).call(this,d);E(this,La,bc).call(this,c,c,c,u),E(this,Dd,kb).call(this,u);const f=(g,v)=>{const b=o[g]/255,A=l[g]/255,_=new Array(v+1);for(let x=0;x<=v;x++)_[x]=b+x/v*(A-b);return _.join(",")};return E(this,La,bc).call(this,f(0,5),f(1,5),f(2,5),u),a.url=E(this,br,Uo).call(this,d),a.url}addAlphaFilter(t){let s=n(this,De,Xe).get(t);if(s)return s;const[i]=E(this,Bl,$f).call(this,[t]),r=`alpha_${i}`;if(s=n(this,De,Xe).get(r),s)return n(this,De,Xe).set(t,s),s;const a=`g_${n(this,yn)}_alpha_map_${Ae(this,Ia)._++}`,o=E(this,br,Uo).call(this,a);n(this,De,Xe).set(t,o),n(this,De,Xe).set(r,o);const l=E(this,yr,Ho).call(this,a);return E(this,Id,Tb).call(this,i,l),o}addLuminosityFilter(t){let s=n(this,De,Xe).get(t||"luminosity");if(s)return s;let i,r;if(t?([i]=E(this,Bl,$f).call(this,[t]),r=`luminosity_${i}`):r="luminosity",s=n(this,De,Xe).get(r),s)return n(this,De,Xe).set(t,s),s;const a=`g_${n(this,yn)}_luminosity_map_${Ae(this,Ia)._++}`,o=E(this,br,Uo).call(this,a);n(this,De,Xe).set(t,o),n(this,De,Xe).set(r,o);const l=E(this,yr,Ho).call(this,a);return E(this,wg,Rw).call(this,l),t&&E(this,Id,Tb).call(this,i,l),o}addHighlightHCMFilter(t,s,i,r,a){var A;const o=`${s}-${i}-${r}-${a}`;let l=n(this,Ma,gc).get(t);if((l==null?void 0:l.key)===o||(l?((A=l.filter)==null||A.remove(),l.key=o,l.url="none",l.filter=null):(l={key:o,url:"none",filter:null},n(this,Ma,gc).set(t,l)),!s||!i))return l.url;const[h,c]=[s,i].map(E(this,Fa,yc).bind(this));let d=Math.round(.2126*h[0]+.7152*h[1]+.0722*h[2]),u=Math.round(.2126*c[0]+.7152*c[1]+.0722*c[2]),[f,y]=[r,a].map(E(this,Fa,yc).bind(this));u<d&&([d,u,f,y]=[u,d,y,f]),n(this,mr,zo).style.color="";const g=(_,x,k)=>{const T=new Array(256),P=(u-d)/k,F=_/255,R=(x-_)/(255*k);let B=0;for(let j=0;j<=k;j++){const I=Math.round(d+j*P),L=F+j*R;for(let S=B;S<=I;S++)T[S]=L;B=I+1}for(let j=B;j<256;j++)T[j]=T[B-1];return T.join(",")},v=`g_${n(this,yn)}_hcm_${t}_filter`,b=l.filter=E(this,yr,Ho).call(this,v);return E(this,Dd,kb).call(this,b),E(this,La,bc).call(this,g(f[0],y[0],5),g(f[1],y[1],5),g(f[2],y[2],5),b),l.url=E(this,br,Uo).call(this,v),l.url}destroy(t=!1){var s,i,r,a;t&&((s=n(this,Da))!=null&&s.size)||((i=n(this,bn))==null||i.parentNode.parentNode.remove(),w(this,bn,null),(r=n(this,Nl))==null||r.clear(),w(this,Nl,null),(a=n(this,Da))==null||a.clear(),w(this,Da,null),w(this,Ia,0))}}Pa=new WeakMap,Nl=new WeakMap,bn=new WeakMap,yn=new WeakMap,Ke=new WeakMap,Da=new WeakMap,Ia=new WeakMap,De=new WeakSet,Xe=function(){return n(this,Nl)||w(this,Nl,new Map)},Ma=new WeakSet,gc=function(){return n(this,Da)||w(this,Da,new Map)},mr=new WeakSet,zo=function(){if(!n(this,bn)){const t=n(this,Ke).createElement("div"),{style:s}=t;s.visibility="hidden",s.contain="strict",s.width=s.height=0,s.position="absolute",s.top=s.left=0,s.zIndex=-1;const i=n(this,Ke).createElementNS(Ji,"svg");i.setAttribute("width",0),i.setAttribute("height",0),w(this,bn,n(this,Ke).createElementNS(Ji,"defs")),t.append(i),i.append(n(this,bn)),n(this,Ke).body.append(t)}return n(this,bn)},Bl=new WeakSet,$f=function(t){if(t.length===1){const h=t[0],c=new Array(256);for(let u=0;u<256;u++)c[u]=h[u]/255;const d=c.join(",");return[d,d,d]}const[s,i,r]=t,a=new Array(256),o=new Array(256),l=new Array(256);for(let h=0;h<256;h++)a[h]=s[h]/255,o[h]=i[h]/255,l[h]=r[h]/255;return[a.join(","),o.join(","),l.join(",")]},br=new WeakSet,Uo=function(t){if(n(this,Pa)===void 0){w(this,Pa,"");const s=n(this,Ke).URL;s!==n(this,Ke).baseURI&&(zm(s)?At('#createUrl: ignore "data:"-URL for performance reasons.'):w(this,Pa,U0(s,"")))}return`url(${n(this,Pa)}#${t})`},wg=new WeakSet,Rw=function(t){const s=n(this,Ke).createElementNS(Ji,"feColorMatrix");s.setAttribute("type","matrix"),s.setAttribute("values","0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.3 0.59 0.11 0 0"),t.append(s)},Dd=new WeakSet,kb=function(t){const s=n(this,Ke).createElementNS(Ji,"feColorMatrix");s.setAttribute("type","matrix"),s.setAttribute("values","0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0 0 0 1 0"),t.append(s)},yr=new WeakSet,Ho=function(t){const s=n(this,Ke).createElementNS(Ji,"filter");return s.setAttribute("color-interpolation-filters","sRGB"),s.setAttribute("id",t),n(this,mr,zo).append(s),s},Ra=new WeakSet,mc=function(t,s,i){const r=n(this,Ke).createElementNS(Ji,s);r.setAttribute("type","discrete"),r.setAttribute("tableValues",i),t.append(r)},La=new WeakSet,bc=function(t,s,i,r){const a=n(this,Ke).createElementNS(Ji,"feComponentTransfer");r.append(a),E(this,Ra,mc).call(this,a,"feFuncR",t),E(this,Ra,mc).call(this,a,"feFuncG",s),E(this,Ra,mc).call(this,a,"feFuncB",i)},Id=new WeakSet,Tb=function(t,s){const i=n(this,Ke).createElementNS(Ji,"feComponentTransfer");s.append(i),E(this,Ra,mc).call(this,i,"feFuncA",t)},Fa=new WeakSet,yc=function(t){return n(this,mr,zo).style.color=t,_f(getComputedStyle(n(this,mr,zo)).getPropertyValue("color"))};class Lw{constructor({baseUrl:e=null}){this.baseUrl=e}async fetch({filename:e}){if(!this.baseUrl)throw new Error("Ensure that the `standardFontDataUrl` API parameter is provided.");if(!e)throw new Error("Font filename must be specified.");const t=`${this.baseUrl}${e}`;return this._fetch(t).catch(s=>{throw new Error(`Unable to load font data at: ${t}`)})}async _fetch(e){zt("Abstract method `_fetch` called.")}}class a0 extends Lw{async _fetch(e){const t=await vf(e,"arraybuffer");return new Uint8Array(t)}}class Fw{constructor({baseUrl:e=null}){this.baseUrl=e}async fetch({filename:e}){if(!this.baseUrl)throw new Error("Ensure that the `wasmUrl` API parameter is provided.");if(!e)throw new Error("Wasm filename must be specified.");const t=`${this.baseUrl}${e}`;return this._fetch(t).catch(s=>{throw new Error(`Unable to load wasm data at: ${t}`)})}async _fetch(e){zt("Abstract method `_fetch` called.")}}class o0 extends Fw{async _fetch(e){const t=await vf(e,"arraybuffer");return new Uint8Array(t)}}rs&&At("Please use the `legacy` build in Node.js environments.");async function Fy(p){const t=await process.getBuiltinModule("fs").promises.readFile(p);return new Uint8Array(t)}class a_ extends Mw{}class o_ extends Dw{_createCanvas(e,t){return process.getBuiltinModule("module").createRequire(import.meta.url)("@napi-rs/canvas").createCanvas(e,t)}}class l_ extends Iw{async _fetch(e){return Fy(e)}}class h_ extends Lw{async _fetch(e){return Fy(e)}}class c_ extends Fw{async _fetch(e){return Fy(e)}}const Oo="__forcedDependency",{floor:l0,ceil:h0}=Math;function Df(p,e,t,s,i,r){p[e*4+0]=Math.min(p[e*4+0],t),p[e*4+1]=Math.min(p[e*4+1],s),p[e*4+2]=Math.max(p[e*4+2],i),p[e*4+3]=Math.max(p[e*4+3],r)}const Pb=new Uint32Array(new Uint8Array([255,255,0,0]).buffer)[0];var zl,wr;class d_{constructor(e,t){m(this,zl,void 0);m(this,wr,void 0);w(this,zl,e),w(this,wr,t)}get length(){return n(this,zl).length}isEmpty(e){return n(this,zl)[e]===Pb}minX(e){return n(this,wr)[e*4+0]/256}minY(e){return n(this,wr)[e*4+1]/256}maxX(e){return(n(this,wr)[e*4+2]+1)/256}maxY(e){return(n(this,wr)[e*4+3]+1)/256}}zl=new WeakMap,wr=new WeakMap;const If=(p,e)=>{if(!p)return;let t=p.get(e);return t||(t={dependencies:new Set,isRenderingOperation:!1},p.set(e,t)),t};var hs,cs,Oa,ci,Na,wn,jt,Xt,vn,ds,Md,Ul,Ba,za,An,Ze,Oi,Rd,Db;class u_{constructor(e,t,s=!1){m(this,Rd);m(this,hs,{__proto__:null});m(this,cs,{__proto__:null,transform:[],moveText:[],sameLineText:[],[Oo]:[]});m(this,Oa,new Map);m(this,ci,[]);m(this,Na,[]);m(this,wn,[[1,0,0,1,0,0]]);m(this,jt,[-1/0,-1/0,1/0,1/0]);m(this,Xt,new Float64Array([1/0,1/0,-1/0,-1/0]));m(this,vn,-1);m(this,ds,new Set);m(this,Md,new Map);m(this,Ul,new Map);m(this,Ba,void 0);m(this,za,void 0);m(this,An,void 0);m(this,Ze,void 0);m(this,Oi,void 0);w(this,Ba,e.width),w(this,za,e.height),E(this,Rd,Db).call(this,t),s&&w(this,Oi,new Map)}growOperationsCount(e){e>=n(this,Ze).length&&E(this,Rd,Db).call(this,e,n(this,Ze))}save(e){return w(this,hs,{__proto__:n(this,hs)}),w(this,cs,{__proto__:n(this,cs),transform:{__proto__:n(this,cs).transform},moveText:{__proto__:n(this,cs).moveText},sameLineText:{__proto__:n(this,cs).sameLineText},[Oo]:{__proto__:n(this,cs)[Oo]}}),w(this,jt,{__proto__:n(this,jt)}),n(this,ci).push(e),this}restore(e){var i;const t=Object.getPrototypeOf(n(this,hs));if(t===null)return this;w(this,hs,t),w(this,cs,Object.getPrototypeOf(n(this,cs))),w(this,jt,Object.getPrototypeOf(n(this,jt)));const s=n(this,ci).pop();return s!==void 0&&((i=If(n(this,Oi),e))==null||i.dependencies.add(s),n(this,Ze)[e]=n(this,Ze)[s]),this}recordOpenMarker(e){return n(this,ci).push(e),this}getOpenMarker(){return n(this,ci).length===0?null:n(this,ci).at(-1)}recordCloseMarker(e){var s;const t=n(this,ci).pop();return t!==void 0&&((s=If(n(this,Oi),e))==null||s.dependencies.add(t),n(this,Ze)[e]=n(this,Ze)[t]),this}beginMarkedContent(e){return n(this,Na).push(e),this}endMarkedContent(e){var s;const t=n(this,Na).pop();return t!==void 0&&((s=If(n(this,Oi),e))==null||s.dependencies.add(t),n(this,Ze)[e]=n(this,Ze)[t]),this}pushBaseTransform(e){return n(this,wn).push(ct.multiplyByDOMMatrix(n(this,wn).at(-1),e.getTransform())),this}popBaseTransform(){return n(this,wn).length>1&&n(this,wn).pop(),this}recordSimpleData(e,t){return n(this,hs)[e]=t,this}recordIncrementalData(e,t){return n(this,cs)[e].push(t),this}resetIncrementalData(e,t){return n(this,cs)[e].length=0,this}recordNamedData(e,t){return n(this,Oa).set(e,t),this}recordSimpleDataFromNamed(e,t,s){n(this,hs)[e]=n(this,Oa).get(t)??s}recordFutureForcedDependency(e,t){return this.recordIncrementalData(Oo,t),this}inheritSimpleDataAsFutureForcedDependencies(e){for(const t of e)t in n(this,hs)&&this.recordFutureForcedDependency(t,n(this,hs)[t]);return this}inheritPendingDependenciesAsFutureForcedDependencies(){for(const e of n(this,ds))this.recordFutureForcedDependency(Oo,e);return this}resetBBox(e){return n(this,vn)!==e&&(w(this,vn,e),n(this,Xt)[0]=1/0,n(this,Xt)[1]=1/0,n(this,Xt)[2]=-1/0,n(this,Xt)[3]=-1/0),this}recordClipBox(e,t,s,i,r,a){const o=ct.multiplyByDOMMatrix(n(this,wn).at(-1),t.getTransform()),l=[1/0,1/0,-1/0,-1/0];ct.axialAlignedBoundingBox([s,r,i,a],o,l);const h=ct.intersect(n(this,jt),l);return h?(n(this,jt)[0]=h[0],n(this,jt)[1]=h[1],n(this,jt)[2]=h[2],n(this,jt)[3]=h[3]):(n(this,jt)[0]=n(this,jt)[1]=1/0,n(this,jt)[2]=n(this,jt)[3]=-1/0),this}recordBBox(e,t,s,i,r,a){const o=n(this,jt);if(o[0]===1/0)return this;const l=ct.multiplyByDOMMatrix(n(this,wn).at(-1),t.getTransform());if(o[0]===-1/0)return ct.axialAlignedBoundingBox([s,r,i,a],l,n(this,Xt)),this;const h=[1/0,1/0,-1/0,-1/0];return ct.axialAlignedBoundingBox([s,r,i,a],l,h),n(this,Xt)[0]=Math.min(n(this,Xt)[0],Math.max(h[0],o[0])),n(this,Xt)[1]=Math.min(n(this,Xt)[1],Math.max(h[1],o[1])),n(this,Xt)[2]=Math.max(n(this,Xt)[2],Math.min(h[2],o[2])),n(this,Xt)[3]=Math.max(n(this,Xt)[3],Math.min(h[3],o[3])),this}recordCharacterBBox(e,t,s,i=1,r=0,a=0,o){const l=s.bbox;let h,c;if(l&&(h=l[2]!==l[0]&&l[3]!==l[1]&&n(this,Ul).get(s),h!==!1&&(c=[0,0,0,0],ct.axialAlignedBoundingBox(l,s.fontMatrix,c),(i!==1||r!==0||a!==0)&&ct.scaleMinMax([i,0,0,-i,r,a],c),h)))return this.recordBBox(e,t,c[0],c[2],c[1],c[3]);if(!o)return this.recordFullPageBBox(e);const d=o();return l&&c&&h===void 0&&(h=c[0]<=r-d.actualBoundingBoxLeft&&c[2]>=r+d.actualBoundingBoxRight&&c[1]<=a-d.actualBoundingBoxAscent&&c[3]>=a+d.actualBoundingBoxDescent,n(this,Ul).set(s,h),h)?this.recordBBox(e,t,c[0],c[2],c[1],c[3]):this.recordBBox(e,t,r-d.actualBoundingBoxLeft,r+d.actualBoundingBoxRight,a-d.actualBoundingBoxAscent,a+d.actualBoundingBoxDescent)}recordFullPageBBox(e){return n(this,Xt)[0]=Math.max(0,n(this,jt)[0]),n(this,Xt)[1]=Math.max(0,n(this,jt)[1]),n(this,Xt)[2]=Math.min(n(this,Ba),n(this,jt)[2]),n(this,Xt)[3]=Math.min(n(this,za),n(this,jt)[3]),this}getSimpleIndex(e){return n(this,hs)[e]}recordDependencies(e,t){const s=n(this,ds),i=n(this,hs),r=n(this,cs);for(const a of t)a in n(this,hs)?s.add(i[a]):a in r&&r[a].forEach(s.add,s);return this}recordNamedDependency(e,t){return n(this,Oa).has(t)&&n(this,ds).add(n(this,Oa).get(t)),this}recordOperation(e,t=!1){if(this.recordDependencies(e,[Oo]),n(this,Oi)){const s=If(n(this,Oi),e),{dependencies:i}=s;n(this,ds).forEach(i.add,i),n(this,ci).forEach(i.add,i),n(this,Na).forEach(i.add,i),i.delete(e),s.isRenderingOperation=!0}if(n(this,vn)===e){const s=l0(n(this,Xt)[0]*256/n(this,Ba)),i=l0(n(this,Xt)[1]*256/n(this,za)),r=h0(n(this,Xt)[2]*256/n(this,Ba)),a=h0(n(this,Xt)[3]*256/n(this,za));Df(n(this,An),e,s,i,r,a);for(const o of n(this,ds))o!==e&&Df(n(this,An),o,s,i,r,a);for(const o of n(this,ci))o!==e&&Df(n(this,An),o,s,i,r,a);for(const o of n(this,Na))o!==e&&Df(n(this,An),o,s,i,r,a);t||(n(this,ds).clear(),w(this,vn,-1))}return this}recordShowTextOperation(e,t=!1){const s=Array.from(n(this,ds));this.recordOperation(e,t),this.recordIncrementalData("sameLineText",e);for(const i of s)this.recordIncrementalData("sameLineText",i);return this}bboxToClipBoxDropOperation(e,t=!1){return n(this,vn)===e&&(w(this,vn,-1),n(this,jt)[0]=Math.max(n(this,jt)[0],n(this,Xt)[0]),n(this,jt)[1]=Math.max(n(this,jt)[1],n(this,Xt)[1]),n(this,jt)[2]=Math.min(n(this,jt)[2],n(this,Xt)[2]),n(this,jt)[3]=Math.min(n(this,jt)[3],n(this,Xt)[3]),t||n(this,ds).clear()),this}_takePendingDependencies(){const e=n(this,ds);return w(this,ds,new Set),e}_extractOperation(e){const t=n(this,Md).get(e);return n(this,Md).delete(e),t}_pushPendingDependencies(e){for(const t of e)n(this,ds).add(t)}take(){return n(this,Ul).clear(),new d_(n(this,Ze),n(this,An))}takeDebugMetadata(){return n(this,Oi)}}hs=new WeakMap,cs=new WeakMap,Oa=new WeakMap,ci=new WeakMap,Na=new WeakMap,wn=new WeakMap,jt=new WeakMap,Xt=new WeakMap,vn=new WeakMap,ds=new WeakMap,Md=new WeakMap,Ul=new WeakMap,Ba=new WeakMap,za=new WeakMap,An=new WeakMap,Ze=new WeakMap,Oi=new WeakMap,Rd=new WeakSet,Db=function(e,t){const s=new ArrayBuffer(e*4);w(this,An,new Uint8ClampedArray(s)),w(this,Ze,new Uint32Array(s)),t&&t.length>0?(n(this,Ze).set(t),n(this,Ze).fill(Pb,t.length)):n(this,Ze).fill(Pb)};var Yt,he,di,Hl,jl;const Vy=class Vy{constructor(e,t,s){m(this,Yt,void 0);m(this,he,void 0);m(this,di,void 0);m(this,Hl,0);m(this,jl,0);if(e instanceof Vy&&n(e,di)===!!s)return e;w(this,Yt,e),w(this,he,t),w(this,di,!!s)}growOperationsCount(){throw new Error("Unreachable")}save(e){return Ae(this,jl)._++,n(this,Yt).save(n(this,he)),this}restore(e){return n(this,jl)>0&&(n(this,Yt).restore(n(this,he)),Ae(this,jl)._--),this}recordOpenMarker(e){return Ae(this,Hl)._++,this}getOpenMarker(){return n(this,Hl)>0?n(this,he):n(this,Yt).getOpenMarker()}recordCloseMarker(e){return Ae(this,Hl)._--,this}beginMarkedContent(e){return this}endMarkedContent(e){return this}pushBaseTransform(e){return n(this,Yt).pushBaseTransform(e),this}popBaseTransform(){return n(this,Yt).popBaseTransform(),this}recordSimpleData(e,t){return n(this,Yt).recordSimpleData(e,n(this,he)),this}recordIncrementalData(e,t){return n(this,Yt).recordIncrementalData(e,n(this,he)),this}resetIncrementalData(e,t){return n(this,Yt).resetIncrementalData(e,n(this,he)),this}recordNamedData(e,t){return this}recordSimpleDataFromNamed(e,t,s){return n(this,Yt).recordSimpleDataFromNamed(e,t,n(this,he)),this}recordFutureForcedDependency(e,t){return n(this,Yt).recordFutureForcedDependency(e,n(this,he)),this}inheritSimpleDataAsFutureForcedDependencies(e){return n(this,Yt).inheritSimpleDataAsFutureForcedDependencies(e),this}inheritPendingDependenciesAsFutureForcedDependencies(){return n(this,Yt).inheritPendingDependenciesAsFutureForcedDependencies(),this}resetBBox(e){return n(this,di)||n(this,Yt).resetBBox(n(this,he)),this}recordClipBox(e,t,s,i,r,a){return n(this,di)||n(this,Yt).recordClipBox(n(this,he),t,s,i,r,a),this}recordBBox(e,t,s,i,r,a){return n(this,di)||n(this,Yt).recordBBox(n(this,he),t,s,i,r,a),this}recordCharacterBBox(e,t,s,i,r,a,o){return n(this,di)||n(this,Yt).recordCharacterBBox(n(this,he),t,s,i,r,a,o),this}recordFullPageBBox(e){return n(this,di)||n(this,Yt).recordFullPageBBox(n(this,he)),this}getSimpleIndex(e){return n(this,Yt).getSimpleIndex(e)}recordDependencies(e,t){return n(this,Yt).recordDependencies(n(this,he),t),this}recordNamedDependency(e,t){return n(this,Yt).recordNamedDependency(n(this,he),t),this}recordOperation(e){return n(this,Yt).recordOperation(n(this,he),!0),this}recordShowTextOperation(e){return n(this,Yt).recordShowTextOperation(n(this,he),!0),this}bboxToClipBoxDropOperation(e){return n(this,di)||n(this,Yt).bboxToClipBoxDropOperation(n(this,he),!0),this}take(){throw new Error("Unreachable")}takeDebugMetadata(){throw new Error("Unreachable")}};Yt=new WeakMap,he=new WeakMap,di=new WeakMap,Hl=new WeakMap,jl=new WeakMap;let Cp=Vy;const Hs={stroke:["path","transform","filter","strokeColor","strokeAlpha","lineWidth","lineCap","lineJoin","miterLimit","dash"],fill:["path","transform","filter","fillColor","fillAlpha","globalCompositeOperation","SMask"],imageXObject:["transform","SMask","filter","fillAlpha","strokeAlpha","globalCompositeOperation"],rawFillPath:["filter","fillColor","fillAlpha"],showText:["transform","leading","charSpacing","wordSpacing","hScale","textRise","moveText","textMatrix","font","fontObj","filter","fillColor","textRenderingMode","SMask","fillAlpha","strokeAlpha","globalCompositeOperation","sameLineText"],transform:["transform"],transformAndFill:["transform","fillColor"]},We={FILL:"Fill",STROKE:"Stroke",SHADING:"Shading"};function Ib(p,e){if(!e)return;const t=e[2]-e[0],s=e[3]-e[1],i=new Path2D;i.rect(e[0],e[1],t,s),p.clip(i)}class Oy{isModifyingCurrentTransform(){return!1}getPattern(){zt("Abstract method `getPattern` called.")}}class f_ extends Oy{constructor(e){super(),this._type=e[1],this._bbox=e[2],this._colorStops=e[3],this._p0=e[4],this._p1=e[5],this._r0=e[6],this._r1=e[7],this.matrix=null}isOriginBased(){return this._p0[0]===0&&this._p0[1]===0&&(!this.isRadial()||this._p1[0]===0&&this._p1[1]===0)}isRadial(){return this._type==="radial"}_createGradient(e,t=null){let s,i=this._p0,r=this._p1;if(t&&(i=i.slice(),r=r.slice(),ct.applyTransform(i,t),ct.applyTransform(r,t)),this._type==="axial")s=e.createLinearGradient(i[0],i[1],r[0],r[1]);else if(this._type==="radial"){let a=this._r0,o=this._r1;if(t){const l=new Float32Array(2);ct.singularValueDecompose2dScale(t,l),a*=l[0],o*=l[0]}s=e.createRadialGradient(i[0],i[1],a,r[0],r[1],o)}for(const a of this._colorStops)s.addColorStop(a[0],a[1]);return s}getPattern(e,t,s,i){let r;if(i===We.STROKE||i===We.FILL){if(this.isOriginBased()){let u=ct.transform(s,t.baseTransform);this.matrix&&(u=ct.transform(u,this.matrix));const f=.001,y=Math.hypot(u[0],u[1]),g=Math.hypot(u[2],u[3]),v=(u[0]*u[2]+u[1]*u[3])/(y*g);if(Math.abs(v)<f)if(this.isRadial()){if(Math.abs(y-g)<f)return this._createGradient(e,u)}else return this._createGradient(e,u)}const a=t.current.getClippedPathBoundingBox(i,oe(e))||[0,0,0,0],o=Math.ceil(a[2]-a[0])||1,l=Math.ceil(a[3]-a[1])||1,h=t.cachedCanvases.getCanvas("pattern",o,l),c=h.context;c.clearRect(0,0,c.canvas.width,c.canvas.height),c.beginPath(),c.rect(0,0,c.canvas.width,c.canvas.height),c.translate(-a[0],-a[1]),s=ct.transform(s,[1,0,0,1,a[0],a[1]]),c.transform(...t.baseTransform),this.matrix&&c.transform(...this.matrix),Ib(c,this._bbox),c.fillStyle=this._createGradient(c),c.fill(),r=e.createPattern(h.canvas,"no-repeat");const d=new DOMMatrix(s);r.setTransform(d)}else Ib(e,this._bbox),r=this._createGradient(e);return r}}function Zm(p,e,t,s,i,r,a,o){const l=e.coords,h=e.colors,c=p.data,d=p.width*4;let u;l[t+1]>l[s+1]&&(u=t,t=s,s=u,u=r,r=a,a=u),l[s+1]>l[i+1]&&(u=s,s=i,i=u,u=a,a=o,o=u),l[t+1]>l[s+1]&&(u=t,t=s,s=u,u=r,r=a,a=u);const f=(l[t]+e.offsetX)*e.scaleX,y=(l[t+1]+e.offsetY)*e.scaleY,g=(l[s]+e.offsetX)*e.scaleX,v=(l[s+1]+e.offsetY)*e.scaleY,b=(l[i]+e.offsetX)*e.scaleX,A=(l[i+1]+e.offsetY)*e.scaleY;if(y>=A)return;const _=h[r],x=h[r+1],k=h[r+2],T=h[a],P=h[a+1],F=h[a+2],R=h[o],B=h[o+1],j=h[o+2],I=Math.round(y),L=Math.round(A);let S,N,G,U,it,Y,lt,H;for(let O=I;O<=L;O++){if(O<v){const pt=O<y?0:(y-O)/(y-v);S=f-(f-g)*pt,N=_-(_-T)*pt,G=x-(x-P)*pt,U=k-(k-F)*pt}else{let pt;O>A?pt=1:v===A?pt=0:pt=(v-O)/(v-A),S=g-(g-b)*pt,N=T-(T-R)*pt,G=P-(P-B)*pt,U=F-(F-j)*pt}let Q;O<y?Q=0:O>A?Q=1:Q=(y-O)/(y-A),it=f-(f-b)*Q,Y=_-(_-R)*Q,lt=x-(x-B)*Q,H=k-(k-j)*Q;const tt=Math.round(Math.min(S,it)),J=Math.round(Math.max(S,it));let bt=d*O+tt*4;for(let pt=tt;pt<=J;pt++)Q=(S-pt)/(S-it),Q<0?Q=0:Q>1&&(Q=1),c[bt++]=N-(N-Y)*Q|0,c[bt++]=G-(G-lt)*Q|0,c[bt++]=U-(U-H)*Q|0,c[bt++]=255}}function p_(p,e,t){const s=e.coords,i=e.colors;let r,a;switch(e.type){case sb.LATTICE:const o=e.verticesPerRow,l=Math.floor(s.length/o)-1,h=o-1;for(r=0;r<l;r++){let c=r*o;for(let d=0;d<h;d++,c++)Zm(p,t,s[c],s[c+1],s[c+o],i[c],i[c+1],i[c+o]),Zm(p,t,s[c+o+1],s[c+1],s[c+o],i[c+o+1],i[c+1],i[c+o])}break;case sb.TRIANGLES:for(r=0,a=s.length;r<a;r+=3)Zm(p,t,s[r],s[r+1],s[r+2],i[r],i[r+1],i[r+2]);break;default:throw new Error("illegal figure")}}class g_ extends Oy{constructor(e){super(),this._coords=e[2],this._colors=e[3],this._figures=e[4],this._bounds=e[5],this._bbox=e[6],this._background=e[7],this.matrix=null}_createMeshCanvas(e,t,s){const o=Math.floor(this._bounds[0]),l=Math.floor(this._bounds[1]),h=Math.ceil(this._bounds[2])-o,c=Math.ceil(this._bounds[3])-l,d=Math.min(Math.ceil(Math.abs(h*e[0]*1.1)),3e3),u=Math.min(Math.ceil(Math.abs(c*e[1]*1.1)),3e3),f=h/d,y=c/u,g={coords:this._coords,colors:this._colors,offsetX:-o,offsetY:-l,scaleX:1/f,scaleY:1/y},v=d+2*2,b=u+2*2,A=s.getCanvas("mesh",v,b),_=A.context,x=_.createImageData(d,u);if(t){const T=x.data;for(let P=0,F=T.length;P<F;P+=4)T[P]=t[0],T[P+1]=t[1],T[P+2]=t[2],T[P+3]=255}for(const T of this._figures)p_(x,T,g);return _.putImageData(x,2,2),{canvas:A.canvas,offsetX:o-2*f,offsetY:l-2*y,scaleX:f,scaleY:y}}isModifyingCurrentTransform(){return!0}getPattern(e,t,s,i){Ib(e,this._bbox);const r=new Float32Array(2);if(i===We.SHADING)ct.singularValueDecompose2dScale(oe(e),r);else if(this.matrix){ct.singularValueDecompose2dScale(this.matrix,r);const[o,l]=r;ct.singularValueDecompose2dScale(t.baseTransform,r),r[0]*=o,r[1]*=l}else ct.singularValueDecompose2dScale(t.baseTransform,r);const a=this._createMeshCanvas(r,i===We.SHADING?null:this._background,t.cachedCanvases);return i!==We.SHADING&&(e.setTransform(...t.baseTransform),this.matrix&&e.transform(...this.matrix)),e.translate(a.offsetX,a.offsetY),e.scale(a.scaleX,a.scaleY),e.createPattern(a.canvas,"no-repeat")}}class m_ extends Oy{getPattern(){return"hotpink"}}function b_(p){switch(p[0]){case"RadialAxial":return new f_(p);case"Mesh":return new g_(p);case"Dummy":return new m_}throw new Error(`Unknown IR type: ${p[0]}`)}const c0={COLORED:1,UNCOLORED:2},vg=class vg{constructor(e,t,s,i){this.color=e[1],this.operatorList=e[2],this.matrix=e[3],this.bbox=e[4],this.xstep=e[5],this.ystep=e[6],this.paintType=e[7],this.tilingType=e[8],this.ctx=t,this.canvasGraphicsFactory=s,this.baseTransform=i}createPatternCanvas(e,t){var Y,lt;const{bbox:s,operatorList:i,paintType:r,tilingType:a,color:o,canvasGraphicsFactory:l}=this;let{xstep:h,ystep:c}=this;h=Math.abs(h),c=Math.abs(c),Nm("TilingType: "+a);const d=s[0],u=s[1],f=s[2],y=s[3],g=f-d,v=y-u,b=new Float32Array(2);ct.singularValueDecompose2dScale(this.matrix,b);const[A,_]=b;ct.singularValueDecompose2dScale(this.baseTransform,b);const x=A*b[0],k=_*b[1];let T=g,P=v,F=!1,R=!1;const B=Math.ceil(h*x),j=Math.ceil(c*k),I=Math.ceil(g*x),L=Math.ceil(v*k);B>=I?T=h:F=!0,j>=L?P=c:R=!0;const S=this.getSizeAndScale(T,this.ctx.canvas.width,x),N=this.getSizeAndScale(P,this.ctx.canvas.height,k),G=e.cachedCanvases.getCanvas("pattern",S.size,N.size),U=G.context,it=l.createCanvasGraphics(U,t);if(it.groupLevel=e.groupLevel,this.setFillAndStrokeStyleToContext(it,r,o),U.translate(-S.scale*d,-N.scale*u),it.transform(0,S.scale,0,0,N.scale,0,0),U.save(),(Y=it.dependencyTracker)==null||Y.save(),this.clipBbox(it,d,u,f,y),it.baseTransform=oe(it.ctx),it.executeOperatorList(i),it.endDrawing(),(lt=it.dependencyTracker)==null||lt.restore(),U.restore(),F||R){const H=G.canvas;F&&(T=h),R&&(P=c);const O=this.getSizeAndScale(T,this.ctx.canvas.width,x),Q=this.getSizeAndScale(P,this.ctx.canvas.height,k),tt=O.size,J=Q.size,bt=e.cachedCanvases.getCanvas("pattern-workaround",tt,J),pt=bt.context,ft=F?Math.floor(g/h):0,yt=R?Math.floor(v/c):0;for(let It=0;It<=ft;It++)for(let xt=0;xt<=yt;xt++)pt.drawImage(H,tt*It,J*xt,tt,J,0,0,tt,J);return{canvas:bt.canvas,scaleX:O.scale,scaleY:Q.scale,offsetX:d,offsetY:u}}return{canvas:G.canvas,scaleX:S.scale,scaleY:N.scale,offsetX:d,offsetY:u}}getSizeAndScale(e,t,s){const i=Math.max(vg.MAX_PATTERN_SIZE,t);let r=Math.ceil(e*s);return r>=i?r=i:s=r/e,{scale:s,size:r}}clipBbox(e,t,s,i,r){const a=i-t,o=r-s;e.ctx.rect(t,s,a,o),ct.axialAlignedBoundingBox([t,s,i,r],oe(e.ctx),e.current.minMax),e.clip(),e.endPath()}setFillAndStrokeStyleToContext(e,t,s){const i=e.ctx,r=e.current;switch(t){case c0.COLORED:const{fillStyle:a,strokeStyle:o}=this.ctx;i.fillStyle=r.fillColor=a,i.strokeStyle=r.strokeColor=o;break;case c0.UNCOLORED:i.fillStyle=i.strokeStyle=s,r.fillColor=r.strokeColor=s;break;default:throw new PA(`Unsupported paint type: ${t}`)}}isModifyingCurrentTransform(){return!1}getPattern(e,t,s,i,r){let a=s;i!==We.SHADING&&(a=ct.transform(a,t.baseTransform),this.matrix&&(a=ct.transform(a,this.matrix)));const o=this.createPatternCanvas(t,r);let l=new DOMMatrix(a);l=l.translate(o.offsetX,o.offsetY),l=l.scale(1/o.scaleX,1/o.scaleY);const h=e.createPattern(o.canvas,"repeat");return h.setTransform(l),h}};$(vg,"MAX_PATTERN_SIZE",3e3);let Mb=vg;function y_({src:p,srcPos:e=0,dest:t,width:s,height:i,nonBlackColor:r=4294967295,inverseDecode:a=!1}){const o=Te.isLittleEndian?4278190080:255,[l,h]=a?[r,o]:[o,r],c=s>>3,d=s&7,u=p.length;t=new Uint32Array(t.buffer);let f=0;for(let y=0;y<i;y++){for(const v=e+c;e<v;e++){const b=e<u?p[e]:255;t[f++]=b&128?h:l,t[f++]=b&64?h:l,t[f++]=b&32?h:l,t[f++]=b&16?h:l,t[f++]=b&8?h:l,t[f++]=b&4?h:l,t[f++]=b&2?h:l,t[f++]=b&1?h:l}if(d===0)continue;const g=e<u?p[e++]:255;for(let v=0;v<d;v++)t[f++]=g&1<<7-v?h:l}return{srcPos:e,destPos:f}}const d0=16,u0=100,w_=15,f0=10,ms=16,Jm=new DOMMatrix,zs=new Float32Array(2),Xo=new Float32Array([1/0,1/0,-1/0,-1/0]);function v_(p,e){if(p._removeMirroring)throw new Error("Context is already forwarding operations.");p.__originalSave=p.save,p.__originalRestore=p.restore,p.__originalRotate=p.rotate,p.__originalScale=p.scale,p.__originalTranslate=p.translate,p.__originalTransform=p.transform,p.__originalSetTransform=p.setTransform,p.__originalResetTransform=p.resetTransform,p.__originalClip=p.clip,p.__originalMoveTo=p.moveTo,p.__originalLineTo=p.lineTo,p.__originalBezierCurveTo=p.bezierCurveTo,p.__originalRect=p.rect,p.__originalClosePath=p.closePath,p.__originalBeginPath=p.beginPath,p._removeMirroring=()=>{p.save=p.__originalSave,p.restore=p.__originalRestore,p.rotate=p.__originalRotate,p.scale=p.__originalScale,p.translate=p.__originalTranslate,p.transform=p.__originalTransform,p.setTransform=p.__originalSetTransform,p.resetTransform=p.__originalResetTransform,p.clip=p.__originalClip,p.moveTo=p.__originalMoveTo,p.lineTo=p.__originalLineTo,p.bezierCurveTo=p.__originalBezierCurveTo,p.rect=p.__originalRect,p.closePath=p.__originalClosePath,p.beginPath=p.__originalBeginPath,delete p._removeMirroring},p.save=function(){e.save(),this.__originalSave()},p.restore=function(){e.restore(),this.__originalRestore()},p.translate=function(t,s){e.translate(t,s),this.__originalTranslate(t,s)},p.scale=function(t,s){e.scale(t,s),this.__originalScale(t,s)},p.transform=function(t,s,i,r,a,o){e.transform(t,s,i,r,a,o),this.__originalTransform(t,s,i,r,a,o)},p.setTransform=function(t,s,i,r,a,o){e.setTransform(t,s,i,r,a,o),this.__originalSetTransform(t,s,i,r,a,o)},p.resetTransform=function(){e.resetTransform(),this.__originalResetTransform()},p.rotate=function(t){e.rotate(t),this.__originalRotate(t)},p.clip=function(t){e.clip(t),this.__originalClip(t)},p.moveTo=function(t,s){e.moveTo(t,s),this.__originalMoveTo(t,s)},p.lineTo=function(t,s){e.lineTo(t,s),this.__originalLineTo(t,s)},p.bezierCurveTo=function(t,s,i,r,a,o){e.bezierCurveTo(t,s,i,r,a,o),this.__originalBezierCurveTo(t,s,i,r,a,o)},p.rect=function(t,s,i,r){e.rect(t,s,i,r),this.__originalRect(t,s,i,r)},p.closePath=function(){e.closePath(),this.__originalClosePath()},p.beginPath=function(){e.beginPath(),this.__originalBeginPath()}}class A_{constructor(e){this.canvasFactory=e,this.cache=Object.create(null)}getCanvas(e,t,s){let i;return this.cache[e]!==void 0?(i=this.cache[e],this.canvasFactory.reset(i,t,s)):(i=this.canvasFactory.create(t,s),this.cache[e]=i),i}delete(e){delete this.cache[e]}clear(){for(const e in this.cache){const t=this.cache[e];this.canvasFactory.destroy(t),delete this.cache[e]}}}function Mf(p,e,t,s,i,r,a,o,l,h){const[c,d,u,f,y,g]=oe(p);if(d===0&&u===0){const A=a*c+y,_=Math.round(A),x=o*f+g,k=Math.round(x),T=(a+l)*c+y,P=Math.abs(Math.round(T)-_)||1,F=(o+h)*f+g,R=Math.abs(Math.round(F)-k)||1;return p.setTransform(Math.sign(c),0,0,Math.sign(f),_,k),p.drawImage(e,t,s,i,r,0,0,P,R),p.setTransform(c,d,u,f,y,g),[P,R]}if(c===0&&f===0){const A=o*u+y,_=Math.round(A),x=a*d+g,k=Math.round(x),T=(o+h)*u+y,P=Math.abs(Math.round(T)-_)||1,F=(a+l)*d+g,R=Math.abs(Math.round(F)-k)||1;return p.setTransform(0,Math.sign(d),Math.sign(u),0,_,k),p.drawImage(e,t,s,i,r,0,0,R,P),p.setTransform(c,d,u,f,y,g),[R,P]}p.drawImage(e,t,s,i,r,a,o,l,h);const v=Math.hypot(c,d),b=Math.hypot(u,f);return[v*l,b*h]}class p0{constructor(e,t,s){$(this,"alphaIsShape",!1);$(this,"fontSize",0);$(this,"fontSizeScale",1);$(this,"textMatrix",null);$(this,"textMatrixScale",1);$(this,"fontMatrix",eb);$(this,"leading",0);$(this,"x",0);$(this,"y",0);$(this,"lineX",0);$(this,"lineY",0);$(this,"charSpacing",0);$(this,"wordSpacing",0);$(this,"textHScale",1);$(this,"textRenderingMode",_e.FILL);$(this,"textRise",0);$(this,"fillColor","#000000");$(this,"strokeColor","#000000");$(this,"patternFill",!1);$(this,"patternStroke",!1);$(this,"fillAlpha",1);$(this,"strokeAlpha",1);$(this,"lineWidth",1);$(this,"activeSMask",null);$(this,"transferMaps","none");s==null||s(this),this.clipBox=new Float32Array([0,0,e,t]),this.minMax=Xo.slice()}clone(){const e=Object.create(this);return e.clipBox=this.clipBox.slice(),e.minMax=this.minMax.slice(),e}getPathBoundingBox(e=We.FILL,t=null){const s=this.minMax.slice();if(e===We.STROKE){t||zt("Stroke bounding box must include transform."),ct.singularValueDecompose2dScale(t,zs);const i=zs[0]*this.lineWidth/2,r=zs[1]*this.lineWidth/2;s[0]-=i,s[1]-=r,s[2]+=i,s[3]+=r}return s}updateClipFromPath(){const e=ct.intersect(this.clipBox,this.getPathBoundingBox());this.startNewPathAndClipBox(e||[0,0,0,0])}isEmptyClip(){return this.minMax[0]===1/0}startNewPathAndClipBox(e){this.clipBox.set(e,0),this.minMax.set(Xo,0)}getClippedPathBoundingBox(e=We.FILL,t=null){return ct.intersect(this.clipBox,this.getPathBoundingBox(e,t))}}function g0(p,e){if(e instanceof ImageData){p.putImageData(e,0,0);return}const t=e.height,s=e.width,i=t%ms,r=(t-i)/ms,a=i===0?r:r+1,o=p.createImageData(s,ms);let l=0,h;const c=e.data,d=o.data;let u,f,y,g;if(e.kind===Nf.GRAYSCALE_1BPP){const v=c.byteLength,b=new Uint32Array(d.buffer,0,d.byteLength>>2),A=b.length,_=s+7>>3,x=4294967295,k=Te.isLittleEndian?4278190080:255;for(u=0;u<a;u++){for(y=u<r?ms:i,h=0,f=0;f<y;f++){const T=v-l;let P=0;const F=T>_?s:T*8-7,R=F&-8;let B=0,j=0;for(;P<R;P+=8)j=c[l++],b[h++]=j&128?x:k,b[h++]=j&64?x:k,b[h++]=j&32?x:k,b[h++]=j&16?x:k,b[h++]=j&8?x:k,b[h++]=j&4?x:k,b[h++]=j&2?x:k,b[h++]=j&1?x:k;for(;P<F;P++)B===0&&(j=c[l++],B=128),b[h++]=j&B?x:k,B>>=1}for(;h<A;)b[h++]=0;p.putImageData(o,0,u*ms)}}else if(e.kind===Nf.RGBA_32BPP){for(f=0,g=s*ms*4,u=0;u<r;u++)d.set(c.subarray(l,l+g)),l+=g,p.putImageData(o,0,f),f+=ms;u<a&&(g=s*i*4,d.set(c.subarray(l,l+g)),p.putImageData(o,0,f))}else if(e.kind===Nf.RGB_24BPP)for(y=ms,g=s*y,u=0;u<a;u++){for(u>=r&&(y=i,g=s*y),h=0,f=g;f--;)d[h++]=c[l++],d[h++]=c[l++],d[h++]=c[l++],d[h++]=255;p.putImageData(o,0,u*ms)}else throw new Error(`bad image kind: ${e.kind}`)}function m0(p,e){if(e.bitmap){p.drawImage(e.bitmap,0,0);return}const t=e.height,s=e.width,i=t%ms,r=(t-i)/ms,a=i===0?r:r+1,o=p.createImageData(s,ms);let l=0;const h=e.data,c=o.data;for(let d=0;d<a;d++){const u=d<r?ms:i;({srcPos:l}=y_({src:h,srcPos:l,dest:c,width:s,height:u,nonBlackColor:0})),p.putImageData(o,0,d*ms)}}function sc(p,e){const t=["strokeStyle","fillStyle","fillRule","globalAlpha","lineWidth","lineCap","lineJoin","miterLimit","globalCompositeOperation","font","filter"];for(const s of t)p[s]!==void 0&&(e[s]=p[s]);p.setLineDash!==void 0&&(e.setLineDash(p.getLineDash()),e.lineDashOffset=p.lineDashOffset)}function Rf(p){p.strokeStyle=p.fillStyle="#000000",p.fillRule="nonzero",p.globalAlpha=1,p.lineWidth=1,p.lineCap="butt",p.lineJoin="miter",p.miterLimit=10,p.globalCompositeOperation="source-over",p.font="10px sans-serif",p.setLineDash!==void 0&&(p.setLineDash([]),p.lineDashOffset=0);const{filter:e}=p;e!=="none"&&e!==""&&(p.filter="none")}function b0(p,e){if(e)return!0;ct.singularValueDecompose2dScale(p,zs);const t=Math.fround(Ki.pixelRatio*$r.PDF_TO_CSS_UNITS);return zs[0]<=t&&zs[1]<=t}const __=["butt","round","square"],S_=["miter","round","bevel"],E_={},y0={};var Ld,Rb,Fd,Lb,Od,Fb;const Wy=class Wy{constructor(e,t,s,i,r,{optionalContentConfig:a,markedContentStack:o=null},l,h,c){m(this,Ld);m(this,Fd);m(this,Od);this.ctx=e,this.current=new p0(this.ctx.canvas.width,this.ctx.canvas.height),this.stateStack=[],this.pendingClip=null,this.pendingEOFill=!1,this.res=null,this.xobjs=null,this.commonObjs=t,this.objs=s,this.canvasFactory=i,this.filterFactory=r,this.groupStack=[],this.baseTransform=null,this.baseTransformStack=[],this.groupLevel=0,this.smaskStack=[],this.smaskCounter=0,this.tempSMask=null,this.suspendedCtx=null,this.contentVisible=!0,this.markedContentStack=o||[],this.optionalContentConfig=a,this.cachedCanvases=new A_(this.canvasFactory),this.cachedPatterns=new Map,this.annotationCanvasMap=l,this.viewportScale=1,this.outputScaleX=1,this.outputScaleY=1,this.pageColors=h,this._cachedScaleForStroking=[-1,0],this._cachedGetSinglePixelWidth=null,this._cachedBitmapsMap=new Map,this.dependencyTracker=c??null}getObject(e,t,s=null){var i;return typeof t=="string"?((i=this.dependencyTracker)==null||i.recordNamedDependency(e,t),t.startsWith("g_")?this.commonObjs.get(t):this.objs.get(t)):s}beginDrawing({transform:e,viewport:t,transparency:s=!1,background:i=null}){const r=this.ctx.canvas.width,a=this.ctx.canvas.height,o=this.ctx.fillStyle;if(this.ctx.fillStyle=i||"#ffffff",this.ctx.fillRect(0,0,r,a),this.ctx.fillStyle=o,s){const l=this.cachedCanvases.getCanvas("transparent",r,a);this.compositeCtx=this.ctx,this.transparentCanvas=l.canvas,this.ctx=l.context,this.ctx.save(),this.ctx.transform(...oe(this.compositeCtx))}this.ctx.save(),Rf(this.ctx),e&&(this.ctx.transform(...e),this.outputScaleX=e[0],this.outputScaleY=e[0]),this.ctx.transform(...t.transform),this.viewportScale=t.scale,this.baseTransform=oe(this.ctx)}executeOperatorList(e,t,s,i,r){var b;const a=e.argsArray,o=e.fnArray;let l=t||0;const h=a.length;if(h===l)return l;const c=h-l>f0&&typeof s=="function",d=c?Date.now()+w_:0;let u=0;const f=this.commonObjs,y=this.objs;let g,v;for(;;){if(i!==void 0&&l===i.nextBreakPoint)return i.breakIt(l,s),l;if(!r||r(l))if(g=o[l],v=a[l]??null,g!==Tc.dependency)v===null?this[g](l):this[g](l,...v);else for(const A of v){(b=this.dependencyTracker)==null||b.recordNamedData(A,l);const _=A.startsWith("g_")?f:y;if(!_.has(A))return _.get(A,s),l}if(l++,l===h)return l;if(c&&++u>f0){if(Date.now()>d)return s(),l;u=0}}}endDrawing(){E(this,Ld,Rb).call(this),this.cachedCanvases.clear(),this.cachedPatterns.clear();for(const e of this._cachedBitmapsMap.values()){for(const t of e.values())typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement&&(t.width=t.height=0);e.clear()}this._cachedBitmapsMap.clear(),E(this,Fd,Lb).call(this)}_scaleImage(e,t){const s=e.width??e.displayWidth,i=e.height??e.displayHeight;let r=Math.max(Math.hypot(t[0],t[1]),1),a=Math.max(Math.hypot(t[2],t[3]),1),o=s,l=i,h="prescale1",c,d;for(;r>2&&o>1||a>2&&l>1;){let u=o,f=l;r>2&&o>1&&(u=o>=16384?Math.floor(o/2)-1||1:Math.ceil(o/2),r/=o/u),a>2&&l>1&&(f=l>=16384?Math.floor(l/2)-1||1:Math.ceil(l)/2,a/=l/f),c=this.cachedCanvases.getCanvas(h,u,f),d=c.context,d.clearRect(0,0,u,f),d.drawImage(e,0,0,o,l,0,0,u,f),e=c.canvas,o=u,l=f,h=h==="prescale1"?"prescale2":"prescale1"}return{img:e,paintWidth:o,paintHeight:l}}_createMaskCanvas(e,t){var B,j;const s=this.ctx,{width:i,height:r}=t,a=this.current.fillColor,o=this.current.patternFill,l=oe(s);let h,c,d,u;if((t.bitmap||t.data)&&t.count>1){const I=t.bitmap||t.data.buffer;c=JSON.stringify(o?l:[l.slice(0,4),a]),h=this._cachedBitmapsMap.get(I),h||(h=new Map,this._cachedBitmapsMap.set(I,h));const L=h.get(c);if(L&&!o){const S=Math.round(Math.min(l[0],l[2])+l[4]),N=Math.round(Math.min(l[1],l[3])+l[5]);return(B=this.dependencyTracker)==null||B.recordDependencies(e,Hs.transformAndFill),{canvas:L,offsetX:S,offsetY:N}}d=L}d||(u=this.cachedCanvases.getCanvas("maskCanvas",i,r),m0(u.context,t));let f=ct.transform(l,[1/i,0,0,-1/r,0,0]);f=ct.transform(f,[1,0,0,1,0,-r]);const y=Xo.slice();ct.axialAlignedBoundingBox([0,0,i,r],f,y);const[g,v,b,A]=y,_=Math.round(b-g)||1,x=Math.round(A-v)||1,k=this.cachedCanvases.getCanvas("fillCanvas",_,x),T=k.context,P=g,F=v;T.translate(-P,-F),T.transform(...f),d||(d=this._scaleImage(u.canvas,_i(T)),d=d.img,h&&o&&h.set(c,d)),T.imageSmoothingEnabled=b0(oe(T),t.interpolate),Mf(T,d,0,0,d.width,d.height,0,0,i,r),T.globalCompositeOperation="source-in";const R=ct.transform(_i(T),[1,0,0,1,-P,-F]);return T.fillStyle=o?a.getPattern(s,this,R,We.FILL,e):a,T.fillRect(0,0,i,r),h&&!o&&(this.cachedCanvases.delete("fillCanvas"),h.set(c,k.canvas)),(j=this.dependencyTracker)==null||j.recordDependencies(e,Hs.transformAndFill),{canvas:k.canvas,offsetX:Math.round(P),offsetY:Math.round(F)}}setLineWidth(e,t){var s;(s=this.dependencyTracker)==null||s.recordSimpleData("lineWidth",e),t!==this.current.lineWidth&&(this._cachedScaleForStroking[0]=-1),this.current.lineWidth=t,this.ctx.lineWidth=t}setLineCap(e,t){var s;(s=this.dependencyTracker)==null||s.recordSimpleData("lineCap",e),this.ctx.lineCap=__[t]}setLineJoin(e,t){var s;(s=this.dependencyTracker)==null||s.recordSimpleData("lineJoin",e),this.ctx.lineJoin=S_[t]}setMiterLimit(e,t){var s;(s=this.dependencyTracker)==null||s.recordSimpleData("miterLimit",e),this.ctx.miterLimit=t}setDash(e,t,s){var r;(r=this.dependencyTracker)==null||r.recordSimpleData("dash",e);const i=this.ctx;i.setLineDash!==void 0&&(i.setLineDash(t),i.lineDashOffset=s)}setRenderingIntent(e,t){}setFlatness(e,t){}setGState(e,t){var s,i,r,a,o;for(const[l,h]of t)switch(l){case"LW":this.setLineWidth(e,h);break;case"LC":this.setLineCap(e,h);break;case"LJ":this.setLineJoin(e,h);break;case"ML":this.setMiterLimit(e,h);break;case"D":this.setDash(e,h[0],h[1]);break;case"RI":this.setRenderingIntent(e,h);break;case"FL":this.setFlatness(e,h);break;case"Font":this.setFont(e,h[0],h[1]);break;case"CA":(s=this.dependencyTracker)==null||s.recordSimpleData("strokeAlpha",e),this.current.strokeAlpha=h;break;case"ca":(i=this.dependencyTracker)==null||i.recordSimpleData("fillAlpha",e),this.ctx.globalAlpha=this.current.fillAlpha=h;break;case"BM":(r=this.dependencyTracker)==null||r.recordSimpleData("globalCompositeOperation",e),this.ctx.globalCompositeOperation=h;break;case"SMask":(a=this.dependencyTracker)==null||a.recordSimpleData("SMask",e),this.current.activeSMask=h?this.tempSMask:null,this.tempSMask=null,this.checkSMaskState();break;case"TR":(o=this.dependencyTracker)==null||o.recordSimpleData("filter",e),this.ctx.filter=this.current.transferMaps=this.filterFactory.addFilter(h);break}}get inSMaskMode(){return!!this.suspendedCtx}checkSMaskState(){const e=this.inSMaskMode;this.current.activeSMask&&!e?this.beginSMaskMode():!this.current.activeSMask&&e&&this.endSMaskMode()}beginSMaskMode(e){if(this.inSMaskMode)throw new Error("beginSMaskMode called while already in smask mode");const t=this.ctx.canvas.width,s=this.ctx.canvas.height,i="smaskGroupAt"+this.groupLevel,r=this.cachedCanvases.getCanvas(i,t,s);this.suspendedCtx=this.ctx;const a=this.ctx=r.context;a.setTransform(this.suspendedCtx.getTransform()),sc(this.suspendedCtx,a),v_(a,this.suspendedCtx),this.setGState(e,[["BM","source-over"]])}endSMaskMode(){if(!this.inSMaskMode)throw new Error("endSMaskMode called while not in smask mode");this.ctx._removeMirroring(),sc(this.ctx,this.suspendedCtx),this.ctx=this.suspendedCtx,this.suspendedCtx=null}compose(e){if(!this.current.activeSMask)return;e?(e[0]=Math.floor(e[0]),e[1]=Math.floor(e[1]),e[2]=Math.ceil(e[2]),e[3]=Math.ceil(e[3])):e=[0,0,this.ctx.canvas.width,this.ctx.canvas.height];const t=this.current.activeSMask,s=this.suspendedCtx;this.composeSMask(s,t,this.ctx,e),this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.restore()}composeSMask(e,t,s,i){const r=i[0],a=i[1],o=i[2]-r,l=i[3]-a;o===0||l===0||(this.genericComposeSMask(t.context,s,o,l,t.subtype,t.backdrop,t.transferMap,r,a,t.offsetX,t.offsetY),e.save(),e.globalAlpha=1,e.globalCompositeOperation="source-over",e.setTransform(1,0,0,1,0,0),e.drawImage(s.canvas,0,0),e.restore())}genericComposeSMask(e,t,s,i,r,a,o,l,h,c,d){let u=e.canvas,f=l-c,y=h-d;if(a)if(f<0||y<0||f+s>u.width||y+i>u.height){const v=this.cachedCanvases.getCanvas("maskExtension",s,i),b=v.context;b.drawImage(u,-f,-y),b.globalCompositeOperation="destination-atop",b.fillStyle=a,b.fillRect(0,0,s,i),b.globalCompositeOperation="source-over",u=v.canvas,f=y=0}else{e.save(),e.globalAlpha=1,e.setTransform(1,0,0,1,0,0);const v=new Path2D;v.rect(f,y,s,i),e.clip(v),e.globalCompositeOperation="destination-atop",e.fillStyle=a,e.fillRect(f,y,s,i),e.restore()}t.save(),t.globalAlpha=1,t.setTransform(1,0,0,1,0,0),r==="Alpha"&&o?t.filter=this.filterFactory.addAlphaFilter(o):r==="Luminosity"&&(t.filter=this.filterFactory.addLuminosityFilter(o));const g=new Path2D;g.rect(l,h,s,i),t.clip(g),t.globalCompositeOperation="destination-in",t.drawImage(u,f,y,s,i,l,h,s,i),t.restore()}save(e){var s;this.inSMaskMode&&sc(this.ctx,this.suspendedCtx),this.ctx.save();const t=this.current;this.stateStack.push(t),this.current=t.clone(),(s=this.dependencyTracker)==null||s.save(e)}restore(e){var t;if((t=this.dependencyTracker)==null||t.restore(e),this.stateStack.length===0){this.inSMaskMode&&this.endSMaskMode();return}this.current=this.stateStack.pop(),this.ctx.restore(),this.inSMaskMode&&sc(this.suspendedCtx,this.ctx),this.checkSMaskState(),this.pendingClip=null,this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}transform(e,t,s,i,r,a,o){var l;(l=this.dependencyTracker)==null||l.recordIncrementalData("transform",e),this.ctx.transform(t,s,i,r,a,o),this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}constructPath(e,t,s,i){let[r]=s;if(!i){r||(r=s[0]=new Path2D),this[t](e,r);return}if(this.dependencyTracker!==null){const a=t===Tc.stroke?this.current.lineWidth/2:0;this.dependencyTracker.resetBBox(e).recordBBox(e,this.ctx,i[0]-a,i[2]+a,i[1]-a,i[3]+a).recordDependencies(e,["transform"])}r instanceof Path2D||(r=s[0]=W0(r)),ct.axialAlignedBoundingBox(i,oe(this.ctx),this.current.minMax),this[t](e,r),this._pathStartIdx=e}closePath(e){this.ctx.closePath()}stroke(e,t,s=!0){var a;const i=this.ctx,r=this.current.strokeColor;if(i.globalAlpha=this.current.strokeAlpha,this.contentVisible)if(typeof r=="object"&&(r!=null&&r.getPattern)){const o=r.isModifyingCurrentTransform()?i.getTransform():null;if(i.save(),i.strokeStyle=r.getPattern(i,this,_i(i),We.STROKE,e),o){const l=new Path2D;l.addPath(t,i.getTransform().invertSelf().multiplySelf(o)),t=l}this.rescaleAndStroke(t,!1),i.restore()}else this.rescaleAndStroke(t,!0);(a=this.dependencyTracker)==null||a.recordDependencies(e,Hs.stroke),s&&this.consumePath(e,t,this.current.getClippedPathBoundingBox(We.STROKE,oe(this.ctx))),i.globalAlpha=this.current.fillAlpha}closeStroke(e,t){this.stroke(e,t)}fill(e,t,s=!0){var h,c,d;const i=this.ctx,r=this.current.fillColor,a=this.current.patternFill;let o=!1;if(a){const u=r.isModifyingCurrentTransform()?i.getTransform():null;if((h=this.dependencyTracker)==null||h.save(e),i.save(),i.fillStyle=r.getPattern(i,this,_i(i),We.FILL,e),u){const f=new Path2D;f.addPath(t,i.getTransform().invertSelf().multiplySelf(u)),t=f}o=!0}const l=this.current.getClippedPathBoundingBox();this.contentVisible&&l!==null&&(this.pendingEOFill?(i.fill(t,"evenodd"),this.pendingEOFill=!1):i.fill(t)),(c=this.dependencyTracker)==null||c.recordDependencies(e,Hs.fill),o&&(i.restore(),(d=this.dependencyTracker)==null||d.restore(e)),s&&this.consumePath(e,t,l)}eoFill(e,t){this.pendingEOFill=!0,this.fill(e,t)}fillStroke(e,t){this.fill(e,t,!1),this.stroke(e,t,!1),this.consumePath(e,t)}eoFillStroke(e,t){this.pendingEOFill=!0,this.fillStroke(e,t)}closeFillStroke(e,t){this.fillStroke(e,t)}closeEOFillStroke(e,t){this.pendingEOFill=!0,this.fillStroke(e,t)}endPath(e,t){this.consumePath(e,t)}rawFillPath(e,t){var s;this.ctx.fill(t),(s=this.dependencyTracker)==null||s.recordDependencies(e,Hs.rawFillPath).recordOperation(e)}clip(e){var t;(t=this.dependencyTracker)==null||t.recordFutureForcedDependency("clipMode",e),this.pendingClip=E_}eoClip(e){var t;(t=this.dependencyTracker)==null||t.recordFutureForcedDependency("clipMode",e),this.pendingClip=y0}beginText(e){var t;this.current.textMatrix=null,this.current.textMatrixScale=1,this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0,(t=this.dependencyTracker)==null||t.recordOpenMarker(e).resetIncrementalData("sameLineText").resetIncrementalData("moveText",e)}endText(e){const t=this.pendingTextPaths,s=this.ctx;if(this.dependencyTracker){const{dependencyTracker:i}=this;t!==void 0&&i.recordFutureForcedDependency("textClip",i.getOpenMarker()).recordFutureForcedDependency("textClip",e),i.recordCloseMarker(e)}if(t!==void 0){const i=new Path2D,r=s.getTransform().invertSelf();for(const{transform:a,x:o,y:l,fontSize:h,path:c}of t)c&&i.addPath(c,new DOMMatrix(a).preMultiplySelf(r).translate(o,l).scale(h,-h));s.clip(i)}delete this.pendingTextPaths}setCharSpacing(e,t){var s;(s=this.dependencyTracker)==null||s.recordSimpleData("charSpacing",e),this.current.charSpacing=t}setWordSpacing(e,t){var s;(s=this.dependencyTracker)==null||s.recordSimpleData("wordSpacing",e),this.current.wordSpacing=t}setHScale(e,t){var s;(s=this.dependencyTracker)==null||s.recordSimpleData("hScale",e),this.current.textHScale=t/100}setLeading(e,t){var s;(s=this.dependencyTracker)==null||s.recordSimpleData("leading",e),this.current.leading=-t}setFont(e,t,s){var d,u;(d=this.dependencyTracker)==null||d.recordSimpleData("font",e).recordSimpleDataFromNamed("fontObj",t,e);const i=this.commonObjs.get(t),r=this.current;if(!i)throw new Error(`Can't find font for ${t}`);if(r.fontMatrix=i.fontMatrix||eb,(r.fontMatrix[0]===0||r.fontMatrix[3]===0)&&At("Invalid font matrix for font "+t),s<0?(s=-s,r.fontDirection=-1):r.fontDirection=1,this.current.font=i,this.current.fontSize=s,i.isType3Font)return;const a=i.loadedName||"sans-serif",o=((u=i.systemFontInfo)==null?void 0:u.css)||`"${a}", ${i.fallbackName}`;let l="normal";i.black?l="900":i.bold&&(l="bold");const h=i.italic?"italic":"normal";let c=s;s<d0?c=d0:s>u0&&(c=u0),this.current.fontSizeScale=s/c,this.ctx.font=`${h} ${l} ${c}px ${o}`}setTextRenderingMode(e,t){var s;(s=this.dependencyTracker)==null||s.recordSimpleData("textRenderingMode",e),this.current.textRenderingMode=t}setTextRise(e,t){var s;(s=this.dependencyTracker)==null||s.recordSimpleData("textRise",e),this.current.textRise=t}moveText(e,t,s){var i;(i=this.dependencyTracker)==null||i.resetIncrementalData("sameLineText").recordIncrementalData("moveText",e),this.current.x=this.current.lineX+=t,this.current.y=this.current.lineY+=s}setLeadingMoveText(e,t,s){this.setLeading(e,-s),this.moveText(e,t,s)}setTextMatrix(e,t){var i;(i=this.dependencyTracker)==null||i.resetIncrementalData("sameLineText").recordSimpleData("textMatrix",e);const{current:s}=this;s.textMatrix=t,s.textMatrixScale=Math.hypot(t[0],t[1]),s.x=s.lineX=0,s.y=s.lineY=0}nextLine(e){var t;this.moveText(e,0,this.current.leading),(t=this.dependencyTracker)==null||t.recordIncrementalData("moveText",this.dependencyTracker.getSimpleIndex("leading")??e)}paintChar(e,t,s,i,r,a){var b,A,_,x;const o=this.ctx,l=this.current,h=l.font,c=l.textRenderingMode,d=l.fontSize/l.fontSizeScale,u=c&_e.FILL_STROKE_MASK,f=!!(c&_e.ADD_TO_PATH_FLAG),y=l.patternFill&&!h.missingFile,g=l.patternStroke&&!h.missingFile;let v;if((h.disableFontFace||f||y||g)&&!h.missingFile&&(v=h.getPathGenerator(this.commonObjs,t)),v&&(h.disableFontFace||y||g)){o.save(),o.translate(s,i),o.scale(d,-d),(b=this.dependencyTracker)==null||b.recordCharacterBBox(e,o,h);let k;if(u===_e.FILL||u===_e.FILL_STROKE)if(r){k=o.getTransform(),o.setTransform(...r);const T=E(this,Od,Fb).call(this,v,k,r);o.fill(T)}else o.fill(v);if(u===_e.STROKE||u===_e.FILL_STROKE)if(a){k||(k=o.getTransform()),o.setTransform(...a);const{a:T,b:P,c:F,d:R}=k,B=ct.inverseTransform(a),j=ct.transform([T,P,F,R,0,0],B);ct.singularValueDecompose2dScale(j,zs),o.lineWidth*=Math.max(zs[0],zs[1])/d,o.stroke(E(this,Od,Fb).call(this,v,k,a))}else o.lineWidth/=d,o.stroke(v);o.restore()}else(u===_e.FILL||u===_e.FILL_STROKE)&&(o.fillText(t,s,i),(A=this.dependencyTracker)==null||A.recordCharacterBBox(e,o,h,d,s,i,()=>o.measureText(t))),(u===_e.STROKE||u===_e.FILL_STROKE)&&(this.dependencyTracker&&((_=this.dependencyTracker)==null||_.recordCharacterBBox(e,o,h,d,s,i,()=>o.measureText(t)).recordDependencies(e,Hs.stroke)),o.strokeText(t,s,i));f&&((this.pendingTextPaths||(this.pendingTextPaths=[])).push({transform:oe(o),x:s,y:i,fontSize:d,path:v}),(x=this.dependencyTracker)==null||x.recordCharacterBBox(e,o,h,d,s,i))}get isFontSubpixelAAEnabled(){const{context:e}=this.cachedCanvases.getCanvas("isFontSubpixelAAEnabled",10,10);e.scale(1.5,1),e.fillText("I",0,10);const t=e.getImageData(0,0,10,10).data;let s=!1;for(let i=3;i<t.length;i+=4)if(t[i]>0&&t[i]<255){s=!0;break}return _t(this,"isFontSubpixelAAEnabled",s)}showText(e,t){var j,I,L,S;this.dependencyTracker&&(this.dependencyTracker.recordDependencies(e,Hs.showText).resetBBox(e),this.current.textRenderingMode&_e.ADD_TO_PATH_FLAG&&this.dependencyTracker.recordFutureForcedDependency("textClip",e).inheritPendingDependenciesAsFutureForcedDependencies());const s=this.current,i=s.font;if(i.isType3Font){this.showType3Text(e,t),(j=this.dependencyTracker)==null||j.recordShowTextOperation(e);return}const r=s.fontSize;if(r===0){(I=this.dependencyTracker)==null||I.recordOperation(e);return}const a=this.ctx,o=s.fontSizeScale,l=s.charSpacing,h=s.wordSpacing,c=s.fontDirection,d=s.textHScale*c,u=t.length,f=i.vertical,y=f?1:-1,g=i.defaultVMetrics,v=r*s.fontMatrix[0],b=s.textRenderingMode===_e.FILL&&!i.disableFontFace&&!s.patternFill;a.save(),s.textMatrix&&a.transform(...s.textMatrix),a.translate(s.x,s.y+s.textRise),c>0?a.scale(d,-1):a.scale(d,1);let A,_;const x=s.textRenderingMode&_e.FILL_STROKE_MASK,k=x===_e.FILL||x===_e.FILL_STROKE,T=x===_e.STROKE||x===_e.FILL_STROKE;if(k&&s.patternFill){a.save();const N=s.fillColor.getPattern(a,this,_i(a),We.FILL,e);A=oe(a),a.restore(),a.fillStyle=N}if(T&&s.patternStroke){a.save();const N=s.strokeColor.getPattern(a,this,_i(a),We.STROKE,e);_=oe(a),a.restore(),a.strokeStyle=N}let P=s.lineWidth;const F=s.textMatrixScale;if(F===0||P===0?T&&(P=this.getSinglePixelWidth()):P/=F,o!==1&&(a.scale(o,o),P/=o),a.lineWidth=P,i.isInvalidPDFjsFont){const N=[];let G=0;for(const it of t)N.push(it.unicode),G+=it.width;const U=N.join("");if(a.fillText(U,0,0),this.dependencyTracker!==null){const it=a.measureText(U);this.dependencyTracker.recordBBox(e,this.ctx,-it.actualBoundingBoxLeft,it.actualBoundingBoxRight,-it.actualBoundingBoxAscent,it.actualBoundingBoxDescent).recordShowTextOperation(e)}s.x+=G*v*d,a.restore(),this.compose();return}let R=0,B;for(B=0;B<u;++B){const N=t[B];if(typeof N=="number"){R+=y*N*r/1e3;continue}let G=!1;const U=(N.isSpace?h:0)+l,it=N.fontChar,Y=N.accent;let lt,H,O=N.width;if(f){const J=N.vmetric||g,bt=-(N.vmetric?J[1]:O*.5)*v,pt=J[2]*v;O=J?-J[0]:O,lt=bt/o,H=(R+pt)/o}else lt=R/o,H=0;let Q;if(i.remeasure&&O>0){Q=a.measureText(it);const J=Q.width*1e3/r*o;if(O<J&&this.isFontSubpixelAAEnabled){const bt=O/J;G=!0,a.save(),a.scale(bt,1),lt/=bt}else O!==J&&(lt+=(O-J)/2e3*r/o)}if(this.contentVisible&&(N.isInFont||i.missingFile)){if(b&&!Y)a.fillText(it,lt,H),(L=this.dependencyTracker)==null||L.recordCharacterBBox(e,a,Q?{bbox:null}:i,r/o,lt,H,()=>Q??a.measureText(it));else if(this.paintChar(e,it,lt,H,A,_),Y){const J=lt+r*Y.offset.x/o,bt=H-r*Y.offset.y/o;this.paintChar(e,Y.fontChar,J,bt,A,_)}}const tt=f?O*v-U*c:O*v+U*c;R+=tt,G&&a.restore()}f?s.y-=R:s.x+=R*d,a.restore(),this.compose(),(S=this.dependencyTracker)==null||S.recordShowTextOperation(e)}showType3Text(e,t){const s=this.ctx,i=this.current,r=i.font,a=i.fontSize,o=i.fontDirection,l=r.vertical?1:-1,h=i.charSpacing,c=i.wordSpacing,d=i.textHScale*o,u=i.fontMatrix||eb,f=t.length,y=i.textRenderingMode===_e.INVISIBLE;let g,v,b,A;if(y||a===0)return;this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null,s.save(),i.textMatrix&&s.transform(...i.textMatrix),s.translate(i.x,i.y+i.textRise),s.scale(d,o);const _=this.dependencyTracker;for(this.dependencyTracker=_?new Cp(_,e):null,g=0;g<f;++g){if(v=t[g],typeof v=="number"){A=l*v*a/1e3,this.ctx.translate(A,0),i.x+=A*d;continue}const x=(v.isSpace?c:0)+h,k=r.charProcOperatorList[v.operatorListId];k?this.contentVisible&&(this.save(),s.scale(a,a),s.transform(...u),this.executeOperatorList(k),this.restore()):At(`Type3 character "${v.operatorListId}" is not available.`);const T=[v.width,0];ct.applyTransform(T,u),b=T[0]*a+x,s.translate(b,0),i.x+=b*d}s.restore(),_&&(this.dependencyTracker=_)}setCharWidth(e,t,s){}setCharWidthAndBounds(e,t,s,i,r,a,o){var h;const l=new Path2D;l.rect(i,r,a-i,o-r),this.ctx.clip(l),(h=this.dependencyTracker)==null||h.recordBBox(e,this.ctx,i,a,r,o).recordClipBox(e,this.ctx,i,a,r,o),this.endPath(e)}getColorN_Pattern(e,t){let s;if(t[0]==="TilingPattern"){const i=this.baseTransform||oe(this.ctx),r={createCanvasGraphics:(a,o)=>new Wy(a,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:this.optionalContentConfig,markedContentStack:this.markedContentStack},void 0,void 0,this.dependencyTracker?new Cp(this.dependencyTracker,o,!0):null)};s=new Mb(t,this.ctx,r,i)}else s=this._getPattern(e,t[1],t[2]);return s}setStrokeColorN(e,...t){var s;(s=this.dependencyTracker)==null||s.recordSimpleData("strokeColor",e),this.current.strokeColor=this.getColorN_Pattern(e,t),this.current.patternStroke=!0}setFillColorN(e,...t){var s;(s=this.dependencyTracker)==null||s.recordSimpleData("fillColor",e),this.current.fillColor=this.getColorN_Pattern(e,t),this.current.patternFill=!0}setStrokeRGBColor(e,t){var s;(s=this.dependencyTracker)==null||s.recordSimpleData("strokeColor",e),this.ctx.strokeStyle=this.current.strokeColor=t,this.current.patternStroke=!1}setStrokeTransparent(e){var t;(t=this.dependencyTracker)==null||t.recordSimpleData("strokeColor",e),this.ctx.strokeStyle=this.current.strokeColor="transparent",this.current.patternStroke=!1}setFillRGBColor(e,t){var s;(s=this.dependencyTracker)==null||s.recordSimpleData("fillColor",e),this.ctx.fillStyle=this.current.fillColor=t,this.current.patternFill=!1}setFillTransparent(e){var t;(t=this.dependencyTracker)==null||t.recordSimpleData("fillColor",e),this.ctx.fillStyle=this.current.fillColor="transparent",this.current.patternFill=!1}_getPattern(e,t,s=null){let i;return this.cachedPatterns.has(t)?i=this.cachedPatterns.get(t):(i=b_(this.getObject(e,t)),this.cachedPatterns.set(t,i)),s&&(i.matrix=s),i}shadingFill(e,t){var a;if(!this.contentVisible)return;const s=this.ctx;this.save(e);const i=this._getPattern(e,t);s.fillStyle=i.getPattern(s,this,_i(s),We.SHADING,e);const r=_i(s);if(r){const{width:o,height:l}=s.canvas,h=Xo.slice();ct.axialAlignedBoundingBox([0,0,o,l],r,h);const[c,d,u,f]=h;this.ctx.fillRect(c,d,u-c,f-d)}else this.ctx.fillRect(-1e10,-1e10,2e10,2e10);(a=this.dependencyTracker)==null||a.resetBBox(e).recordFullPageBBox(e).recordDependencies(e,Hs.transform).recordDependencies(e,Hs.fill).recordOperation(e),this.compose(this.current.getClippedPathBoundingBox()),this.restore(e)}beginInlineImage(){zt("Should not call beginInlineImage")}beginImageData(){zt("Should not call beginImageData")}paintFormXObjectBegin(e,t,s){var i;if(this.contentVisible&&(this.save(e),this.baseTransformStack.push(this.baseTransform),t&&this.transform(e,...t),this.baseTransform=oe(this.ctx),s)){ct.axialAlignedBoundingBox(s,this.baseTransform,this.current.minMax);const[r,a,o,l]=s,h=new Path2D;h.rect(r,a,o-r,l-a),this.ctx.clip(h),(i=this.dependencyTracker)==null||i.recordClipBox(e,this.ctx,r,o,a,l),this.endPath(e)}}paintFormXObjectEnd(e){this.contentVisible&&(this.restore(e),this.baseTransform=this.baseTransformStack.pop())}beginGroup(e,t){var _;if(!this.contentVisible)return;this.save(e),this.inSMaskMode&&(this.endSMaskMode(),this.current.activeSMask=null);const s=this.ctx;t.isolated||Nm("TODO: Support non-isolated groups."),t.knockout&&At("Knockout groups not supported.");const i=oe(s);if(t.matrix&&s.transform(...t.matrix),!t.bbox)throw new Error("Bounding box is required.");let r=Xo.slice();ct.axialAlignedBoundingBox(t.bbox,oe(s),r);const a=[0,0,s.canvas.width,s.canvas.height];r=ct.intersect(r,a)||[0,0,0,0];const o=Math.floor(r[0]),l=Math.floor(r[1]),h=Math.max(Math.ceil(r[2])-o,1),c=Math.max(Math.ceil(r[3])-l,1);this.current.startNewPathAndClipBox([0,0,h,c]);let d="groupAt"+this.groupLevel;t.smask&&(d+="_smask_"+this.smaskCounter++%2);const u=this.cachedCanvases.getCanvas(d,h,c),f=u.context;f.translate(-o,-l),f.transform(...i);let y=new Path2D;const[g,v,b,A]=t.bbox;if(y.rect(g,v,b-g,A-v),t.matrix){const x=new Path2D;x.addPath(y,new DOMMatrix(t.matrix)),y=x}f.clip(y),t.smask&&this.smaskStack.push({canvas:u.canvas,context:f,offsetX:o,offsetY:l,subtype:t.smask.subtype,backdrop:t.smask.backdrop,transferMap:t.smask.transferMap||null,startTransformInverse:null}),(!t.smask||this.dependencyTracker)&&(s.setTransform(1,0,0,1,0,0),s.translate(o,l),s.save()),sc(s,f),this.ctx=f,(_=this.dependencyTracker)==null||_.inheritSimpleDataAsFutureForcedDependencies(["fillAlpha","strokeAlpha","globalCompositeOperation"]).pushBaseTransform(s),this.setGState(e,[["BM","source-over"],["ca",1],["CA",1]]),this.groupStack.push(s),this.groupLevel++}endGroup(e,t){var r;if(!this.contentVisible)return;this.groupLevel--;const s=this.ctx,i=this.groupStack.pop();if(this.ctx=i,this.ctx.imageSmoothingEnabled=!1,(r=this.dependencyTracker)==null||r.popBaseTransform(),t.smask)this.tempSMask=this.smaskStack.pop(),this.restore(e),this.dependencyTracker&&this.ctx.restore();else{this.ctx.restore();const a=oe(this.ctx);this.restore(e),this.ctx.save(),this.ctx.setTransform(...a);const o=Xo.slice();ct.axialAlignedBoundingBox([0,0,s.canvas.width,s.canvas.height],a,o),this.ctx.drawImage(s.canvas,0,0),this.ctx.restore(),this.compose(o)}}beginAnnotation(e,t,s,i,r,a){if(E(this,Ld,Rb).call(this),Rf(this.ctx),this.ctx.save(),this.save(e),this.baseTransform&&this.ctx.setTransform(...this.baseTransform),s){const o=s[2]-s[0],l=s[3]-s[1];if(a&&this.annotationCanvasMap){i=i.slice(),i[4]-=s[0],i[5]-=s[1],s=s.slice(),s[0]=s[1]=0,s[2]=o,s[3]=l,ct.singularValueDecompose2dScale(oe(this.ctx),zs);const{viewportScale:h}=this,c=Math.ceil(o*this.outputScaleX*h),d=Math.ceil(l*this.outputScaleY*h);this.annotationCanvas=this.canvasFactory.create(c,d);const{canvas:u,context:f}=this.annotationCanvas;this.annotationCanvasMap.set(t,u),this.annotationCanvas.savedCtx=this.ctx,this.ctx=f,this.ctx.save(),this.ctx.setTransform(zs[0],0,0,-zs[1],0,l*zs[1]),Rf(this.ctx)}else{Rf(this.ctx),this.endPath(e);const h=new Path2D;h.rect(s[0],s[1],o,l),this.ctx.clip(h)}}this.current=new p0(this.ctx.canvas.width,this.ctx.canvas.height),this.transform(e,...i),this.transform(e,...r)}endAnnotation(e){this.annotationCanvas&&(this.ctx.restore(),E(this,Fd,Lb).call(this),this.ctx=this.annotationCanvas.savedCtx,delete this.annotationCanvas.savedCtx,delete this.annotationCanvas)}paintImageMaskXObject(e,t){var o;if(!this.contentVisible)return;const s=t.count;t=this.getObject(e,t.data,t),t.count=s;const i=this.ctx,r=this._createMaskCanvas(e,t),a=r.canvas;i.save(),i.setTransform(1,0,0,1,0,0),i.drawImage(a,r.offsetX,r.offsetY),(o=this.dependencyTracker)==null||o.resetBBox(e).recordBBox(e,this.ctx,r.offsetX,r.offsetX+a.width,r.offsetY,r.offsetY+a.height).recordOperation(e),i.restore(),this.compose()}paintImageMaskXObjectRepeat(e,t,s,i=0,r=0,a,o){var d,u,f;if(!this.contentVisible)return;t=this.getObject(e,t.data,t);const l=this.ctx;l.save();const h=oe(l);l.transform(s,i,r,a,0,0);const c=this._createMaskCanvas(e,t);l.setTransform(1,0,0,1,c.offsetX-h[4],c.offsetY-h[5]),(d=this.dependencyTracker)==null||d.resetBBox(e);for(let y=0,g=o.length;y<g;y+=2){const v=ct.transform(h,[s,i,r,a,o[y],o[y+1]]);l.drawImage(c.canvas,v[4],v[5]),(u=this.dependencyTracker)==null||u.recordBBox(e,this.ctx,v[4],v[4]+c.canvas.width,v[5],v[5]+c.canvas.height)}l.restore(),this.compose(),(f=this.dependencyTracker)==null||f.recordOperation(e)}paintImageMaskXObjectGroup(e,t){var a,o,l;if(!this.contentVisible)return;const s=this.ctx,i=this.current.fillColor,r=this.current.patternFill;(a=this.dependencyTracker)==null||a.resetBBox(e).recordDependencies(e,Hs.transformAndFill);for(const h of t){const{data:c,width:d,height:u,transform:f}=h,y=this.cachedCanvases.getCanvas("maskCanvas",d,u),g=y.context;g.save();const v=this.getObject(e,c,h);m0(g,v),g.globalCompositeOperation="source-in",g.fillStyle=r?i.getPattern(g,this,_i(s),We.FILL,e):i,g.fillRect(0,0,d,u),g.restore(),s.save(),s.transform(...f),s.scale(1,-1),Mf(s,y.canvas,0,0,d,u,0,-1,1,1),(o=this.dependencyTracker)==null||o.recordBBox(e,s,0,d,0,u),s.restore()}this.compose(),(l=this.dependencyTracker)==null||l.recordOperation(e)}paintImageXObject(e,t){if(!this.contentVisible)return;const s=this.getObject(e,t);if(!s){At("Dependent image isn't ready yet");return}this.paintInlineImageXObject(e,s)}paintImageXObjectRepeat(e,t,s,i,r){if(!this.contentVisible)return;const a=this.getObject(e,t);if(!a){At("Dependent image isn't ready yet");return}const o=a.width,l=a.height,h=[];for(let c=0,d=r.length;c<d;c+=2)h.push({transform:[s,0,0,i,r[c],r[c+1]],x:0,y:0,w:o,h:l});this.paintInlineImageXObjectGroup(e,a,h)}applyTransferMapsToCanvas(e){return this.current.transferMaps!=="none"&&(e.filter=this.current.transferMaps,e.drawImage(e.canvas,0,0),e.filter="none"),e.canvas}applyTransferMapsToBitmap(e){if(this.current.transferMaps==="none")return e.bitmap;const{bitmap:t,width:s,height:i}=e,r=this.cachedCanvases.getCanvas("inlineImage",s,i),a=r.context;return a.filter=this.current.transferMaps,a.drawImage(t,0,0),a.filter="none",r.canvas}paintInlineImageXObject(e,t){var h;if(!this.contentVisible)return;const s=t.width,i=t.height,r=this.ctx;this.save(e);const{filter:a}=r;a!=="none"&&a!==""&&(r.filter="none"),r.scale(1/s,-1/i);let o;if(t.bitmap)o=this.applyTransferMapsToBitmap(t);else if(typeof HTMLElement=="function"&&t instanceof HTMLElement||!t.data)o=t;else{const d=this.cachedCanvases.getCanvas("inlineImage",s,i).context;g0(d,t),o=this.applyTransferMapsToCanvas(d)}const l=this._scaleImage(o,_i(r));r.imageSmoothingEnabled=b0(oe(r),t.interpolate),(h=this.dependencyTracker)==null||h.resetBBox(e).recordBBox(e,r,0,s,-i,0).recordDependencies(e,Hs.imageXObject).recordOperation(e),Mf(r,l.img,0,0,l.paintWidth,l.paintHeight,0,-i,s,i),this.compose(),this.restore(e)}paintInlineImageXObjectGroup(e,t,s){var a,o,l;if(!this.contentVisible)return;const i=this.ctx;let r;if(t.bitmap)r=t.bitmap;else{const h=t.width,c=t.height,u=this.cachedCanvases.getCanvas("inlineImage",h,c).context;g0(u,t),r=this.applyTransferMapsToCanvas(u)}(a=this.dependencyTracker)==null||a.resetBBox(e);for(const h of s)i.save(),i.transform(...h.transform),i.scale(1,-1),Mf(i,r,h.x,h.y,h.w,h.h,0,-1,1,1),(o=this.dependencyTracker)==null||o.recordBBox(e,i,0,1,-1,0),i.restore();(l=this.dependencyTracker)==null||l.recordOperation(e),this.compose()}paintSolidColorImageMask(e){var t;this.contentVisible&&((t=this.dependencyTracker)==null||t.resetBBox(e).recordBBox(e,this.ctx,0,1,0,1).recordDependencies(e,Hs.fill).recordOperation(e),this.ctx.fillRect(0,0,1,1),this.compose())}markPoint(e,t){}markPointProps(e,t,s){}beginMarkedContent(e,t){var s;(s=this.dependencyTracker)==null||s.beginMarkedContent(e),this.markedContentStack.push({visible:!0})}beginMarkedContentProps(e,t,s){var i;(i=this.dependencyTracker)==null||i.beginMarkedContent(e),t==="OC"?this.markedContentStack.push({visible:this.optionalContentConfig.isVisible(s)}):this.markedContentStack.push({visible:!0}),this.contentVisible=this.isContentVisible()}endMarkedContent(e){var t;(t=this.dependencyTracker)==null||t.endMarkedContent(e),this.markedContentStack.pop(),this.contentVisible=this.isContentVisible()}beginCompat(e){}endCompat(e){}consumePath(e,t,s){var a,o;const i=this.current.isEmptyClip();this.pendingClip&&this.current.updateClipFromPath(),this.pendingClip||this.compose(s);const r=this.ctx;this.pendingClip?(i||(this.pendingClip===y0?r.clip(t,"evenodd"):r.clip(t)),this.pendingClip=null,(a=this.dependencyTracker)==null||a.bboxToClipBoxDropOperation(e).recordFutureForcedDependency("clipPath",e)):(o=this.dependencyTracker)==null||o.recordOperation(e),this.current.startNewPathAndClipBox(this.current.clipBox)}getSinglePixelWidth(){if(!this._cachedGetSinglePixelWidth){const e=oe(this.ctx);if(e[1]===0&&e[2]===0)this._cachedGetSinglePixelWidth=1/Math.min(Math.abs(e[0]),Math.abs(e[3]));else{const t=Math.abs(e[0]*e[3]-e[2]*e[1]),s=Math.hypot(e[0],e[2]),i=Math.hypot(e[1],e[3]);this._cachedGetSinglePixelWidth=Math.max(s,i)/t}}return this._cachedGetSinglePixelWidth}getScaleForStroking(){if(this._cachedScaleForStroking[0]===-1){const{lineWidth:e}=this.current,{a:t,b:s,c:i,d:r}=this.ctx.getTransform();let a,o;if(s===0&&i===0){const l=Math.abs(t),h=Math.abs(r);if(l===h)if(e===0)a=o=1/l;else{const c=l*e;a=o=c<1?1/c:1}else if(e===0)a=1/l,o=1/h;else{const c=l*e,d=h*e;a=c<1?1/c:1,o=d<1?1/d:1}}else{const l=Math.abs(t*r-s*i),h=Math.hypot(t,s),c=Math.hypot(i,r);if(e===0)a=c/l,o=h/l;else{const d=e*l;a=c>d?c/d:1,o=h>d?h/d:1}}this._cachedScaleForStroking[0]=a,this._cachedScaleForStroking[1]=o}return this._cachedScaleForStroking}rescaleAndStroke(e,t){const{ctx:s,current:{lineWidth:i}}=this,[r,a]=this.getScaleForStroking();if(r===a){s.lineWidth=(i||1)*r,s.stroke(e);return}const o=s.getLineDash();t&&s.save(),s.scale(r,a),Jm.a=1/r,Jm.d=1/a;const l=new Path2D;if(l.addPath(e,Jm),o.length>0){const h=Math.max(r,a);s.setLineDash(o.map(c=>c/h)),s.lineDashOffset/=h}s.lineWidth=i||1,s.stroke(l),t&&s.restore()}isContentVisible(){for(let e=this.markedContentStack.length-1;e>=0;e--)if(!this.markedContentStack[e].visible)return!1;return!0}};Ld=new WeakSet,Rb=function(){for(;this.stateStack.length||this.inSMaskMode;)this.restore();this.current.activeSMask=null,this.ctx.restore(),this.transparentCanvas&&(this.ctx=this.compositeCtx,this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.drawImage(this.transparentCanvas,0,0),this.ctx.restore(),this.transparentCanvas=null)},Fd=new WeakSet,Lb=function(){if(this.pageColors){const e=this.filterFactory.addHCMFilter(this.pageColors.foreground,this.pageColors.background);if(e!=="none"){const t=this.ctx.filter;this.ctx.filter=e,this.ctx.drawImage(this.ctx.canvas,0,0),this.ctx.filter=t}}},Od=new WeakSet,Fb=function(e,t,s){const i=new Path2D;return i.addPath(e,new DOMMatrix(s).invertSelf().multiplySelf(t)),i};let Zo=Wy;for(const p in Tc)Zo.prototype[p]!==void 0&&(Zo.prototype[Tc[p]]=Zo.prototype[p]);var Nd,Bd;class qi{static get workerPort(){return n(this,Nd)}static set workerPort(e){if(!(typeof Worker<"u"&&e instanceof Worker)&&e!==null)throw new Error("Invalid `workerPort` type.");w(this,Nd,e)}static get workerSrc(){return n(this,Bd)}static set workerSrc(e){if(typeof e!="string")throw new Error("Invalid `workerSrc` type.");w(this,Bd,e)}}Nd=new WeakMap,Bd=new WeakMap,m(qi,Nd,null),m(qi,Bd,"");var Vl,zd;class C_{constructor({parsedData:e,rawData:t}){m(this,Vl,void 0);m(this,zd,void 0);w(this,Vl,e),w(this,zd,t)}getRaw(){return n(this,zd)}get(e){return n(this,Vl).get(e)??null}[Symbol.iterator](){return n(this,Vl).entries()}}Vl=new WeakMap,zd=new WeakMap;const jo=Symbol("INTERNAL");var Ud,Hd,jd,Wl;class x_{constructor(e,{name:t,intent:s,usage:i,rbGroups:r}){m(this,Ud,!1);m(this,Hd,!1);m(this,jd,!1);m(this,Wl,!0);w(this,Ud,!!(e&Bs.DISPLAY)),w(this,Hd,!!(e&Bs.PRINT)),this.name=t,this.intent=s,this.usage=i,this.rbGroups=r}get visible(){if(n(this,jd))return n(this,Wl);if(!n(this,Wl))return!1;const{print:e,view:t}=this.usage;return n(this,Ud)?(t==null?void 0:t.viewState)!=="OFF":n(this,Hd)?(e==null?void 0:e.printState)!=="OFF":!0}_setVisible(e,t,s=!1){e!==jo&&zt("Internal method `_setVisible` called."),w(this,jd,s),w(this,Wl,t)}}Ud=new WeakMap,Hd=new WeakMap,jd=new WeakMap,Wl=new WeakMap;var vr,$t,Gl,Xl,Vd,Ob;class k_{constructor(e,t=Bs.DISPLAY){m(this,Vd);m(this,vr,null);m(this,$t,new Map);m(this,Gl,null);m(this,Xl,null);if(this.renderingIntent=t,this.name=null,this.creator=null,e!==null){this.name=e.name,this.creator=e.creator,w(this,Xl,e.order);for(const s of e.groups)n(this,$t).set(s.id,new x_(t,s));if(e.baseState==="OFF")for(const s of n(this,$t).values())s._setVisible(jo,!1);for(const s of e.on)n(this,$t).get(s)._setVisible(jo,!0);for(const s of e.off)n(this,$t).get(s)._setVisible(jo,!1);w(this,Gl,this.getHash())}}isVisible(e){if(n(this,$t).size===0)return!0;if(!e)return Nm("Optional content group not defined."),!0;if(e.type==="OCG")return n(this,$t).has(e.id)?n(this,$t).get(e.id).visible:(At(`Optional content group not found: ${e.id}`),!0);if(e.type==="OCMD"){if(e.expression)return E(this,Vd,Ob).call(this,e.expression);if(!e.policy||e.policy==="AnyOn"){for(const t of e.ids){if(!n(this,$t).has(t))return At(`Optional content group not found: ${t}`),!0;if(n(this,$t).get(t).visible)return!0}return!1}else if(e.policy==="AllOn"){for(const t of e.ids){if(!n(this,$t).has(t))return At(`Optional content group not found: ${t}`),!0;if(!n(this,$t).get(t).visible)return!1}return!0}else if(e.policy==="AnyOff"){for(const t of e.ids){if(!n(this,$t).has(t))return At(`Optional content group not found: ${t}`),!0;if(!n(this,$t).get(t).visible)return!0}return!1}else if(e.policy==="AllOff"){for(const t of e.ids){if(!n(this,$t).has(t))return At(`Optional content group not found: ${t}`),!0;if(n(this,$t).get(t).visible)return!1}return!0}return At(`Unknown optional content policy ${e.policy}.`),!0}return At(`Unknown group type ${e.type}.`),!0}setVisibility(e,t=!0,s=!0){var r;const i=n(this,$t).get(e);if(!i){At(`Optional content group not found: ${e}`);return}if(s&&t&&i.rbGroups.length)for(const a of i.rbGroups)for(const o of a)o!==e&&((r=n(this,$t).get(o))==null||r._setVisible(jo,!1,!0));i._setVisible(jo,!!t,!0),w(this,vr,null)}setOCGState({state:e,preserveRB:t}){let s;for(const i of e){switch(i){case"ON":case"OFF":case"Toggle":s=i;continue}const r=n(this,$t).get(i);if(r)switch(s){case"ON":this.setVisibility(i,!0,t);break;case"OFF":this.setVisibility(i,!1,t);break;case"Toggle":this.setVisibility(i,!r.visible,t);break}}w(this,vr,null)}get hasInitialVisibility(){return n(this,Gl)===null||this.getHash()===n(this,Gl)}getOrder(){return n(this,$t).size?n(this,Xl)?n(this,Xl).slice():[...n(this,$t).keys()]:null}getGroup(e){return n(this,$t).get(e)||null}getHash(){if(n(this,vr)!==null)return n(this,vr);const e=new Ew;for(const[t,s]of n(this,$t))e.update(`${t}:${s.visible}`);return w(this,vr,e.hexdigest())}[Symbol.iterator](){return n(this,$t).entries()}}vr=new WeakMap,$t=new WeakMap,Gl=new WeakMap,Xl=new WeakMap,Vd=new WeakSet,Ob=function(e){const t=e.length;if(t<2)return!0;const s=e[0];for(let i=1;i<t;i++){const r=e[i];let a;if(Array.isArray(r))a=E(this,Vd,Ob).call(this,r);else if(n(this,$t).has(r))a=n(this,$t).get(r).visible;else return At(`Optional content group not found: ${r}`),!0;switch(s){case"And":if(!a)return!1;break;case"Or":if(a)return!0;break;case"Not":return!a;default:return!0}}return s==="And"};var Wd,Gd;class Um{constructor(e,t,s){m(this,Wd,null);m(this,Gd,null);$(this,"_fullReader",null);$(this,"_rangeReaders",new Set);$(this,"_source",null);this._source=e,w(this,Wd,t),w(this,Gd,s)}get _progressiveDataLength(){var e;return((e=this._fullReader)==null?void 0:e._loaded)??0}getFullReader(){return Bt(!this._fullReader,"BasePDFStream.getFullReader can only be called once."),this._fullReader=new(n(this,Wd))(this)}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;const s=new(n(this,Gd))(this,e,t);return this._rangeReaders.add(s),s}cancelAllRequests(e){var t;(t=this._fullReader)==null||t.cancel(e);for(const s of new Set(this._rangeReaders))s.cancel(e)}}Wd=new WeakMap,Gd=new WeakMap;class Hm{constructor(e){$(this,"onProgress",null);$(this,"_contentLength",0);$(this,"_filename",null);$(this,"_headersCapability",Promise.withResolvers());$(this,"_isRangeSupported",!1);$(this,"_isStreamingSupported",!1);$(this,"_loaded",0);$(this,"_stream",null);this._stream=e}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){zt("Abstract method `read` called")}cancel(e){zt("Abstract method `cancel` called")}}class jm{constructor(e,t,s){$(this,"_stream",null);this._stream=e}async read(){zt("Abstract method `read` called")}cancel(e){zt("Abstract method `cancel` called")}}function w0(p){return p instanceof Uint8Array&&p.byteLength===p.buffer.byteLength?p.buffer:new Uint8Array(p).buffer}var Xd,Nb;class T_ extends Um{constructor(t){super(t,P_,D_);m(this,Xd);$(this,"_progressiveDone",!1);$(this,"_queuedChunks",[]);const{pdfDataRangeTransport:s}=t,{initialData:i,progressiveDone:r}=s;if((i==null?void 0:i.length)>0){const a=w0(i);this._queuedChunks.push(a)}this._progressiveDone=r,s.addRangeListener((a,o)=>{E(this,Xd,Nb).call(this,a,o)}),s.addProgressListener((a,o)=>{var l,h;o!==void 0&&((h=(l=this._fullReader)==null?void 0:l.onProgress)==null||h.call(l,{loaded:a,total:o}))}),s.addProgressiveReadListener(a=>{E(this,Xd,Nb).call(this,void 0,a)}),s.addProgressiveDoneListener(()=>{var a;(a=this._fullReader)==null||a.progressiveDone(),this._progressiveDone=!0}),s.transportReady()}getFullReader(){const t=super.getFullReader();return this._queuedChunks=null,t}getRangeReader(t,s){const i=super.getRangeReader(t,s);return i&&(i.onDone=()=>this._rangeReaders.delete(i),this._source.pdfDataRangeTransport.requestDataRange(t,s)),i}cancelAllRequests(t){super.cancelAllRequests(t),this._source.pdfDataRangeTransport.abort()}}Xd=new WeakSet,Nb=function(t,s){const i=w0(s);if(t===void 0)this._fullReader?this._fullReader._enqueue(i):this._queuedChunks.push(i);else{const r=this._rangeReaders.keys().find(a=>a._begin===t);Bt(r,"#onReceiveData - no `PDFDataTransportStreamRangeReader` instance found."),r._enqueue(i)}};class P_ extends Hm{constructor(t){super(t);$(this,"_done",!1);$(this,"_queuedChunks",null);$(this,"_requests",[]);const{pdfDataRangeTransport:s,disableRange:i,disableStream:r}=t._source,{length:a,contentDispositionFilename:o}=s;this._queuedChunks=t._queuedChunks||[];for(const l of this._queuedChunks)this._loaded+=l.byteLength;this._done=t._progressiveDone,this._contentLength=a,this._isStreamingSupported=!r,this._isRangeSupported=!i,Ry(o)&&(this._filename=o),this._headersCapability.resolve()}_enqueue(t){this._done||(this._requests.length>0?this._requests.shift().resolve({value:t,done:!1}):this._queuedChunks.push(t),this._loaded+=t.byteLength)}async read(){if(this._queuedChunks.length>0)return{value:this._queuedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const t=Promise.withResolvers();return this._requests.push(t),t.promise}cancel(t){this._done=!0;for(const s of this._requests)s.resolve({value:void 0,done:!0});this._requests.length=0}progressiveDone(){this._done||(this._done=!0)}}class D_ extends jm{constructor(t,s,i){super(t,s,i);$(this,"onDone",null);$(this,"_begin",-1);$(this,"_done",!1);$(this,"_queuedChunk",null);$(this,"_requests",[]);this._begin=s}_enqueue(t){var s;if(!this._done){if(this._requests.length===0)this._queuedChunk=t;else{this._requests.shift().resolve({value:t,done:!1});for(const r of this._requests)r.resolve({value:void 0,done:!0});this._requests.length=0}this._done=!0,(s=this.onDone)==null||s.call(this)}}async read(){if(this._queuedChunk){const s=this._queuedChunk;return this._queuedChunk=null,{value:s,done:!1}}if(this._done)return{value:void 0,done:!0};const t=Promise.withResolvers();return this._requests.push(t),t.promise}cancel(t){var s;this._done=!0;for(const i of this._requests)i.resolve({value:void 0,done:!0});this._requests.length=0,(s=this.onDone)==null||s.call(this)}}function I_(p){let e=!0,t=s("filename\\*","i").exec(p);if(t){t=t[1];let c=o(t);return c=unescape(c),c=l(c),c=h(c),r(c)}if(t=a(p),t){const c=h(t);return r(c)}if(t=s("filename","i").exec(p),t){t=t[1];let c=o(t);return c=h(c),r(c)}function s(c,d){return new RegExp("(?:^|;)\\s*"+c+'\\s*=\\s*([^";\\s][^;\\s]*|"(?:[^"\\\\]|\\\\"?)+"?)',d)}function i(c,d){if(c){if(!/^[\x00-\xFF]+$/.test(d))return d;try{const u=new TextDecoder(c,{fatal:!0}),f=Bm(d);d=u.decode(f),e=!1}catch{}}return d}function r(c){return e&&/[\x80-\xff]/.test(c)&&(c=i("utf-8",c),e&&(c=i("iso-8859-1",c))),c}function a(c){const d=[];let u;const f=s("filename\\*((?!0\\d)\\d+)(\\*?)","ig");for(;(u=f.exec(c))!==null;){let[,g,v,b]=u;if(g=parseInt(g,10),g in d){if(g===0)break;continue}d[g]=[v,b]}const y=[];for(let g=0;g<d.length&&g in d;++g){let[v,b]=d[g];b=o(b),v&&(b=unescape(b),g===0&&(b=l(b))),y.push(b)}return y.join("")}function o(c){if(c.startsWith('"')){const d=c.slice(1).split('\\"');for(let u=0;u<d.length;++u){const f=d[u].indexOf('"');f!==-1&&(d[u]=d[u].slice(0,f),d.length=u+1),d[u]=d[u].replaceAll(/\\(.)/g,"$1")}c=d.join('"')}return c}function l(c){const d=c.indexOf("'");if(d===-1)return c;const u=c.slice(0,d),y=c.slice(d+1).replace(/^[^']*'/,"");return i(u,y)}function h(c){return!c.startsWith("=?")||/[\x00-\x19\x80-\xff]/.test(c)?c:c.replaceAll(/=\?([\w-]*)\?([QqBb])\?((?:[^?]|\?(?!=))*)\?=/g,function(d,u,f,y){if(f==="q"||f==="Q")return y=y.replaceAll("_"," "),y=y.replaceAll(/=([0-9a-fA-F]{2})/g,function(g,v){return String.fromCharCode(parseInt(v,16))}),i(u,y);try{y=atob(y)}catch{}return i(u,y)})}return""}function Ow(p,e){const t=new Headers;if(!p||!e||typeof e!="object")return t;for(const s in e){const i=e[s];i!==void 0&&t.append(s,i)}return t}function Vm(p){var e;return((e=URL.parse(p))==null?void 0:e.origin)??null}function Nw({responseHeaders:p,isHttp:e,rangeChunkSize:t,disableRange:s}){const i={allowRangeRequests:!1,suggestedLength:void 0},r=parseInt(p.get("Content-Length"),10);return!Number.isInteger(r)||(i.suggestedLength=r,r<=2*t)||s||!e||p.get("Accept-Ranges")!=="bytes"||(p.get("Content-Encoding")||"identity")!=="identity"||(i.allowRangeRequests=!0),i}function Bw(p){const e=p.get("Content-Disposition");if(e){let t=I_(e);if(t.includes("%"))try{t=decodeURIComponent(t)}catch{}if(Ry(t))return t}return null}function Wm(p,e){return new wp(`Unexpected server response (${p}) while retrieving PDF "${e}".`,p,p===404||p===0&&e.startsWith("file:"))}function zw(p,e){if(p!==e)throw new Error(`Expected range response-origin "${p}" to match "${e}".`)}function Uw(p,e,t,s){return fetch(p,{method:"GET",headers:e,signal:s.signal,mode:"cors",credentials:t?"include":"same-origin",redirect:"follow"})}function Hw(p,e){if(p!==200&&p!==206)throw Wm(p,e)}function jw(p){return p instanceof Uint8Array?p.buffer:p instanceof ArrayBuffer?p:(At(`getArrayBuffer - unexpected data format: ${p}`),new Uint8Array(p).buffer)}class M_ extends Um{constructor(t){super(t,R_,L_);$(this,"_responseOrigin",null);this.isHttp=/^https?:/i.test(t.url),this.headers=Ow(this.isHttp,t.httpHeaders)}}class R_ extends Hm{constructor(t){super(t);$(this,"_abortController",new AbortController);$(this,"_reader",null);const{disableRange:s,disableStream:i,length:r,rangeChunkSize:a,url:o,withCredentials:l}=t._source;this._contentLength=r,this._isStreamingSupported=!i,this._isRangeSupported=!s;const h=new Headers(t.headers);Uw(o,h,l,this._abortController).then(c=>{t._responseOrigin=Vm(c.url),Hw(c.status,o),this._reader=c.body.getReader();const d=c.headers,{allowRangeRequests:u,suggestedLength:f}=Nw({responseHeaders:d,isHttp:t.isHttp,rangeChunkSize:a,disableRange:s});this._isRangeSupported=u,this._contentLength=f||this._contentLength,this._filename=Bw(d),!this._isStreamingSupported&&this._isRangeSupported&&this.cancel(new Xr("Streaming is disabled.")),this._headersCapability.resolve()}).catch(this._headersCapability.reject)}async read(){var i;await this._headersCapability.promise;const{value:t,done:s}=await this._reader.read();return s?{value:t,done:s}:(this._loaded+=t.byteLength,(i=this.onProgress)==null||i.call(this,{loaded:this._loaded,total:this._contentLength}),{value:jw(t),done:!1})}cancel(t){var s;(s=this._reader)==null||s.cancel(t),this._abortController.abort()}}class L_ extends jm{constructor(t,s,i){super(t,s,i);$(this,"_abortController",new AbortController);$(this,"_readCapability",Promise.withResolvers());$(this,"_reader",null);const{url:r,withCredentials:a}=t._source,o=new Headers(t.headers);o.append("Range",`bytes=${s}-${i-1}`),Uw(r,o,a,this._abortController).then(l=>{const h=Vm(l.url);zw(h,t._responseOrigin),Hw(l.status,r),this._reader=l.body.getReader(),this._readCapability.resolve()}).catch(this._readCapability.reject)}async read(){await this._readCapability.promise;const{value:t,done:s}=await this._reader.read();return s?{value:t,done:s}:{value:jw(t),done:!1}}cancel(t){var s;(s=this._reader)==null||s.cancel(t),this._abortController.abort()}}const Qm=200,v0=206;function F_(p){return typeof p!="string"?p:Bm(p).buffer}var Ni,Ag,Vw,_g,Ww;class O_ extends Um{constructor(t){super(t,N_,B_);m(this,Ag);m(this,_g);m(this,Ni,new WeakMap);$(this,"_responseOrigin",null);this.url=t.url,this.isHttp=/^https?:/i.test(this.url),this.headers=Ow(this.isHttp,t.httpHeaders)}_request(t){const s=new XMLHttpRequest,i={validateStatus:null,onHeadersReceived:t.onHeadersReceived,onDone:t.onDone,onError:t.onError,onProgress:t.onProgress};n(this,Ni).set(s,i),s.open("GET",this.url),s.withCredentials=this._source.withCredentials;for(const[r,a]of this.headers)s.setRequestHeader(r,a);return this.isHttp&&"begin"in t&&"end"in t?(s.setRequestHeader("Range",`bytes=${t.begin}-${t.end-1}`),i.validateStatus=r=>r===v0||r===Qm):i.validateStatus=r=>r===Qm,s.responseType="arraybuffer",Bt(t.onError,"Expected `onError` callback to be provided."),s.onerror=()=>t.onError(s.status),s.onreadystatechange=E(this,_g,Ww).bind(this,s),s.onprogress=E(this,Ag,Vw).bind(this,s),s.send(null),s}_abortRequest(t){n(this,Ni).has(t)&&(n(this,Ni).delete(t),t.abort())}getRangeReader(t,s){const i=super.getRangeReader(t,s);return i&&(i.onClosed=()=>this._rangeReaders.delete(i)),i}}Ni=new WeakMap,Ag=new WeakSet,Vw=function(t,s){var r;const i=n(this,Ni).get(t);(r=i==null?void 0:i.onProgress)==null||r.call(i,s)},_g=new WeakSet,Ww=function(t,s){const i=n(this,Ni).get(t);if(!i||(t.readyState>=2&&i.onHeadersReceived&&(i.onHeadersReceived(),delete i.onHeadersReceived),t.readyState!==4)||!n(this,Ni).has(t))return;if(n(this,Ni).delete(t),t.status===0&&this.isHttp){i.onError(t.status);return}const r=t.status||Qm;if(!i.validateStatus(r)){i.onError(t.status);return}const a=F_(t.response);if(r===v0){const o=t.getResponseHeader("Content-Range");/bytes (\d+)-(\d+)\/(\d+)/.test(o)?i.onDone(a):(At('Missing or invalid "Content-Range" header.'),i.onError(0))}else a?i.onDone(a):i.onError(t.status)};var Sg,Gw,Eg,Xw,Cg,$w,xg,Yw;class N_ extends Hm{constructor(t){super(t);m(this,Sg);m(this,Eg);m(this,Cg);m(this,xg);$(this,"_cachedChunks",[]);$(this,"_done",!1);$(this,"_requests",[]);$(this,"_storedError",null);const{length:s}=t._source;this._contentLength=s,this._fullRequestXhr=t._request({onHeadersReceived:E(this,Sg,Gw).bind(this),onDone:E(this,Eg,Xw).bind(this),onError:E(this,Cg,$w).bind(this),onProgress:E(this,xg,Yw).bind(this)})}async read(){if(await this._headersCapability.promise,this._storedError)throw this._storedError;if(this._cachedChunks.length>0)return{value:this._cachedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const t=Promise.withResolvers();return this._requests.push(t),t.promise}cancel(t){this._done=!0,this._headersCapability.reject(t);for(const s of this._requests)s.resolve({value:void 0,done:!0});this._requests.length=0,this._stream._abortRequest(this._fullRequestXhr),this._fullRequestXhr=null}}Sg=new WeakSet,Gw=function(){const t=this._stream,{disableRange:s,rangeChunkSize:i}=t._source,r=this._fullRequestXhr;t._responseOrigin=Vm(r.responseURL);const a=r.getAllResponseHeaders(),o=new Headers(a?a.trimStart().replace(/[^\S ]+$/,"").split(/[\r\n]+/).map(c=>{const[d,...u]=c.split(": ");return[d,u.join(": ")]}):[]),{allowRangeRequests:l,suggestedLength:h}=Nw({responseHeaders:o,isHttp:t.isHttp,rangeChunkSize:i,disableRange:s});l&&(this._isRangeSupported=!0),this._contentLength=h||this._contentLength,this._filename=Bw(o),this._isRangeSupported&&t._abortRequest(r),this._headersCapability.resolve()},Eg=new WeakSet,Xw=function(t){if(this._requests.length>0?this._requests.shift().resolve({value:t,done:!1}):this._cachedChunks.push(t),this._done=!0,!(this._cachedChunks.length>0)){for(const s of this._requests)s.resolve({value:void 0,done:!0});this._requests.length=0}},Cg=new WeakSet,$w=function(t){this._storedError=Wm(t,this._stream.url),this._headersCapability.reject(this._storedError);for(const s of this._requests)s.reject(this._storedError);this._requests.length=0,this._cachedChunks.length=0},xg=new WeakSet,Yw=function(t){var s;(s=this.onProgress)==null||s.call(this,{loaded:t.loaded,total:t.lengthComputable?t.total:this._contentLength})};var kg,qw,Tg,Kw,$d,Bb;class B_ extends jm{constructor(t,s,i){super(t,s,i);m(this,kg);m(this,Tg);m(this,$d);$(this,"onClosed",null);$(this,"_done",!1);$(this,"_queuedChunk",null);$(this,"_requests",[]);$(this,"_storedError",null);this._requestXhr=t._request({begin:s,end:i,onHeadersReceived:E(this,kg,qw).bind(this),onDone:E(this,Tg,Kw).bind(this),onError:E(this,$d,Bb).bind(this),onProgress:null})}async read(){if(this._storedError)throw this._storedError;if(this._queuedChunk!==null){const s=this._queuedChunk;return this._queuedChunk=null,{value:s,done:!1}}if(this._done)return{value:void 0,done:!0};const t=Promise.withResolvers();return this._requests.push(t),t.promise}cancel(t){var s;this._done=!0;for(const i of this._requests)i.resolve({value:void 0,done:!0});this._requests.length=0,this._stream._abortRequest(this._requestXhr),(s=this.onClosed)==null||s.call(this)}}kg=new WeakSet,qw=function(){var s;const t=Vm((s=this._requestXhr)==null?void 0:s.responseURL);try{zw(t,this._stream._responseOrigin)}catch(i){this._storedError=i,E(this,$d,Bb).call(this,0)}},Tg=new WeakSet,Kw=function(t){var s;this._requests.length>0?this._requests.shift().resolve({value:t,done:!1}):this._queuedChunk=t,this._done=!0;for(const i of this._requests)i.resolve({value:void 0,done:!0});this._requests.length=0,(s=this.onClosed)==null||s.call(this)},$d=new WeakSet,Bb=function(t){this._storedError??(this._storedError=Wm(t,this._stream.url));for(const s of this._requests)s.reject(this._storedError);this._requests.length=0,this._queuedChunk=null};const z_=/^[a-z][a-z0-9\-+.]+:/i;function U_(p){if(z_.test(p))return new URL(p);const e=process.getBuiltinModule("url");return new URL(e.pathToFileURL(p))}function Zw(p){const{Readable:e}=process.getBuiltinModule("stream");return typeof e.toWeb=="function"?e.toWeb(p):process.getBuiltinModule("module").createRequire(import.meta.url)("node-readable-to-web-readable-stream").makeDefaultReadableStreamFromNodeReadable(p)}function Jw(p){return p instanceof Uint8Array?p.buffer:p instanceof ArrayBuffer?p:(At(`getArrayBuffer - unexpected data format: ${p}`),new Uint8Array(p).buffer)}class H_ extends Um{constructor(e){super(e,j_,V_),this.url=U_(e.url),Bt(this.url.protocol==="file:","PDFNodeStream only supports file:// URLs.")}}class j_ extends Hm{constructor(t){super(t);$(this,"_reader",null);const{disableRange:s,disableStream:i,length:r,rangeChunkSize:a}=t._source;this._contentLength=r,this._isStreamingSupported=!i,this._isRangeSupported=!s;const o=t.url,l=process.getBuiltinModule("fs");l.promises.lstat(o).then(h=>{const c=l.createReadStream(o),d=Zw(c);this._reader=d.getReader();const{size:u}=h;u<=2*a&&(this._isRangeSupported=!1),this._contentLength=u,!this._isStreamingSupported&&this._isRangeSupported&&this.cancel(new Xr("Streaming is disabled.")),this._headersCapability.resolve()}).catch(h=>{h.code==="ENOENT"&&(h=Wm(0,o.href)),this._headersCapability.reject(h)})}async read(){var i;await this._headersCapability.promise;const{value:t,done:s}=await this._reader.read();return s?{value:t,done:s}:(this._loaded+=t.length,(i=this.onProgress)==null||i.call(this,{loaded:this._loaded,total:this._contentLength}),{value:Jw(t),done:!1})}cancel(t){var s;(s=this._reader)==null||s.cancel(t)}}class V_ extends jm{constructor(t,s,i){super(t,s,i);$(this,"_readCapability",Promise.withResolvers());$(this,"_reader",null);const r=t.url,a=process.getBuiltinModule("fs");try{const o=a.createReadStream(r,{start:s,end:i-1}),l=Zw(o);this._reader=l.getReader(),this._readCapability.resolve()}catch(o){this._readCapability.reject(o)}}async read(){await this._readCapability.promise;const{value:t,done:s}=await this._reader.read();return s?{value:t,done:s}:{value:Jw(t),done:!1}}cancel(t){var s;(s=this._reader)==null||s.cancel(t)}}const ic=Symbol("INITIAL_DATA");var Ss,Yd,zb;class Qw{constructor(){m(this,Yd);m(this,Ss,Object.create(null))}get(e,t=null){if(t){const i=E(this,Yd,zb).call(this,e);return i.promise.then(()=>t(i.data)),null}const s=n(this,Ss)[e];if(!s||s.data===ic)throw new Error(`Requesting object that isn't resolved yet ${e}.`);return s.data}has(e){const t=n(this,Ss)[e];return!!t&&t.data!==ic}delete(e){const t=n(this,Ss)[e];return!t||t.data===ic?!1:(delete n(this,Ss)[e],!0)}resolve(e,t=null){const s=E(this,Yd,zb).call(this,e);s.data=t,s.resolve()}clear(){var e;for(const t in n(this,Ss)){const{data:s}=n(this,Ss)[t];(e=s==null?void 0:s.bitmap)==null||e.close()}w(this,Ss,Object.create(null))}*[Symbol.iterator](){for(const e in n(this,Ss)){const{data:t}=n(this,Ss)[e];t!==ic&&(yield[e,t])}}}Ss=new WeakMap,Yd=new WeakSet,zb=function(e){var t;return(t=n(this,Ss))[e]||(t[e]={...Promise.withResolvers(),data:ic})};const W_=1e5,A0=30;var B0,Ar,us,qd,Kd,Ua,_n,Zd,Jd,Ha,Qd,$l,_r,Yl,tu,ql,ja,eu,su,Kl,Va,iu,Zl,Jl,Pg,tv,Dg,ev,nu,Ub,Ql,Yf,ru,Hb,Ig,sv,Mg,iv;const ye=class ye{constructor({textContentSource:e,container:t,viewport:s}){m(this,Pg);m(this,Dg);m(this,nu);m(this,Ar,Promise.withResolvers());m(this,us,null);m(this,qd,!1);m(this,Kd,!!((B0=globalThis.FontInspector)!=null&&B0.enabled));m(this,Ua,null);m(this,_n,null);m(this,Zd,0);m(this,Jd,0);m(this,Ha,null);m(this,Qd,null);m(this,$l,0);m(this,_r,0);m(this,Yl,Object.create(null));m(this,tu,[]);m(this,ql,null);m(this,ja,[]);m(this,eu,new WeakMap);m(this,su,null);var l;if(e instanceof ReadableStream)w(this,ql,e);else if(typeof e=="object")w(this,ql,new ReadableStream({start(h){h.enqueue(e),h.close()}}));else throw new Error('No "textContentSource" parameter specified.');w(this,us,w(this,Qd,t)),w(this,_r,s.scale*Ki.pixelRatio),w(this,$l,s.rotation),w(this,_n,{div:null,properties:null,ctx:null});const{pageWidth:i,pageHeight:r,pageX:a,pageY:o}=s.rawDims;w(this,su,[1,0,0,-1,-a,o+r]),w(this,Jd,i),w(this,Zd,r),E(l=ye,Ig,sv).call(l),t.style.setProperty("--min-font-size",n(ye,Zl)),Io(t,s),n(this,Ar).promise.finally(()=>{n(ye,Jl).delete(this),w(this,_n,null),w(this,Yl,null)}).catch(()=>{})}static get fontFamilyMap(){const{isWindows:e,isFirefox:t}=Te.platform;return _t(this,"fontFamilyMap",new Map([["sans-serif",`${e&&t?"Calibri, ":""}sans-serif`],["monospace",`${e&&t?"Lucida Console, ":""}monospace`]]))}render(){const e=()=>{n(this,Ha).read().then(({value:t,done:s})=>{if(s){n(this,Ar).resolve();return}n(this,Ua)??w(this,Ua,t.lang),Object.assign(n(this,Yl),t.styles),E(this,Pg,tv).call(this,t.items),e()},n(this,Ar).reject)};return w(this,Ha,n(this,ql).getReader()),n(ye,Jl).add(this),e(),n(this,Ar).promise}update({viewport:e,onBefore:t=null}){var r;const s=e.scale*Ki.pixelRatio,i=e.rotation;if(i!==n(this,$l)&&(t==null||t(),w(this,$l,i),Io(n(this,Qd),{rotation:i})),s!==n(this,_r)){t==null||t(),w(this,_r,s);const a={div:null,properties:null,ctx:E(r=ye,Ql,Yf).call(r,n(this,Ua))};for(const o of n(this,ja))a.properties=n(this,eu).get(o),a.div=o,E(this,nu,Ub).call(this,a)}}cancel(){var t;const e=new Xr("TextLayer task cancelled.");(t=n(this,Ha))==null||t.cancel(e).catch(()=>{}),w(this,Ha,null),n(this,Ar).reject(e)}get textDivs(){return n(this,ja)}get textContentItemsStr(){return n(this,tu)}static cleanup(){if(!(n(this,Jl).size>0)){n(this,Kl).clear();for(const{canvas:e}of n(this,Va).values())e.remove();n(this,Va).clear()}}};Ar=new WeakMap,us=new WeakMap,qd=new WeakMap,Kd=new WeakMap,Ua=new WeakMap,_n=new WeakMap,Zd=new WeakMap,Jd=new WeakMap,Ha=new WeakMap,Qd=new WeakMap,$l=new WeakMap,_r=new WeakMap,Yl=new WeakMap,tu=new WeakMap,ql=new WeakMap,ja=new WeakMap,eu=new WeakMap,su=new WeakMap,Kl=new WeakMap,Va=new WeakMap,iu=new WeakMap,Zl=new WeakMap,Jl=new WeakMap,Pg=new WeakSet,tv=function(e){var i,r;if(n(this,qd))return;(r=n(this,_n)).ctx??(r.ctx=E(i=ye,Ql,Yf).call(i,n(this,Ua)));const t=n(this,ja),s=n(this,tu);for(const a of e){if(t.length>W_){At("Ignoring additional textDivs for performance reasons."),w(this,qd,!0);return}if(a.str===void 0){if(a.type==="beginMarkedContentProps"||a.type==="beginMarkedContent"){const o=n(this,us);w(this,us,document.createElement("span")),n(this,us).classList.add("markedContent"),a.id&&n(this,us).setAttribute("id",`${a.id}`),a.tag==="Artifact"&&(n(this,us).ariaHidden=!0),o.append(n(this,us))}else a.type==="endMarkedContent"&&w(this,us,n(this,us).parentNode);continue}s.push(a.str),E(this,Dg,ev).call(this,a)}},Dg=new WeakSet,ev=function(e){var y;const t=document.createElement("span"),s={angle:0,canvasWidth:0,hasText:e.str!=="",hasEOL:e.hasEOL,fontSize:0};n(this,ja).push(t);const i=ct.transform(n(this,su),e.transform);let r=Math.atan2(i[1],i[0]);const a=n(this,Yl)[e.fontName];a.vertical&&(r+=Math.PI/2);let o=n(this,Kd)&&a.fontSubstitution||a.fontFamily;o=ye.fontFamilyMap.get(o)||o;const l=Math.hypot(i[2],i[3]),h=l*E(y=ye,Mg,iv).call(y,o,a,n(this,Ua));let c,d;r===0?(c=i[4],d=i[5]-h):(c=i[4]+h*Math.sin(r),d=i[5]-h*Math.cos(r));const u=t.style;u.left=`${(100*c/n(this,Jd)).toFixed(2)}%`,u.top=`${(100*d/n(this,Zd)).toFixed(2)}%`,u.setProperty("--font-height",`${l.toFixed(2)}px`),u.fontFamily=o,s.fontSize=l,t.setAttribute("role","presentation"),t.textContent=e.str,t.dir=e.dir,n(this,Kd)&&(t.dataset.fontName=a.fontSubstitutionLoadedName||e.fontName),r!==0&&(s.angle=r*(180/Math.PI));let f=!1;if(e.str.length>1)f=!0;else if(e.str!==" "&&e.transform[0]!==e.transform[3]){const g=Math.abs(e.transform[0]),v=Math.abs(e.transform[3]);g!==v&&Math.max(g,v)/Math.min(g,v)>1.5&&(f=!0)}if(f&&(s.canvasWidth=a.vertical?e.height:e.width),n(this,eu).set(t,s),n(this,_n).div=t,n(this,_n).properties=s,E(this,nu,Ub).call(this,n(this,_n)),s.hasText&&n(this,us).append(t),s.hasEOL){const g=document.createElement("br");g.setAttribute("role","presentation"),n(this,us).append(g)}},nu=new WeakSet,Ub=function(e){var a;const{div:t,properties:s,ctx:i}=e,{style:r}=t;if(s.canvasWidth!==0&&s.hasText){const{fontFamily:o}=r,{canvasWidth:l,fontSize:h}=s;E(a=ye,ru,Hb).call(a,i,h*n(this,_r),o);const{width:c}=i.measureText(t.textContent);c>0&&r.setProperty("--scale-x",l*n(this,_r)/c)}s.angle!==0&&r.setProperty("--rotate",`${s.angle}deg`)},Ql=new WeakSet,Yf=function(e=null){let t=n(this,Va).get(e||(e=""));if(!t){const s=document.createElement("canvas");s.className="hiddenCanvasElement",s.lang=e,document.body.append(s),t=s.getContext("2d",{alpha:!1,willReadFrequently:!0}),n(this,Va).set(e,t),n(this,iu).set(t,{size:0,family:""})}return t},ru=new WeakSet,Hb=function(e,t,s){const i=n(this,iu).get(e);t===i.size&&s===i.family||(e.font=`${t}px ${s}`,i.size=t,i.family=s)},Ig=new WeakSet,sv=function(){if(n(this,Zl)!==null)return;const e=document.createElement("div");e.style.opacity=0,e.style.lineHeight=1,e.style.fontSize="1px",e.style.position="absolute",e.textContent="X",document.body.append(e),w(this,Zl,e.getBoundingClientRect().height),e.remove()},Mg=new WeakSet,iv=function(e,t,s){const i=n(this,Kl).get(e);if(i)return i;const r=E(this,Ql,Yf).call(this,s);r.canvas.width=r.canvas.height=A0,E(this,ru,Hb).call(this,r,A0,e);const a=r.measureText(""),o=a.fontBoundingBoxAscent,l=Math.abs(a.fontBoundingBoxDescent);r.canvas.width=r.canvas.height=0;let h=.8;return o?h=o/(o+l):(Te.platform.isFirefox&&At("Enable the `dom.textMetrics.fontBoundingBox.enabled` preference in `about:config` to improve TextLayer rendering."),t.ascent?h=t.ascent:t.descent&&(h=1+t.descent)),n(this,Kl).set(e,h),h},m(ye,Ql),m(ye,ru),m(ye,Ig),m(ye,Mg),m(ye,Kl,new Map),m(ye,Va,new Map),m(ye,iu,new WeakMap),m(ye,Zl,null),m(ye,Jl,new Set);let Ic=ye;const G_=100;function nv(p={}){typeof p=="string"||p instanceof URL?p={url:p}:(p instanceof ArrayBuffer||ArrayBuffer.isView(p))&&(p={data:p});const e=new jb,{docId:t}=e,s=p.url?QA(p.url):null,i=p.data?t_(p.data):null,r=p.httpHeaders||null,a=p.withCredentials===!0,o=p.password??null,l=p.range instanceof rv?p.range:null,h=Number.isInteger(p.rangeChunkSize)&&p.rangeChunkSize>0?p.rangeChunkSize:2**16;let c=p.worker instanceof Mc?p.worker:null;const d=p.verbosity,u=typeof p.docBaseUrl=="string"&&!zm(p.docBaseUrl)?p.docBaseUrl:null,f=Tf(p.cMapUrl),y=p.cMapPacked!==!1,g=p.CMapReaderFactory||(rs?l_:r0),v=Tf(p.iccUrl),b=Tf(p.standardFontDataUrl),A=p.StandardFontDataFactory||(rs?h_:a0),_=Tf(p.wasmUrl),x=p.WasmFactory||(rs?c_:o0),k=p.stopAtErrors!==!0,T=Number.isInteger(p.maxImageSize)&&p.maxImageSize>-1?p.maxImageSize:-1,P=p.isEvalSupported!==!1,F=typeof p.isOffscreenCanvasSupported=="boolean"?p.isOffscreenCanvasSupported:!rs,R=typeof p.isImageDecoderSupported=="boolean"?p.isImageDecoderSupported:!rs&&(Te.platform.isFirefox||!globalThis.chrome),B=Number.isInteger(p.canvasMaxAreaInBytes)?p.canvasMaxAreaInBytes:-1,j=typeof p.disableFontFace=="boolean"?p.disableFontFace:rs,I=p.fontExtraProperties===!0,L=p.enableXfa===!0,S=p.ownerDocument||globalThis.document,N=p.disableRange===!0,G=p.disableStream===!0,U=p.disableAutoFetch===!0,it=p.pdfBug===!0,Y=p.CanvasFactory||(rs?o_:n_),lt=p.FilterFactory||(rs?a_:r_),H=p.enableHWA===!0,O=p.useWasm!==!1,Q=l?l.length:p.length??NaN,tt=typeof p.useSystemFonts=="boolean"?p.useSystemFonts:!rs&&!j,J=typeof p.useWorkerFetch=="boolean"?p.useWorkerFetch:!!(g===r0&&A===a0&&x===o0&&f&&b&&_&&ac(f,document.baseURI)&&ac(b,document.baseURI)&&ac(_,document.baseURI)),bt=null;xA(d);const pt={canvasFactory:new Y({ownerDocument:S,enableHWA:H}),filterFactory:new lt({docId:t,ownerDocument:S}),cMapReaderFactory:J?null:new g({baseUrl:f,isCompressed:y}),standardFontDataFactory:J?null:new A({baseUrl:b}),wasmFactory:J?null:new x({baseUrl:_})};c||(c=Mc.create({verbosity:d,port:qi.workerPort}),e._worker=c);const ft={docId:t,apiVersion:"5.4.624",data:i,password:o,disableAutoFetch:U,rangeChunkSize:h,length:Q,docBaseUrl:u,enableXfa:L,evaluatorOptions:{maxImageSize:T,disableFontFace:j,ignoreErrors:k,isEvalSupported:P,isOffscreenCanvasSupported:F,isImageDecoderSupported:R,canvasMaxAreaInBytes:B,fontExtraProperties:I,useSystemFonts:tt,useWasm:O,useWorkerFetch:J,cMapUrl:f,iccUrl:v,standardFontDataUrl:b,wasmUrl:_}},yt={ownerDocument:S,pdfBug:it,styleElement:bt,enableHWA:H,loadingParams:{disableAutoFetch:U,enableXfa:L}};return c.promise.then(function(){if(e.destroyed)throw new Error("Loading aborted");if(c.destroyed)throw new Error("Worker was destroyed");const It=c.messageHandler.sendWithPromise("GetDocRequest",ft,i?[i.buffer]:null);let xt;if(l)xt=new T_({pdfDataRangeTransport:l,disableRange:N,disableStream:G});else if(!i){if(!s)throw new Error("getDocument - no `url` parameter provided.");const qt=ac(s)?M_:rs?H_:O_;xt=new qt({url:s,length:Q,httpHeaders:r,withCredentials:a,rangeChunkSize:h,disableRange:N,disableStream:G})}return It.then(qt=>{if(e.destroyed)throw new Error("Loading aborted");if(c.destroyed)throw new Error("Worker was destroyed");const te=new pc(t,qt,c.port),C=new Y_(te,e,xt,yt,pt);e._transport=C,te.send("Ready",null)})}).catch(e._capability.reject),e}var Rg;const Lg=class Lg{constructor(){$(this,"_capability",Promise.withResolvers());$(this,"_transport",null);$(this,"_worker",null);$(this,"docId",`d${Ae(Lg,Rg)._++}`);$(this,"destroyed",!1);$(this,"onPassword",null);$(this,"onProgress",null)}get promise(){return this._capability.promise}async destroy(){var e,t,s,i;this.destroyed=!0;try{(e=this._worker)!=null&&e.port&&(this._worker._pendingDestroy=!0),await((t=this._transport)==null?void 0:t.destroy())}catch(r){throw(s=this._worker)!=null&&s.port&&delete this._worker._pendingDestroy,r}this._transport=null,(i=this._worker)==null||i.destroy(),this._worker=null}async getData(){return this._transport.getData()}};Rg=new WeakMap,m(Lg,Rg,0);let jb=Lg;var Wa,au,ou,lu,hu;class rv{constructor(e,t,s=!1,i=null){m(this,Wa,Promise.withResolvers());m(this,au,[]);m(this,ou,[]);m(this,lu,[]);m(this,hu,[]);this.length=e,this.initialData=t,this.progressiveDone=s,this.contentDispositionFilename=i}addRangeListener(e){n(this,hu).push(e)}addProgressListener(e){n(this,lu).push(e)}addProgressiveReadListener(e){n(this,ou).push(e)}addProgressiveDoneListener(e){n(this,au).push(e)}onDataRange(e,t){for(const s of n(this,hu))s(e,t)}onDataProgress(e,t){n(this,Wa).promise.then(()=>{for(const s of n(this,lu))s(e,t)})}onDataProgressiveRead(e){n(this,Wa).promise.then(()=>{for(const t of n(this,ou))t(e)})}onDataProgressiveDone(){n(this,Wa).promise.then(()=>{for(const e of n(this,au))e()})}transportReady(){n(this,Wa).resolve()}requestDataRange(e,t){zt("Abstract method PDFDataRangeTransport.requestDataRange")}abort(){}}Wa=new WeakMap,au=new WeakMap,ou=new WeakMap,lu=new WeakMap,hu=new WeakMap;class X_{constructor(e,t){this._pdfInfo=e,this._transport=t}get annotationStorage(){return this._transport.annotationStorage}get canvasFactory(){return this._transport.canvasFactory}get filterFactory(){return this._transport.filterFactory}get numPages(){return this._pdfInfo.numPages}get fingerprints(){return this._pdfInfo.fingerprints}get isPureXfa(){return _t(this,"isPureXfa",!!this._transport._htmlForXfa)}get allXfaHtml(){return this._transport._htmlForXfa}getPage(e){return this._transport.getPage(e)}getPageIndex(e){return this._transport.getPageIndex(e)}getDestinations(){return this._transport.getDestinations()}getDestination(e){return this._transport.getDestination(e)}getPageLabels(){return this._transport.getPageLabels()}getPageLayout(){return this._transport.getPageLayout()}getPageMode(){return this._transport.getPageMode()}getViewerPreferences(){return this._transport.getViewerPreferences()}getOpenAction(){return this._transport.getOpenAction()}getAttachments(){return this._transport.getAttachments()}getAnnotationsByType(e,t){return this._transport.getAnnotationsByType(e,t)}getJSActions(){return this._transport.getDocJSActions()}getOutline(){return this._transport.getOutline()}getOptionalContentConfig({intent:e="display"}={}){const{renderingIntent:t}=this._transport.getRenderingIntent(e);return this._transport.getOptionalContentConfig(t)}getPermissions(){return this._transport.getPermissions()}getMetadata(){return this._transport.getMetadata()}getMarkInfo(){return this._transport.getMarkInfo()}getData(){return this._transport.getData()}saveDocument(){return this._transport.saveDocument()}extractPages(e){return this._transport.extractPages(e)}getDownloadInfo(){return this._transport.downloadInfoCapability.promise}cleanup(e=!1){return this._transport.startCleanup(e||this.isPureXfa)}destroy(){return this.loadingTask.destroy()}cachedPageNumber(e){return this._transport.cachedPageNumber(e)}get loadingParams(){return this._transport.loadingParams}get loadingTask(){return this._transport.loadingTask}getFieldObjects(){return this._transport.getFieldObjects()}hasJSActions(){return this._transport.hasJSActions()}getCalculationOrderIds(){return this._transport.getCalculationOrderIds()}}var Sn,cu,Ga,wc;class $_{constructor(e,t,s,i=!1){m(this,Ga);m(this,Sn,!1);m(this,cu,Dc.instance);this._pageIndex=e,this._pageInfo=t,this._transport=s,this._stats=i?new Jy:null,this._pdfBug=i,this.commonObjs=s.commonObjs,this.objs=new Qw,this._intentStates=new Map,this.destroyed=!1,this.recordedBBoxes=null}get pageNumber(){return this._pageIndex+1}set pageNumber(e){this._pageIndex=e-1}get rotate(){return this._pageInfo.rotate}get ref(){return this._pageInfo.ref}get userUnit(){return this._pageInfo.userUnit}get view(){return this._pageInfo.view}getViewport({scale:e,rotation:t=this.rotate,offsetX:s=0,offsetY:i=0,dontFlip:r=!1}={}){return new Af({viewBox:this.view,userUnit:this.userUnit,scale:e,rotation:t,offsetX:s,offsetY:i,dontFlip:r})}getAnnotations({intent:e="display"}={}){const{renderingIntent:t}=this._transport.getRenderingIntent(e);return this._transport.getAnnotations(this._pageIndex,t)}getJSActions(){return this._transport.getPageJSActions(this._pageIndex)}get filterFactory(){return this._transport.filterFactory}get isPureXfa(){return _t(this,"isPureXfa",!!this._transport._htmlForXfa)}async getXfa(){var e;return((e=this._transport._htmlForXfa)==null?void 0:e.children[this._pageIndex])||null}render({canvasContext:e,canvas:t=e.canvas,viewport:s,intent:i="display",annotationMode:r=Gn.ENABLE,transform:a=null,background:o=null,optionalContentConfigPromise:l=null,annotationCanvasMap:h=null,pageColors:c=null,printAnnotationStorage:d=null,isEditing:u=!1,recordOperations:f=!1,operationsFilter:y=null}){var R,B,j;(R=this._stats)==null||R.time("Overall");const g=this._transport.getRenderingIntent(i,r,d,u),{renderingIntent:v,cacheKey:b}=g;w(this,Sn,!1),l||(l=this._transport.getOptionalContentConfig(v));let A=this._intentStates.get(b);A||(A=Object.create(null),this._intentStates.set(b,A)),A.streamReaderCancelTimeout&&(clearTimeout(A.streamReaderCancelTimeout),A.streamReaderCancelTimeout=null);const _=!!(v&Bs.PRINT);A.displayReadyCapability||(A.displayReadyCapability=Promise.withResolvers(),A.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},(B=this._stats)==null||B.time("Page Request"),this._pumpOperatorList(g));const x=!!(this._pdfBug&&((j=globalThis.StepperManager)!=null&&j.enabled)),k=!this.recordedBBoxes&&(f||x),T=I=>{var L,S;if(A.renderTasks.delete(P),k){const N=(L=P.gfx)==null?void 0:L.dependencyTracker.take();N&&(P.stepper&&P.stepper.setOperatorBBoxes(N,P.gfx.dependencyTracker.takeDebugMetadata()),f&&(this.recordedBBoxes=N))}_&&w(this,Sn,!0),E(this,Ga,wc).call(this),I?(P.capability.reject(I),this._abortOperatorList({intentState:A,reason:I instanceof Error?I:new Error(I)})):P.capability.resolve(),this._stats&&(this._stats.timeEnd("Rendering"),this._stats.timeEnd("Overall"),(S=globalThis.Stats)!=null&&S.enabled&&globalThis.Stats.add(this.pageNumber,this._stats))},P=new Vb({callback:T,params:{canvas:t,canvasContext:e,dependencyTracker:k?new u_(t,A.operatorList.length,x):null,viewport:s,transform:a,background:o},objs:this.objs,commonObjs:this.commonObjs,annotationCanvasMap:h,operatorList:A.operatorList,pageIndex:this._pageIndex,canvasFactory:this._transport.canvasFactory,filterFactory:this._transport.filterFactory,useRequestAnimationFrame:!_,pdfBug:this._pdfBug,pageColors:c,enableHWA:this._transport.enableHWA,operationsFilter:y});(A.renderTasks||(A.renderTasks=new Set)).add(P);const F=P.task;return Promise.all([A.displayReadyCapability.promise,l]).then(([I,L])=>{var S;if(this.destroyed){T();return}if((S=this._stats)==null||S.time("Rendering"),!(L.renderingIntent&v))throw new Error("Must use the same `intent`-argument when calling the `PDFPageProxy.render` and `PDFDocumentProxy.getOptionalContentConfig` methods.");P.initializeGraphics({transparency:I,optionalContentConfig:L}),P.operatorListChanged()}).catch(T),F}getOperatorList({intent:e="display",annotationMode:t=Gn.ENABLE,printAnnotationStorage:s=null,isEditing:i=!1}={}){var h;function r(){o.operatorList.lastChunk&&(o.opListReadCapability.resolve(o.operatorList),o.renderTasks.delete(l))}const a=this._transport.getRenderingIntent(e,t,s,i,!0);let o=this._intentStates.get(a.cacheKey);o||(o=Object.create(null),this._intentStates.set(a.cacheKey,o));let l;return o.opListReadCapability||(l=Object.create(null),l.operatorListChanged=r,o.opListReadCapability=Promise.withResolvers(),(o.renderTasks||(o.renderTasks=new Set)).add(l),o.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},(h=this._stats)==null||h.time("Page Request"),this._pumpOperatorList(a)),o.opListReadCapability.promise}streamTextContent({includeMarkedContent:e=!1,disableNormalization:t=!1}={}){return this._transport.messageHandler.sendWithStream("GetTextContent",{pageId:n(this,cu).getPageId(this._pageIndex+1)-1,pageIndex:this._pageIndex,includeMarkedContent:e===!0,disableNormalization:t===!0},{highWaterMark:100,size(i){return i.items.length}})}getTextContent(e={}){if(this._transport._htmlForXfa)return this.getXfa().then(s=>Pc.textContent(s));const t=this.streamTextContent(e);return new Promise(function(s,i){function r(){a.read().then(function({value:l,done:h}){if(h){s(o);return}o.lang??(o.lang=l.lang),Object.assign(o.styles,l.styles),o.items.push(...l.items),r()},i)}const a=t.getReader(),o={items:[],styles:Object.create(null),lang:null};r()})}getStructTree(){return this._transport.getStructTree(this._pageIndex)}_destroy(){this.destroyed=!0;const e=[];for(const t of this._intentStates.values())if(this._abortOperatorList({intentState:t,reason:new Error("Page was destroyed."),force:!0}),!t.opListReadCapability)for(const s of t.renderTasks)e.push(s.completed),s.cancel();return this.objs.clear(),w(this,Sn,!1),Promise.all(e)}cleanup(e=!1){w(this,Sn,!0);const t=E(this,Ga,wc).call(this);return e&&t&&this._stats&&(this._stats=new Jy),t}_startRenderPage(e,t){var i,r;const s=this._intentStates.get(t);s&&((i=this._stats)==null||i.timeEnd("Page Request"),(r=s.displayReadyCapability)==null||r.resolve(e))}_renderPageChunk(e,t){for(let s=0,i=e.length;s<i;s++)t.operatorList.fnArray.push(e.fnArray[s]),t.operatorList.argsArray.push(e.argsArray[s]);t.operatorList.lastChunk=e.lastChunk,t.operatorList.separateAnnots=e.separateAnnots;for(const s of t.renderTasks)s.operatorListChanged();e.lastChunk&&E(this,Ga,wc).call(this)}_pumpOperatorList({renderingIntent:e,cacheKey:t,annotationStorageSerializable:s,modifiedIds:i}){const{map:r,transfer:a}=s,l=this._transport.messageHandler.sendWithStream("GetOperatorList",{pageId:n(this,cu).getPageId(this._pageIndex+1)-1,pageIndex:this._pageIndex,intent:e,cacheKey:t,annotationStorage:r,modifiedIds:i},a).getReader(),h=this._intentStates.get(t);h.streamReader=l;const c=()=>{l.read().then(({value:d,done:u})=>{if(u){h.streamReader=null;return}this._transport.destroyed||(this._renderPageChunk(d,h),c())},d=>{if(h.streamReader=null,!this._transport.destroyed){if(h.operatorList){h.operatorList.lastChunk=!0;for(const u of h.renderTasks)u.operatorListChanged();E(this,Ga,wc).call(this)}if(h.displayReadyCapability)h.displayReadyCapability.reject(d);else if(h.opListReadCapability)h.opListReadCapability.reject(d);else throw d}})};c()}_abortOperatorList({intentState:e,reason:t,force:s=!1}){if(e.streamReader){if(e.streamReaderCancelTimeout&&(clearTimeout(e.streamReaderCancelTimeout),e.streamReaderCancelTimeout=null),!s){if(e.renderTasks.size>0)return;if(t instanceof My){let i=G_;t.extraDelay>0&&t.extraDelay<1e3&&(i+=t.extraDelay),e.streamReaderCancelTimeout=setTimeout(()=>{e.streamReaderCancelTimeout=null,this._abortOperatorList({intentState:e,reason:t,force:!0})},i);return}}if(e.streamReader.cancel(new Xr(t.message)).catch(()=>{}),e.streamReader=null,!this._transport.destroyed){for(const[i,r]of this._intentStates)if(r===e){this._intentStates.delete(i);break}this.cleanup()}}}get stats(){return this._stats}}Sn=new WeakMap,cu=new WeakMap,Ga=new WeakSet,wc=function(){if(!n(this,Sn)||this.destroyed)return!1;for(const{renderTasks:e,operatorList:t}of this._intentStates.values())if(e.size>0||!t.lastChunk)return!1;return this._intentStates.clear(),this.objs.clear(),w(this,Sn,!1),!0};var Sr,ui,En,Xa,Fg,$a,Ya,th,qf,Og,av,Ng,ov,qa,vc,eh,Kf;const ee=class ee{constructor({name:e=null,port:t=null,verbosity:s=kA()}={}){m(this,th);m(this,Og);m(this,Ng);m(this,qa);m(this,Sr,Promise.withResolvers());m(this,ui,null);m(this,En,null);m(this,Xa,null);if(this.name=e,this.destroyed=!1,this.verbosity=s,t){if(n(ee,Ya).has(t))throw new Error("Cannot use more than one PDFWorker per port.");n(ee,Ya).set(t,this),E(this,Og,av).call(this,t)}else E(this,Ng,ov).call(this)}get promise(){return n(this,Sr).promise}get port(){return n(this,En)}get messageHandler(){return n(this,ui)}destroy(){var e,t;this.destroyed=!0,(e=n(this,Xa))==null||e.terminate(),w(this,Xa,null),n(ee,Ya).delete(n(this,En)),w(this,En,null),(t=n(this,ui))==null||t.destroy(),w(this,ui,null)}static create(e){const t=n(this,Ya).get(e==null?void 0:e.port);if(t){if(t._pendingDestroy)throw new Error("PDFWorker.create - the worker is being destroyed.\nPlease remember to await `PDFDocumentLoadingTask.destroy()`-calls.");return t}return new ee(e)}static get workerSrc(){if(qi.workerSrc)return qi.workerSrc;throw new Error('No "GlobalWorkerOptions.workerSrc" specified.')}static get _setupFakeWorkerGlobal(){return _t(this,"_setupFakeWorkerGlobal",(async()=>n(this,eh,Kf)?n(this,eh,Kf):(await _A(()=>import(this.workerSrc),__vite__mapDeps([]),import.meta.url)).WorkerMessageHandler)())}};Sr=new WeakMap,ui=new WeakMap,En=new WeakMap,Xa=new WeakMap,Fg=new WeakMap,$a=new WeakMap,Ya=new WeakMap,th=new WeakSet,qf=function(){n(this,Sr).resolve(),n(this,ui).send("configure",{verbosity:this.verbosity})},Og=new WeakSet,av=function(e){w(this,En,e),w(this,ui,new pc("main","worker",e)),n(this,ui).on("ready",()=>{}),E(this,th,qf).call(this)},Ng=new WeakSet,ov=function(){if(n(ee,$a)||n(ee,eh,Kf)){E(this,qa,vc).call(this);return}let{workerSrc:e}=ee;try{ee._isSameOrigin(window.location,e)||(e=ee._createCDNWrapper(new URL(e,window.location).href));const t=new Worker(e,{type:"module"}),s=new pc("main","worker",t),i=()=>{r.abort(),s.destroy(),t.terminate(),this.destroyed?n(this,Sr).reject(new Error("Worker was destroyed")):E(this,qa,vc).call(this)},r=new AbortController;t.addEventListener("error",()=>{n(this,Xa)||i()},{signal:r.signal}),s.on("test",o=>{if(r.abort(),this.destroyed||!o){i();return}w(this,ui,s),w(this,En,t),w(this,Xa,t),E(this,th,qf).call(this)}),s.on("ready",o=>{if(r.abort(),this.destroyed){i();return}try{a()}catch{E(this,qa,vc).call(this)}});const a=()=>{const o=new Uint8Array;s.send("test",o,[o.buffer])};a();return}catch{Nm("The worker has been disabled.")}E(this,qa,vc).call(this)},qa=new WeakSet,vc=function(){n(ee,$a)||(At("Setting up fake worker."),w(ee,$a,!0)),ee._setupFakeWorkerGlobal.then(e=>{if(this.destroyed){n(this,Sr).reject(new Error("Worker was destroyed"));return}const t=new i_;w(this,En,t);const s=`fake${Ae(ee,Fg)._++}`,i=new pc(s+"_worker",s,t);e.setup(i,t),w(this,ui,new pc(s,s+"_worker",t)),E(this,th,qf).call(this)}).catch(e=>{n(this,Sr).reject(new Error(`Setting up fake worker failed: "${e.message}".`))})},eh=new WeakSet,Kf=function(){var e;try{return((e=globalThis.pdfjsWorker)==null?void 0:e.WorkerMessageHandler)||null}catch{return null}},m(ee,eh),m(ee,Fg,0),m(ee,$a,!1),m(ee,Ya,new WeakMap),rs&&(w(ee,$a,!0),qi.workerSrc||(qi.workerSrc="./pdf.worker.mjs")),ee._isSameOrigin=(e,t)=>{const s=URL.parse(e);if(!(s!=null&&s.origin)||s.origin==="null")return!1;const i=new URL(t,s);return s.origin===i.origin},ee._createCDNWrapper=e=>{const t=`await import("${e}");`;return URL.createObjectURL(new Blob([t],{type:"text/javascript"}))},ee.fromPort=e=>{if(zA("`PDFWorker.fromPort` - please use `PDFWorker.create` instead."),!(e!=null&&e.port))throw new Error("PDFWorker.fromPort - invalid method signature.");return ee.create(e)};let Mc=ee;var Es,Cn,xn,Js,Er,sh,kn,fs,Bg,lv,Ka,Ac,ih,Zf;class Y_{constructor(e,t,s,i,r){m(this,Bg);m(this,Ka);m(this,ih);$(this,"downloadInfoCapability",Promise.withResolvers());m(this,Es,null);m(this,Cn,new Map);m(this,xn,null);m(this,Js,new Map);m(this,Er,new Map);m(this,sh,new Map);m(this,kn,null);m(this,fs,Dc.instance);this.messageHandler=e,this.loadingTask=t,w(this,xn,s),this.commonObjs=new Qw,this.fontLoader=new KA({ownerDocument:i.ownerDocument,styleElement:i.styleElement}),this.enableHWA=i.enableHWA,this.loadingParams=i.loadingParams,this._params=i,this.canvasFactory=r.canvasFactory,this.filterFactory=r.filterFactory,this.cMapReaderFactory=r.cMapReaderFactory,this.standardFontDataFactory=r.standardFontDataFactory,this.wasmFactory=r.wasmFactory,this.destroyed=!1,this.destroyCapability=null,this.setupMessageHandler(),n(this,fs).addListener(E(this,Bg,lv).bind(this))}get annotationStorage(){return _t(this,"annotationStorage",new Ly)}getRenderingIntent(e,t=Gn.ENABLE,s=null,i=!1,r=!1){let a=Bs.DISPLAY,o=Sb;switch(e){case"any":a=Bs.ANY;break;case"display":break;case"print":a=Bs.PRINT;break;default:At(`getRenderingIntent - invalid intent: ${e}`)}const l=a&Bs.PRINT&&s instanceof xw?s:this.annotationStorage;switch(t){case Gn.DISABLE:a+=Bs.ANNOTATIONS_DISABLE;break;case Gn.ENABLE:break;case Gn.ENABLE_FORMS:a+=Bs.ANNOTATIONS_FORMS;break;case Gn.ENABLE_STORAGE:a+=Bs.ANNOTATIONS_STORAGE,o=l.serializable;break;default:At(`getRenderingIntent - invalid annotationMode: ${t}`)}i&&(a+=Bs.IS_EDITING),r&&(a+=Bs.OPLIST);const{ids:h,hash:c}=l.modifiedIds,d=[a,o.hash,c];return{renderingIntent:a,cacheKey:d.join("_"),annotationStorageSerializable:o,modifiedIds:h}}destroy(){var s;if(this.destroyCapability)return this.destroyCapability.promise;this.destroyed=!0,this.destroyCapability=Promise.withResolvers(),(s=n(this,kn))==null||s.reject(new Error("Worker was destroyed during onPassword callback"));const e=[];for(const i of n(this,Js).values())e.push(i._destroy());n(this,Js).clear(),n(this,Er).clear(),n(this,sh).clear(),this.hasOwnProperty("annotationStorage")&&this.annotationStorage.resetModified();const t=this.messageHandler.sendWithPromise("Terminate",null);return e.push(t),Promise.all(e).then(()=>{var i,r;this.commonObjs.clear(),this.fontLoader.clear(),n(this,Cn).clear(),this.filterFactory.destroy(),Ic.cleanup(),(i=n(this,xn))==null||i.cancelAllRequests(new Xr("Worker was terminated.")),(r=this.messageHandler)==null||r.destroy(),this.messageHandler=null,this.destroyCapability.resolve()},this.destroyCapability.reject),this.destroyCapability.promise}setupMessageHandler(){const{messageHandler:e,loadingTask:t}=this;e.on("GetReader",(s,i)=>{Bt(n(this,xn),"GetReader - no `BasePDFStream` instance available."),w(this,Es,n(this,xn).getFullReader()),n(this,Es).onProgress=r=>E(this,ih,Zf).call(this,r),i.onPull=()=>{n(this,Es).read().then(function({value:r,done:a}){if(a){i.close();return}Bt(r instanceof ArrayBuffer,"GetReader - expected an ArrayBuffer."),i.enqueue(new Uint8Array(r),1,[r])}).catch(r=>{i.error(r)})},i.onCancel=r=>{n(this,Es).cancel(r),i.ready.catch(a=>{if(!this.destroyed)throw a})}}),e.on("ReaderHeadersReady",async s=>{await n(this,Es).headersReady;const{isStreamingSupported:i,isRangeSupported:r,contentLength:a}=n(this,Es);return i&&r&&(n(this,Es).onProgress=null),{isStreamingSupported:i,isRangeSupported:r,contentLength:a}}),e.on("GetRangeReader",(s,i)=>{Bt(n(this,xn),"GetRangeReader - no `BasePDFStream` instance available.");const r=n(this,xn).getRangeReader(s.begin,s.end);if(!r){i.close();return}i.onPull=()=>{r.read().then(function({value:a,done:o}){if(o){i.close();return}Bt(a instanceof ArrayBuffer,"GetRangeReader - expected an ArrayBuffer."),i.enqueue(new Uint8Array(a),1,[a])}).catch(a=>{i.error(a)})},i.onCancel=a=>{r.cancel(a),i.ready.catch(o=>{if(!this.destroyed)throw o})}}),e.on("GetDoc",({pdfInfo:s})=>{n(this,fs).pagesNumber=s.numPages,this._numPages=s.numPages,this._htmlForXfa=s.htmlForXfa,delete s.htmlForXfa,t._capability.resolve(new X_(s,this))}),e.on("DocException",s=>{t._capability.reject(as(s))}),e.on("PasswordRequest",s=>{w(this,kn,Promise.withResolvers());try{if(!t.onPassword)throw as(s);const i=r=>{r instanceof Error?n(this,kn).reject(r):n(this,kn).resolve({password:r})};t.onPassword(i,s.code)}catch(i){n(this,kn).reject(i)}return n(this,kn).promise}),e.on("DataLoaded",s=>{E(this,ih,Zf).call(this,{loaded:s.length,total:s.length}),this.downloadInfoCapability.resolve(s)}),e.on("StartRenderPage",s=>{if(this.destroyed)return;n(this,Js).get(s.pageIndex)._startRenderPage(s.transparency,s.cacheKey)}),e.on("commonobj",([s,i,r])=>{var a;if(this.destroyed||this.commonObjs.has(s))return null;switch(i){case"Font":if("error"in r){const u=r.error;At(`Error during font loading: ${u}`),this.commonObjs.resolve(s,u);break}const o=new Eb(r),l=this._params.pdfBug&&((a=globalThis.FontInspector)!=null&&a.enabled)?(u,f)=>globalThis.FontInspector.fontAdded(u,f):null,h=new ZA(o,l,r.extra,r.charProcOperatorList);this.fontLoader.bind(h).catch(()=>e.sendWithPromise("FontFallback",{id:s})).finally(()=>{!h.fontExtraProperties&&h.data&&h.clearData(),this.commonObjs.resolve(s,h)});break;case"CopyLocalImage":const{imageRef:c}=r;Bt(c,"The imageRef must be defined.");for(const u of n(this,Js).values())for(const[,f]of u.objs)if((f==null?void 0:f.ref)===c)return f.dataLen?(this.commonObjs.resolve(s,structuredClone(f)),f.dataLen):null;break;case"FontPath":this.commonObjs.resolve(s,new JA(r));break;case"Image":this.commonObjs.resolve(s,r);break;case"Pattern":const d=new Cb(r);this.commonObjs.resolve(s,d.getIR());break;default:throw new Error(`Got unknown common object type ${i}`)}return null}),e.on("obj",([s,i,r,a])=>{var l;if(this.destroyed)return;const o=n(this,Js).get(i);if(!o.objs.has(s)){if(o._intentStates.size===0){(l=a==null?void 0:a.bitmap)==null||l.close();return}switch(r){case"Image":case"Pattern":o.objs.resolve(s,a);break;default:throw new Error(`Got unknown object type ${r}`)}}}),e.on("DocProgress",s=>{this.destroyed||E(this,ih,Zf).call(this,s)}),e.on("FetchBinaryData",async s=>{if(this.destroyed)throw new Error("Worker was destroyed.");const i=this[s.type];if(!i)throw new Error(`${s.type} not initialized, see the \`useWorkerFetch\` parameter.`);return i.fetch(s)})}getData(){return this.messageHandler.sendWithPromise("GetData",null)}saveDocument(){var s;this.annotationStorage.size<=0&&At("saveDocument called while `annotationStorage` is empty, please use the getData-method instead.");const{map:e,transfer:t}=this.annotationStorage.serializable;return this.messageHandler.sendWithPromise("SaveDocument",{isPureXfa:!!this._htmlForXfa,numPages:this._numPages,annotationStorage:e,filename:((s=n(this,Es))==null?void 0:s.filename)??null},t).finally(()=>{this.annotationStorage.resetModified()})}extractPages(e){return this.messageHandler.sendWithPromise("ExtractPages",{pageInfos:e})}getPage(e){if(!Number.isInteger(e)||e<=0||e>n(this,fs).pagesNumber)return Promise.reject(new Error("Invalid page request."));const t=e-1,s=n(this,fs).getPageId(e)-1,i=n(this,Er).get(t);if(i)return i;const r=this.messageHandler.sendWithPromise("GetPage",{pageIndex:s}).then(a=>{if(this.destroyed)throw new Error("Transport destroyed");a.refStr&&n(this,sh).set(a.refStr,s);const o=new $_(t,a,this,this._params.pdfBug);return n(this,Js).set(t,o),o});return n(this,Er).set(t,r),r}async getPageIndex(e){if(!xb(e))throw new Error("Invalid pageIndex request.");const t=await this.messageHandler.sendWithPromise("GetPageIndex",{num:e.num,gen:e.gen});return n(this,fs).getPageNumber(t+1)-1}getAnnotations(e,t){return this.messageHandler.sendWithPromise("GetAnnotations",{pageIndex:n(this,fs).getPageId(e+1)-1,intent:t})}getFieldObjects(){return E(this,Ka,Ac).call(this,"GetFieldObjects")}hasJSActions(){return E(this,Ka,Ac).call(this,"HasJSActions")}getCalculationOrderIds(){return this.messageHandler.sendWithPromise("GetCalculationOrderIds",null)}getDestinations(){return this.messageHandler.sendWithPromise("GetDestinations",null)}getDestination(e){return typeof e!="string"?Promise.reject(new Error("Invalid destination request.")):this.messageHandler.sendWithPromise("GetDestination",{id:e})}getPageLabels(){return this.messageHandler.sendWithPromise("GetPageLabels",null)}getPageLayout(){return this.messageHandler.sendWithPromise("GetPageLayout",null)}getPageMode(){return this.messageHandler.sendWithPromise("GetPageMode",null)}getViewerPreferences(){return this.messageHandler.sendWithPromise("GetViewerPreferences",null)}getOpenAction(){return this.messageHandler.sendWithPromise("GetOpenAction",null)}getAttachments(){return this.messageHandler.sendWithPromise("GetAttachments",null)}getAnnotationsByType(e,t){return this.messageHandler.sendWithPromise("GetAnnotationsByType",{types:e,pageIndexesToSkip:t})}getDocJSActions(){return E(this,Ka,Ac).call(this,"GetDocJSActions")}getPageJSActions(e){return this.messageHandler.sendWithPromise("GetPageJSActions",{pageIndex:n(this,fs).getPageId(e+1)-1})}getStructTree(e){return this.messageHandler.sendWithPromise("GetStructTree",{pageIndex:n(this,fs).getPageId(e+1)-1})}getOutline(){return this.messageHandler.sendWithPromise("GetOutline",null)}getOptionalContentConfig(e){return E(this,Ka,Ac).call(this,"GetOptionalContentConfig").then(t=>new k_(t,e))}getPermissions(){return this.messageHandler.sendWithPromise("GetPermissions",null)}getMetadata(){const e="GetMetadata",t=n(this,Cn).get(e);if(t)return t;const s=this.messageHandler.sendWithPromise(e,null).then(i=>{var r,a;return{info:i[0],metadata:i[1]?new C_(i[1]):null,contentDispositionFilename:((r=n(this,Es))==null?void 0:r.filename)??null,contentLength:((a=n(this,Es))==null?void 0:a.contentLength)??null,hasStructTree:i[2]}});return n(this,Cn).set(e,s),s}getMarkInfo(){return this.messageHandler.sendWithPromise("GetMarkInfo",null)}async startCleanup(e=!1){if(!this.destroyed){await this.messageHandler.sendWithPromise("Cleanup",null);for(const t of n(this,Js).values())if(!t.cleanup())throw new Error(`startCleanup: Page ${t.pageNumber} is currently rendering.`);this.commonObjs.clear(),e||this.fontLoader.clear(),n(this,Cn).clear(),this.filterFactory.destroy(!0),Ic.cleanup()}}cachedPageNumber(e){if(!xb(e))return null;const t=e.gen===0?`${e.num}R`:`${e.num}R${e.gen}`,s=n(this,sh).get(t);return s>=0?n(this,fs).getPageNumber(s+1):null}}Es=new WeakMap,Cn=new WeakMap,xn=new WeakMap,Js=new WeakMap,Er=new WeakMap,sh=new WeakMap,kn=new WeakMap,fs=new WeakMap,Bg=new WeakSet,lv=function(){const e=new Map,t=new Map;for(let s=0,i=n(this,fs).pagesNumber;s<i;s++){const r=n(this,fs).getPrevPageNumber(s+1)-1,a=n(this,Js).get(r);a&&e.set(s,a);const o=n(this,Er).get(r);o&&t.set(s,o)}w(this,Js,e),w(this,Er,t)},Ka=new WeakSet,Ac=function(e,t=null){const s=n(this,Cn).get(e);if(s)return s;const i=this.messageHandler.sendWithPromise(e,t);return n(this,Cn).set(e,i),i},ih=new WeakSet,Zf=function({loaded:e,total:t}){var s,i;(i=(s=this.loadingTask).onProgress)==null||i.call(s,{loaded:e,total:t,percent:Ve(Math.round(e/t*100),0,100)})};class q_{constructor(e){$(this,"_internalRenderTask",null);$(this,"onContinue",null);$(this,"onError",null);this._internalRenderTask=e}get promise(){return this._internalRenderTask.capability.promise}cancel(e=0){this._internalRenderTask.cancel(null,e)}get separateAnnots(){const{separateAnnots:e}=this._internalRenderTask.operatorList;if(!e)return!1;const{annotationCanvasMap:t}=this._internalRenderTask;return e.form||e.canvas&&(t==null?void 0:t.size)>0}}var Cr,Za;const Qr=class Qr{constructor({callback:e,params:t,objs:s,commonObjs:i,annotationCanvasMap:r,operatorList:a,pageIndex:o,canvasFactory:l,filterFactory:h,useRequestAnimationFrame:c=!1,pdfBug:d=!1,pageColors:u=null,enableHWA:f=!1,operationsFilter:y=null}){m(this,Cr,null);this.callback=e,this.params=t,this.objs=s,this.commonObjs=i,this.annotationCanvasMap=r,this.operatorListIdx=null,this.operatorList=a,this._pageIndex=o,this.canvasFactory=l,this.filterFactory=h,this._pdfBug=d,this.pageColors=u,this.running=!1,this.graphicsReadyCallback=null,this.graphicsReady=!1,this._useRequestAnimationFrame=c===!0&&typeof window<"u",this.cancelled=!1,this.capability=Promise.withResolvers(),this.task=new q_(this),this._cancelBound=this.cancel.bind(this),this._continueBound=this._continue.bind(this),this._scheduleNextBound=this._scheduleNext.bind(this),this._nextBound=this._next.bind(this),this._canvas=t.canvas,this._canvasContext=t.canvas?null:t.canvasContext,this._enableHWA=f,this._dependencyTracker=t.dependencyTracker,this._operationsFilter=y}get completed(){return this.capability.promise.catch(function(){})}initializeGraphics({transparency:e=!1,optionalContentConfig:t}){var l,h;if(this.cancelled)return;if(this._canvas){if(n(Qr,Za).has(this._canvas))throw new Error("Cannot use the same canvas during multiple render() operations. Use different canvas or ensure previous operations were cancelled or completed.");n(Qr,Za).add(this._canvas)}this._pdfBug&&((l=globalThis.StepperManager)!=null&&l.enabled)&&(this.stepper=globalThis.StepperManager.create(this._pageIndex),this.stepper.init(this.operatorList),this.stepper.nextBreakPoint=this.stepper.getNextBreakPoint());const{viewport:s,transform:i,background:r,dependencyTracker:a}=this.params,o=this._canvasContext||this._canvas.getContext("2d",{alpha:!1,willReadFrequently:!this._enableHWA});this.gfx=new Zo(o,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:t},this.annotationCanvasMap,this.pageColors,a),this.gfx.beginDrawing({transform:i,viewport:s,transparency:e,background:r}),this.operatorListIdx=0,this.graphicsReady=!0,(h=this.graphicsReadyCallback)==null||h.call(this)}cancel(e=null,t=0){var s,i,r;this.running=!1,this.cancelled=!0,(s=this.gfx)==null||s.endDrawing(),n(this,Cr)&&(window.cancelAnimationFrame(n(this,Cr)),w(this,Cr,null)),n(Qr,Za).delete(this._canvas),e||(e=new My(`Rendering cancelled, page ${this._pageIndex+1}`,t)),this.callback(e),(r=(i=this.task).onError)==null||r.call(i,e)}operatorListChanged(){var e,t;if(!this.graphicsReady){this.graphicsReadyCallback||(this.graphicsReadyCallback=this._continueBound);return}(e=this.gfx.dependencyTracker)==null||e.growOperationsCount(this.operatorList.fnArray.length),(t=this.stepper)==null||t.updateOperatorList(this.operatorList),!this.running&&this._continue()}_continue(){this.running=!0,!this.cancelled&&(this.task.onContinue?this.task.onContinue(this._scheduleNextBound):this._scheduleNext())}_scheduleNext(){this._useRequestAnimationFrame?w(this,Cr,window.requestAnimationFrame(()=>{w(this,Cr,null),this._nextBound().catch(this._cancelBound)})):Promise.resolve().then(this._nextBound).catch(this._cancelBound)}async _next(){this.cancelled||(this.operatorListIdx=this.gfx.executeOperatorList(this.operatorList,this.operatorListIdx,this._continueBound,this.stepper,this._operationsFilter),this.operatorListIdx===this.operatorList.argsArray.length&&(this.running=!1,this.operatorList.lastChunk&&(this.gfx.endDrawing(),n(Qr,Za).delete(this._canvas),this.callback())))}};Cr=new WeakMap,Za=new WeakMap,m(Qr,Za,new WeakSet);let Vb=Qr;const hv="5.4.624",K_="384c6208b";var Cs,Ja,nh,Ee,du,rh,Tn,uu,xr,fi,fu,pu,Wb,gu,Gb,mu,Xb,Pn,qr,zg,cv,Bi,Wn;const os=class os{constructor({editor:e=null,uiManager:t=null}){m(this,pu);m(this,gu);m(this,mu);m(this,Pn);m(this,zg);m(this,Bi);m(this,Cs,null);m(this,Ja,null);m(this,nh,void 0);m(this,Ee,null);m(this,du,!1);m(this,rh,!1);m(this,Tn,null);m(this,uu,void 0);m(this,xr,null);m(this,fi,null);var s,i;e?(w(this,rh,!1),w(this,Tn,e)):w(this,rh,!0),w(this,fi,(e==null?void 0:e._uiManager)||t),w(this,uu,n(this,fi)._eventBus),w(this,nh,((s=e==null?void 0:e.color)==null?void 0:s.toUpperCase())||((i=n(this,fi))==null?void 0:i.highlightColors.values().next().value)||"#FFFF98"),n(os,fu)||w(os,fu,Object.freeze({blue:"pdfjs-editor-colorpicker-blue",green:"pdfjs-editor-colorpicker-green",pink:"pdfjs-editor-colorpicker-pink",red:"pdfjs-editor-colorpicker-red",yellow:"pdfjs-editor-colorpicker-yellow"}))}static get _keyboardManager(){return _t(this,"_keyboardManager",new Sf([[["Escape","mac+Escape"],os.prototype._hideDropdownFromKeyboard],[[" ","mac+ "],os.prototype._colorSelectFromKeyboard],[["ArrowDown","ArrowRight","mac+ArrowDown","mac+ArrowRight"],os.prototype._moveToNext],[["ArrowUp","ArrowLeft","mac+ArrowUp","mac+ArrowLeft"],os.prototype._moveToPrevious],[["Home","mac+Home"],os.prototype._moveToBeginning],[["End","mac+End"],os.prototype._moveToEnd]]))}renderButton(){const e=w(this,Cs,document.createElement("button"));e.className="colorPicker",e.tabIndex="0",e.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-button"),e.ariaHasPopup="true",n(this,Tn)&&(e.ariaControls=`${n(this,Tn).id}_colorpicker_dropdown`);const t=n(this,fi)._signal;e.addEventListener("click",E(this,Pn,qr).bind(this),{signal:t}),e.addEventListener("keydown",E(this,mu,Xb).bind(this),{signal:t});const s=w(this,Ja,document.createElement("span"));return s.className="swatch",s.ariaHidden="true",s.style.backgroundColor=n(this,nh),e.append(s),e}renderMainDropdown(){const e=w(this,Ee,E(this,pu,Wb).call(this));return e.ariaOrientation="horizontal",e.ariaLabelledBy="highlightColorPickerLabel",e}_colorSelectFromKeyboard(e){if(e.target===n(this,Cs)){E(this,Pn,qr).call(this,e);return}const t=e.target.getAttribute("data-color");t&&E(this,gu,Gb).call(this,t,e)}_moveToNext(e){var t,s;if(!n(this,Bi,Wn)){E(this,Pn,qr).call(this,e);return}if(e.target===n(this,Cs)){(t=n(this,Ee).firstElementChild)==null||t.focus();return}(s=e.target.nextSibling)==null||s.focus()}_moveToPrevious(e){var t,s;if(e.target===((t=n(this,Ee))==null?void 0:t.firstElementChild)||e.target===n(this,Cs)){n(this,Bi,Wn)&&this._hideDropdownFromKeyboard();return}n(this,Bi,Wn)||E(this,Pn,qr).call(this,e),(s=e.target.previousSibling)==null||s.focus()}_moveToBeginning(e){var t;if(!n(this,Bi,Wn)){E(this,Pn,qr).call(this,e);return}(t=n(this,Ee).firstElementChild)==null||t.focus()}_moveToEnd(e){var t;if(!n(this,Bi,Wn)){E(this,Pn,qr).call(this,e);return}(t=n(this,Ee).lastElementChild)==null||t.focus()}hideDropdown(){var e,t;(e=n(this,Ee))==null||e.classList.add("hidden"),n(this,Cs).ariaExpanded="false",(t=n(this,xr))==null||t.abort(),w(this,xr,null)}_hideDropdownFromKeyboard(){var e;if(!n(this,rh)){if(!n(this,Bi,Wn)){(e=n(this,Tn))==null||e.unselect();return}this.hideDropdown(),n(this,Cs).focus({preventScroll:!0,focusVisible:n(this,du)})}}updateColor(e){if(n(this,Ja)&&(n(this,Ja).style.backgroundColor=e),!n(this,Ee))return;const t=n(this,fi).highlightColors.values();for(const s of n(this,Ee).children)s.ariaSelected=t.next().value===e.toUpperCase()}destroy(){var e,t;(e=n(this,Cs))==null||e.remove(),w(this,Cs,null),w(this,Ja,null),(t=n(this,Ee))==null||t.remove(),w(this,Ee,null)}};Cs=new WeakMap,Ja=new WeakMap,nh=new WeakMap,Ee=new WeakMap,du=new WeakMap,rh=new WeakMap,Tn=new WeakMap,uu=new WeakMap,xr=new WeakMap,fi=new WeakMap,fu=new WeakMap,pu=new WeakSet,Wb=function(){const e=document.createElement("div"),t=n(this,fi)._signal;e.addEventListener("contextmenu",ii,{signal:t}),e.className="dropdown",e.role="listbox",e.ariaMultiSelectable="false",e.ariaOrientation="vertical",e.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-dropdown"),n(this,Tn)&&(e.id=`${n(this,Tn).id}_colorpicker_dropdown`);for(const[s,i]of n(this,fi).highlightColors){const r=document.createElement("button");r.tabIndex="0",r.role="option",r.setAttribute("data-color",i),r.title=s,r.setAttribute("data-l10n-id",n(os,fu)[s]);const a=document.createElement("span");r.append(a),a.className="swatch",a.style.backgroundColor=i,r.ariaSelected=i===n(this,nh),r.addEventListener("click",E(this,gu,Gb).bind(this,i),{signal:t}),e.append(r)}return e.addEventListener("keydown",E(this,mu,Xb).bind(this),{signal:t}),e},gu=new WeakSet,Gb=function(e,t){t.stopPropagation(),n(this,uu).dispatch("switchannotationeditorparams",{source:this,type:Mt.HIGHLIGHT_COLOR,value:e}),this.updateColor(e)},mu=new WeakSet,Xb=function(e){os._keyboardManager.exec(this,e)},Pn=new WeakSet,qr=function(e){if(n(this,Bi,Wn)){this.hideDropdown();return}if(w(this,du,e.detail===0),n(this,xr)||(w(this,xr,new AbortController),window.addEventListener("pointerdown",E(this,zg,cv).bind(this),{signal:n(this,fi).combinedSignal(n(this,xr))})),n(this,Cs).ariaExpanded="true",n(this,Ee)){n(this,Ee).classList.remove("hidden");return}const t=w(this,Ee,E(this,pu,Wb).call(this));n(this,Cs).append(t)},zg=new WeakSet,cv=function(e){var t;(t=n(this,Ee))!=null&&t.contains(e.target)||this.hideDropdown()},Bi=new WeakSet,Wn=function(){return n(this,Ee)&&!n(this,Ee).classList.contains("hidden")},m(os,fu,null);let xp=os;var zi,bu,ah,yu;const ta=class ta{constructor(e){m(this,zi,null);m(this,bu,null);m(this,ah,null);w(this,bu,e),w(this,ah,e._uiManager),n(ta,yu)||w(ta,yu,Object.freeze({freetext:"pdfjs-editor-color-picker-free-text-input",ink:"pdfjs-editor-color-picker-ink-input"}))}renderButton(){if(n(this,zi))return n(this,zi);const{editorType:e,colorType:t,color:s}=n(this,bu),i=w(this,zi,document.createElement("input"));return i.type="color",i.value=s||"#000000",i.className="basicColorPicker",i.tabIndex=0,i.setAttribute("data-l10n-id",n(ta,yu)[e]),i.addEventListener("input",()=>{n(this,ah).updateParams(t,i.value)},{signal:n(this,ah)._signal}),i}update(e){n(this,zi)&&(n(this,zi).value=e)}destroy(){var e;(e=n(this,zi))==null||e.remove(),w(this,zi,null)}hideDropdown(){}};zi=new WeakMap,bu=new WeakMap,ah=new WeakMap,yu=new WeakMap,m(ta,yu,null);let kp=ta;function _0(p){return Math.floor(Math.max(0,Math.min(1,p))*255).toString(16).padStart(2,"0")}function nc(p){return Math.max(0,Math.min(255,255*p))}class S0{static CMYK_G([e,t,s,i]){return["G",1-Math.min(1,.3*e+.59*s+.11*t+i)]}static G_CMYK([e]){return["CMYK",0,0,0,1-e]}static G_RGB([e]){return["RGB",e,e,e]}static G_rgb([e]){return e=nc(e),[e,e,e]}static G_HTML([e]){const t=_0(e);return`#${t}${t}${t}`}static RGB_G([e,t,s]){return["G",.3*e+.59*t+.11*s]}static RGB_rgb(e){return e.map(nc)}static RGB_HTML(e){return`#${e.map(_0).join("")}`}static T_HTML(){return"#00000000"}static T_rgb(){return[null]}static CMYK_RGB([e,t,s,i]){return["RGB",1-Math.min(1,e+i),1-Math.min(1,s+i),1-Math.min(1,t+i)]}static CMYK_rgb([e,t,s,i]){return[nc(1-Math.min(1,e+i)),nc(1-Math.min(1,s+i)),nc(1-Math.min(1,t+i))]}static CMYK_HTML(e){const t=this.CMYK_RGB(e).slice(1);return this.RGB_HTML(t)}static RGB_CMYK([e,t,s]){const i=1-e,r=1-t,a=1-s,o=Math.min(i,r,a);return["CMYK",i,r,a,o]}}class Z_{create(e,t,s=!1){if(e<=0||t<=0)throw new Error("Invalid SVG dimensions");const i=this._createSVG("svg:svg");return i.setAttribute("version","1.1"),s||(i.setAttribute("width",`${e}px`),i.setAttribute("height",`${t}px`)),i.setAttribute("preserveAspectRatio","none"),i.setAttribute("viewBox",`0 0 ${e} ${t}`),i}createElement(e){if(typeof e!="string")throw new Error("Invalid SVG element type");return this._createSVG(e)}_createSVG(e){zt("Abstract method `_createSVG` called.")}}class Tp extends Z_{_createSVG(e){return document.createElementNS(Ji,e)}}const J_=9,Ro=new WeakSet,Q_=new Date().getTimezoneOffset()*60*1e3;class tb{static create(e){switch(e.data.annotationType){case be.LINK:return new Ny(e);case be.TEXT:return new e1(e);case be.WIDGET:switch(e.data.fieldType){case"Tx":return new s1(e);case"Btn":return e.data.radioButton?new fv(e):e.data.checkBox?new n1(e):new r1(e);case"Ch":return new a1(e);case"Sig":return new i1(e)}return new Fo(e);case be.POPUP:return new Yb(e);case be.FREETEXT:return new yv(e);case be.LINE:return new l1(e);case be.SQUARE:return new h1(e);case be.CIRCLE:return new c1(e);case be.POLYLINE:return new wv(e);case be.CARET:return new u1(e);case be.INK:return new By(e);case be.POLYGON:return new d1(e);case be.HIGHLIGHT:return new vv(e);case be.UNDERLINE:return new f1(e);case be.SQUIGGLY:return new p1(e);case be.STRIKEOUT:return new g1(e);case be.STAMP:return new Av(e);case be.FILEATTACHMENT:return new m1(e);default:return new le(e)}}}var Qa,oh,Qs,wu,$b;const Gy=class Gy{constructor(e,{isRenderable:t=!1,ignoreBorder:s=!1,createQuadrilaterals:i=!1}={}){m(this,wu);m(this,Qa,null);m(this,oh,!1);m(this,Qs,null);this.isRenderable=t,this.data=e.data,this.layer=e.layer,this.linkService=e.linkService,this.downloadManager=e.downloadManager,this.imageResourcesPath=e.imageResourcesPath,this.renderForms=e.renderForms,this.svgFactory=e.svgFactory,this.annotationStorage=e.annotationStorage,this.enableComment=e.enableComment,this.enableScripting=e.enableScripting,this.hasJSActions=e.hasJSActions,this._fieldObjects=e.fieldObjects,this.parent=e.parent,this.hasOwnCommentButton=!1,t&&(this.contentElement=this.container=this._createContainer(s)),i&&this._createQuadrilaterals()}static _hasPopupData({contentsObj:e,richText:t}){return!!(e!=null&&e.str||t!=null&&t.str)}get _isEditable(){return this.data.isEditable}get hasPopupData(){return Gy._hasPopupData(this.data)||this.enableComment&&!!this.commentText}get commentData(){var s;const{data:e}=this,t=(s=this.annotationStorage)==null?void 0:s.getEditor(e.id);return t?t.getData():e}get hasCommentButton(){return this.enableComment&&this.hasPopupElement}get commentButtonPosition(){var o;const e=(o=this.annotationStorage)==null?void 0:o.getEditor(this.data.id);if(e)return e.commentButtonPositionInPage;const{quadPoints:t,inkLists:s,rect:i}=this.data;let r=-1/0,a=-1/0;if((t==null?void 0:t.length)>=8){for(let l=0;l<t.length;l+=8)t[l+1]>a?(a=t[l+1],r=t[l+2]):t[l+1]===a&&(r=Math.max(r,t[l+2]));return[r,a]}if((s==null?void 0:s.length)>=1){for(const l of s)for(let h=0,c=l.length;h<c;h+=2)l[h+1]>a?(a=l[h+1],r=l[h]):l[h+1]===a&&(r=Math.max(r,l[h]));if(r!==1/0)return[r,a]}return i?[i[2],i[3]]:null}_normalizePoint(e){const{page:{view:t},viewport:{rawDims:{pageWidth:s,pageHeight:i,pageX:r,pageY:a}}}=this.parent;return e[1]=t[3]-e[1]+t[1],e[0]=100*(e[0]-r)/s,e[1]=100*(e[1]-a)/i,e}get commentText(){var t,s,i;const{data:e}=this;return((s=(t=this.annotationStorage.getRawValue(`${kc}${e.id}`))==null?void 0:t.popup)==null?void 0:s.contents)||((i=e.contentsObj)==null?void 0:i.str)||""}set commentText(e){const{data:t}=this,s={deleted:!e,contents:e||""};this.annotationStorage.updateEditor(t.id,{popup:s})||this.annotationStorage.setValue(`${kc}${t.id}`,{id:t.id,annotationType:t.annotationType,page:this.parent.page,popup:s,popupRef:t.popupRef,modificationDate:new Date}),e||this.removePopup()}removePopup(){var e,t;(t=((e=n(this,Qs))==null?void 0:e.popup)||this.popup)==null||t.remove(),w(this,Qs,this.popup=null)}updateEdited(e){var r;if(!this.container)return;e.rect&&(n(this,Qa)||w(this,Qa,{rect:this.data.rect.slice(0)}));const{rect:t,popup:s}=e;t&&E(this,wu,$b).call(this,t);let i=((r=n(this,Qs))==null?void 0:r.popup)||this.popup;!i&&(s!=null&&s.text)&&(this._createPopup(s),i=n(this,Qs).popup),i&&(i.updateEdited(e),s!=null&&s.deleted&&(i.remove(),w(this,Qs,null),this.popup=null))}resetEdited(){var e;n(this,Qa)&&(E(this,wu,$b).call(this,n(this,Qa).rect),(e=n(this,Qs))==null||e.popup.resetEdited(),w(this,Qa,null))}_createContainer(e){const{data:t,parent:{page:s,viewport:i}}=this,r=document.createElement("section");r.setAttribute("data-annotation-id",t.id),!(this instanceof Fo)&&!(this instanceof Ny)&&(r.tabIndex=0);const{style:a}=r;if(a.zIndex=this.parent.zIndex,this.parent.zIndex+=2,t.alternativeText&&(r.title=t.alternativeText),t.noRotate&&r.classList.add("norotate"),!t.rect||this instanceof Yb){const{rotation:g}=t;return!t.hasOwnCanvas&&g!==0&&this.setRotation(g,r),r}const{width:o,height:l}=this;if(!e&&t.borderStyle.width>0){a.borderWidth=`${t.borderStyle.width}px`;const g=t.borderStyle.horizontalCornerRadius,v=t.borderStyle.verticalCornerRadius;if(g>0||v>0){const A=`calc(${g}px * var(--total-scale-factor)) / calc(${v}px * var(--total-scale-factor))`;a.borderRadius=A}else if(this instanceof fv){const A=`calc(${o}px * var(--total-scale-factor)) / calc(${l}px * var(--total-scale-factor))`;a.borderRadius=A}switch(t.borderStyle.style){case No.SOLID:a.borderStyle="solid";break;case No.DASHED:a.borderStyle="dashed";break;case No.BEVELED:At("Unimplemented border style: beveled");break;case No.INSET:At("Unimplemented border style: inset");break;case No.UNDERLINE:a.borderBottomStyle="solid";break}const b=t.borderColor||null;b?(w(this,oh,!0),a.borderColor=ct.makeHexColor(b[0]|0,b[1]|0,b[2]|0)):a.borderWidth=0}const h=ct.normalizeRect([t.rect[0],s.view[3]-t.rect[1]+s.view[1],t.rect[2],s.view[3]-t.rect[3]+s.view[1]]),{pageWidth:c,pageHeight:d,pageX:u,pageY:f}=i.rawDims;a.left=`${100*(h[0]-u)/c}%`,a.top=`${100*(h[1]-f)/d}%`;const{rotation:y}=t;return t.hasOwnCanvas||y===0?(a.width=`${100*o/c}%`,a.height=`${100*l/d}%`):this.setRotation(y,r),r}setRotation(e,t=this.container){if(!this.data.rect)return;const{pageWidth:s,pageHeight:i}=this.parent.viewport.rawDims;let{width:r,height:a}=this;e%180!==0&&([r,a]=[a,r]),t.style.width=`${100*r/s}%`,t.style.height=`${100*a/i}%`,t.setAttribute("data-main-rotation",(360-e)%360)}get _commonActions(){const e=(t,s,i)=>{const r=i.detail[t],a=r[0],o=r.slice(1);i.target.style[s]=S0[`${a}_HTML`](o),this.annotationStorage.setValue(this.data.id,{[s]:S0[`${a}_rgb`](o)})};return _t(this,"_commonActions",{display:t=>{const{display:s}=t.detail,i=s%2===1;this.container.style.visibility=i?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noView:i,noPrint:s===1||s===2})},print:t=>{this.annotationStorage.setValue(this.data.id,{noPrint:!t.detail.print})},hidden:t=>{const{hidden:s}=t.detail;this.container.style.visibility=s?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noPrint:s,noView:s})},focus:t=>{setTimeout(()=>t.target.focus({preventScroll:!1}),0)},userName:t=>{t.target.title=t.detail.userName},readonly:t=>{t.target.disabled=t.detail.readonly},required:t=>{this._setRequired(t.target,t.detail.required)},bgColor:t=>{e("bgColor","backgroundColor",t)},fillColor:t=>{e("fillColor","backgroundColor",t)},fgColor:t=>{e("fgColor","color",t)},textColor:t=>{e("textColor","color",t)},borderColor:t=>{e("borderColor","borderColor",t)},strokeColor:t=>{e("strokeColor","borderColor",t)},rotation:t=>{const s=t.detail.rotation;this.setRotation(s),this.annotationStorage.setValue(this.data.id,{rotation:s})}})}_dispatchEventFromSandbox(e,t){const s=this._commonActions;for(const i of Object.keys(t.detail)){const r=e[i]||s[i];r==null||r(t)}}_setDefaultPropertiesFromJS(e){if(!this.enableScripting)return;const t=this.annotationStorage.getRawValue(this.data.id);if(!t)return;const s=this._commonActions;for(const[i,r]of Object.entries(t)){const a=s[i];if(a){const o={detail:{[i]:r},target:e};a(o),delete t[i]}}}_createQuadrilaterals(){if(!this.container)return;const{quadPoints:e}=this.data;if(!e)return;const[t,s,i,r]=this.data.rect.map(g=>Math.fround(g));if(e.length===8){const[g,v,b,A]=e.subarray(2,6);if(i===g&&r===v&&t===b&&s===A)return}const{style:a}=this.container;let o;if(n(this,oh)){const{borderColor:g,borderWidth:v}=a;a.borderWidth=0,o=["url('data:image/svg+xml;utf8,",'<svg xmlns="http://www.w3.org/2000/svg"',' preserveAspectRatio="none" viewBox="0 0 1 1">',`<g fill="transparent" stroke="${g}" stroke-width="${v}">`],this.container.classList.add("hasBorder")}const l=i-t,h=r-s,{svgFactory:c}=this,d=c.createElement("svg");d.classList.add("quadrilateralsContainer"),d.setAttribute("width",0),d.setAttribute("height",0),d.role="none";const u=c.createElement("defs");d.append(u);const f=c.createElement("clipPath"),y=`clippath_${this.data.id}`;f.setAttribute("id",y),f.setAttribute("clipPathUnits","objectBoundingBox"),u.append(f);for(let g=2,v=e.length;g<v;g+=8){const b=e[g],A=e[g+1],_=e[g+2],x=e[g+3],k=c.createElement("rect"),T=(_-t)/l,P=(r-A)/h,F=(b-_)/l,R=(A-x)/h;k.setAttribute("x",T),k.setAttribute("y",P),k.setAttribute("width",F),k.setAttribute("height",R),f.append(k),o==null||o.push(`<rect vector-effect="non-scaling-stroke" x="${T}" y="${P}" width="${F}" height="${R}"/>`)}n(this,oh)&&(o.push("</g></svg>')"),a.backgroundImage=o.join("")),this.container.append(d),this.container.style.clipPath=`url(#${y})`}_createPopup(e=null){const{data:t}=this;let s,i;e?(s={str:e.text},i=e.date):(s=t.contentsObj,i=t.modificationDate),w(this,Qs,new Yb({data:{color:t.color,titleObj:t.titleObj,modificationDate:i,contentsObj:s,richText:t.richText,parentRect:t.rect,borderStyle:0,id:`popup_${t.id}`,rotation:t.rotation,noRotate:!0},linkService:this.linkService,parent:this.parent,elements:[this]}))}get hasPopupElement(){return!!(n(this,Qs)||this.popup||this.data.popupRef)}get extraPopupElement(){return n(this,Qs)}render(){zt("Abstract method `AnnotationElement.render` called")}_getElementsByName(e,t=null){const s=[];if(this._fieldObjects){const i=this._fieldObjects[e];if(i)for(const{page:r,id:a,exportValues:o}of i){if(r===-1||a===t)continue;const l=typeof o=="string"?o:null,h=document.querySelector(`[data-element-id="${a}"]`);if(h&&!Ro.has(h)){At(`_getElementsByName - element not allowed: ${a}`);continue}s.push({id:a,exportValue:l,domElement:h})}return s}for(const i of document.getElementsByName(e)){const{exportValue:r}=i,a=i.getAttribute("data-element-id");a!==t&&Ro.has(i)&&s.push({id:a,exportValue:r,domElement:i})}return s}show(){var e;this.container&&(this.container.hidden=!1),(e=this.popup)==null||e.maybeShow()}hide(){var e;this.container&&(this.container.hidden=!0),(e=this.popup)==null||e.forceHide()}getElementsToTriggerPopup(){return this.container}addHighlightArea(){const e=this.getElementsToTriggerPopup();if(Array.isArray(e))for(const t of e)t.classList.add("highlightArea");else e.classList.add("highlightArea")}_editOnDoubleClick(){if(!this._isEditable)return;const{annotationEditorType:e,data:{id:t}}=this;this.container.addEventListener("dblclick",()=>{var s;(s=this.linkService.eventBus)==null||s.dispatch("switchannotationeditormode",{source:this,mode:e,editId:t,mustEnterInEditMode:!0})})}get width(){return this.data.rect[2]-this.data.rect[0]}get height(){return this.data.rect[3]-this.data.rect[1]}};Qa=new WeakMap,oh=new WeakMap,Qs=new WeakMap,wu=new WeakSet,$b=function(e){const{container:{style:t},data:{rect:s,rotation:i},parent:{viewport:{rawDims:{pageWidth:r,pageHeight:a,pageX:o,pageY:l}}}}=this;s==null||s.splice(0,4,...e),t.left=`${100*(e[0]-o)/r}%`,t.top=`${100*(a-e[3]+l)/a}%`,i===0?(t.width=`${100*(e[2]-e[0])/r}%`,t.height=`${100*(e[3]-e[1])/a}%`):this.setRotation(i)};let le=Gy;class t1 extends le{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.editor=e.editor}render(){return this.container.className="editorAnnotation",this.container}createOrUpdatePopup(){const{editor:e}=this;e.hasComment&&this._createPopup(e.comment)}get hasCommentButton(){return this.enableComment&&this.editor.hasComment}get commentButtonPosition(){return this.editor.commentButtonPositionInPage}get commentText(){return this.editor.comment.text}set commentText(e){this.editor.comment=e,e||this.removePopup()}get commentData(){return this.editor.getData()}remove(){this.parent.removeAnnotation(this.data.id),this.container.remove(),this.container=null,this.removePopup()}}var Dn,Kr,Ug,dv,Hg,uv;class Ny extends le{constructor(t,s=null){super(t,{isRenderable:!0,ignoreBorder:!!(s!=null&&s.ignoreBorder),createQuadrilaterals:!0});m(this,Dn);m(this,Ug);m(this,Hg);this.isTooltipOnly=t.data.isTooltipOnly}render(){const{data:t,linkService:s}=this,i=document.createElement("a");i.setAttribute("data-element-id",t.id);let r=!1;return t.url?(s.addLinkAttributes(i,t.url,t.newWindow),r=!0):t.action?(this._bindNamedAction(i,t.action,t.overlaidText),r=!0):t.attachment?(E(this,Ug,dv).call(this,i,t.attachment,t.overlaidText,t.attachmentDest),r=!0):t.setOCGState?(E(this,Hg,uv).call(this,i,t.setOCGState,t.overlaidText),r=!0):t.dest?(this._bindLink(i,t.dest,t.overlaidText),r=!0):(t.actions&&(t.actions.Action||t.actions["Mouse Up"]||t.actions["Mouse Down"])&&this.enableScripting&&this.hasJSActions&&(this._bindJSAction(i,t),r=!0),t.resetForm?(this._bindResetFormAction(i,t.resetForm),r=!0):this.isTooltipOnly&&!r&&(this._bindLink(i,""),r=!0)),this.container.classList.add("linkAnnotation"),r&&(this.contentElement=i,this.container.append(i)),this.container}_bindLink(t,s,i=""){t.href=this.linkService.getDestinationHash(s),t.onclick=()=>(s&&this.linkService.goToDestination(s),!1),(s||s==="")&&E(this,Dn,Kr).call(this),i&&(t.title=i)}_bindNamedAction(t,s,i=""){t.href=this.linkService.getAnchorUrl(""),t.onclick=()=>(this.linkService.executeNamedAction(s),!1),i&&(t.title=i),E(this,Dn,Kr).call(this)}_bindJSAction(t,s){t.href=this.linkService.getAnchorUrl("");const i=new Map([["Action","onclick"],["Mouse Up","onmouseup"],["Mouse Down","onmousedown"]]);for(const r of Object.keys(s.actions)){const a=i.get(r);a&&(t[a]=()=>{var o;return(o=this.linkService.eventBus)==null||o.dispatch("dispatcheventinsandbox",{source:this,detail:{id:s.id,name:r}}),!1})}s.overlaidText&&(t.title=s.overlaidText),t.onclick||(t.onclick=()=>!1),E(this,Dn,Kr).call(this)}_bindResetFormAction(t,s){const i=t.onclick;if(i||(t.href=this.linkService.getAnchorUrl("")),E(this,Dn,Kr).call(this),!this._fieldObjects){At('_bindResetFormAction - "resetForm" action not supported, ensure that the `fieldObjects` parameter is provided.'),i||(t.onclick=()=>!1);return}t.onclick=()=>{var d;i==null||i();const{fields:r,refs:a,include:o}=s,l=[];if(r.length!==0||a.length!==0){const u=new Set(a);for(const f of r){const y=this._fieldObjects[f]||[];for(const{id:g}of y)u.add(g)}for(const f of Object.values(this._fieldObjects))for(const y of f)u.has(y.id)===o&&l.push(y)}else for(const u of Object.values(this._fieldObjects))l.push(...u);const h=this.annotationStorage,c=[];for(const u of l){const{id:f}=u;switch(c.push(f),u.type){case"text":{const g=u.defaultValue||"";h.setValue(f,{value:g});break}case"checkbox":case"radiobutton":{const g=u.defaultValue===u.exportValues;h.setValue(f,{value:g});break}case"combobox":case"listbox":{const g=u.defaultValue||"";h.setValue(f,{value:g});break}default:continue}const y=document.querySelector(`[data-element-id="${f}"]`);if(y){if(!Ro.has(y)){At(`_bindResetFormAction - element not allowed: ${f}`);continue}}else continue;y.dispatchEvent(new Event("resetform"))}return this.enableScripting&&((d=this.linkService.eventBus)==null||d.dispatch("dispatcheventinsandbox",{source:this,detail:{id:"app",ids:c,name:"ResetForm"}})),!1}}}Dn=new WeakSet,Kr=function(){this.container.setAttribute("data-internal-link","")},Ug=new WeakSet,dv=function(t,s,i="",r=null){t.href=this.linkService.getAnchorUrl(""),s.description?t.title=s.description:i&&(t.title=i),t.onclick=()=>{var a;return(a=this.downloadManager)==null||a.openOrDownloadData(s.content,s.filename,r),!1},E(this,Dn,Kr).call(this)},Hg=new WeakSet,uv=function(t,s,i=""){t.href=this.linkService.getAnchorUrl(""),t.onclick=()=>(this.linkService.executeSetOCGState(s),!1),i&&(t.title=i),E(this,Dn,Kr).call(this)};class e1 extends le{constructor(e){super(e,{isRenderable:!0})}render(){this.container.classList.add("textAnnotation");const e=document.createElement("img");return e.src=this.imageResourcesPath+"annotation-"+this.data.name.toLowerCase()+".svg",e.setAttribute("data-l10n-id","pdfjs-text-annotation-type"),e.setAttribute("data-l10n-args",JSON.stringify({type:this.data.name})),!this.data.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container.append(e),this.container}}class Fo extends le{render(){return this.container}showElementAndHideCanvas(e){var t;this.data.hasOwnCanvas&&(((t=e.previousSibling)==null?void 0:t.nodeName)==="CANVAS"&&(e.previousSibling.hidden=!0),e.hidden=!1)}_getKeyModifier(e){return Te.platform.isMac?e.metaKey:e.ctrlKey}_setEventListener(e,t,s,i,r){s.includes("mouse")?e.addEventListener(s,a=>{var o;(o=this.linkService.eventBus)==null||o.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:i,value:r(a),shift:a.shiftKey,modifier:this._getKeyModifier(a)}})}):e.addEventListener(s,a=>{var o;if(s==="blur"){if(!t.focused||!a.relatedTarget)return;t.focused=!1}else if(s==="focus"){if(t.focused)return;t.focused=!0}r&&((o=this.linkService.eventBus)==null||o.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:i,value:r(a)}}))})}_setEventListeners(e,t,s,i){var r,a,o;for(const[l,h]of s)(h==="Action"||(r=this.data.actions)!=null&&r[h])&&((h==="Focus"||h==="Blur")&&(t||(t={focused:!1})),this._setEventListener(e,t,l,h,i),h==="Focus"&&!((a=this.data.actions)!=null&&a.Blur)?this._setEventListener(e,t,"blur","Blur",null):h==="Blur"&&!((o=this.data.actions)!=null&&o.Focus)&&this._setEventListener(e,t,"focus","Focus",null))}_setBackgroundColor(e){const t=this.data.backgroundColor||null;e.style.backgroundColor=t===null?"transparent":ct.makeHexColor(t[0],t[1],t[2])}_setTextStyle(e){const t=["left","center","right"],{fontColor:s}=this.data.defaultAppearanceData,i=this.data.defaultAppearanceData.fontSize||J_,r=e.style;let a;const o=2,l=h=>Math.round(10*h)/10;if(this.data.multiLine){const h=Math.abs(this.data.rect[3]-this.data.rect[1]-o),c=Math.round(h/($m*i))||1,d=h/c;a=Math.min(i,l(d/$m))}else{const h=Math.abs(this.data.rect[3]-this.data.rect[1]-o);a=Math.min(i,l(h/$m))}r.fontSize=`calc(${a}px * var(--total-scale-factor))`,r.color=ct.makeHexColor(s[0],s[1],s[2]),this.data.textAlignment!==null&&(r.textAlign=t[this.data.textAlignment])}_setRequired(e,t){t?e.setAttribute("required",!0):e.removeAttribute("required"),e.setAttribute("aria-required",t)}}class s1 extends Fo{constructor(e){const t=e.renderForms||e.data.hasOwnCanvas||!e.data.hasAppearance&&!!e.data.fieldValue;super(e,{isRenderable:t})}setPropertyOnSiblings(e,t,s,i){const r=this.annotationStorage;for(const a of this._getElementsByName(e.name,e.id))a.domElement&&(a.domElement[t]=s),r.setValue(a.id,{[i]:s})}render(){var i,r;const e=this.annotationStorage,t=this.data.id;this.container.classList.add("textWidgetAnnotation");let s=null;if(this.renderForms){const a=e.getValue(t,{value:this.data.fieldValue});let o=a.value||"";const l=e.getValue(t,{charLimit:this.data.maxLen}).charLimit;l&&o.length>l&&(o=o.slice(0,l));let h=a.formattedValue||((i=this.data.textContent)==null?void 0:i.join(`
`))||null;h&&this.data.comb&&(h=h.replaceAll(/\s+/g,""));const c={userValue:o,formattedValue:h,lastCommittedValue:null,commitKey:1,focused:!1};this.data.multiLine?(s=document.createElement("textarea"),s.textContent=h??o,this.data.doNotScroll&&(s.style.overflowY="hidden")):(s=document.createElement("input"),s.type=this.data.password?"password":"text",s.setAttribute("value",h??o),this.data.doNotScroll&&(s.style.overflowX="hidden")),this.data.hasOwnCanvas&&(s.hidden=!0),Ro.add(s),this.contentElement=s,s.setAttribute("data-element-id",t),s.disabled=this.data.readOnly,s.name=this.data.fieldName,s.tabIndex=0;const{datetimeFormat:d,datetimeType:u,timeStep:f}=this.data,y=!!u&&this.enableScripting;d&&(s.title=d),this._setRequired(s,this.data.required),l&&(s.maxLength=l),s.addEventListener("input",v=>{e.setValue(t,{value:v.target.value}),this.setPropertyOnSiblings(s,"value",v.target.value,"value"),c.formattedValue=null}),s.addEventListener("resetform",v=>{const b=this.data.defaultFieldValue??"";s.value=c.userValue=b,c.formattedValue=null});let g=v=>{const{formattedValue:b}=c;b!=null&&(v.target.value=b),v.target.scrollLeft=0};if(this.enableScripting&&this.hasJSActions){s.addEventListener("focus",b=>{var _;if(c.focused)return;const{target:A}=b;if(y&&(A.type=u,f&&(A.step=f)),c.userValue){const x=c.userValue;if(y)if(u==="time"){const k=new Date(x),T=[k.getHours(),k.getMinutes(),k.getSeconds()];A.value=T.map(P=>P.toString().padStart(2,"0")).join(":")}else A.value=new Date(x-Q_).toISOString().split(u==="date"?"T":".",1)[0];else A.value=x}c.lastCommittedValue=A.value,c.commitKey=1,(_=this.data.actions)!=null&&_.Focus||(c.focused=!0)}),s.addEventListener("updatefromsandbox",b=>{this.showElementAndHideCanvas(b.target);const A={value(_){c.userValue=_.detail.value??"",y||e.setValue(t,{value:c.userValue.toString()}),_.target.value=c.userValue},formattedValue(_){const{formattedValue:x}=_.detail;c.formattedValue=x,x!=null&&_.target!==document.activeElement&&(_.target.value=x);const k={formattedValue:x};y&&(k.value=x),e.setValue(t,k)},selRange(_){_.target.setSelectionRange(..._.detail.selRange)},charLimit:_=>{var P;const{charLimit:x}=_.detail,{target:k}=_;if(x===0){k.removeAttribute("maxLength");return}k.setAttribute("maxLength",x);let T=c.userValue;!T||T.length<=x||(T=T.slice(0,x),k.value=c.userValue=T,e.setValue(t,{value:T}),(P=this.linkService.eventBus)==null||P.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:T,willCommit:!0,commitKey:1,selStart:k.selectionStart,selEnd:k.selectionEnd}}))}};this._dispatchEventFromSandbox(A,b)}),s.addEventListener("keydown",b=>{var x;c.commitKey=1;let A=-1;if(b.key==="Escape"?A=0:b.key==="Enter"&&!this.data.multiLine?A=2:b.key==="Tab"&&(c.commitKey=3),A===-1)return;const{value:_}=b.target;c.lastCommittedValue!==_&&(c.lastCommittedValue=_,c.userValue=_,(x=this.linkService.eventBus)==null||x.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:_,willCommit:!0,commitKey:A,selStart:b.target.selectionStart,selEnd:b.target.selectionEnd}}))});const v=g;g=null,s.addEventListener("blur",b=>{var x,k;if(!c.focused||!b.relatedTarget)return;(x=this.data.actions)!=null&&x.Blur||(c.focused=!1);const{target:A}=b;let{value:_}=A;if(y){if(_&&u==="time"){const T=_.split(":").map(P=>parseInt(P,10));_=new Date(2e3,0,1,T[0],T[1],T[2]||0).valueOf(),A.step=""}else _.includes("T")||(_=`${_}T00:00`),_=new Date(_).valueOf();A.type="text"}c.userValue=_,c.lastCommittedValue!==_&&((k=this.linkService.eventBus)==null||k.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:_,willCommit:!0,commitKey:c.commitKey,selStart:b.target.selectionStart,selEnd:b.target.selectionEnd}})),v(b)}),(r=this.data.actions)!=null&&r.Keystroke&&s.addEventListener("beforeinput",b=>{var R;c.lastCommittedValue=null;const{data:A,target:_}=b,{value:x,selectionStart:k,selectionEnd:T}=_;let P=k,F=T;switch(b.inputType){case"deleteWordBackward":{const B=x.substring(0,k).match(/\w*[^\w]*$/);B&&(P-=B[0].length);break}case"deleteWordForward":{const B=x.substring(k).match(/^[^\w]*\w*/);B&&(F+=B[0].length);break}case"deleteContentBackward":k===T&&(P-=1);break;case"deleteContentForward":k===T&&(F+=1);break}b.preventDefault(),(R=this.linkService.eventBus)==null||R.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:x,change:A||"",willCommit:!1,selStart:P,selEnd:F}})}),this._setEventListeners(s,c,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],b=>b.target.value)}if(g&&s.addEventListener("blur",g),this.data.comb){const b=(this.data.rect[2]-this.data.rect[0])/l;s.classList.add("comb"),s.style.letterSpacing=`calc(${b}px * var(--total-scale-factor) - 1ch)`}}else s=document.createElement("div"),s.textContent=this.data.fieldValue,s.style.verticalAlign="middle",s.style.display="table-cell",this.data.hasOwnCanvas&&(s.hidden=!0);return this._setTextStyle(s),this._setBackgroundColor(s),this._setDefaultPropertiesFromJS(s),this.container.append(s),this.container}}class i1 extends Fo{constructor(e){super(e,{isRenderable:!!e.data.hasOwnCanvas})}}class n1 extends Fo{constructor(e){super(e,{isRenderable:e.renderForms})}render(){const e=this.annotationStorage,t=this.data,s=t.id;let i=e.getValue(s,{value:t.exportValue===t.fieldValue}).value;typeof i=="string"&&(i=i!=="Off",e.setValue(s,{value:i})),this.container.classList.add("buttonWidgetAnnotation","checkBox");const r=document.createElement("input");return Ro.add(r),r.setAttribute("data-element-id",s),r.disabled=t.readOnly,this._setRequired(r,this.data.required),r.type="checkbox",r.name=t.fieldName,i&&r.setAttribute("checked",!0),r.setAttribute("exportValue",t.exportValue),r.tabIndex=0,r.addEventListener("change",a=>{const{name:o,checked:l}=a.target;for(const h of this._getElementsByName(o,s)){const c=l&&h.exportValue===t.exportValue;h.domElement&&(h.domElement.checked=c),e.setValue(h.id,{value:c})}e.setValue(s,{value:l})}),r.addEventListener("resetform",a=>{const o=t.defaultFieldValue||"Off";a.target.checked=o===t.exportValue}),this.enableScripting&&this.hasJSActions&&(r.addEventListener("updatefromsandbox",a=>{const o={value(l){l.target.checked=l.detail.value!=="Off",e.setValue(s,{value:l.target.checked})}};this._dispatchEventFromSandbox(o,a)}),this._setEventListeners(r,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],a=>a.target.checked)),this._setBackgroundColor(r),this._setDefaultPropertiesFromJS(r),this.container.append(r),this.container}}class fv extends Fo{constructor(e){super(e,{isRenderable:e.renderForms})}render(){this.container.classList.add("buttonWidgetAnnotation","radioButton");const e=this.annotationStorage,t=this.data,s=t.id;let i=e.getValue(s,{value:t.fieldValue===t.buttonValue}).value;if(typeof i=="string"&&(i=i!==t.buttonValue,e.setValue(s,{value:i})),i)for(const a of this._getElementsByName(t.fieldName,s))e.setValue(a.id,{value:!1});const r=document.createElement("input");if(Ro.add(r),r.setAttribute("data-element-id",s),r.disabled=t.readOnly,this._setRequired(r,this.data.required),r.type="radio",r.name=t.fieldName,i&&r.setAttribute("checked",!0),r.tabIndex=0,r.addEventListener("change",a=>{const{name:o,checked:l}=a.target;for(const h of this._getElementsByName(o,s))e.setValue(h.id,{value:!1});e.setValue(s,{value:l})}),r.addEventListener("resetform",a=>{const o=t.defaultFieldValue;a.target.checked=o!=null&&o===t.buttonValue}),this.enableScripting&&this.hasJSActions){const a=t.buttonValue;r.addEventListener("updatefromsandbox",o=>{const l={value:h=>{const c=a===h.detail.value;for(const d of this._getElementsByName(h.target.name)){const u=c&&d.id===s;d.domElement&&(d.domElement.checked=u),e.setValue(d.id,{value:u})}}};this._dispatchEventFromSandbox(l,o)}),this._setEventListeners(r,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],o=>o.target.checked)}return this._setBackgroundColor(r),this._setDefaultPropertiesFromJS(r),this.container.append(r),this.container}}class r1 extends Ny{constructor(e){super(e,{ignoreBorder:e.data.hasAppearance})}render(){const e=super.render();e.classList.add("buttonWidgetAnnotation","pushButton");const t=e.lastChild;return this.enableScripting&&this.hasJSActions&&t&&(this._setDefaultPropertiesFromJS(t),t.addEventListener("updatefromsandbox",s=>{this._dispatchEventFromSandbox({},s)})),e}}class a1 extends Fo{constructor(e){super(e,{isRenderable:e.renderForms})}render(){this.container.classList.add("choiceWidgetAnnotation");const e=this.annotationStorage,t=this.data.id,s=e.getValue(t,{value:this.data.fieldValue}),i=document.createElement("select");Ro.add(i),i.setAttribute("data-element-id",t),i.disabled=this.data.readOnly,this._setRequired(i,this.data.required),i.name=this.data.fieldName,i.tabIndex=0;let r=this.data.combo&&this.data.options.length>0;this.data.combo||(i.size=this.data.options.length,this.data.multiSelect&&(i.multiple=!0)),i.addEventListener("resetform",c=>{const d=this.data.defaultFieldValue;for(const u of i.options)u.selected=u.value===d});for(const c of this.data.options){const d=document.createElement("option");d.textContent=c.displayValue,d.value=c.exportValue,s.value.includes(c.exportValue)&&(d.setAttribute("selected",!0),r=!1),i.append(d)}let a=null;if(r){const c=document.createElement("option");c.value=" ",c.setAttribute("hidden",!0),c.setAttribute("selected",!0),i.prepend(c),a=()=>{c.remove(),i.removeEventListener("input",a),a=null},i.addEventListener("input",a)}const o=c=>{const d=c?"value":"textContent",{options:u,multiple:f}=i;return f?Array.prototype.filter.call(u,y=>y.selected).map(y=>y[d]):u.selectedIndex===-1?null:u[u.selectedIndex][d]};let l=o(!1);const h=c=>{const d=c.target.options;return Array.prototype.map.call(d,u=>({displayValue:u.textContent,exportValue:u.value}))};return this.enableScripting&&this.hasJSActions?(i.addEventListener("updatefromsandbox",c=>{const d={value(u){a==null||a();const f=u.detail.value,y=new Set(Array.isArray(f)?f:[f]);for(const g of i.options)g.selected=y.has(g.value);e.setValue(t,{value:o(!0)}),l=o(!1)},multipleSelection(u){i.multiple=!0},remove(u){const f=i.options,y=u.detail.remove;f[y].selected=!1,i.remove(y),f.length>0&&Array.prototype.findIndex.call(f,v=>v.selected)===-1&&(f[0].selected=!0),e.setValue(t,{value:o(!0),items:h(u)}),l=o(!1)},clear(u){for(;i.length!==0;)i.remove(0);e.setValue(t,{value:null,items:[]}),l=o(!1)},insert(u){const{index:f,displayValue:y,exportValue:g}=u.detail.insert,v=i.children[f],b=document.createElement("option");b.textContent=y,b.value=g,v?v.before(b):i.append(b),e.setValue(t,{value:o(!0),items:h(u)}),l=o(!1)},items(u){const{items:f}=u.detail;for(;i.length!==0;)i.remove(0);for(const y of f){const{displayValue:g,exportValue:v}=y,b=document.createElement("option");b.textContent=g,b.value=v,i.append(b)}i.options.length>0&&(i.options[0].selected=!0),e.setValue(t,{value:o(!0),items:h(u)}),l=o(!1)},indices(u){const f=new Set(u.detail.indices);for(const y of u.target.options)y.selected=f.has(y.index);e.setValue(t,{value:o(!0)}),l=o(!1)},editable(u){u.target.disabled=!u.detail.editable}};this._dispatchEventFromSandbox(d,c)}),i.addEventListener("input",c=>{var f;const d=o(!0),u=o(!1);e.setValue(t,{value:d}),c.preventDefault(),(f=this.linkService.eventBus)==null||f.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:l,change:u,changeEx:d,willCommit:!1,commitKey:1,keyDown:!1}})}),this._setEventListeners(i,null,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"],["input","Action"],["input","Validate"]],c=>c.target.value)):i.addEventListener("input",function(c){e.setValue(t,{value:o(!0)})}),this.data.combo&&this._setTextStyle(i),this._setBackgroundColor(i),this._setDefaultPropertiesFromJS(i),this.container.append(i),this.container}}var vu,qb;class Yb extends le{constructor(t){const{data:s,elements:i,parent:r}=t,a=!!r._commentManager;super(t,{isRenderable:!a&&le._hasPopupData(s)});m(this,vu);if(this.elements=i,a&&le._hasPopupData(s)){const o=this.popup=E(this,vu,qb).call(this);for(const l of i)l.popup=o}else this.popup=null}render(){const{container:t}=this;t.classList.add("popupAnnotation"),t.role="comment";const s=this.popup=E(this,vu,qb).call(this),i=[];for(const r of this.elements)r.popup=s,r.container.ariaHasPopup="dialog",i.push(r.data.id),r.addHighlightArea();return this.container.setAttribute("aria-controls",i.map(r=>`${Go}${r}`).join(",")),this.container}}vu=new WeakSet,qb=function(){return new o1({container:this.container,color:this.data.color,titleObj:this.data.titleObj,modificationDate:this.data.modificationDate||this.data.creationDate,contentsObj:this.data.contentsObj,richText:this.data.richText,rect:this.data.rect,parentRect:this.data.parentRect||null,parent:this.parent,elements:this.elements,open:this.data.open,commentManager:this.parent._commentManager})};var xs,kr,jg,Vg,lh,hh,ce,Ui,Tr,to,ch,dh,Hi,ks,In,Mn,de,Rn,Pr,Au,Ln,uh,eo,Dr,Ie,Ir,fh,Jf,_u,Kb,Su,Zb,Eu,Jb,ph,Qf,Cu,Qb,Wg,pv,Gg,gv,Xg,mv,$g,bv,gh,tp,mh,ep,xu,ty;class o1{constructor({container:e,color:t,elements:s,titleObj:i,modificationDate:r,contentsObj:a,richText:o,parent:l,rect:h,parentRect:c,open:d,commentManager:u=null}){m(this,fh);m(this,_u);m(this,Su);m(this,Eu);m(this,ph);m(this,Cu);m(this,Wg);m(this,Gg);m(this,Xg);m(this,$g);m(this,gh);m(this,mh);m(this,xu);m(this,xs,null);m(this,kr,E(this,Xg,mv).bind(this));m(this,jg,E(this,xu,ty).bind(this));m(this,Vg,E(this,mh,ep).bind(this));m(this,lh,E(this,gh,tp).bind(this));m(this,hh,null);m(this,ce,null);m(this,Ui,null);m(this,Tr,null);m(this,to,null);m(this,ch,null);m(this,dh,null);m(this,Hi,!1);m(this,ks,null);m(this,In,null);m(this,Mn,null);m(this,de,null);m(this,Rn,null);m(this,Pr,null);m(this,Au,null);m(this,Ln,null);m(this,uh,null);m(this,eo,null);m(this,Dr,!1);m(this,Ie,null);m(this,Ir,null);w(this,ce,e),w(this,uh,i),w(this,Ui,a),w(this,Ln,o),w(this,ch,l),w(this,hh,t),w(this,Au,h),w(this,dh,c),w(this,to,s),w(this,xs,u),w(this,Ie,s[0]),w(this,Tr,vp.toDateObject(r)),this.trigger=s.flatMap(f=>f.getElementsToTriggerPopup()),u||(E(this,fh,Jf).call(this),n(this,ce).hidden=!0,d&&E(this,gh,tp).call(this))}renderCommentButton(){if(n(this,de)){n(this,de).parentNode||n(this,Ie).container.after(n(this,de));return}if(n(this,Rn)||E(this,_u,Kb).call(this),!n(this,Rn))return;const{signal:e}=w(this,In,new AbortController),t=n(this,Ie).hasOwnCommentButton,s=()=>{n(this,xs).toggleCommentPopup(this,!0,void 0,!t)},i=()=>{n(this,xs).toggleCommentPopup(this,!1,!0,!t)},r=()=>{n(this,xs).toggleCommentPopup(this,!1,!1)};if(t){w(this,de,n(this,Ie).container);for(const a of this.trigger)a.ariaHasPopup="dialog",a.ariaControls="commentPopup",a.addEventListener("keydown",n(this,kr),{signal:e}),a.addEventListener("click",s,{signal:e}),a.addEventListener("pointerenter",i,{signal:e}),a.addEventListener("pointerleave",r,{signal:e}),a.classList.add("popupTriggerArea")}else{const a=w(this,de,document.createElement("button"));a.className="annotationCommentButton";const o=n(this,Ie).container;a.style.zIndex=o.style.zIndex+1,a.tabIndex=0,a.ariaHasPopup="dialog",a.ariaControls="commentPopup",a.setAttribute("data-l10n-id","pdfjs-show-comment-button"),E(this,Eu,Jb).call(this),E(this,Su,Zb).call(this),a.addEventListener("keydown",n(this,kr),{signal:e}),a.addEventListener("click",s,{signal:e}),a.addEventListener("pointerenter",i,{signal:e}),a.addEventListener("pointerleave",r,{signal:e}),o.after(a)}}get commentButtonColor(){const{color:e,opacity:t}=n(this,Ie).commentData;return e?n(this,ch)._commentManager.makeCommentColor(e,t):null}focusCommentButton(){setTimeout(()=>{var e;(e=n(this,de))==null||e.focus()},0)}getData(){const{richText:e,color:t,opacity:s,creationDate:i,modificationDate:r}=n(this,Ie).commentData;return{contentsObj:{str:this.comment},richText:e,color:t,opacity:s,creationDate:i,modificationDate:r}}get elementBeforePopup(){return n(this,de)}get comment(){return n(this,Ir)||w(this,Ir,n(this,Ie).commentText),n(this,Ir)}set comment(e){e!==this.comment&&(n(this,Ie).commentText=w(this,Ir,e))}focus(){var e;(e=n(this,Ie).container)==null||e.focus()}get parentBoundingClientRect(){return n(this,Ie).layer.getBoundingClientRect()}setCommentButtonStates({selected:e,hasPopup:t}){n(this,de)&&(n(this,de).classList.toggle("selected",e),n(this,de).ariaExpanded=t)}setSelectedCommentButton(e){n(this,de).classList.toggle("selected",e)}get commentPopupPosition(){if(n(this,Pr))return n(this,Pr);const{x:e,y:t,height:s}=n(this,de).getBoundingClientRect(),{x:i,y:r,width:a,height:o}=n(this,Ie).layer.getBoundingClientRect();return[(e-i)/a,(t+s-r)/o]}set commentPopupPosition(e){w(this,Pr,e)}hasDefaultPopupPosition(){return n(this,Pr)===null}get commentButtonPosition(){return n(this,Rn)}get commentButtonWidth(){return n(this,de).getBoundingClientRect().width/this.parentBoundingClientRect.width}editComment(e){const[t,s]=n(this,Pr)||this.commentButtonPosition.map(h=>h/100),i=this.parentBoundingClientRect,{x:r,y:a,width:o,height:l}=i;n(this,xs).showDialog(null,this,r+t*o,a+s*l,{...e,parentDimensions:i})}render(){var s,i;if(n(this,ks))return;const e=w(this,ks,document.createElement("div"));if(e.className="popup",n(this,hh)){const r=e.style.outlineColor=ct.makeHexColor(...n(this,hh));e.style.backgroundColor=`color-mix(in srgb, ${r} 30%, white)`}const t=document.createElement("span");if(t.className="header",(s=n(this,uh))!=null&&s.str){const r=document.createElement("span");r.className="title",t.append(r),{dir:r.dir,str:r.textContent}=n(this,uh)}if(e.append(t),n(this,Tr)){const r=document.createElement("time");r.className="popupDate",r.setAttribute("data-l10n-id","pdfjs-annotation-date-time-string"),r.setAttribute("data-l10n-args",JSON.stringify({dateObj:n(this,Tr).valueOf()})),r.dateTime=n(this,Tr).toISOString(),t.append(r)}V0({html:n(this,ph,Qf)||n(this,Ui).str,dir:(i=n(this,Ui))==null?void 0:i.dir,className:"popupContent"},e),n(this,ce).append(e)}updateEdited({rect:e,popup:t,deleted:s}){var i;if(n(this,xs)){s?(this.remove(),w(this,Ir,null)):t&&(t.deleted?this.remove():(E(this,Eu,Jb).call(this),w(this,Ir,t.text))),e&&(w(this,Rn,null),E(this,_u,Kb).call(this),E(this,Su,Zb).call(this));return}if(s||t!=null&&t.deleted){this.remove();return}E(this,fh,Jf).call(this),n(this,eo)||w(this,eo,{contentsObj:n(this,Ui),richText:n(this,Ln)}),e&&w(this,Mn,null),t&&t.text&&(w(this,Ln,E(this,Gg,gv).call(this,t.text)),w(this,Tr,vp.toDateObject(t.date)),w(this,Ui,null)),(i=n(this,ks))==null||i.remove(),w(this,ks,null)}resetEdited(){var e;n(this,eo)&&({contentsObj:Ae(this,Ui)._,richText:Ae(this,Ln)._}=n(this,eo),w(this,eo,null),(e=n(this,ks))==null||e.remove(),w(this,ks,null),w(this,Mn,null))}remove(){var e,t,s;if((e=n(this,In))==null||e.abort(),w(this,In,null),(t=n(this,ks))==null||t.remove(),w(this,ks,null),w(this,Dr,!1),w(this,Hi,!1),(s=n(this,de))==null||s.remove(),w(this,de,null),this.trigger)for(const i of this.trigger)i.classList.remove("popupTriggerArea")}forceHide(){w(this,Dr,this.isVisible),n(this,Dr)&&(n(this,ce).hidden=!0)}maybeShow(){n(this,xs)||(E(this,fh,Jf).call(this),n(this,Dr)&&(n(this,ks)||E(this,mh,ep).call(this),w(this,Dr,!1),n(this,ce).hidden=!1))}get isVisible(){return n(this,xs)?!1:n(this,ce).hidden===!1}}xs=new WeakMap,kr=new WeakMap,jg=new WeakMap,Vg=new WeakMap,lh=new WeakMap,hh=new WeakMap,ce=new WeakMap,Ui=new WeakMap,Tr=new WeakMap,to=new WeakMap,ch=new WeakMap,dh=new WeakMap,Hi=new WeakMap,ks=new WeakMap,In=new WeakMap,Mn=new WeakMap,de=new WeakMap,Rn=new WeakMap,Pr=new WeakMap,Au=new WeakMap,Ln=new WeakMap,uh=new WeakMap,eo=new WeakMap,Dr=new WeakMap,Ie=new WeakMap,Ir=new WeakMap,fh=new WeakSet,Jf=function(){var t;if(n(this,In))return;w(this,In,new AbortController);const{signal:e}=n(this,In);for(const s of this.trigger)s.addEventListener("click",n(this,lh),{signal:e}),s.addEventListener("pointerenter",n(this,Vg),{signal:e}),s.addEventListener("pointerleave",n(this,jg),{signal:e}),s.classList.add("popupTriggerArea");for(const s of n(this,to))(t=s.container)==null||t.addEventListener("keydown",n(this,kr),{signal:e})},_u=new WeakSet,Kb=function(){const e=n(this,to).find(t=>t.hasCommentButton);e&&w(this,Rn,e._normalizePoint(e.commentButtonPosition))},Su=new WeakSet,Zb=function(){if(n(this,Ie).extraPopupElement&&!n(this,Ie).editor)return;n(this,de)||this.renderCommentButton();const[e,t]=n(this,Rn),{style:s}=n(this,de);s.left=`calc(${e}%)`,s.top=`calc(${t}% - var(--comment-button-dim))`},Eu=new WeakSet,Jb=function(){n(this,Ie).extraPopupElement||(n(this,de)||this.renderCommentButton(),n(this,de).style.backgroundColor=this.commentButtonColor||"")},ph=new WeakSet,Qf=function(){const e=n(this,Ln),t=n(this,Ui);return e!=null&&e.str&&(!(t!=null&&t.str)||t.str===e.str)&&n(this,Ln).html||null},Cu=new WeakSet,Qb=function(){var e,t,s;return((s=(t=(e=n(this,ph,Qf))==null?void 0:e.attributes)==null?void 0:t.style)==null?void 0:s.fontSize)||0},Wg=new WeakSet,pv=function(){var e,t,s;return((s=(t=(e=n(this,ph,Qf))==null?void 0:e.attributes)==null?void 0:t.style)==null?void 0:s.color)||null},Gg=new WeakSet,gv=function(e){const t=[],s={str:e,html:{name:"div",attributes:{dir:"auto"},children:[{name:"p",children:t}]}},i={style:{color:n(this,Wg,pv),fontSize:n(this,Cu,Qb)?`calc(${n(this,Cu,Qb)}px * var(--total-scale-factor))`:""}};for(const r of e.split(`
`))t.push({name:"span",value:r,attributes:i});return s},Xg=new WeakSet,mv=function(e){e.altKey||e.shiftKey||e.ctrlKey||e.metaKey||(e.key==="Enter"||e.key==="Escape"&&n(this,Hi))&&E(this,gh,tp).call(this)},$g=new WeakSet,bv=function(){if(n(this,Mn)!==null)return;const{page:{view:e},viewport:{rawDims:{pageWidth:t,pageHeight:s,pageX:i,pageY:r}}}=n(this,ch);let a=!!n(this,dh),o=a?n(this,dh):n(this,Au);for(const y of n(this,to))if(!o||ct.intersect(y.data.rect,o)!==null){o=y.data.rect,a=!0;break}const l=ct.normalizeRect([o[0],e[3]-o[1]+e[1],o[2],e[3]-o[3]+e[1]]),c=a?o[2]-o[0]+5:0,d=l[0]+c,u=l[1];w(this,Mn,[100*(d-i)/t,100*(u-r)/s]);const{style:f}=n(this,ce);f.left=`${n(this,Mn)[0]}%`,f.top=`${n(this,Mn)[1]}%`},gh=new WeakSet,tp=function(){if(n(this,xs)){n(this,xs).toggleCommentPopup(this,!1);return}w(this,Hi,!n(this,Hi)),n(this,Hi)?(E(this,mh,ep).call(this),n(this,ce).addEventListener("click",n(this,lh)),n(this,ce).addEventListener("keydown",n(this,kr))):(E(this,xu,ty).call(this),n(this,ce).removeEventListener("click",n(this,lh)),n(this,ce).removeEventListener("keydown",n(this,kr)))},mh=new WeakSet,ep=function(){n(this,ks)||this.render(),this.isVisible?n(this,Hi)&&n(this,ce).classList.add("focused"):(E(this,$g,bv).call(this),n(this,ce).hidden=!1,n(this,ce).style.zIndex=parseInt(n(this,ce).style.zIndex)+1e3)},xu=new WeakSet,ty=function(){n(this,ce).classList.remove("focused"),!(n(this,Hi)||!this.isVisible)&&(n(this,ce).hidden=!0,n(this,ce).style.zIndex=parseInt(n(this,ce).style.zIndex)-1e3)};class yv extends le{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.textContent=e.data.textContent,this.textPosition=e.data.textPosition,this.annotationEditorType=Et.FREETEXT}render(){if(this.container.classList.add("freeTextAnnotation"),this.textContent){const e=this.contentElement=document.createElement("div");e.classList.add("annotationTextContent"),e.setAttribute("role","comment");for(const t of this.textContent){const s=document.createElement("span");s.textContent=t,e.append(s)}this.container.append(e)}return!this.data.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this._editOnDoubleClick(),this.container}}var ku;class l1 extends le{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});m(this,ku,null)}render(){this.container.classList.add("lineAnnotation");const{data:t,width:s,height:i}=this,r=this.svgFactory.create(s,i,!0),a=w(this,ku,this.svgFactory.createElement("svg:line"));return a.setAttribute("x1",t.rect[2]-t.lineCoordinates[0]),a.setAttribute("y1",t.rect[3]-t.lineCoordinates[1]),a.setAttribute("x2",t.rect[2]-t.lineCoordinates[2]),a.setAttribute("y2",t.rect[3]-t.lineCoordinates[3]),a.setAttribute("stroke-width",t.borderStyle.width||1),a.setAttribute("stroke","transparent"),a.setAttribute("fill","transparent"),r.append(a),this.container.append(r),!t.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container}getElementsToTriggerPopup(){return n(this,ku)}addHighlightArea(){this.container.classList.add("highlightArea")}}ku=new WeakMap;var Tu;class h1 extends le{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});m(this,Tu,null)}render(){this.container.classList.add("squareAnnotation");const{data:t,width:s,height:i}=this,r=this.svgFactory.create(s,i,!0),a=t.borderStyle.width,o=w(this,Tu,this.svgFactory.createElement("svg:rect"));return o.setAttribute("x",a/2),o.setAttribute("y",a/2),o.setAttribute("width",s-a),o.setAttribute("height",i-a),o.setAttribute("stroke-width",a||1),o.setAttribute("stroke","transparent"),o.setAttribute("fill","transparent"),r.append(o),this.container.append(r),!t.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container}getElementsToTriggerPopup(){return n(this,Tu)}addHighlightArea(){this.container.classList.add("highlightArea")}}Tu=new WeakMap;var Pu;class c1 extends le{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});m(this,Pu,null)}render(){this.container.classList.add("circleAnnotation");const{data:t,width:s,height:i}=this,r=this.svgFactory.create(s,i,!0),a=t.borderStyle.width,o=w(this,Pu,this.svgFactory.createElement("svg:ellipse"));return o.setAttribute("cx",s/2),o.setAttribute("cy",i/2),o.setAttribute("rx",s/2-a/2),o.setAttribute("ry",i/2-a/2),o.setAttribute("stroke-width",a||1),o.setAttribute("stroke","transparent"),o.setAttribute("fill","transparent"),r.append(o),this.container.append(r),!t.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container}getElementsToTriggerPopup(){return n(this,Pu)}addHighlightArea(){this.container.classList.add("highlightArea")}}Pu=new WeakMap;var Du;class wv extends le{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});m(this,Du,null);this.containerClassName="polylineAnnotation",this.svgElementName="svg:polyline"}render(){this.container.classList.add(this.containerClassName);const{data:{rect:t,vertices:s,borderStyle:i,popupRef:r},width:a,height:o}=this;if(!s)return this.container;const l=this.svgFactory.create(a,o,!0);let h=[];for(let d=0,u=s.length;d<u;d+=2){const f=s[d]-t[0],y=t[3]-s[d+1];h.push(`${f},${y}`)}h=h.join(" ");const c=w(this,Du,this.svgFactory.createElement(this.svgElementName));return c.setAttribute("points",h),c.setAttribute("stroke-width",i.width||1),c.setAttribute("stroke","transparent"),c.setAttribute("fill","transparent"),l.append(c),this.container.append(l),!r&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container}getElementsToTriggerPopup(){return n(this,Du)}addHighlightArea(){this.container.classList.add("highlightArea")}}Du=new WeakMap;class d1 extends wv{constructor(e){super(e),this.containerClassName="polygonAnnotation",this.svgElementName="svg:polygon"}}class u1 extends le{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0})}render(){return this.container.classList.add("caretAnnotation"),!this.data.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container}}var Iu,so,Mu,ey;class By extends le{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});m(this,Mu);m(this,Iu,null);m(this,so,[]);this.containerClassName="inkAnnotation",this.svgElementName="svg:polyline",this.annotationEditorType=this.data.it==="InkHighlight"?Et.HIGHLIGHT:Et.INK}render(){this.container.classList.add(this.containerClassName);const{data:{rect:t,rotation:s,inkLists:i,borderStyle:r,popupRef:a}}=this,{transform:o,width:l,height:h}=E(this,Mu,ey).call(this,s,t),c=this.svgFactory.create(l,h,!0),d=w(this,Iu,this.svgFactory.createElement("svg:g"));c.append(d),d.setAttribute("stroke-width",r.width||1),d.setAttribute("stroke-linecap","round"),d.setAttribute("stroke-linejoin","round"),d.setAttribute("stroke-miterlimit",10),d.setAttribute("stroke","transparent"),d.setAttribute("fill","transparent"),d.setAttribute("transform",o);for(let u=0,f=i.length;u<f;u++){const y=this.svgFactory.createElement(this.svgElementName);n(this,so).push(y),y.setAttribute("points",i[u].join(",")),d.append(y)}return!a&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container.append(c),this._editOnDoubleClick(),this.container}updateEdited(t){super.updateEdited(t);const{thickness:s,points:i,rect:r}=t,a=n(this,Iu);if(s>=0&&a.setAttribute("stroke-width",s||1),i)for(let o=0,l=n(this,so).length;o<l;o++)n(this,so)[o].setAttribute("points",i[o].join(","));if(r){const{transform:o,width:l,height:h}=E(this,Mu,ey).call(this,this.data.rotation,r);a.parentElement.setAttribute("viewBox",`0 0 ${l} ${h}`),a.setAttribute("transform",o)}}getElementsToTriggerPopup(){return n(this,so)}addHighlightArea(){this.container.classList.add("highlightArea")}}Iu=new WeakMap,so=new WeakMap,Mu=new WeakSet,ey=function(t,s){switch(t){case 90:return{transform:`rotate(90) translate(${-s[0]},${s[1]}) scale(1,-1)`,width:s[3]-s[1],height:s[2]-s[0]};case 180:return{transform:`rotate(180) translate(${-s[2]},${s[1]}) scale(1,-1)`,width:s[2]-s[0],height:s[3]-s[1]};case 270:return{transform:`rotate(270) translate(${-s[2]},${s[3]}) scale(1,-1)`,width:s[3]-s[1],height:s[2]-s[0]};default:return{transform:`translate(${-s[0]},${s[3]}) scale(1,-1)`,width:s[2]-s[0],height:s[3]-s[1]}}};class vv extends le{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0}),this.annotationEditorType=Et.HIGHLIGHT}render(){const{data:{overlaidText:e,popupRef:t}}=this;if(!t&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container.classList.add("highlightAnnotation"),this._editOnDoubleClick(),e){const s=document.createElement("mark");s.classList.add("overlaidText"),s.textContent=e,this.container.append(s)}return this.container}}class f1 extends le{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){const{data:{overlaidText:e,popupRef:t}}=this;if(!t&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container.classList.add("underlineAnnotation"),e){const s=document.createElement("u");s.classList.add("overlaidText"),s.textContent=e,this.container.append(s)}return this.container}}class p1 extends le{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){const{data:{overlaidText:e,popupRef:t}}=this;if(!t&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container.classList.add("squigglyAnnotation"),e){const s=document.createElement("u");s.classList.add("overlaidText"),s.textContent=e,this.container.append(s)}return this.container}}class g1 extends le{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){const{data:{overlaidText:e,popupRef:t}}=this;if(!t&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container.classList.add("strikeoutAnnotation"),e){const s=document.createElement("s");s.classList.add("overlaidText"),s.textContent=e,this.container.append(s)}return this.container}}class Av extends le{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.annotationEditorType=Et.STAMP}render(){return this.container.classList.add("stampAnnotation"),this.container.setAttribute("role","img"),!this.data.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this._editOnDoubleClick(),this.container}}var Ru,Lu,sy;class m1 extends le{constructor(t){var i;super(t,{isRenderable:!0});m(this,Lu);m(this,Ru,null);const{file:s}=this.data;this.filename=s.filename,this.content=s.content,(i=this.linkService.eventBus)==null||i.dispatch("fileattachmentannotation",{source:this,...s})}render(){this.container.classList.add("fileAttachmentAnnotation");const{container:t,data:s}=this;let i;s.hasAppearance||s.fillAlpha===0?i=document.createElement("div"):(i=document.createElement("img"),i.src=`${this.imageResourcesPath}annotation-${/paperclip/i.test(s.name)?"paperclip":"pushpin"}.svg`,s.fillAlpha&&s.fillAlpha<1&&(i.style=`filter: opacity(${Math.round(s.fillAlpha*100)}%);`)),i.addEventListener("dblclick",E(this,Lu,sy).bind(this)),w(this,Ru,i);const{isMac:r}=Te.platform;return t.addEventListener("keydown",a=>{a.key==="Enter"&&(r?a.metaKey:a.ctrlKey)&&E(this,Lu,sy).call(this)}),!s.popupRef&&this.hasPopupData?(this.hasOwnCommentButton=!0,this._createPopup()):i.classList.add("popupTriggerArea"),t.append(i),t}getElementsToTriggerPopup(){return n(this,Ru)}addHighlightArea(){this.container.classList.add("highlightArea")}}Ru=new WeakMap,Lu=new WeakSet,sy=function(){var t;(t=this.downloadManager)==null||t.openOrDownloadData(this.content,this.filename)};var io,no,bh,Mr,Fu,ro,Ts,Ou,yh,sp,Nu,ny;const Xy=class Xy{constructor({div:e,accessibilityManager:t,annotationCanvasMap:s,annotationEditorUIManager:i,page:r,viewport:a,structTreeLayer:o,commentManager:l,linkService:h,annotationStorage:c}){m(this,yh);m(this,Nu);m(this,io,null);m(this,no,null);m(this,bh,null);m(this,Mr,new Map);m(this,Fu,null);m(this,ro,null);m(this,Ts,[]);m(this,Ou,!1);this.div=e,w(this,io,t),w(this,no,s),w(this,Fu,o||null),w(this,ro,h||null),w(this,bh,c||new Ly),this.page=r,this.viewport=a,this.zIndex=0,this._annotationEditorUIManager=i,this._commentManager=l||null}hasEditableAnnotations(){return n(this,Mr).size>0}async render(e){var o;const{annotations:t}=e,s=this.div;Io(s,this.viewport);const i=new Map,r=[],a={data:null,layer:s,linkService:n(this,ro),downloadManager:e.downloadManager,imageResourcesPath:e.imageResourcesPath||"",renderForms:e.renderForms!==!1,svgFactory:new Tp,annotationStorage:n(this,bh),enableComment:e.enableComment===!0,enableScripting:e.enableScripting===!0,hasJSActions:e.hasJSActions,fieldObjects:e.fieldObjects,parent:this,elements:null};for(const l of t){if(l.noHTML)continue;const h=l.annotationType===be.POPUP;if(h){const u=i.get(l.id);if(!u)continue;if(!this._commentManager){r.push(l);continue}a.elements=u}else if(l.rect[2]===l.rect[0]||l.rect[3]===l.rect[1])continue;a.data=l;const c=tb.create(a);if(!c.isRenderable)continue;if(!h&&(n(this,Ts).push(c),l.popupRef)){const u=i.get(l.popupRef);u?u.push(c):i.set(l.popupRef,[c])}const d=c.render();l.hidden&&(d.style.visibility="hidden"),c._isEditable&&(n(this,Mr).set(c.data.id,c),(o=this._annotationEditorUIManager)==null||o.renderAnnotationElement(c))}await E(this,yh,sp).call(this);for(const l of r){const h=a.elements=i.get(l.id);a.data=l;const c=tb.create(a);if(!c.isRenderable)continue;const d=c.render();c.contentElement.id=`${Go}${l.id}`,l.hidden&&(d.style.visibility="hidden"),h.at(-1).container.after(d)}E(this,Nu,ny).call(this)}async addLinkAnnotations(e){const t={data:null,layer:this.div,linkService:n(this,ro),svgFactory:new Tp,parent:this};for(const s of e){s.borderStyle||(s.borderStyle=Xy._defaultBorderStyle),t.data=s;const i=tb.create(t);i.isRenderable&&(i.render(),i.contentElement.id=`${Go}${s.id}`,n(this,Ts).push(i))}await E(this,yh,sp).call(this)}update({viewport:e}){const t=this.div;this.viewport=e,Io(t,{rotation:e.rotation}),E(this,Nu,ny).call(this),t.hidden=!1}getEditableAnnotations(){return Array.from(n(this,Mr).values())}getEditableAnnotation(e){return n(this,Mr).get(e)}addFakeAnnotation(e){const{div:t}=this,{id:s,rotation:i}=e,r=new t1({data:{id:s,rect:e.getPDFRect(),rotation:i},editor:e,layer:t,parent:this,enableComment:!!this._commentManager,linkService:n(this,ro),annotationStorage:n(this,bh)});return r.render(),r.contentElement.id=`${Go}${s}`,r.createOrUpdatePopup(),n(this,Ts).push(r),r}removeAnnotation(e){var i;const t=n(this,Ts).findIndex(r=>r.data.id===e);if(t<0)return;const[s]=n(this,Ts).splice(t,1);(i=n(this,io))==null||i.removePointerInTextLayer(s.contentElement)}updateFakeAnnotations(e){if(e.length!==0){for(const t of e)t.updateFakeAnnotationElement(this);E(this,yh,sp).call(this)}}togglePointerEvents(e=!1){this.div.classList.toggle("disabled",!e)}static get _defaultBorderStyle(){return _t(this,"_defaultBorderStyle",Object.freeze({width:1,rawWidth:1,style:No.SOLID,dashArray:[3],horizontalCornerRadius:0,verticalCornerRadius:0}))}};io=new WeakMap,no=new WeakMap,bh=new WeakMap,Mr=new WeakMap,Fu=new WeakMap,ro=new WeakMap,Ts=new WeakMap,Ou=new WeakMap,yh=new WeakSet,sp=async function(){var s,i,r;if(n(this,Ts).length===0)return;this.div.replaceChildren();const e=[];if(!n(this,Ou)){w(this,Ou,!0);for(const{contentElement:a,data:{id:o}}of n(this,Ts)){const l=a.id=`${Go}${o}`;e.push((s=n(this,Fu))==null?void 0:s.getAriaAttributes(l).then(h=>{if(h)for(const[c,d]of h)a.setAttribute(c,d)}))}}n(this,Ts).sort(({data:{rect:[a,o,l,h]}},{data:{rect:[c,d,u,f]}})=>{if(a===l&&o===h)return 1;if(c===u&&d===f)return-1;const y=h,g=o,v=(o+h)/2,b=f,A=d,_=(d+f)/2;if(v>=b&&_<=g)return-1;if(_>=y&&v<=A)return 1;const x=(a+l)/2,k=(c+u)/2;return x-k});const t=document.createDocumentFragment();for(const a of n(this,Ts))t.append(a.container),this._commentManager?(r=((i=a.extraPopupElement)==null?void 0:i.popup)||a.popup)==null||r.renderCommentButton():a.extraPopupElement&&t.append(a.extraPopupElement.render());if(this.div.append(t),await Promise.all(e),n(this,io))for(const a of n(this,Ts))n(this,io).addPointerInTextLayer(a.contentElement,!1)},Nu=new WeakSet,ny=function(){var t;if(!n(this,no))return;const e=this.div;for(const[s,i]of n(this,no)){const r=e.querySelector(`[data-annotation-id="${s}"]`);if(!r)continue;i.className="annotationContent";const{firstChild:a}=r;a?a.nodeName==="CANVAS"?a.replaceWith(i):a.classList.contains("annotationContent")?a.after(i):a.before(i):r.append(i);const o=n(this,Mr).get(s);o&&(o._hasNoCanvas?((t=this._annotationEditorUIManager)==null||t.setMissingCanvas(s,r.id,i),o._hasNoCanvas=!1):o.canvas=i)}n(this,no).clear()};let iy=Xy;const Lf=/\r\n?|\n/g;var Ps,Bu,ao,Ds,Yg,_v,qg,Sv,Kg,Ev,wh,ip,vh,np,Ah,rp,Zg,Cv,zu,ay,Jg,xv;const Zt=class Zt extends Qt{constructor(t){super({...t,name:"freeTextEditor"});m(this,Yg);m(this,qg);m(this,Kg);m(this,wh);m(this,Ah);m(this,Zg);m(this,Jg);m(this,Ps,"");m(this,Bu,`${this.id}-editor`);m(this,ao,null);m(this,Ds,void 0);$(this,"_colorPicker",null);this.color=t.color||Zt._defaultColor||Qt._defaultLineColor,w(this,Ds,t.fontSize||Zt._defaultFontSize),this.annotationElementId||this._uiManager.a11yAlert("pdfjs-editor-freetext-added-alert"),this.canAddComment=!1}static get _keyboardManager(){const t=Zt.prototype,s=a=>a.isEmpty(),i=Mo.TRANSLATE_SMALL,r=Mo.TRANSLATE_BIG;return _t(this,"_keyboardManager",new Sf([[["ctrl+s","mac+meta+s","ctrl+p","mac+meta+p"],t.commitOrRemove,{bubbles:!0}],[["ctrl+Enter","mac+meta+Enter","Escape","mac+Escape"],t.commitOrRemove],[["ArrowLeft","mac+ArrowLeft"],t._translateEmpty,{args:[-i,0],checker:s}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],t._translateEmpty,{args:[-r,0],checker:s}],[["ArrowRight","mac+ArrowRight"],t._translateEmpty,{args:[i,0],checker:s}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],t._translateEmpty,{args:[r,0],checker:s}],[["ArrowUp","mac+ArrowUp"],t._translateEmpty,{args:[0,-i],checker:s}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],t._translateEmpty,{args:[0,-r],checker:s}],[["ArrowDown","mac+ArrowDown"],t._translateEmpty,{args:[0,i],checker:s}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],t._translateEmpty,{args:[0,r],checker:s}]]))}static initialize(t,s){Qt.initialize(t,s);const i=getComputedStyle(document.documentElement);this._internalPadding=parseFloat(i.getPropertyValue("--freetext-padding"))}static updateDefaultParams(t,s){switch(t){case Mt.FREETEXT_SIZE:Zt._defaultFontSize=s;break;case Mt.FREETEXT_COLOR:Zt._defaultColor=s;break}}updateParams(t,s){switch(t){case Mt.FREETEXT_SIZE:E(this,Yg,_v).call(this,s);break;case Mt.FREETEXT_COLOR:E(this,qg,Sv).call(this,s);break}}static get defaultPropertiesToUpdate(){return[[Mt.FREETEXT_SIZE,Zt._defaultFontSize],[Mt.FREETEXT_COLOR,Zt._defaultColor||Qt._defaultLineColor]]}get propertiesToUpdate(){return[[Mt.FREETEXT_SIZE,n(this,Ds)],[Mt.FREETEXT_COLOR,this.color]]}get toolbarButtons(){return this._colorPicker||(this._colorPicker=new kp(this)),[["colorPicker",this._colorPicker]]}get colorType(){return Mt.FREETEXT_COLOR}onUpdatedColor(){var t;this.editorDiv.style.color=this.color,(t=this._colorPicker)==null||t.update(this.color),super.onUpdatedColor()}_translateEmpty(t,s){this._uiManager.translateSelectedEditors(t,s,!0)}getInitialTranslation(){const t=this.parentScale;return[-Zt._internalPadding*t,-(Zt._internalPadding+n(this,Ds))*t]}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.isAttachedToDOM||this.parent.add(this)))}enableEditMode(){if(!super.enableEditMode())return!1;this.overlayDiv.classList.remove("enabled"),this.editorDiv.contentEditable=!0,this._isDraggable=!1,this.div.removeAttribute("aria-activedescendant"),w(this,ao,new AbortController);const t=this._uiManager.combinedSignal(n(this,ao));return this.editorDiv.addEventListener("keydown",this.editorDivKeydown.bind(this),{signal:t}),this.editorDiv.addEventListener("focus",this.editorDivFocus.bind(this),{signal:t}),this.editorDiv.addEventListener("blur",this.editorDivBlur.bind(this),{signal:t}),this.editorDiv.addEventListener("input",this.editorDivInput.bind(this),{signal:t}),this.editorDiv.addEventListener("paste",this.editorDivPaste.bind(this),{signal:t}),!0}disableEditMode(){var t;return super.disableEditMode()?(this.overlayDiv.classList.add("enabled"),this.editorDiv.contentEditable=!1,this.div.setAttribute("aria-activedescendant",n(this,Bu)),this._isDraggable=!0,(t=n(this,ao))==null||t.abort(),w(this,ao,null),this.div.focus({preventScroll:!0}),this.isEditing=!1,this.parent.div.classList.add("freetextEditing"),!0):!1}focusin(t){this._focusEventsAllowed&&(super.focusin(t),t.target!==this.editorDiv&&this.editorDiv.focus())}onceAdded(t){var s;this.width||(this.enableEditMode(),t&&this.editorDiv.focus(),(s=this._initialOptions)!=null&&s.isCentered&&this.center(),this._initialOptions=null)}isEmpty(){return!this.editorDiv||this.editorDiv.innerText.trim()===""}remove(){this.isEditing=!1,this.parent&&(this.parent.setEditingState(!0),this.parent.div.classList.add("freetextEditing")),super.remove()}commit(){if(!this.isInEditMode())return;super.commit(),this.disableEditMode();const t=n(this,Ps),s=w(this,Ps,E(this,Kg,Ev).call(this).trimEnd());if(t===s)return;const i=r=>{if(w(this,Ps,r),!r){this.remove();return}E(this,Ah,rp).call(this),this._uiManager.rebuild(this),E(this,wh,ip).call(this)};this.addCommands({cmd:()=>{i(s)},undo:()=>{i(t)},mustExec:!1}),E(this,wh,ip).call(this)}shouldGetKeyboardEvents(){return this.isInEditMode()}enterInEditMode(){this.enableEditMode(),this.editorDiv.focus()}keydown(t){t.target===this.div&&t.key==="Enter"&&(this.enterInEditMode(),t.preventDefault())}editorDivKeydown(t){Zt._keyboardManager.exec(this,t)}editorDivFocus(t){this.isEditing=!0}editorDivBlur(t){this.isEditing=!1}editorDivInput(t){this.parent.div.classList.toggle("freetextEditing",this.isEmpty())}disableEditing(){this.editorDiv.setAttribute("role","comment"),this.editorDiv.removeAttribute("aria-multiline")}enableEditing(){this.editorDiv.setAttribute("role","textbox"),this.editorDiv.setAttribute("aria-multiline",!0)}get canChangeContent(){return!0}render(){if(this.div)return this.div;let t,s;(this._isCopy||this.annotationElementId)&&(t=this.x,s=this.y),super.render(),this.editorDiv=document.createElement("div"),this.editorDiv.className="internal",this.editorDiv.setAttribute("id",n(this,Bu)),this.editorDiv.setAttribute("data-l10n-id","pdfjs-free-text2"),this.editorDiv.setAttribute("data-l10n-attrs","default-content"),this.enableEditing(),this.editorDiv.contentEditable=!0;const{style:i}=this.editorDiv;if(i.fontSize=`calc(${n(this,Ds)}px * var(--total-scale-factor))`,i.color=this.color,this.div.append(this.editorDiv),this.overlayDiv=document.createElement("div"),this.overlayDiv.classList.add("overlay","enabled"),this.div.append(this.overlayDiv),this._isCopy||this.annotationElementId){const[r,a]=this.parentDimensions;if(this.annotationElementId){const{position:o}=this._initialData;let[l,h]=this.getInitialTranslation();[l,h]=this.pageTranslationToScreen(l,h);const[c,d]=this.pageDimensions,[u,f]=this.pageTranslation;let y,g;switch(this.rotation){case 0:y=t+(o[0]-u)/c,g=s+this.height-(o[1]-f)/d;break;case 90:y=t+(o[0]-u)/c,g=s-(o[1]-f)/d,[l,h]=[h,-l];break;case 180:y=t-this.width+(o[0]-u)/c,g=s-(o[1]-f)/d,[l,h]=[-l,-h];break;case 270:y=t+(o[0]-u-this.height*d)/c,g=s+(o[1]-f-this.width*c)/d,[l,h]=[-h,l];break}this.setAt(y*r,g*a,l,h)}else this._moveAfterPaste(t,s);E(this,Ah,rp).call(this),this._isDraggable=!0,this.editorDiv.contentEditable=!1}else this._isDraggable=!1,this.editorDiv.contentEditable=!0;return this.div}editorDivPaste(t){var y,g,v;const s=t.clipboardData||window.clipboardData,{types:i}=s;if(i.length===1&&i[0]==="text/plain")return;t.preventDefault();const r=E(y=Zt,zu,ay).call(y,s.getData("text")||"").replaceAll(Lf,`
`);if(!r)return;const a=window.getSelection();if(!a.rangeCount)return;this.editorDiv.normalize(),a.deleteFromDocument();const o=a.getRangeAt(0);if(!r.includes(`
`)){o.insertNode(document.createTextNode(r)),this.editorDiv.normalize(),a.collapseToStart();return}const{startContainer:l,startOffset:h}=o,c=[],d=[];if(l.nodeType===Node.TEXT_NODE){const b=l.parentElement;if(d.push(l.nodeValue.slice(h).replaceAll(Lf,"")),b!==this.editorDiv){let A=c;for(const _ of this.editorDiv.childNodes){if(_===b){A=d;continue}A.push(E(g=Zt,vh,np).call(g,_))}}c.push(l.nodeValue.slice(0,h).replaceAll(Lf,""))}else if(l===this.editorDiv){let b=c,A=0;for(const _ of this.editorDiv.childNodes)A++===h&&(b=d),b.push(E(v=Zt,vh,np).call(v,_))}w(this,Ps,`${c.join(`
`)}${r}${d.join(`
`)}`),E(this,Ah,rp).call(this);const u=new Range;let f=Math.sumPrecise(c.map(b=>b.length));for(const{firstChild:b}of this.editorDiv.childNodes)if(b.nodeType===Node.TEXT_NODE){const A=b.nodeValue.length;if(f<=A){u.setStart(b,f),u.setEnd(b,f);break}f-=A}a.removeAllRanges(),a.addRange(u)}get contentDiv(){return this.editorDiv}getPDFRect(){const t=Zt._internalPadding*this.parentScale;return this.getRect(t,t)}static async deserialize(t,s,i){var o;let r=null;if(t instanceof yv){const{data:{defaultAppearanceData:{fontSize:l,fontColor:h},rect:c,rotation:d,id:u,popupRef:f,richText:y,contentsObj:g,creationDate:v,modificationDate:b},textContent:A,textPosition:_,parent:{page:{pageNumber:x}}}=t;if(!A||A.length===0)return null;r=t={annotationType:Et.FREETEXT,color:Array.from(h),fontSize:l,value:A.join(`
`),position:_,pageIndex:x-1,rect:c.slice(0),rotation:d,annotationElementId:u,id:u,deleted:!1,popupRef:f,comment:(g==null?void 0:g.str)||null,richText:y,creationDate:v,modificationDate:b}}const a=await super.deserialize(t,s,i);return w(a,Ds,t.fontSize),a.color=ct.makeHexColor(...t.color),w(a,Ps,E(o=Zt,zu,ay).call(o,t.value)),a._initialData=r,t.comment&&a.setCommentData(t),a}serialize(t=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const s=Qt._colorManager.convert(this.isAttachedToDOM?getComputedStyle(this.editorDiv).color:this.color),i=Object.assign(super.serialize(t),{color:s,fontSize:n(this,Ds),value:E(this,Zg,Cv).call(this)});return this.addComment(i),t?(i.isCopy=!0,i):this.annotationElementId&&!E(this,Jg,xv).call(this,i)?null:(i.id=this.annotationElementId,i)}renderAnnotationElement(t){const s=super.renderAnnotationElement(t);if(!s)return null;const{style:i}=s;i.fontSize=`calc(${n(this,Ds)}px * var(--total-scale-factor))`,i.color=this.color,s.replaceChildren();for(const r of n(this,Ps).split(`
`)){const a=document.createElement("div");a.append(r?document.createTextNode(r):document.createElement("br")),s.append(a)}return t.updateEdited({rect:this.getPDFRect(),popup:this._uiManager.hasCommentManager()||this.hasEditedComment?this.comment:{text:n(this,Ps)}}),s}resetAnnotationElement(t){super.resetAnnotationElement(t),t.resetEdited()}};Ps=new WeakMap,Bu=new WeakMap,ao=new WeakMap,Ds=new WeakMap,Yg=new WeakSet,_v=function(t){const s=r=>{this.editorDiv.style.fontSize=`calc(${r}px * var(--total-scale-factor))`,this.translate(0,-(r-n(this,Ds))*this.parentScale),w(this,Ds,r),E(this,wh,ip).call(this)},i=n(this,Ds);this.addCommands({cmd:s.bind(this,t),undo:s.bind(this,i),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:Mt.FREETEXT_SIZE,overwriteIfSameType:!0,keepUndo:!0})},qg=new WeakSet,Sv=function(t){const s=r=>{this.color=r,this.onUpdatedColor()},i=this.color;this.addCommands({cmd:s.bind(this,t),undo:s.bind(this,i),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:Mt.FREETEXT_COLOR,overwriteIfSameType:!0,keepUndo:!0})},Kg=new WeakSet,Ev=function(){var i;const t=[];this.editorDiv.normalize();let s=null;for(const r of this.editorDiv.childNodes)(s==null?void 0:s.nodeType)===Node.TEXT_NODE&&r.nodeName==="BR"||(t.push(E(i=Zt,vh,np).call(i,r)),s=r);return t.join(`
`)},wh=new WeakSet,ip=function(){const[t,s]=this.parentDimensions;let i;if(this.isAttachedToDOM)i=this.div.getBoundingClientRect();else{const{currentLayer:r,div:a}=this,o=a.style.display,l=a.classList.contains("hidden");a.classList.remove("hidden"),a.style.display="hidden",r.div.append(this.div),i=a.getBoundingClientRect(),a.remove(),a.style.display=o,a.classList.toggle("hidden",l)}this.rotation%180===this.parentRotation%180?(this.width=i.width/t,this.height=i.height/s):(this.width=i.height/t,this.height=i.width/s),this.fixAndSetPosition()},vh=new WeakSet,np=function(t){return(t.nodeType===Node.TEXT_NODE?t.nodeValue:t.innerText).replaceAll(Lf,"")},Ah=new WeakSet,rp=function(){if(this.editorDiv.replaceChildren(),!!n(this,Ps))for(const t of n(this,Ps).split(`
`)){const s=document.createElement("div");s.append(t?document.createTextNode(t):document.createElement("br")),this.editorDiv.append(s)}},Zg=new WeakSet,Cv=function(){return n(this,Ps).replaceAll(" "," ")},zu=new WeakSet,ay=function(t){return t.replaceAll(" "," ")},Jg=new WeakSet,xv=function(t){const{value:s,fontSize:i,color:r,pageIndex:a}=this._initialData;return this.hasEditedComment||this._hasBeenMoved||t.value!==s||t.fontSize!==i||t.color.some((o,l)=>o!==r[l])||t.pageIndex!==a},m(Zt,vh),m(Zt,zu),$(Zt,"_freeTextDefaultContent",""),$(Zt,"_internalPadding",0),$(Zt,"_defaultColor",null),$(Zt,"_defaultFontSize",10),$(Zt,"_type","freetext"),$(Zt,"_editorType",Et.FREETEXT);let ry=Zt;class ut{toSVGPath(){zt("Abstract method `toSVGPath` must be implemented.")}get box(){zt("Abstract getter `box` must be implemented.")}serialize(e,t){zt("Abstract method `serialize` must be implemented.")}static _rescale(e,t,s,i,r,a){a||(a=new Float32Array(e.length));for(let o=0,l=e.length;o<l;o+=2)a[o]=t+e[o]*i,a[o+1]=s+e[o+1]*r;return a}static _rescaleAndSwap(e,t,s,i,r,a){a||(a=new Float32Array(e.length));for(let o=0,l=e.length;o<l;o+=2)a[o]=t+e[o+1]*i,a[o+1]=s+e[o]*r;return a}static _translate(e,t,s,i){i||(i=new Float32Array(e.length));for(let r=0,a=e.length;r<a;r+=2)i[r]=t+e[r],i[r+1]=s+e[r+1];return i}static svgRound(e){return Math.round(e*1e4)}static _normalizePoint(e,t,s,i,r){switch(r){case 90:return[1-t/s,e/i];case 180:return[1-e/s,1-t/i];case 270:return[t/s,1-e/i];default:return[e/s,t/i]}}static _normalizePagePoint(e,t,s){switch(s){case 90:return[1-t,e];case 180:return[1-e,1-t];case 270:return[t,1-e];default:return[e,t]}}static createBezierPoints(e,t,s,i,r,a){return[(e+5*s)/6,(t+5*i)/6,(5*s+r)/6,(5*i+a)/6,(s+r)/2,(i+a)/2]}}$(ut,"PRECISION",1e-4);var Is,pi,_h,Sh,ji,Tt,oo,lo,Uu,Hu,Eh,Ch,Rr,ju,Qg,tm,ho,_c,em,kv,sm,Tv,im,Pv,nm,Dv,rm,Iv,am,Mv;const sn=class sn{constructor({x:e,y:t},s,i,r,a,o=0){m(this,ho);m(this,em);m(this,sm);m(this,im);m(this,nm);m(this,rm);m(this,am);m(this,Is,void 0);m(this,pi,[]);m(this,_h,void 0);m(this,Sh,void 0);m(this,ji,[]);m(this,Tt,new Float32Array(18));m(this,oo,void 0);m(this,lo,void 0);m(this,Uu,void 0);m(this,Hu,void 0);m(this,Eh,void 0);m(this,Ch,void 0);m(this,Rr,[]);w(this,Is,s),w(this,Ch,r*i),w(this,Sh,a),n(this,Tt).set([NaN,NaN,NaN,NaN,e,t],6),w(this,_h,o),w(this,Hu,n(sn,ju)*i),w(this,Uu,n(sn,tm)*i),w(this,Eh,i),n(this,Rr).push(e,t)}isEmpty(){return isNaN(n(this,Tt)[8])}add({x:e,y:t}){var R;w(this,oo,e),w(this,lo,t);const[s,i,r,a]=n(this,Is);let[o,l,h,c]=n(this,Tt).subarray(8,12);const d=e-h,u=t-c,f=Math.hypot(d,u);if(f<n(this,Uu))return!1;const y=f-n(this,Hu),g=y/f,v=g*d,b=g*u;let A=o,_=l;o=h,l=c,h+=v,c+=b,(R=n(this,Rr))==null||R.push(e,t);const x=-b/y,k=v/y,T=x*n(this,Ch),P=k*n(this,Ch);return n(this,Tt).set(n(this,Tt).subarray(2,8),0),n(this,Tt).set([h+T,c+P],4),n(this,Tt).set(n(this,Tt).subarray(14,18),12),n(this,Tt).set([h-T,c-P],16),isNaN(n(this,Tt)[6])?(n(this,ji).length===0&&(n(this,Tt).set([o+T,l+P],2),n(this,ji).push(NaN,NaN,NaN,NaN,(o+T-s)/r,(l+P-i)/a),n(this,Tt).set([o-T,l-P],14),n(this,pi).push(NaN,NaN,NaN,NaN,(o-T-s)/r,(l-P-i)/a)),n(this,Tt).set([A,_,o,l,h,c],6),!this.isEmpty()):(n(this,Tt).set([A,_,o,l,h,c],6),Math.abs(Math.atan2(_-l,A-o)-Math.atan2(b,v))<Math.PI/2?([o,l,h,c]=n(this,Tt).subarray(2,6),n(this,ji).push(NaN,NaN,NaN,NaN,((o+h)/2-s)/r,((l+c)/2-i)/a),[o,l,A,_]=n(this,Tt).subarray(14,18),n(this,pi).push(NaN,NaN,NaN,NaN,((A+o)/2-s)/r,((_+l)/2-i)/a),!0):([A,_,o,l,h,c]=n(this,Tt).subarray(0,6),n(this,ji).push(((A+5*o)/6-s)/r,((_+5*l)/6-i)/a,((5*o+h)/6-s)/r,((5*l+c)/6-i)/a,((o+h)/2-s)/r,((l+c)/2-i)/a),[h,c,o,l,A,_]=n(this,Tt).subarray(12,18),n(this,pi).push(((A+5*o)/6-s)/r,((_+5*l)/6-i)/a,((5*o+h)/6-s)/r,((5*l+c)/6-i)/a,((o+h)/2-s)/r,((l+c)/2-i)/a),!0))}toSVGPath(){if(this.isEmpty())return"";const e=n(this,ji),t=n(this,pi);if(isNaN(n(this,Tt)[6])&&!this.isEmpty())return E(this,em,kv).call(this);const s=[];s.push(`M${e[4]} ${e[5]}`);for(let i=6;i<e.length;i+=6)isNaN(e[i])?s.push(`L${e[i+4]} ${e[i+5]}`):s.push(`C${e[i]} ${e[i+1]} ${e[i+2]} ${e[i+3]} ${e[i+4]} ${e[i+5]}`);E(this,im,Pv).call(this,s);for(let i=t.length-6;i>=6;i-=6)isNaN(t[i])?s.push(`L${t[i+4]} ${t[i+5]}`):s.push(`C${t[i]} ${t[i+1]} ${t[i+2]} ${t[i+3]} ${t[i+4]} ${t[i+5]}`);return E(this,sm,Tv).call(this,s),s.join(" ")}newFreeDrawOutline(e,t,s,i,r,a){return new Rv(e,t,s,i,r,a)}getOutlines(){var d;const e=n(this,ji),t=n(this,pi),s=n(this,Tt),[i,r,a,o]=n(this,Is),l=new Float32Array((((d=n(this,Rr))==null?void 0:d.length)??0)+2);for(let u=0,f=l.length-2;u<f;u+=2)l[u]=(n(this,Rr)[u]-i)/a,l[u+1]=(n(this,Rr)[u+1]-r)/o;if(l[l.length-2]=(n(this,oo)-i)/a,l[l.length-1]=(n(this,lo)-r)/o,isNaN(s[6])&&!this.isEmpty())return E(this,nm,Dv).call(this,l);const h=new Float32Array(n(this,ji).length+24+n(this,pi).length);let c=e.length;for(let u=0;u<c;u+=2){if(isNaN(e[u])){h[u]=h[u+1]=NaN;continue}h[u]=e[u],h[u+1]=e[u+1]}c=E(this,am,Mv).call(this,h,c);for(let u=t.length-6;u>=6;u-=6)for(let f=0;f<6;f+=2){if(isNaN(t[u+f])){h[c]=h[c+1]=NaN,c+=2;continue}h[c]=t[u+f],h[c+1]=t[u+f+1],c+=2}return E(this,rm,Iv).call(this,h,c),this.newFreeDrawOutline(h,l,n(this,Is),n(this,Eh),n(this,_h),n(this,Sh))}};Is=new WeakMap,pi=new WeakMap,_h=new WeakMap,Sh=new WeakMap,ji=new WeakMap,Tt=new WeakMap,oo=new WeakMap,lo=new WeakMap,Uu=new WeakMap,Hu=new WeakMap,Eh=new WeakMap,Ch=new WeakMap,Rr=new WeakMap,ju=new WeakMap,Qg=new WeakMap,tm=new WeakMap,ho=new WeakSet,_c=function(){const e=n(this,Tt).subarray(4,6),t=n(this,Tt).subarray(16,18),[s,i,r,a]=n(this,Is);return[(n(this,oo)+(e[0]-t[0])/2-s)/r,(n(this,lo)+(e[1]-t[1])/2-i)/a,(n(this,oo)+(t[0]-e[0])/2-s)/r,(n(this,lo)+(t[1]-e[1])/2-i)/a]},em=new WeakSet,kv=function(){const[e,t,s,i]=n(this,Is),[r,a,o,l]=E(this,ho,_c).call(this);return`M${(n(this,Tt)[2]-e)/s} ${(n(this,Tt)[3]-t)/i} L${(n(this,Tt)[4]-e)/s} ${(n(this,Tt)[5]-t)/i} L${r} ${a} L${o} ${l} L${(n(this,Tt)[16]-e)/s} ${(n(this,Tt)[17]-t)/i} L${(n(this,Tt)[14]-e)/s} ${(n(this,Tt)[15]-t)/i} Z`},sm=new WeakSet,Tv=function(e){const t=n(this,pi);e.push(`L${t[4]} ${t[5]} Z`)},im=new WeakSet,Pv=function(e){const[t,s,i,r]=n(this,Is),a=n(this,Tt).subarray(4,6),o=n(this,Tt).subarray(16,18),[l,h,c,d]=E(this,ho,_c).call(this);e.push(`L${(a[0]-t)/i} ${(a[1]-s)/r} L${l} ${h} L${c} ${d} L${(o[0]-t)/i} ${(o[1]-s)/r}`)},nm=new WeakSet,Dv=function(e){const t=n(this,Tt),[s,i,r,a]=n(this,Is),[o,l,h,c]=E(this,ho,_c).call(this),d=new Float32Array(36);return d.set([NaN,NaN,NaN,NaN,(t[2]-s)/r,(t[3]-i)/a,NaN,NaN,NaN,NaN,(t[4]-s)/r,(t[5]-i)/a,NaN,NaN,NaN,NaN,o,l,NaN,NaN,NaN,NaN,h,c,NaN,NaN,NaN,NaN,(t[16]-s)/r,(t[17]-i)/a,NaN,NaN,NaN,NaN,(t[14]-s)/r,(t[15]-i)/a],0),this.newFreeDrawOutline(d,e,n(this,Is),n(this,Eh),n(this,_h),n(this,Sh))},rm=new WeakSet,Iv=function(e,t){const s=n(this,pi);return e.set([NaN,NaN,NaN,NaN,s[4],s[5]],t),t+=6},am=new WeakSet,Mv=function(e,t){const s=n(this,Tt).subarray(4,6),i=n(this,Tt).subarray(16,18),[r,a,o,l]=n(this,Is),[h,c,d,u]=E(this,ho,_c).call(this);return e.set([NaN,NaN,NaN,NaN,(s[0]-r)/o,(s[1]-a)/l,NaN,NaN,NaN,NaN,h,c,NaN,NaN,NaN,NaN,d,u,NaN,NaN,NaN,NaN,(i[0]-r)/o,(i[1]-a)/l],t),t+=24},m(sn,ju,8),m(sn,Qg,2),m(sn,tm,n(sn,ju)+n(sn,Qg));let Pp=sn;var xh,co,Fn,Vu,Ms,Wu,ge,om,Lv;class Rv extends ut{constructor(t,s,i,r,a,o){super();m(this,om);m(this,xh,void 0);m(this,co,new Float32Array(4));m(this,Fn,void 0);m(this,Vu,void 0);m(this,Ms,void 0);m(this,Wu,void 0);m(this,ge,void 0);w(this,ge,t),w(this,Ms,s),w(this,xh,i),w(this,Wu,r),w(this,Fn,a),w(this,Vu,o),this.firstPoint=[NaN,NaN],this.lastPoint=[NaN,NaN],E(this,om,Lv).call(this,o);const[l,h,c,d]=n(this,co);for(let u=0,f=t.length;u<f;u+=2)t[u]=(t[u]-l)/c,t[u+1]=(t[u+1]-h)/d;for(let u=0,f=s.length;u<f;u+=2)s[u]=(s[u]-l)/c,s[u+1]=(s[u+1]-h)/d}toSVGPath(){const t=[`M${n(this,ge)[4]} ${n(this,ge)[5]}`];for(let s=6,i=n(this,ge).length;s<i;s+=6){if(isNaN(n(this,ge)[s])){t.push(`L${n(this,ge)[s+4]} ${n(this,ge)[s+5]}`);continue}t.push(`C${n(this,ge)[s]} ${n(this,ge)[s+1]} ${n(this,ge)[s+2]} ${n(this,ge)[s+3]} ${n(this,ge)[s+4]} ${n(this,ge)[s+5]}`)}return t.push("Z"),t.join(" ")}serialize([t,s,i,r],a){const o=i-t,l=r-s;let h,c;switch(a){case 0:h=ut._rescale(n(this,ge),t,r,o,-l),c=ut._rescale(n(this,Ms),t,r,o,-l);break;case 90:h=ut._rescaleAndSwap(n(this,ge),t,s,o,l),c=ut._rescaleAndSwap(n(this,Ms),t,s,o,l);break;case 180:h=ut._rescale(n(this,ge),i,s,-o,l),c=ut._rescale(n(this,Ms),i,s,-o,l);break;case 270:h=ut._rescaleAndSwap(n(this,ge),i,r,-o,-l),c=ut._rescaleAndSwap(n(this,Ms),i,r,-o,-l);break}return{outline:Array.from(h),points:[Array.from(c)]}}get box(){return n(this,co)}newOutliner(t,s,i,r,a,o=0){return new Pp(t,s,i,r,a,o)}getNewOutline(t,s){const[i,r,a,o]=n(this,co),[l,h,c,d]=n(this,xh),u=a*c,f=o*d,y=i*c+l,g=r*d+h,v=this.newOutliner({x:n(this,Ms)[0]*u+y,y:n(this,Ms)[1]*f+g},n(this,xh),n(this,Wu),t,n(this,Vu),s??n(this,Fn));for(let b=2;b<n(this,Ms).length;b+=2)v.add({x:n(this,Ms)[b]*u+y,y:n(this,Ms)[b+1]*f+g});return v.getOutlines()}}xh=new WeakMap,co=new WeakMap,Fn=new WeakMap,Vu=new WeakMap,Ms=new WeakMap,Wu=new WeakMap,ge=new WeakMap,om=new WeakSet,Lv=function(t){const s=n(this,ge);let i=s[4],r=s[5];const a=[i,r,i,r];let o=i,l=r,h=i,c=r;const d=t?Math.max:Math.min,u=new Float32Array(4);for(let y=6,g=s.length;y<g;y+=6){const v=s[y+4],b=s[y+5];isNaN(s[y])?(ct.pointBoundingBox(v,b,a),l>b?(o=v,l=b):l===b&&(o=d(o,v)),c<b?(h=v,c=b):c===b&&(h=d(h,v))):(u[0]=u[1]=1/0,u[2]=u[3]=-1/0,ct.bezierBoundingBox(i,r,...s.slice(y,y+6),u),ct.rectBoundingBox(u[0],u[1],u[2],u[3],a),l>u[1]?(o=u[0],l=u[1]):l===u[1]&&(o=d(o,u[0])),c<u[3]?(h=u[2],c=u[3]):c===u[3]&&(h=d(h,u[2]))),i=v,r=b}const f=n(this,co);f[0]=a[0]-n(this,Fn),f[1]=a[1]-n(this,Fn),f[2]=a[2]-a[0]+2*n(this,Fn),f[3]=a[3]-a[1]+2*n(this,Fn),this.firstPoint=[o,l],this.lastPoint=[h,c]};var Gu,Xu,$u,Lr,gi,lm,Fv,kh,ap,hm,Ov,cm,Nv,Yu,ly;class oy{constructor(e,t=0,s=0,i=!0){m(this,lm);m(this,kh);m(this,hm);m(this,cm);m(this,Yu);m(this,Gu,void 0);m(this,Xu,void 0);m(this,$u,void 0);m(this,Lr,[]);m(this,gi,[]);const r=[1/0,1/0,-1/0,-1/0],a=10**-4;for(const{x:g,y:v,width:b,height:A}of e){const _=Math.floor((g-t)/a)*a,x=Math.ceil((g+b+t)/a)*a,k=Math.floor((v-t)/a)*a,T=Math.ceil((v+A+t)/a)*a,P=[_,k,T,!0],F=[x,k,T,!1];n(this,Lr).push(P,F),ct.rectBoundingBox(_,k,x,T,r)}const o=r[2]-r[0]+2*s,l=r[3]-r[1]+2*s,h=r[0]-s,c=r[1]-s;let d=i?-1/0:1/0,u=1/0;const f=n(this,Lr).at(i?-1:-2),y=[f[0],f[2]];for(const g of n(this,Lr)){const[v,b,A,_]=g;!_&&i?b<u?(u=b,d=v):b===u&&(d=Math.max(d,v)):_&&!i&&(b<u?(u=b,d=v):b===u&&(d=Math.min(d,v))),g[0]=(v-h)/o,g[1]=(b-c)/l,g[2]=(A-c)/l}w(this,Gu,new Float32Array([h,c,o,l])),w(this,Xu,[d,u]),w(this,$u,y)}getOutlines(){n(this,Lr).sort((t,s)=>t[0]-s[0]||t[1]-s[1]||t[2]-s[2]);const e=[];for(const t of n(this,Lr))t[3]?(e.push(...E(this,Yu,ly).call(this,t)),E(this,hm,Ov).call(this,t)):(E(this,cm,Nv).call(this,t),e.push(...E(this,Yu,ly).call(this,t)));return E(this,lm,Fv).call(this,e)}}Gu=new WeakMap,Xu=new WeakMap,$u=new WeakMap,Lr=new WeakMap,gi=new WeakMap,lm=new WeakSet,Fv=function(e){const t=[],s=new Set;for(const a of e){const[o,l,h]=a;t.push([o,l,a],[o,h,a])}t.sort((a,o)=>a[1]-o[1]||a[0]-o[0]);for(let a=0,o=t.length;a<o;a+=2){const l=t[a][2],h=t[a+1][2];l.push(h),h.push(l),s.add(l),s.add(h)}const i=[];let r;for(;s.size>0;){const a=s.values().next().value;let[o,l,h,c,d]=a;s.delete(a);let u=o,f=l;for(r=[o,h],i.push(r);;){let y;if(s.has(c))y=c;else if(s.has(d))y=d;else break;s.delete(y),[o,l,h,c,d]=y,u!==o&&(r.push(u,f,o,f===l?l:h),u=o),f=f===l?h:l}r.push(u,f)}return new b1(i,n(this,Gu),n(this,Xu),n(this,$u))},kh=new WeakSet,ap=function(e){const t=n(this,gi);let s=0,i=t.length-1;for(;s<=i;){const r=s+i>>1,a=t[r][0];if(a===e)return r;a<e?s=r+1:i=r-1}return i+1},hm=new WeakSet,Ov=function([,e,t]){const s=E(this,kh,ap).call(this,e);n(this,gi).splice(s,0,[e,t])},cm=new WeakSet,Nv=function([,e,t]){const s=E(this,kh,ap).call(this,e);for(let i=s;i<n(this,gi).length;i++){const[r,a]=n(this,gi)[i];if(r!==e)break;if(r===e&&a===t){n(this,gi).splice(i,1);return}}for(let i=s-1;i>=0;i--){const[r,a]=n(this,gi)[i];if(r!==e)break;if(r===e&&a===t){n(this,gi).splice(i,1);return}}},Yu=new WeakSet,ly=function(e){const[t,s,i]=e,r=[[t,s,i]],a=E(this,kh,ap).call(this,i);for(let o=0;o<a;o++){const[l,h]=n(this,gi)[o];for(let c=0,d=r.length;c<d;c++){const[,u,f]=r[c];if(!(h<=u||f<=l)){if(u>=l){if(f>h)r[c][1]=h;else{if(d===1)return[];r.splice(c,1),c--,d--}continue}r[c][2]=l,f>h&&r.push([t,h,f])}}}return r};var qu,Th;class b1 extends ut{constructor(t,s,i,r){super();m(this,qu,void 0);m(this,Th,void 0);w(this,Th,t),w(this,qu,s),this.firstPoint=i,this.lastPoint=r}toSVGPath(){const t=[];for(const s of n(this,Th)){let[i,r]=s;t.push(`M${i} ${r}`);for(let a=2;a<s.length;a+=2){const o=s[a],l=s[a+1];o===i?(t.push(`V${l}`),r=l):l===r&&(t.push(`H${o}`),i=o)}t.push("Z")}return t.join(" ")}serialize([t,s,i,r],a){const o=[],l=i-t,h=r-s;for(const c of n(this,Th)){const d=new Array(c.length);for(let u=0;u<c.length;u+=2)d[u]=t+c[u]*l,d[u+1]=r-c[u+1]*h;o.push(d)}return o}get box(){return n(this,qu)}get classNamesForOutlining(){return["highlightOutline"]}}qu=new WeakMap,Th=new WeakMap;class hy extends Pp{newFreeDrawOutline(e,t,s,i,r,a){return new y1(e,t,s,i,r,a)}}class y1 extends Rv{newOutliner(e,t,s,i,r,a=0){return new hy(e,t,s,i,r,a)}}var Ph,Ku,On,uo,Zu,ps,Ju,Qu,fo,Rs,Ls,He,Dh,Ih,Je,Mh,ti,tf,ef,cy,Rh,op,dm,Bv,um,zv,fm,Uv,sf,dy,Nn,Zr,Fr,Vo,pm,Hv,Lh,lp,Fh,hp,gm,jv,mm,Vv,bm,Wv,ym,Gv,wm,Xv;const Lt=class Lt extends Qt{constructor(t){super({...t,name:"highlightEditor"});m(this,ef);m(this,Rh);m(this,dm);m(this,um);m(this,fm);m(this,sf);m(this,Nn);m(this,pm);m(this,Lh);m(this,Fh);m(this,gm);m(this,mm);m(this,wm);m(this,Ph,null);m(this,Ku,0);m(this,On,void 0);m(this,uo,null);m(this,Zu,null);m(this,ps,null);m(this,Ju,null);m(this,Qu,0);m(this,fo,null);m(this,Rs,null);m(this,Ls,null);m(this,He,!1);m(this,Dh,null);m(this,Ih,null);m(this,Je,null);m(this,Mh,"");m(this,ti,void 0);m(this,tf,"");this.color=t.color||Lt._defaultColor,w(this,ti,t.thickness||Lt._defaultThickness),this.opacity=t.opacity||Lt._defaultOpacity,w(this,On,t.boxes||null),w(this,tf,t.methodOfCreation||""),w(this,Mh,t.text||""),this._isDraggable=!1,this.defaultL10nId="pdfjs-editor-highlight-editor",t.highlightId>-1?(w(this,He,!0),E(this,Rh,op).call(this,t),E(this,Nn,Zr).call(this)):n(this,On)&&(w(this,Ph,t.anchorNode),w(this,Ku,t.anchorOffset),w(this,Ju,t.focusNode),w(this,Qu,t.focusOffset),E(this,ef,cy).call(this),E(this,Nn,Zr).call(this),this.rotate(this.rotation)),this.annotationElementId||this._uiManager.a11yAlert("pdfjs-editor-highlight-added-alert")}static get _keyboardManager(){const t=Lt.prototype;return _t(this,"_keyboardManager",new Sf([[["ArrowLeft","mac+ArrowLeft"],t._moveCaret,{args:[0]}],[["ArrowRight","mac+ArrowRight"],t._moveCaret,{args:[1]}],[["ArrowUp","mac+ArrowUp"],t._moveCaret,{args:[2]}],[["ArrowDown","mac+ArrowDown"],t._moveCaret,{args:[3]}]]))}get telemetryInitialData(){return{action:"added",type:n(this,He)?"free_highlight":"highlight",color:this._uiManager.getNonHCMColorName(this.color),thickness:n(this,ti),methodOfCreation:n(this,tf)}}get telemetryFinalData(){return{type:"highlight",color:this._uiManager.getNonHCMColorName(this.color)}}static computeTelemetryFinalData(t){return{numberOfColors:t.get("color").size}}static initialize(t,s){var i;Qt.initialize(t,s),Lt._defaultColor||(Lt._defaultColor=((i=s.highlightColors)==null?void 0:i.values().next().value)||"#fff066")}static updateDefaultParams(t,s){switch(t){case Mt.HIGHLIGHT_COLOR:Lt._defaultColor=s;break;case Mt.HIGHLIGHT_THICKNESS:Lt._defaultThickness=s;break}}translateInPage(t,s){}get toolbarPosition(){return n(this,Ih)}get commentButtonPosition(){return n(this,Dh)}updateParams(t,s){switch(t){case Mt.HIGHLIGHT_COLOR:E(this,dm,Bv).call(this,s);break;case Mt.HIGHLIGHT_THICKNESS:E(this,um,zv).call(this,s);break}}static get defaultPropertiesToUpdate(){return[[Mt.HIGHLIGHT_COLOR,Lt._defaultColor],[Mt.HIGHLIGHT_THICKNESS,Lt._defaultThickness]]}get propertiesToUpdate(){return[[Mt.HIGHLIGHT_COLOR,this.color||Lt._defaultColor],[Mt.HIGHLIGHT_THICKNESS,n(this,ti)||Lt._defaultThickness],[Mt.HIGHLIGHT_FREE,n(this,He)]]}onUpdatedColor(){var t,s;(t=this.parent)==null||t.drawLayer.updateProperties(n(this,Ls),{root:{fill:this.color,"fill-opacity":this.opacity}}),(s=n(this,Zu))==null||s.updateColor(this.color),super.onUpdatedColor()}get toolbarButtons(){return this._uiManager.highlightColors?[["colorPicker",w(this,Zu,new xp({editor:this}))]]:super.toolbarButtons}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}fixAndSetPosition(){return super.fixAndSetPosition(E(this,Fh,hp).call(this))}getBaseTranslation(){return[0,0]}getRect(t,s){return super.getRect(t,s,E(this,Fh,hp).call(this))}onceAdded(t){this.annotationElementId||this.parent.addUndoableEditor(this),t&&this.div.focus()}remove(){E(this,sf,dy).call(this),this._reportTelemetry({action:"deleted"}),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(E(this,Nn,Zr).call(this),this.isAttachedToDOM||this.parent.add(this)))}setParent(t){var i;let s=!1;this.parent&&!t?E(this,sf,dy).call(this):t&&(E(this,Nn,Zr).call(this,t),s=!this.parent&&((i=this.div)==null?void 0:i.classList.contains("selectedEditor"))),super.setParent(t),this.show(this._isVisible),s&&this.select()}rotate(t){var r,a,o;const{drawLayer:s}=this.parent;let i;n(this,He)?(t=(t-this.rotation+360)%360,i=E(r=Lt,Fr,Vo).call(r,n(this,Rs).box,t)):i=E(a=Lt,Fr,Vo).call(a,[this.x,this.y,this.width,this.height],t),s.updateProperties(n(this,Ls),{bbox:i,root:{"data-main-rotation":t}}),s.updateProperties(n(this,Je),{bbox:E(o=Lt,Fr,Vo).call(o,n(this,ps).box,t),root:{"data-main-rotation":t}})}render(){if(this.div)return this.div;const t=super.render();n(this,Mh)&&(t.setAttribute("aria-label",n(this,Mh)),t.setAttribute("role","mark")),n(this,He)?t.classList.add("free"):this.div.addEventListener("keydown",E(this,pm,Hv).bind(this),{signal:this._uiManager._signal});const s=w(this,fo,document.createElement("div"));return t.append(s),s.setAttribute("aria-hidden","true"),s.className="internal",s.style.clipPath=n(this,uo),this.setDims(),J0(this,n(this,fo),["pointerover","pointerleave"]),this.enableEditing(),t}pointerover(){var t;this.isSelected||(t=this.parent)==null||t.drawLayer.updateProperties(n(this,Je),{rootClass:{hovered:!0}})}pointerleave(){var t;this.isSelected||(t=this.parent)==null||t.drawLayer.updateProperties(n(this,Je),{rootClass:{hovered:!1}})}_moveCaret(t){switch(this.parent.unselect(this),t){case 0:case 2:E(this,Lh,lp).call(this,!0);break;case 1:case 3:E(this,Lh,lp).call(this,!1);break}}select(){var t;super.select(),n(this,Je)&&((t=this.parent)==null||t.drawLayer.updateProperties(n(this,Je),{rootClass:{hovered:!1,selected:!0}}))}unselect(){var t;super.unselect(),n(this,Je)&&((t=this.parent)==null||t.drawLayer.updateProperties(n(this,Je),{rootClass:{selected:!1}}),n(this,He)||E(this,Lh,lp).call(this,!1))}get _mustFixPosition(){return!n(this,He)}show(t=this._isVisible){super.show(t),this.parent&&(this.parent.drawLayer.updateProperties(n(this,Ls),{rootClass:{hidden:!t}}),this.parent.drawLayer.updateProperties(n(this,Je),{rootClass:{hidden:!t}}))}static startHighlighting(t,s,{target:i,x:r,y:a}){const{x:o,y:l,width:h,height:c}=i.getBoundingClientRect(),d=new AbortController,u=t.combinedSignal(d),f=y=>{d.abort(),E(this,ym,Gv).call(this,t,y)};window.addEventListener("blur",f,{signal:u}),window.addEventListener("pointerup",f,{signal:u}),window.addEventListener("pointerdown",ue,{capture:!0,passive:!1,signal:u}),window.addEventListener("contextmenu",ii,{signal:u}),i.addEventListener("pointermove",E(this,bm,Wv).bind(this,t),{signal:u}),this._freeHighlight=new hy({x:r,y:a},[o,l,h,c],t.scale,this._defaultThickness/2,s,.001),{id:this._freeHighlightId,clipPathId:this._freeHighlightClipId}=t.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:this._defaultColor,"fill-opacity":this._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:this._freeHighlight.toSVGPath()}},!0,!0)}static async deserialize(t,s,i){var g,v,b,A;let r=null;if(t instanceof vv){const{data:{quadPoints:_,rect:x,rotation:k,id:T,color:P,opacity:F,popupRef:R,richText:B,contentsObj:j,creationDate:I,modificationDate:L},parent:{page:{pageNumber:S}}}=t;r=t={annotationType:Et.HIGHLIGHT,color:Array.from(P),opacity:F,quadPoints:_,boxes:null,pageIndex:S-1,rect:x.slice(0),rotation:k,annotationElementId:T,id:T,deleted:!1,popupRef:R,richText:B,comment:(j==null?void 0:j.str)||null,creationDate:I,modificationDate:L}}else if(t instanceof By){const{data:{inkLists:_,rect:x,rotation:k,id:T,color:P,borderStyle:{rawWidth:F},popupRef:R,richText:B,contentsObj:j,creationDate:I,modificationDate:L},parent:{page:{pageNumber:S}}}=t;r=t={annotationType:Et.HIGHLIGHT,color:Array.from(P),thickness:F,inkLists:_,boxes:null,pageIndex:S-1,rect:x.slice(0),rotation:k,annotationElementId:T,id:T,deleted:!1,popupRef:R,richText:B,comment:(j==null?void 0:j.str)||null,creationDate:I,modificationDate:L}}const{color:a,quadPoints:o,inkLists:l,opacity:h}=t,c=await super.deserialize(t,s,i);c.color=ct.makeHexColor(...a),c.opacity=h||1,l&&w(c,ti,t.thickness),c._initialData=r,t.comment&&c.setCommentData(t);const[d,u]=c.pageDimensions,[f,y]=c.pageTranslation;if(o){const _=w(c,On,[]);for(let x=0;x<o.length;x+=8)_.push({x:(o[x]-f)/d,y:1-(o[x+1]-y)/u,width:(o[x+2]-o[x])/d,height:(o[x+1]-o[x+5])/u});E(g=c,ef,cy).call(g),E(v=c,Nn,Zr).call(v),c.rotate(c.rotation)}else if(l){w(c,He,!0);const _=l[0],x={x:_[0]-f,y:u-(_[1]-y)},k=new hy(x,[0,0,d,u],1,n(c,ti)/2,!0,.001);for(let F=0,R=_.length;F<R;F+=2)x.x=_[F]-f,x.y=u-(_[F+1]-y),k.add(x);const{id:T,clipPathId:P}=s.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:c.color,"fill-opacity":c._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:k.toSVGPath()}},!0,!0);E(b=c,Rh,op).call(b,{highlightOutlines:k.getOutlines(),highlightId:T,clipPathId:P}),E(A=c,Nn,Zr).call(A),c.rotate(c.parentRotation)}return c}serialize(t=!1){if(this.isEmpty()||t)return null;if(this.deleted)return this.serializeDeleted();const s=Qt._colorManager.convert(this._uiManager.getNonHCMColor(this.color)),i=super.serialize(t);return Object.assign(i,{color:s,opacity:this.opacity,thickness:n(this,ti),quadPoints:E(this,gm,jv).call(this),outlines:E(this,mm,Vv).call(this,i.rect)}),this.addComment(i),this.annotationElementId&&!E(this,wm,Xv).call(this,i)?null:(i.id=this.annotationElementId,i)}renderAnnotationElement(t){return this.deleted?(t.hide(),null):(t.updateEdited({rect:this.getPDFRect(),popup:this.comment}),null)}static canCreateNewEmptyEditor(){return!1}};Ph=new WeakMap,Ku=new WeakMap,On=new WeakMap,uo=new WeakMap,Zu=new WeakMap,ps=new WeakMap,Ju=new WeakMap,Qu=new WeakMap,fo=new WeakMap,Rs=new WeakMap,Ls=new WeakMap,He=new WeakMap,Dh=new WeakMap,Ih=new WeakMap,Je=new WeakMap,Mh=new WeakMap,ti=new WeakMap,tf=new WeakMap,ef=new WeakSet,cy=function(){const t=new oy(n(this,On),.001);w(this,Rs,t.getOutlines()),[this.x,this.y,this.width,this.height]=n(this,Rs).box;const s=new oy(n(this,On),.0025,.001,this._uiManager.direction==="ltr");w(this,ps,s.getOutlines());const{firstPoint:i}=n(this,Rs);w(this,Dh,[(i[0]-this.x)/this.width,(i[1]-this.y)/this.height]);const{lastPoint:r}=n(this,ps);w(this,Ih,[(r[0]-this.x)/this.width,(r[1]-this.y)/this.height])},Rh=new WeakSet,op=function({highlightOutlines:t,highlightId:s,clipPathId:i}){var u,f;if(w(this,Rs,t),w(this,ps,t.getNewOutline(n(this,ti)/2+1.5,.0025)),s>=0)w(this,Ls,s),w(this,uo,i),this.parent.drawLayer.finalizeDraw(s,{bbox:t.box,path:{d:t.toSVGPath()}}),w(this,Je,this.parent.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:!0},bbox:n(this,ps).box,path:{d:n(this,ps).toSVGPath()}},!0));else if(this.parent){const y=this.parent.viewport.rotation;this.parent.drawLayer.updateProperties(n(this,Ls),{bbox:E(u=Lt,Fr,Vo).call(u,n(this,Rs).box,(y-this.rotation+360)%360),path:{d:t.toSVGPath()}}),this.parent.drawLayer.updateProperties(n(this,Je),{bbox:E(f=Lt,Fr,Vo).call(f,n(this,ps).box,y),path:{d:n(this,ps).toSVGPath()}})}const[a,o,l,h]=t.box;switch(this.rotation){case 0:this.x=a,this.y=o,this.width=l,this.height=h;break;case 90:{const[y,g]=this.parentDimensions;this.x=o,this.y=1-a,this.width=l*g/y,this.height=h*y/g;break}case 180:this.x=1-a,this.y=1-o,this.width=l,this.height=h;break;case 270:{const[y,g]=this.parentDimensions;this.x=1-o,this.y=a,this.width=l*g/y,this.height=h*y/g;break}}const{firstPoint:c}=t;w(this,Dh,[(c[0]-a)/l,(c[1]-o)/h]);const{lastPoint:d}=n(this,ps);w(this,Ih,[(d[0]-a)/l,(d[1]-o)/h])},dm=new WeakSet,Bv=function(t){const s=(a,o)=>{this.color=a,this.opacity=o,this.onUpdatedColor()},i=this.color,r=this.opacity;this.addCommands({cmd:s.bind(this,t,Lt._defaultOpacity),undo:s.bind(this,i,r),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:Mt.HIGHLIGHT_COLOR,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"color_changed",color:this._uiManager.getNonHCMColorName(t)},!0)},um=new WeakSet,zv=function(t){const s=n(this,ti),i=r=>{w(this,ti,r),E(this,fm,Uv).call(this,r)};this.addCommands({cmd:i.bind(this,t),undo:i.bind(this,s),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:Mt.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"thickness_changed",thickness:t},!0)},fm=new WeakSet,Uv=function(t){n(this,He)&&(E(this,Rh,op).call(this,{highlightOutlines:n(this,Rs).getNewOutline(t/2)}),this.fixAndSetPosition(),this.setDims())},sf=new WeakSet,dy=function(){n(this,Ls)===null||!this.parent||(this.parent.drawLayer.remove(n(this,Ls)),w(this,Ls,null),this.parent.drawLayer.remove(n(this,Je)),w(this,Je,null))},Nn=new WeakSet,Zr=function(t=this.parent){n(this,Ls)===null&&({id:Ae(this,Ls)._,clipPathId:Ae(this,uo)._}=t.drawLayer.draw({bbox:n(this,Rs).box,root:{viewBox:"0 0 1 1",fill:this.color,"fill-opacity":this.opacity},rootClass:{highlight:!0,free:n(this,He)},path:{d:n(this,Rs).toSVGPath()}},!1,!0),w(this,Je,t.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:n(this,He)},bbox:n(this,ps).box,path:{d:n(this,ps).toSVGPath()}},n(this,He))),n(this,fo)&&(n(this,fo).style.clipPath=n(this,uo)))},Fr=new WeakSet,Vo=function([t,s,i,r],a){switch(a){case 90:return[1-s-r,t,r,i];case 180:return[1-t-i,1-s-r,i,r];case 270:return[s,1-t-i,r,i]}return[t,s,i,r]},pm=new WeakSet,Hv=function(t){Lt._keyboardManager.exec(this,t)},Lh=new WeakSet,lp=function(t){if(!n(this,Ph))return;const s=window.getSelection();t?s.setPosition(n(this,Ph),n(this,Ku)):s.setPosition(n(this,Ju),n(this,Qu))},Fh=new WeakSet,hp=function(){return n(this,He)?this.rotation:0},gm=new WeakSet,jv=function(){if(n(this,He))return null;const[t,s]=this.pageDimensions,[i,r]=this.pageTranslation,a=n(this,On),o=new Float32Array(a.length*8);let l=0;for(const{x:h,y:c,width:d,height:u}of a){const f=h*t+i,y=(1-c)*s+r;o[l]=o[l+4]=f,o[l+1]=o[l+3]=y,o[l+2]=o[l+6]=f+d*t,o[l+5]=o[l+7]=y-u*s,l+=8}return o},mm=new WeakSet,Vv=function(t){return n(this,Rs).serialize(t,E(this,Fh,hp).call(this))},bm=new WeakSet,Wv=function(t,s){this._freeHighlight.add(s)&&t.drawLayer.updateProperties(this._freeHighlightId,{path:{d:this._freeHighlight.toSVGPath()}})},ym=new WeakSet,Gv=function(t,s){this._freeHighlight.isEmpty()?t.drawLayer.remove(this._freeHighlightId):t.createAndAddNewEditor(s,!1,{highlightId:this._freeHighlightId,highlightOutlines:this._freeHighlight.getOutlines(),clipPathId:this._freeHighlightClipId,methodOfCreation:"main_toolbar"}),this._freeHighlightId=-1,this._freeHighlight=null,this._freeHighlightClipId=""},wm=new WeakSet,Xv=function(t){const{color:s}=this._initialData;return this.hasEditedComment||t.color.some((i,r)=>i!==s[r])},m(Lt,Fr),m(Lt,bm),m(Lt,ym),$(Lt,"_defaultColor",null),$(Lt,"_defaultOpacity",1),$(Lt,"_defaultThickness",12),$(Lt,"_type","highlight"),$(Lt,"_editorType",Et.HIGHLIGHT),$(Lt,"_freeHighlightId",-1),$(Lt,"_freeHighlight",null),$(Lt,"_freeHighlightClipId","");let Dp=Lt;var po;class $v{constructor(){m(this,po,Object.create(null))}updateProperty(e,t){this[e]=t,this.updateSVGProperty(e,t)}updateProperties(e){if(e)for(const[t,s]of Object.entries(e))t.startsWith("_")||this.updateProperty(t,s)}updateSVGProperty(e,t){n(this,po)[e]=t}toSVGProperties(){const e=n(this,po);return w(this,po,Object.create(null)),{root:e}}reset(){w(this,po,Object.create(null))}updateAll(e=this){this.updateProperties(e)}clone(){zt("Not implemented")}}po=new WeakMap;var Fs,Oh,Me,go,mo,nf,uy,rf,fy,af,py,bo,Sc,vm,Yv,Nh,cp,yo,Ec,Or,Wo;const Dt=class Dt extends Qt{constructor(t){super(t);m(this,nf);m(this,rf);m(this,af);m(this,bo);m(this,vm);m(this,Nh);m(this,yo);m(this,Or);m(this,Fs,null);m(this,Oh,void 0);$(this,"_colorPicker",null);$(this,"_drawId",null);w(this,Oh,t.mustBeCommitted||!1),this._addOutlines(t)}onUpdatedColor(){var t;(t=this._colorPicker)==null||t.update(this.color),super.onUpdatedColor()}_addOutlines(t){t.drawOutlines&&(E(this,nf,uy).call(this,t),E(this,bo,Sc).call(this))}static _mergeSVGProperties(t,s){const i=new Set(Object.keys(t));for(const[r,a]of Object.entries(s))i.has(r)?Object.assign(t[r],a):t[r]=a;return t}static getDefaultDrawingOptions(t){zt("Not implemented")}static get typesMap(){zt("Not implemented")}static get isDrawer(){return!0}static get supportMultipleDrawings(){return!1}static updateDefaultParams(t,s){const i=this.typesMap.get(t);i&&this._defaultDrawingOptions.updateProperty(i,s),this._currentParent&&(n(Dt,Me).updateProperty(i,s),this._currentParent.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}updateParams(t,s){const i=this.constructor.typesMap.get(t);i&&this._updateProperty(t,i,s)}static get defaultPropertiesToUpdate(){const t=[],s=this._defaultDrawingOptions;for(const[i,r]of this.typesMap)t.push([i,s[r]]);return t}get propertiesToUpdate(){const t=[],{_drawingOptions:s}=this;for(const[i,r]of this.constructor.typesMap)t.push([i,s[r]]);return t}_updateProperty(t,s,i){const r=this._drawingOptions,a=r[s],o=l=>{var c;r.updateProperty(s,l);const h=n(this,Fs).updateProperty(s,l);h&&E(this,yo,Ec).call(this,h),(c=this.parent)==null||c.drawLayer.updateProperties(this._drawId,r.toSVGProperties()),t===this.colorType&&this.onUpdatedColor()};this.addCommands({cmd:o.bind(this,i),undo:o.bind(this,a),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:t,overwriteIfSameType:!0,keepUndo:!0})}_onResizing(){var t;(t=this.parent)==null||t.drawLayer.updateProperties(this._drawId,Dt._mergeSVGProperties(n(this,Fs).getPathResizingSVGProperties(E(this,Nh,cp).call(this)),{bbox:E(this,Or,Wo).call(this)}))}_onResized(){var t;(t=this.parent)==null||t.drawLayer.updateProperties(this._drawId,Dt._mergeSVGProperties(n(this,Fs).getPathResizedSVGProperties(E(this,Nh,cp).call(this)),{bbox:E(this,Or,Wo).call(this)}))}_onTranslating(t,s){var i;(i=this.parent)==null||i.drawLayer.updateProperties(this._drawId,{bbox:E(this,Or,Wo).call(this)})}_onTranslated(){var t;(t=this.parent)==null||t.drawLayer.updateProperties(this._drawId,Dt._mergeSVGProperties(n(this,Fs).getPathTranslatedSVGProperties(E(this,Nh,cp).call(this),this.parentDimensions),{bbox:E(this,Or,Wo).call(this)}))}_onStartDragging(){var t;(t=this.parent)==null||t.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!0}})}_onStopDragging(){var t;(t=this.parent)==null||t.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!1}})}commit(){super.commit(),this.disableEditMode(),this.disableEditing()}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}getBaseTranslation(){return[0,0]}get isResizable(){return!0}onceAdded(t){this.annotationElementId||this.parent.addUndoableEditor(this),this._isDraggable=!0,n(this,Oh)&&(w(this,Oh,!1),this.commit(),this.parent.setSelected(this),t&&this.isOnScreen&&this.div.focus())}remove(){E(this,af,py).call(this),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(E(this,bo,Sc).call(this),E(this,yo,Ec).call(this,n(this,Fs).box),this.isAttachedToDOM||this.parent.add(this)))}setParent(t){var i;let s=!1;this.parent&&!t?(this._uiManager.removeShouldRescale(this),E(this,af,py).call(this)):t&&(this._uiManager.addShouldRescale(this),E(this,bo,Sc).call(this,t),s=!this.parent&&((i=this.div)==null?void 0:i.classList.contains("selectedEditor"))),super.setParent(t),s&&this.select()}rotate(){this.parent&&this.parent.drawLayer.updateProperties(this._drawId,Dt._mergeSVGProperties({bbox:E(this,Or,Wo).call(this)},n(this,Fs).updateRotation((this.parentRotation-this.rotation+360)%360)))}onScaleChanging(){this.parent&&E(this,yo,Ec).call(this,n(this,Fs).updateParentDimensions(this.parentDimensions,this.parent.scale))}static onScaleChangingWhenDrawing(){}render(){if(this.div)return this.div;let t,s;this._isCopy&&(t=this.x,s=this.y);const i=super.render();i.classList.add("draw");const r=document.createElement("div");return i.append(r),r.setAttribute("aria-hidden","true"),r.className="internal",this.setDims(),this._uiManager.addShouldRescale(this),this.disableEditing(),this._isCopy&&this._moveAfterPaste(t,s),i}static createDrawerInstance(t,s,i,r,a){zt("Not implemented")}static startDrawing(t,s,i,r){var v;const{target:a,offsetX:o,offsetY:l,pointerId:h,pointerType:c}=r;if($e.isInitializedAndDifferentPointerType(c))return;const{viewport:{rotation:d}}=t,{width:u,height:f}=a.getBoundingClientRect(),y=w(Dt,go,new AbortController),g=t.combinedSignal(y);if($e.setPointer(c,h),window.addEventListener("pointerup",b=>{$e.isSamePointerIdOrRemove(b.pointerId)&&this._endDraw(b)},{signal:g}),window.addEventListener("pointercancel",b=>{$e.isSamePointerIdOrRemove(b.pointerId)&&this._currentParent.endDrawingSession()},{signal:g}),window.addEventListener("pointerdown",b=>{$e.isSamePointerType(b.pointerType)&&($e.initializeAndAddPointerId(b.pointerId),n(Dt,Me).isCancellable()&&(n(Dt,Me).removeLastElement(),n(Dt,Me).isEmpty()?this._currentParent.endDrawingSession(!0):this._endDraw(null)))},{capture:!0,passive:!1,signal:g}),window.addEventListener("contextmenu",ii,{signal:g}),a.addEventListener("pointermove",this._drawMove.bind(this),{signal:g}),a.addEventListener("touchmove",b=>{$e.isSameTimeStamp(b.timeStamp)&&ue(b)},{signal:g}),t.toggleDrawing(),(v=s._editorUndoBar)==null||v.hide(),n(Dt,Me)){t.drawLayer.updateProperties(this._currentDrawId,n(Dt,Me).startNew(o,l,u,f,d));return}s.updateUIForDefaultProperties(this),w(Dt,Me,this.createDrawerInstance(o,l,u,f,d)),w(Dt,mo,this.getDefaultDrawingOptions()),this._currentParent=t,{id:this._currentDrawId}=t.drawLayer.draw(this._mergeSVGProperties(n(Dt,mo).toSVGProperties(),n(Dt,Me).defaultSVGProperties),!0,!1)}static _drawMove(t){if($e.isSameTimeStamp(t.timeStamp),!n(Dt,Me))return;const{offsetX:s,offsetY:i,pointerId:r}=t;if($e.isSamePointerId(r)){if($e.isUsingMultiplePointers()){this._endDraw(t);return}this._currentParent.drawLayer.updateProperties(this._currentDrawId,n(Dt,Me).add(s,i)),$e.setTimeStamp(t.timeStamp),ue(t)}}static _cleanup(t){t&&(this._currentDrawId=-1,this._currentParent=null,w(Dt,Me,null),w(Dt,mo,null),$e.clearTimeStamp()),n(Dt,go)&&(n(Dt,go).abort(),w(Dt,go,null),$e.clearPointerIds())}static _endDraw(t){const s=this._currentParent;if(s){if(s.toggleDrawing(!0),this._cleanup(!1),(t==null?void 0:t.target)===s.div&&s.drawLayer.updateProperties(this._currentDrawId,n(Dt,Me).end(t.offsetX,t.offsetY)),this.supportMultipleDrawings){const i=n(Dt,Me),r=this._currentDrawId,a=i.getLastElement();s.addCommands({cmd:()=>{s.drawLayer.updateProperties(r,i.setLastElement(a))},undo:()=>{s.drawLayer.updateProperties(r,i.removeLastElement())},mustExec:!1,type:Mt.DRAW_STEP});return}this.endDrawing(!1)}}static endDrawing(t){const s=this._currentParent;if(!s)return null;if(s.toggleDrawing(!0),s.cleanUndoStack(Mt.DRAW_STEP),!n(Dt,Me).isEmpty()){const{pageDimensions:[i,r],scale:a}=s,o=s.createAndAddNewEditor({offsetX:0,offsetY:0},!1,{drawId:this._currentDrawId,drawOutlines:n(Dt,Me).getOutlines(i*a,r*a,a,this._INNER_MARGIN),drawingOptions:n(Dt,mo),mustBeCommitted:!t});return this._cleanup(!0),o}return s.drawLayer.remove(this._currentDrawId),this._cleanup(!0),null}createDrawingOptions(t){}static deserializeDraw(t,s,i,r,a,o){zt("Not implemented")}static async deserialize(t,s,i){var d,u;const{rawDims:{pageWidth:r,pageHeight:a,pageX:o,pageY:l}}=s.viewport,h=this.deserializeDraw(o,l,r,a,this._INNER_MARGIN,t),c=await super.deserialize(t,s,i);return c.createDrawingOptions(t),E(d=c,nf,uy).call(d,{drawOutlines:h}),E(u=c,bo,Sc).call(u),c.onScaleChanging(),c.rotate(),c}serializeDraw(t){const[s,i]=this.pageTranslation,[r,a]=this.pageDimensions;return n(this,Fs).serialize([s,i,r,a],t)}renderAnnotationElement(t){return t.updateEdited({rect:this.getPDFRect()}),null}static canCreateNewEmptyEditor(){return!1}};Fs=new WeakMap,Oh=new WeakMap,Me=new WeakMap,go=new WeakMap,mo=new WeakMap,nf=new WeakSet,uy=function({drawOutlines:t,drawId:s,drawingOptions:i}){w(this,Fs,t),this._drawingOptions||(this._drawingOptions=i),this.annotationElementId||this._uiManager.a11yAlert(`pdfjs-editor-${this.editorType}-added-alert`),s>=0?(this._drawId=s,this.parent.drawLayer.finalizeDraw(s,t.defaultProperties)):this._drawId=E(this,rf,fy).call(this,t,this.parent),E(this,yo,Ec).call(this,t.box)},rf=new WeakSet,fy=function(t,s){const{id:i}=s.drawLayer.draw(Dt._mergeSVGProperties(this._drawingOptions.toSVGProperties(),t.defaultSVGProperties),!1,!1);return i},af=new WeakSet,py=function(){this._drawId===null||!this.parent||(this.parent.drawLayer.remove(this._drawId),this._drawId=null,this._drawingOptions.reset())},bo=new WeakSet,Sc=function(t=this.parent){if(!(this._drawId!==null&&this.parent===t)){if(this._drawId!==null){this.parent.drawLayer.updateParent(this._drawId,t.drawLayer);return}this._drawingOptions.updateAll(),this._drawId=E(this,rf,fy).call(this,n(this,Fs),t)}},vm=new WeakSet,Yv=function([t,s,i,r]){const{parentDimensions:[a,o],rotation:l}=this;switch(l){case 90:return[s,1-t,i*(o/a),r*(a/o)];case 180:return[1-t,1-s,i,r];case 270:return[1-s,t,i*(o/a),r*(a/o)];default:return[t,s,i,r]}},Nh=new WeakSet,cp=function(){const{x:t,y:s,width:i,height:r,parentDimensions:[a,o],rotation:l}=this;switch(l){case 90:return[1-s,t,i*(a/o),r*(o/a)];case 180:return[1-t,1-s,i,r];case 270:return[s,1-t,i*(a/o),r*(o/a)];default:return[t,s,i,r]}},yo=new WeakSet,Ec=function(t){[this.x,this.y,this.width,this.height]=E(this,vm,Yv).call(this,t),this.div&&(this.fixAndSetPosition(),this.setDims()),this._onResized()},Or=new WeakSet,Wo=function(){const{x:t,y:s,width:i,height:r,rotation:a,parentRotation:o,parentDimensions:[l,h]}=this;switch((a*4+o)/90){case 1:return[1-s-r,t,r,i];case 2:return[1-t-i,1-s-r,i,r];case 3:return[s,1-t-i,r,i];case 4:return[t,s-i*(l/h),r*(h/l),i*(l/h)];case 5:return[1-s,t,i*(l/h),r*(h/l)];case 6:return[1-t-r*(h/l),1-s,r*(h/l),i*(l/h)];case 7:return[s-i*(l/h),1-t-r*(h/l),i*(l/h),r*(h/l)];case 8:return[t-i,s-r,i,r];case 9:return[1-s,t-i,r,i];case 10:return[1-t,1-s,i,r];case 11:return[s-r,1-t,r,i];case 12:return[t-r*(h/l),s,r*(h/l),i*(l/h)];case 13:return[1-s-i*(l/h),t-r*(h/l),i*(l/h),r*(h/l)];case 14:return[1-t,1-s-i*(l/h),r*(h/l),i*(l/h)];case 15:return[s,1-t,i*(l/h),r*(h/l)];default:return[t,s,i,r]}},$(Dt,"_currentDrawId",-1),$(Dt,"_currentParent",null),m(Dt,Me,null),m(Dt,go,null),m(Dt,mo,null),$(Dt,"_INNER_MARGIN",3);let Ip=Dt;var Vi,Re,Le,wo,Bh,ss,je,ei,vo,Ao,_o,zh,dp;class w1{constructor(e,t,s,i,r,a){m(this,zh);m(this,Vi,new Float64Array(6));m(this,Re,void 0);m(this,Le,void 0);m(this,wo,void 0);m(this,Bh,void 0);m(this,ss,void 0);m(this,je,"");m(this,ei,0);m(this,vo,new Ef);m(this,Ao,void 0);m(this,_o,void 0);w(this,Ao,s),w(this,_o,i),w(this,wo,r),w(this,Bh,a),[e,t]=E(this,zh,dp).call(this,e,t);const o=w(this,Re,[NaN,NaN,NaN,NaN,e,t]);w(this,ss,[e,t]),w(this,Le,[{line:o,points:n(this,ss)}]),n(this,Vi).set(o,0)}updateProperty(e,t){e==="stroke-width"&&w(this,Bh,t)}isEmpty(){return!n(this,Le)||n(this,Le).length===0}isCancellable(){return n(this,ss).length<=10}add(e,t){[e,t]=E(this,zh,dp).call(this,e,t);const[s,i,r,a]=n(this,Vi).subarray(2,6),o=e-r,l=t-a;return Math.hypot(n(this,Ao)*o,n(this,_o)*l)<=2?null:(n(this,ss).push(e,t),isNaN(s)?(n(this,Vi).set([r,a,e,t],2),n(this,Re).push(NaN,NaN,NaN,NaN,e,t),{path:{d:this.toSVGPath()}}):(isNaN(n(this,Vi)[0])&&n(this,Re).splice(6,6),n(this,Vi).set([s,i,r,a,e,t],0),n(this,Re).push(...ut.createBezierPoints(s,i,r,a,e,t)),{path:{d:this.toSVGPath()}}))}end(e,t){const s=this.add(e,t);return s||(n(this,ss).length===2?{path:{d:this.toSVGPath()}}:null)}startNew(e,t,s,i,r){w(this,Ao,s),w(this,_o,i),w(this,wo,r),[e,t]=E(this,zh,dp).call(this,e,t);const a=w(this,Re,[NaN,NaN,NaN,NaN,e,t]);w(this,ss,[e,t]);const o=n(this,Le).at(-1);return o&&(o.line=new Float32Array(o.line),o.points=new Float32Array(o.points)),n(this,Le).push({line:a,points:n(this,ss)}),n(this,Vi).set(a,0),w(this,ei,0),this.toSVGPath(),null}getLastElement(){return n(this,Le).at(-1)}setLastElement(e){return n(this,Le)?(n(this,Le).push(e),w(this,Re,e.line),w(this,ss,e.points),w(this,ei,0),{path:{d:this.toSVGPath()}}):n(this,vo).setLastElement(e)}removeLastElement(){if(!n(this,Le))return n(this,vo).removeLastElement();n(this,Le).pop(),w(this,je,"");for(let e=0,t=n(this,Le).length;e<t;e++){const{line:s,points:i}=n(this,Le)[e];w(this,Re,s),w(this,ss,i),w(this,ei,0),this.toSVGPath()}return{path:{d:n(this,je)}}}toSVGPath(){const e=ut.svgRound(n(this,Re)[4]),t=ut.svgRound(n(this,Re)[5]);if(n(this,ss).length===2)return w(this,je,`${n(this,je)} M ${e} ${t} Z`),n(this,je);if(n(this,ss).length<=6){const i=n(this,je).lastIndexOf("M");w(this,je,`${n(this,je).slice(0,i)} M ${e} ${t}`),w(this,ei,6)}if(n(this,ss).length===4){const i=ut.svgRound(n(this,Re)[10]),r=ut.svgRound(n(this,Re)[11]);return w(this,je,`${n(this,je)} L ${i} ${r}`),w(this,ei,12),n(this,je)}const s=[];n(this,ei)===0&&(s.push(`M ${e} ${t}`),w(this,ei,6));for(let i=n(this,ei),r=n(this,Re).length;i<r;i+=6){const[a,o,l,h,c,d]=n(this,Re).slice(i,i+6).map(ut.svgRound);s.push(`C${a} ${o} ${l} ${h} ${c} ${d}`)}return w(this,je,n(this,je)+s.join(" ")),w(this,ei,n(this,Re).length),n(this,je)}getOutlines(e,t,s,i){const r=n(this,Le).at(-1);return r.line=new Float32Array(r.line),r.points=new Float32Array(r.points),n(this,vo).build(n(this,Le),e,t,s,n(this,wo),n(this,Bh),i),w(this,Vi,null),w(this,Re,null),w(this,Le,null),w(this,je,null),n(this,vo)}get defaultSVGProperties(){return{root:{viewBox:"0 0 10000 10000"},rootClass:{draw:!0},bbox:[0,0,1,1]}}}Vi=new WeakMap,Re=new WeakMap,Le=new WeakMap,wo=new WeakMap,Bh=new WeakMap,ss=new WeakMap,je=new WeakMap,ei=new WeakMap,vo=new WeakMap,Ao=new WeakMap,_o=new WeakMap,zh=new WeakSet,dp=function(e,t){return ut._normalizePoint(e,t,n(this,Ao),n(this,_o),n(this,wo))};var is,of,lf,Os,Wi,Gi,Uh,Hh,So,mi,tn,Am,qv,_m,Kv,Sm,Zv;class Ef extends ut{constructor(){super(...arguments);m(this,mi);m(this,Am);m(this,_m);m(this,Sm);m(this,is,void 0);m(this,of,0);m(this,lf,void 0);m(this,Os,void 0);m(this,Wi,void 0);m(this,Gi,void 0);m(this,Uh,void 0);m(this,Hh,void 0);m(this,So,void 0)}build(t,s,i,r,a,o,l){w(this,Wi,s),w(this,Gi,i),w(this,Uh,r),w(this,Hh,a),w(this,So,o),w(this,lf,l??0),w(this,Os,t),E(this,_m,Kv).call(this)}get thickness(){return n(this,So)}setLastElement(t){return n(this,Os).push(t),{path:{d:this.toSVGPath()}}}removeLastElement(){return n(this,Os).pop(),{path:{d:this.toSVGPath()}}}toSVGPath(){const t=[];for(const{line:s}of n(this,Os)){if(t.push(`M${ut.svgRound(s[4])} ${ut.svgRound(s[5])}`),s.length===6){t.push("Z");continue}if(s.length===12&&isNaN(s[6])){t.push(`L${ut.svgRound(s[10])} ${ut.svgRound(s[11])}`);continue}for(let i=6,r=s.length;i<r;i+=6){const[a,o,l,h,c,d]=s.subarray(i,i+6).map(ut.svgRound);t.push(`C${a} ${o} ${l} ${h} ${c} ${d}`)}}return t.join("")}serialize([t,s,i,r],a){const o=[],l=[],[h,c,d,u]=E(this,Am,qv).call(this);let f,y,g,v,b,A,_,x,k;switch(n(this,Hh)){case 0:k=ut._rescale,f=t,y=s+r,g=i,v=-r,b=t+h*i,A=s+(1-c-u)*r,_=t+(h+d)*i,x=s+(1-c)*r;break;case 90:k=ut._rescaleAndSwap,f=t,y=s,g=i,v=r,b=t+c*i,A=s+h*r,_=t+(c+u)*i,x=s+(h+d)*r;break;case 180:k=ut._rescale,f=t+i,y=s,g=-i,v=r,b=t+(1-h-d)*i,A=s+c*r,_=t+(1-h)*i,x=s+(c+u)*r;break;case 270:k=ut._rescaleAndSwap,f=t+i,y=s+r,g=-i,v=-r,b=t+(1-c-u)*i,A=s+(1-h-d)*r,_=t+(1-c)*i,x=s+(1-h)*r;break}for(const{line:T,points:P}of n(this,Os))o.push(k(T,f,y,g,v,a?new Array(T.length):null)),l.push(k(P,f,y,g,v,a?new Array(P.length):null));return{lines:o,points:l,rect:[b,A,_,x]}}static deserialize(t,s,i,r,a,{paths:{lines:o,points:l},rotation:h,thickness:c}){const d=[];let u,f,y,g,v;switch(h){case 0:v=ut._rescale,u=-t/i,f=s/r+1,y=1/i,g=-1/r;break;case 90:v=ut._rescaleAndSwap,u=-s/r,f=-t/i,y=1/r,g=1/i;break;case 180:v=ut._rescale,u=t/i+1,f=-s/r,y=-1/i,g=1/r;break;case 270:v=ut._rescaleAndSwap,u=s/r+1,f=t/i+1,y=-1/r,g=-1/i;break}if(!o){o=[];for(const A of l){const _=A.length;if(_===2){o.push(new Float32Array([NaN,NaN,NaN,NaN,A[0],A[1]]));continue}if(_===4){o.push(new Float32Array([NaN,NaN,NaN,NaN,A[0],A[1],NaN,NaN,NaN,NaN,A[2],A[3]]));continue}const x=new Float32Array(3*(_-2));o.push(x);let[k,T,P,F]=A.subarray(0,4);x.set([NaN,NaN,NaN,NaN,k,T],0);for(let R=4;R<_;R+=2){const B=A[R],j=A[R+1];x.set(ut.createBezierPoints(k,T,P,F,B,j),(R-2)*3),[k,T,P,F]=[P,F,B,j]}}}for(let A=0,_=o.length;A<_;A++)d.push({line:v(o[A].map(x=>x??NaN),u,f,y,g),points:v(l[A].map(x=>x??NaN),u,f,y,g)});const b=new this.prototype.constructor;return b.build(d,i,r,1,h,c,a),b}get box(){return n(this,is)}updateProperty(t,s){return t==="stroke-width"?E(this,Sm,Zv).call(this,s):null}updateParentDimensions([t,s],i){const[r,a]=E(this,mi,tn).call(this);w(this,Wi,t),w(this,Gi,s),w(this,Uh,i);const[o,l]=E(this,mi,tn).call(this),h=o-r,c=l-a,d=n(this,is);return d[0]-=h,d[1]-=c,d[2]+=2*h,d[3]+=2*c,d}updateRotation(t){return w(this,of,t),{path:{transform:this.rotationTransform}}}get viewBox(){return n(this,is).map(ut.svgRound).join(" ")}get defaultProperties(){const[t,s]=n(this,is);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${ut.svgRound(t)} ${ut.svgRound(s)}`}}}get rotationTransform(){const[,,t,s]=n(this,is);let i=0,r=0,a=0,o=0,l=0,h=0;switch(n(this,of)){case 90:r=s/t,a=-t/s,l=t;break;case 180:i=-1,o=-1,l=t,h=s;break;case 270:r=-s/t,a=t/s,h=s;break;default:return""}return`matrix(${i} ${r} ${a} ${o} ${ut.svgRound(l)} ${ut.svgRound(h)})`}getPathResizingSVGProperties([t,s,i,r]){const[a,o]=E(this,mi,tn).call(this),[l,h,c,d]=n(this,is);if(Math.abs(c-a)<=ut.PRECISION||Math.abs(d-o)<=ut.PRECISION){const v=t+i/2-(l+c/2),b=s+r/2-(h+d/2);return{path:{"transform-origin":`${ut.svgRound(t)} ${ut.svgRound(s)}`,transform:`${this.rotationTransform} translate(${v} ${b})`}}}const u=(i-2*a)/(c-2*a),f=(r-2*o)/(d-2*o),y=c/i,g=d/r;return{path:{"transform-origin":`${ut.svgRound(l)} ${ut.svgRound(h)}`,transform:`${this.rotationTransform} scale(${y} ${g}) translate(${ut.svgRound(a)} ${ut.svgRound(o)}) scale(${u} ${f}) translate(${ut.svgRound(-a)} ${ut.svgRound(-o)})`}}}getPathResizedSVGProperties([t,s,i,r]){const[a,o]=E(this,mi,tn).call(this),l=n(this,is),[h,c,d,u]=l;if(l[0]=t,l[1]=s,l[2]=i,l[3]=r,Math.abs(d-a)<=ut.PRECISION||Math.abs(u-o)<=ut.PRECISION){const b=t+i/2-(h+d/2),A=s+r/2-(c+u/2);for(const{line:_,points:x}of n(this,Os))ut._translate(_,b,A,_),ut._translate(x,b,A,x);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${ut.svgRound(t)} ${ut.svgRound(s)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}const f=(i-2*a)/(d-2*a),y=(r-2*o)/(u-2*o),g=-f*(h+a)+t+a,v=-y*(c+o)+s+o;if(f!==1||y!==1||g!==0||v!==0)for(const{line:b,points:A}of n(this,Os))ut._rescale(b,g,v,f,y,b),ut._rescale(A,g,v,f,y,A);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${ut.svgRound(t)} ${ut.svgRound(s)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}getPathTranslatedSVGProperties([t,s],i){const[r,a]=i,o=n(this,is),l=t-o[0],h=s-o[1];if(n(this,Wi)===r&&n(this,Gi)===a)for(const{line:c,points:d}of n(this,Os))ut._translate(c,l,h,c),ut._translate(d,l,h,d);else{const c=n(this,Wi)/r,d=n(this,Gi)/a;w(this,Wi,r),w(this,Gi,a);for(const{line:u,points:f}of n(this,Os))ut._rescale(u,l,h,c,d,u),ut._rescale(f,l,h,c,d,f);o[2]*=c,o[3]*=d}return o[0]=t,o[1]=s,{root:{viewBox:this.viewBox},path:{d:this.toSVGPath(),"transform-origin":`${ut.svgRound(t)} ${ut.svgRound(s)}`}}}get defaultSVGProperties(){const t=n(this,is);return{root:{viewBox:this.viewBox},rootClass:{draw:!0},path:{d:this.toSVGPath(),"transform-origin":`${ut.svgRound(t[0])} ${ut.svgRound(t[1])}`,transform:this.rotationTransform||null},bbox:t}}}is=new WeakMap,of=new WeakMap,lf=new WeakMap,Os=new WeakMap,Wi=new WeakMap,Gi=new WeakMap,Uh=new WeakMap,Hh=new WeakMap,So=new WeakMap,mi=new WeakSet,tn=function(t=n(this,So)){const s=n(this,lf)+t/2*n(this,Uh);return n(this,Hh)%180===0?[s/n(this,Wi),s/n(this,Gi)]:[s/n(this,Gi),s/n(this,Wi)]},Am=new WeakSet,qv=function(){const[t,s,i,r]=n(this,is),[a,o]=E(this,mi,tn).call(this,0);return[t+a,s+o,i-2*a,r-2*o]},_m=new WeakSet,Kv=function(){const t=w(this,is,new Float32Array([1/0,1/0,-1/0,-1/0]));for(const{line:r}of n(this,Os)){if(r.length<=12){for(let l=4,h=r.length;l<h;l+=6)ct.pointBoundingBox(r[l],r[l+1],t);continue}let a=r[4],o=r[5];for(let l=6,h=r.length;l<h;l+=6){const[c,d,u,f,y,g]=r.subarray(l,l+6);ct.bezierBoundingBox(a,o,c,d,u,f,y,g,t),a=y,o=g}}const[s,i]=E(this,mi,tn).call(this);t[0]=Ve(t[0]-s,0,1),t[1]=Ve(t[1]-i,0,1),t[2]=Ve(t[2]+s,0,1),t[3]=Ve(t[3]+i,0,1),t[2]-=t[0],t[3]-=t[1]},Sm=new WeakSet,Zv=function(t){const[s,i]=E(this,mi,tn).call(this);w(this,So,t);const[r,a]=E(this,mi,tn).call(this),[o,l]=[r-s,a-i],h=n(this,is);return h[0]-=o,h[1]-=l,h[2]+=2*o,h[3]+=2*l,h};class Gm extends $v{constructor(e){super(),this._viewParameters=e,super.updateProperties({fill:"none",stroke:Qt._defaultLineColor,"stroke-opacity":1,"stroke-width":1,"stroke-linecap":"round","stroke-linejoin":"round","stroke-miterlimit":10})}updateSVGProperty(e,t){e==="stroke-width"&&(t??(t=this["stroke-width"]),t*=this._viewParameters.realScale),super.updateSVGProperty(e,t)}clone(){const e=new Gm(this._viewParameters);return e.updateAll(this),e}}var Em,Jv;const Ko=class Ko extends Ip{constructor(t){super({...t,name:"inkEditor"});m(this,Em);this._willKeepAspectRatio=!0,this.defaultL10nId="pdfjs-editor-ink-editor"}static initialize(t,s){Qt.initialize(t,s),this._defaultDrawingOptions=new Gm(s.viewParameters)}static getDefaultDrawingOptions(t){const s=this._defaultDrawingOptions.clone();return s.updateProperties(t),s}static get supportMultipleDrawings(){return!0}static get typesMap(){return _t(this,"typesMap",new Map([[Mt.INK_THICKNESS,"stroke-width"],[Mt.INK_COLOR,"stroke"],[Mt.INK_OPACITY,"stroke-opacity"]]))}static createDrawerInstance(t,s,i,r,a){return new w1(t,s,i,r,a,this._defaultDrawingOptions["stroke-width"])}static deserializeDraw(t,s,i,r,a,o){return Ef.deserialize(t,s,i,r,a,o)}static async deserialize(t,s,i){let r=null;if(t instanceof By){const{data:{inkLists:o,rect:l,rotation:h,id:c,color:d,opacity:u,borderStyle:{rawWidth:f},popupRef:y,richText:g,contentsObj:v,creationDate:b,modificationDate:A},parent:{page:{pageNumber:_}}}=t;r=t={annotationType:Et.INK,color:Array.from(d),thickness:f,opacity:u,paths:{points:o},boxes:null,pageIndex:_-1,rect:l.slice(0),rotation:h,annotationElementId:c,id:c,deleted:!1,popupRef:y,richText:g,comment:(v==null?void 0:v.str)||null,creationDate:b,modificationDate:A}}const a=await super.deserialize(t,s,i);return a._initialData=r,t.comment&&a.setCommentData(t),a}get toolbarButtons(){return this._colorPicker||(this._colorPicker=new kp(this)),[["colorPicker",this._colorPicker]]}get colorType(){return Mt.INK_COLOR}get color(){return this._drawingOptions.stroke}get opacity(){return this._drawingOptions["stroke-opacity"]}onScaleChanging(){if(!this.parent)return;super.onScaleChanging();const{_drawId:t,_drawingOptions:s,parent:i}=this;s.updateSVGProperty("stroke-width"),i.drawLayer.updateProperties(t,s.toSVGProperties())}static onScaleChangingWhenDrawing(){const t=this._currentParent;t&&(super.onScaleChangingWhenDrawing(),this._defaultDrawingOptions.updateSVGProperty("stroke-width"),t.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}createDrawingOptions({color:t,thickness:s,opacity:i}){this._drawingOptions=Ko.getDefaultDrawingOptions({stroke:ct.makeHexColor(...t),"stroke-width":s,"stroke-opacity":i})}serialize(t=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const{lines:s,points:i}=this.serializeDraw(t),{_drawingOptions:{stroke:r,"stroke-opacity":a,"stroke-width":o}}=this,l=Object.assign(super.serialize(t),{color:Qt._colorManager.convert(r),opacity:a,thickness:o,paths:{lines:s,points:i}});return this.addComment(l),t?(l.isCopy=!0,l):this.annotationElementId&&!E(this,Em,Jv).call(this,l)?null:(l.id=this.annotationElementId,l)}renderAnnotationElement(t){if(this.deleted)return t.hide(),null;const{points:s,rect:i}=this.serializeDraw(!1);return t.updateEdited({rect:i,thickness:this._drawingOptions["stroke-width"],points:s,popup:this.comment}),null}};Em=new WeakSet,Jv=function(t){const{color:s,thickness:i,opacity:r,pageIndex:a}=this._initialData;return this.hasEditedComment||this._hasBeenMoved||this._hasBeenResized||t.color.some((o,l)=>o!==s[l])||t.thickness!==i||t.opacity!==r||t.pageIndex!==a},$(Ko,"_type","ink"),$(Ko,"_editorType",Et.INK),$(Ko,"_defaultDrawingOptions",null);let gy=Ko;class my extends Ef{toSVGPath(){let e=super.toSVGPath();return e.endsWith("Z")||(e+="Z"),e}}const Ff=8,rc=3;var Eo,hf,by,bi,Cm,Qv,xm,tA,cf,yy,jh,up,km,eA,Tm,sA,Pm,iA,df,wy,uf,vy,Dm,nA;class Ce{static extractContoursFromText(e,{fontFamily:t,fontStyle:s,fontWeight:i},r,a,o,l){let h=new OffscreenCanvas(1,1),c=h.getContext("2d",{alpha:!1});const d=200,u=c.font=`${s} ${i} ${d}px ${t}`,{actualBoundingBoxLeft:f,actualBoundingBoxRight:y,actualBoundingBoxAscent:g,actualBoundingBoxDescent:v,fontBoundingBoxAscent:b,fontBoundingBoxDescent:A,width:_}=c.measureText(e),x=1.5,k=Math.ceil(Math.max(Math.abs(f)+Math.abs(y)||0,_)*x),T=Math.ceil(Math.max(Math.abs(g)+Math.abs(v)||d,Math.abs(b)+Math.abs(A)||d)*x);h=new OffscreenCanvas(k,T),c=h.getContext("2d",{alpha:!0,willReadFrequently:!0}),c.font=u,c.filter="grayscale(1)",c.fillStyle="white",c.fillRect(0,0,k,T),c.fillStyle="black",c.fillText(e,k*(x-1)/2,T*(3-x)/2);const P=E(this,df,wy).call(this,c.getImageData(0,0,k,T).data),F=E(this,Pm,iA).call(this,P),R=E(this,uf,vy).call(this,F),B=E(this,cf,yy).call(this,P,k,T,R);return this.processDrawnLines({lines:{curves:B,width:k,height:T},pageWidth:r,pageHeight:a,rotation:o,innerMargin:l,mustSmooth:!0,areContours:!0})}static process(e,t,s,i,r){const[a,o,l]=E(this,Dm,nA).call(this,e),[h,c]=E(this,Tm,sA).call(this,a,o,l,Math.hypot(o,l)*n(this,Eo).sigmaSFactor,n(this,Eo).sigmaR,n(this,Eo).kernelSize),d=E(this,uf,vy).call(this,c),u=E(this,cf,yy).call(this,h,o,l,d);return this.processDrawnLines({lines:{curves:u,width:o,height:l},pageWidth:t,pageHeight:s,rotation:i,innerMargin:r,mustSmooth:!0,areContours:!0})}static processDrawnLines({lines:e,pageWidth:t,pageHeight:s,rotation:i,innerMargin:r,mustSmooth:a,areContours:o}){i%180!==0&&([t,s]=[s,t]);const{curves:l,width:h,height:c}=e,d=e.thickness??0,u=[],f=Math.min(t/h,s/c),y=f/t,g=f/s,v=[];for(const{points:A}of l){const _=a?E(this,km,eA).call(this,A):A;if(!_)continue;v.push(_);const x=_.length,k=new Float32Array(x),T=new Float32Array(3*(x===2?2:x-2));if(u.push({line:T,points:k}),x===2){k[0]=_[0]*y,k[1]=_[1]*g,T.set([NaN,NaN,NaN,NaN,k[0],k[1]],0);continue}let[P,F,R,B]=_;P*=y,F*=g,R*=y,B*=g,k.set([P,F,R,B],0),T.set([NaN,NaN,NaN,NaN,P,F],0);for(let j=4;j<x;j+=2){const I=k[j]=_[j]*y,L=k[j+1]=_[j+1]*g;T.set(ut.createBezierPoints(P,F,R,B,I,L),(j-2)*3),[P,F,R,B]=[R,B,I,L]}}if(u.length===0)return null;const b=o?new my:new Ef;return b.build(u,t,s,1,i,o?0:d,r),{outline:b,newCurves:v,areContours:o,thickness:d,width:h,height:c}}static async compressSignature({outlines:e,areContours:t,thickness:s,width:i,height:r}){let a=1/0,o=-1/0,l=0;for(const _ of e){l+=_.length;for(let x=2,k=_.length;x<k;x++){const T=_[x]-_[x-2];a=Math.min(a,T),o=Math.max(o,T)}}let h;a>=-128&&o<=127?h=Int8Array:a>=-32768&&o<=32767?h=Int16Array:h=Int32Array;const c=e.length,d=Ff+rc*c,u=new Uint32Array(d);let f=0;u[f++]=d*Uint32Array.BYTES_PER_ELEMENT+(l-2*c)*h.BYTES_PER_ELEMENT,u[f++]=0,u[f++]=i,u[f++]=r,u[f++]=t?0:1,u[f++]=Math.max(0,Math.floor(s??0)),u[f++]=c,u[f++]=h.BYTES_PER_ELEMENT;for(const _ of e)u[f++]=_.length-2,u[f++]=_[0],u[f++]=_[1];const y=new CompressionStream("deflate-raw"),g=y.writable.getWriter();await g.ready,g.write(u);const v=h.prototype.constructor;for(const _ of e){const x=new v(_.length-2);for(let k=2,T=_.length;k<T;k++)x[k-2]=_[k]-_[k-2];g.write(x)}g.close();const b=await new Response(y.readable).arrayBuffer();return new Uint8Array(b).toBase64()}static async decompressSignature(e){try{const t=Uint8Array.fromBase64(e),{readable:s,writable:i}=new DecompressionStream("deflate-raw"),r=i.getWriter();await r.ready,r.write(t).then(async()=>{await r.ready,await r.close()}).catch(()=>{});let a=null,o=0;for await(const _ of s)a||(a=new Uint8Array(new Uint32Array(_.buffer,0,4)[0])),a.set(_,o),o+=_.length;const l=new Uint32Array(a.buffer,0,a.length>>2),h=l[1];if(h!==0)throw new Error(`Invalid version: ${h}`);const c=l[2],d=l[3],u=l[4]===0,f=l[5],y=l[6],g=l[7],v=[],b=(Ff+rc*y)*Uint32Array.BYTES_PER_ELEMENT;let A;switch(g){case Int8Array.BYTES_PER_ELEMENT:A=new Int8Array(a.buffer,b);break;case Int16Array.BYTES_PER_ELEMENT:A=new Int16Array(a.buffer,b);break;case Int32Array.BYTES_PER_ELEMENT:A=new Int32Array(a.buffer,b);break}o=0;for(let _=0;_<y;_++){const x=l[rc*_+Ff],k=new Float32Array(x+2);v.push(k);for(let T=0;T<rc-1;T++)k[T]=l[rc*_+Ff+T+1];for(let T=0;T<x;T++)k[T+2]=k[T]+A[o++]}return{areContours:u,thickness:f,outlines:v,width:c,height:d}}catch(t){return At(`decompressSignature: ${t}`),null}}}Eo=new WeakMap,hf=new WeakSet,by=function(e,t,s,i){return s-=e,i-=t,s===0?i>0?0:4:s===1?i+6:2-i},bi=new WeakMap,Cm=new WeakSet,Qv=function(e,t,s,i,r,a,o){const l=E(this,hf,by).call(this,s,i,r,a);for(let h=0;h<8;h++){const c=(-h+l-o+16)%8,d=n(this,bi)[2*c],u=n(this,bi)[2*c+1];if(e[(s+d)*t+(i+u)]!==0)return c}return-1},xm=new WeakSet,tA=function(e,t,s,i,r,a,o){const l=E(this,hf,by).call(this,s,i,r,a);for(let h=0;h<8;h++){const c=(h+l+o+16)%8,d=n(this,bi)[2*c],u=n(this,bi)[2*c+1];if(e[(s+d)*t+(i+u)]!==0)return c}return-1},cf=new WeakSet,yy=function(e,t,s,i){const r=e.length,a=new Int32Array(r);for(let c=0;c<r;c++)a[c]=e[c]<=i?1:0;for(let c=1;c<s-1;c++)a[c*t]=a[c*t+t-1]=0;for(let c=0;c<t;c++)a[c]=a[t*s-1-c]=0;let o=1,l;const h=[];for(let c=1;c<s-1;c++){l=1;for(let d=1;d<t-1;d++){const u=c*t+d,f=a[u];if(f===0)continue;let y=c,g=d;if(f===1&&a[u-1]===0)o+=1,g-=1;else if(f>=1&&a[u+1]===0)o+=1,g+=1,f>1&&(l=f);else{f!==1&&(l=Math.abs(f));continue}const v=[d,c],b=g===d+1,A={isHole:b,points:v,id:o,parent:0};h.push(A);let _;for(const j of h)if(j.id===l){_=j;break}_?_.isHole?A.parent=b?_.parent:l:A.parent=b?l:_.parent:A.parent=b?l:0;const x=E(this,Cm,Qv).call(this,a,t,c,d,y,g,0);if(x===-1){a[u]=-o,a[u]!==1&&(l=Math.abs(a[u]));continue}let k=n(this,bi)[2*x],T=n(this,bi)[2*x+1];const P=c+k,F=d+T;y=P,g=F;let R=c,B=d;for(;;){const j=E(this,xm,tA).call(this,a,t,R,B,y,g,1);k=n(this,bi)[2*j],T=n(this,bi)[2*j+1];const I=R+k,L=B+T;v.push(L,I);const S=R*t+B;if(a[S+1]===0?a[S]=-o:a[S]===1&&(a[S]=o),I===c&&L===d&&R===P&&B===F){a[u]!==1&&(l=Math.abs(a[u]));break}else y=R,g=B,R=I,B=L}}}return h},jh=new WeakSet,up=function(e,t,s,i){if(s-t<=4){for(let P=t;P<s-2;P+=2)i.push(e[P],e[P+1]);return}const r=e[t],a=e[t+1],o=e[s-4]-r,l=e[s-3]-a,h=Math.hypot(o,l),c=o/h,d=l/h,u=c*a-d*r,f=l/o,y=1/h,g=Math.atan(f),v=Math.cos(g),b=Math.sin(g),A=y*(Math.abs(v)+Math.abs(b)),_=y*(1-A+A**2),x=Math.max(Math.atan(Math.abs(b+v)*_),Math.atan(Math.abs(b-v)*_));let k=0,T=t;for(let P=t+2;P<s-2;P+=2){const F=Math.abs(u-c*e[P+1]+d*e[P]);F>k&&(T=P,k=F)}k>(h*x)**2?(E(this,jh,up).call(this,e,t,T+2,i),E(this,jh,up).call(this,e,T,s,i)):i.push(r,a)},km=new WeakSet,eA=function(e){const t=[],s=e.length;return E(this,jh,up).call(this,e,0,s,t),t.push(e[s-2],e[s-1]),t.length<=4?null:t},Tm=new WeakSet,sA=function(e,t,s,i,r,a){const o=new Float32Array(a**2),l=-2*i**2,h=a>>1;for(let g=0;g<a;g++){const v=(g-h)**2;for(let b=0;b<a;b++)o[g*a+b]=Math.exp((v+(b-h)**2)/l)}const c=new Float32Array(256),d=-2*r**2;for(let g=0;g<256;g++)c[g]=Math.exp(g**2/d);const u=e.length,f=new Uint8Array(u),y=new Uint32Array(256);for(let g=0;g<s;g++)for(let v=0;v<t;v++){const b=g*t+v,A=e[b];let _=0,x=0;for(let T=0;T<a;T++){const P=g+T-h;if(!(P<0||P>=s))for(let F=0;F<a;F++){const R=v+F-h;if(R<0||R>=t)continue;const B=e[P*t+R],j=o[T*a+F]*c[Math.abs(B-A)];_+=B*j,x+=j}}const k=f[b]=Math.round(_/x);y[k]++}return[f,y]},Pm=new WeakSet,iA=function(e){const t=new Uint32Array(256);for(const s of e)t[s]++;return t},df=new WeakSet,wy=function(e){const t=e.length,s=new Uint8ClampedArray(t>>2);let i=-1/0,r=1/0;for(let o=0,l=s.length;o<l;o++){const h=s[o]=e[o<<2];i=Math.max(i,h),r=Math.min(r,h)}const a=255/(i-r);for(let o=0,l=s.length;o<l;o++)s[o]=(s[o]-r)*a;return s},uf=new WeakSet,vy=function(e){let t,s=-1/0,i=-1/0;const r=e.findIndex(l=>l!==0);let a=r,o=r;for(t=r;t<256;t++){const l=e[t];l>s&&(t-a>i&&(i=t-a,o=t-1),s=l,a=t)}for(t=o-1;t>=0&&!(e[t]>e[t+1]);t--);return t},Dm=new WeakSet,nA=function(e){const t=e,{width:s,height:i}=e,{maxDim:r}=n(this,Eo);let a=s,o=i;if(s>r||i>r){let u=s,f=i,y=Math.log2(Math.max(s,i)/r);const g=Math.floor(y);y=y===g?g-1:g;for(let b=0;b<y;b++){a=Math.ceil(u/2),o=Math.ceil(f/2);const A=new OffscreenCanvas(a,o);A.getContext("2d").drawImage(e,0,0,u,f,0,0,a,o),u=a,f=o,e!==t&&e.close(),e=A.transferToImageBitmap()}const v=Math.min(r/a,r/o);a=Math.round(a*v),o=Math.round(o*v)}const h=new OffscreenCanvas(a,o).getContext("2d",{willReadFrequently:!0});h.fillStyle="white",h.fillRect(0,0,a,o),h.filter="grayscale(1)",h.drawImage(e,0,0,e.width,e.height,0,0,a,o);const c=h.getImageData(0,0,a,o).data;return[E(this,df,wy).call(this,c),a,o]},m(Ce,hf),m(Ce,Cm),m(Ce,xm),m(Ce,cf),m(Ce,jh),m(Ce,km),m(Ce,Tm),m(Ce,Pm),m(Ce,df),m(Ce,uf),m(Ce,Dm),m(Ce,Eo,{maxDim:512,sigmaSFactor:.02,sigmaR:25,kernelSize:16}),m(Ce,bi,new Int32Array([0,1,-1,1,-1,0,-1,-1,0,-1,1,-1,1,0,1,1]));class zy extends $v{constructor(){super(),super.updateProperties({fill:Qt._defaultLineColor,"stroke-width":0})}clone(){const e=new zy;return e.updateAll(this),e}}class Uy extends Gm{constructor(e){super(e),super.updateProperties({stroke:Qt._defaultLineColor,"stroke-width":1})}clone(){const e=new Uy(this._viewParameters);return e.updateAll(this),e}}var Nr,Xi,Br,Co;const bs=class bs extends Ip{constructor(t){super({...t,mustBeCommitted:!0,name:"signatureEditor"});m(this,Nr,!1);m(this,Xi,null);m(this,Br,null);m(this,Co,null);this._willKeepAspectRatio=!0,w(this,Br,t.signatureData||null),w(this,Xi,null),this.defaultL10nId="pdfjs-editor-signature-editor1"}static initialize(t,s){Qt.initialize(t,s),this._defaultDrawingOptions=new zy,this._defaultDrawnSignatureOptions=new Uy(s.viewParameters)}static getDefaultDrawingOptions(t){const s=this._defaultDrawingOptions.clone();return s.updateProperties(t),s}static get supportMultipleDrawings(){return!1}static get typesMap(){return _t(this,"typesMap",new Map)}static get isDrawer(){return!1}get telemetryFinalData(){return{type:"signature",hasDescription:!!n(this,Xi)}}static computeTelemetryFinalData(t){const s=t.get("hasDescription");return{hasAltText:s.get(!0)??0,hasNoAltText:s.get(!1)??0}}get isResizable(){return!0}onScaleChanging(){this._drawId!==null&&super.onScaleChanging()}render(){if(this.div)return this.div;let t,s;const{_isCopy:i}=this;if(i&&(this._isCopy=!1,t=this.x,s=this.y),super.render(),this._drawId===null)if(n(this,Br)){const{lines:r,mustSmooth:a,areContours:o,description:l,uuid:h,heightInPage:c}=n(this,Br),{rawDims:{pageWidth:d,pageHeight:u},rotation:f}=this.parent.viewport,y=Ce.processDrawnLines({lines:r,pageWidth:d,pageHeight:u,rotation:f,innerMargin:bs._INNER_MARGIN,mustSmooth:a,areContours:o});this.addSignature(y,c,l,h)}else this.div.setAttribute("data-l10n-args",JSON.stringify({description:""})),this.div.hidden=!0,this._uiManager.getSignature(this);else this.div.setAttribute("data-l10n-args",JSON.stringify({description:n(this,Xi)||""}));return i&&(this._isCopy=!0,this._moveAfterPaste(t,s)),this.div}setUuid(t){w(this,Co,t),this.addEditToolbar()}getUuid(){return n(this,Co)}get description(){return n(this,Xi)}set description(t){w(this,Xi,t),this.div&&(this.div.setAttribute("data-l10n-args",JSON.stringify({description:t})),super.addEditToolbar().then(s=>{s==null||s.updateEditSignatureButton(t)}))}getSignaturePreview(){const{newCurves:t,areContours:s,thickness:i,width:r,height:a}=n(this,Br),o=Math.max(r,a),l=Ce.processDrawnLines({lines:{curves:t.map(h=>({points:h})),thickness:i,width:r,height:a},pageWidth:o,pageHeight:o,rotation:0,innerMargin:0,mustSmooth:!1,areContours:s});return{areContours:s,outline:l.outline}}get toolbarButtons(){return this._uiManager.signatureManager?[["editSignature",this._uiManager.signatureManager]]:super.toolbarButtons}addSignature(t,s,i,r){const{x:a,y:o}=this,{outline:l}=w(this,Br,t);w(this,Nr,l instanceof my),this.description=i;let h;n(this,Nr)?h=bs.getDefaultDrawingOptions():(h=bs._defaultDrawnSignatureOptions.clone(),h.updateProperties({"stroke-width":l.thickness})),this._addOutlines({drawOutlines:l,drawingOptions:h});const[,c]=this.pageDimensions;let d=s/c;d=d>=1?.5:d,this.width*=d/this.height,this.width>=1&&(d*=.9/this.width,this.width=.9),this.height=d,this.setDims(),this.x=a,this.y=o,this.center(),this._onResized(),this.onScaleChanging(),this.rotate(),this._uiManager.addToAnnotationStorage(this),this.setUuid(r),this._reportTelemetry({action:"pdfjs.signature.inserted",data:{hasBeenSaved:!!r,hasDescription:!!i}}),this.div.hidden=!1}getFromImage(t){const{rawDims:{pageWidth:s,pageHeight:i},rotation:r}=this.parent.viewport;return Ce.process(t,s,i,r,bs._INNER_MARGIN)}getFromText(t,s){const{rawDims:{pageWidth:i,pageHeight:r},rotation:a}=this.parent.viewport;return Ce.extractContoursFromText(t,s,i,r,a,bs._INNER_MARGIN)}getDrawnSignature(t){const{rawDims:{pageWidth:s,pageHeight:i},rotation:r}=this.parent.viewport;return Ce.processDrawnLines({lines:t,pageWidth:s,pageHeight:i,rotation:r,innerMargin:bs._INNER_MARGIN,mustSmooth:!1,areContours:!1})}createDrawingOptions({areContours:t,thickness:s}){t?this._drawingOptions=bs.getDefaultDrawingOptions():(this._drawingOptions=bs._defaultDrawnSignatureOptions.clone(),this._drawingOptions.updateProperties({"stroke-width":s}))}serialize(t=!1){if(this.isEmpty())return null;const{lines:s,points:i}=this.serializeDraw(t),{_drawingOptions:{"stroke-width":r}}=this,a=Object.assign(super.serialize(t),{isSignature:!0,areContours:n(this,Nr),color:[0,0,0],thickness:n(this,Nr)?0:r});return this.addComment(a),t?(a.paths={lines:s,points:i},a.uuid=n(this,Co),a.isCopy=!0):a.lines=s,n(this,Xi)&&(a.accessibilityData={type:"Figure",alt:n(this,Xi)}),a}static deserializeDraw(t,s,i,r,a,o){return o.areContours?my.deserialize(t,s,i,r,a,o):Ef.deserialize(t,s,i,r,a,o)}static async deserialize(t,s,i){var a;const r=await super.deserialize(t,s,i);return w(r,Nr,t.areContours),r.description=((a=t.accessibilityData)==null?void 0:a.alt)||"",w(r,Co,t.uuid),r}};Nr=new WeakMap,Xi=new WeakMap,Br=new WeakMap,Co=new WeakMap,$(bs,"_type","signature"),$(bs,"_editorType",Et.SIGNATURE),$(bs,"_defaultDrawingOptions",null);let Ay=bs;var ie,Fe,zr,Bn,Ur,Vh,zn,xo,$i,Ns,Wh,ko,Cc,To,xc,Gh,fp,Xh,pp,$h,gp,ff,Sy,Yh,mp,Im,rA;class _y extends Qt{constructor(t){super({...t,name:"stampEditor"});m(this,ko);m(this,To);m(this,Gh);m(this,Xh);m(this,$h);m(this,ff);m(this,Yh);m(this,Im);m(this,ie,null);m(this,Fe,null);m(this,zr,null);m(this,Bn,null);m(this,Ur,null);m(this,Vh,"");m(this,zn,null);m(this,xo,!1);m(this,$i,null);m(this,Ns,!1);m(this,Wh,!1);w(this,Bn,t.bitmapUrl),w(this,Ur,t.bitmapFile),this.defaultL10nId="pdfjs-editor-stamp-editor"}static initialize(t,s){Qt.initialize(t,s)}static isHandlingMimeForPasting(t){return rb.includes(t)}static paste(t,s){s.pasteEditor({mode:Et.STAMP},{bitmapFile:t.getAsFile()})}altTextFinish(){this._uiManager.useNewAltTextFlow&&(this.div.hidden=!1),super.altTextFinish()}get telemetryFinalData(){var t;return{type:"stamp",hasAltText:!!((t=this.altTextData)!=null&&t.altText)}}static computeTelemetryFinalData(t){const s=t.get("hasAltText");return{hasAltText:s.get(!0)??0,hasNoAltText:s.get(!1)??0}}async mlGuessAltText(t=null,s=!0){if(this.hasAltTextData())return null;const{mlManager:i}=this._uiManager;if(!i)throw new Error("No ML.");if(!await i.isEnabledFor("altText"))throw new Error("ML isn't enabled for alt text.");const{data:r,width:a,height:o}=t||this.copyCanvas(null,null,!0).imageData,l=await i.guess({name:"altText",request:{data:r,width:a,height:o,channels:r.length/(a*o)}});if(!l)throw new Error("No response from the AI service.");if(l.error)throw new Error("Error from the AI service.");if(l.cancel)return null;if(!l.output)throw new Error("No valid response from the AI service.");const h=l.output;return await this.setGuessedAltText(h),s&&!this.hasAltTextData()&&(this.altTextData={alt:h,decorative:!1}),h}remove(){var t;n(this,Fe)&&(w(this,ie,null),this._uiManager.imageManager.deleteId(n(this,Fe)),(t=n(this,zn))==null||t.remove(),w(this,zn,null),n(this,$i)&&(clearTimeout(n(this,$i)),w(this,$i,null))),super.remove()}rebuild(){if(!this.parent){n(this,Fe)&&E(this,Gh,fp).call(this);return}super.rebuild(),this.div!==null&&(n(this,Fe)&&n(this,zn)===null&&E(this,Gh,fp).call(this),this.isAttachedToDOM||this.parent.add(this))}onceAdded(t){this._isDraggable=!0,t&&this.div.focus()}isEmpty(){return!(n(this,zr)||n(this,ie)||n(this,Bn)||n(this,Ur)||n(this,Fe)||n(this,xo))}get toolbarButtons(){return[["altText",this.createAltText()]]}get isResizable(){return!0}render(){if(this.div)return this.div;let t,s;return this._isCopy&&(t=this.x,s=this.y),super.render(),this.div.hidden=!0,this.createAltText(),n(this,xo)||(n(this,ie)?E(this,Xh,pp).call(this):E(this,Gh,fp).call(this)),this._isCopy&&this._moveAfterPaste(t,s),this._uiManager.addShouldRescale(this),this.div}setCanvas(t,s){const{id:i,bitmap:r}=this._uiManager.imageManager.getFromCanvas(t,s);s.remove(),i&&this._uiManager.imageManager.isValidId(i)&&(w(this,Fe,i),r&&w(this,ie,r),w(this,xo,!1),E(this,Xh,pp).call(this))}_onResized(){this.onScaleChanging()}onScaleChanging(){if(!this.parent)return;n(this,$i)!==null&&clearTimeout(n(this,$i)),w(this,$i,setTimeout(()=>{w(this,$i,null),E(this,ff,Sy).call(this)},200))}copyCanvas(t,s,i=!1){t||(t=224);const{width:r,height:a}=n(this,ie),o=new Ki;let l=n(this,ie),h=r,c=a,d=null;if(s){if(r>s||a>s){const P=Math.min(s/r,s/a);h=Math.floor(r*P),c=Math.floor(a*P)}d=document.createElement("canvas");const f=d.width=Math.ceil(h*o.sx),y=d.height=Math.ceil(c*o.sy);n(this,Ns)||(l=E(this,$h,gp).call(this,f,y));const g=d.getContext("2d");g.filter=this._uiManager.hcmFilter;let v="white",b="#cfcfd8";this._uiManager.hcmFilter!=="none"?b="black":jA.isDarkMode&&(v="#8f8f9d",b="#42414d");const A=15,_=A*o.sx,x=A*o.sy,k=new OffscreenCanvas(_*2,x*2),T=k.getContext("2d");T.fillStyle=v,T.fillRect(0,0,_*2,x*2),T.fillStyle=b,T.fillRect(0,0,_,x),T.fillRect(_,x,_,x),g.fillStyle=g.createPattern(k,"repeat"),g.fillRect(0,0,f,y),g.drawImage(l,0,0,l.width,l.height,0,0,f,y)}let u=null;if(i){let f,y;if(o.symmetric&&l.width<t&&l.height<t)f=l.width,y=l.height;else if(l=n(this,ie),r>t||a>t){const b=Math.min(t/r,t/a);f=Math.floor(r*b),y=Math.floor(a*b),n(this,Ns)||(l=E(this,$h,gp).call(this,f,y))}const v=new OffscreenCanvas(f,y).getContext("2d",{willReadFrequently:!0});v.drawImage(l,0,0,l.width,l.height,0,0,f,y),u={width:f,height:y,data:v.getImageData(0,0,f,y).data}}return{canvas:d,width:h,height:c,imageData:u}}static async deserialize(t,s,i){var v;let r=null,a=!1;if(t instanceof Av){const{data:{rect:b,rotation:A,id:_,structParent:x,popupRef:k,richText:T,contentsObj:P,creationDate:F,modificationDate:R},container:B,parent:{page:{pageNumber:j}},canvas:I}=t;let L,S;I?(delete t.canvas,{id:L,bitmap:S}=i.imageManager.getFromCanvas(B.id,I),I.remove()):(a=!0,t._hasNoCanvas=!0);const N=((v=await s._structTree.getAriaAttributes(`${Go}${_}`))==null?void 0:v.get("aria-label"))||"";r=t={annotationType:Et.STAMP,bitmapId:L,bitmap:S,pageIndex:j-1,rect:b.slice(0),rotation:A,annotationElementId:_,id:_,deleted:!1,accessibilityData:{decorative:!1,altText:N},isSvg:!1,structParent:x,popupRef:k,richText:T,comment:(P==null?void 0:P.str)||null,creationDate:F,modificationDate:R}}const o=await super.deserialize(t,s,i),{rect:l,bitmap:h,bitmapUrl:c,bitmapId:d,isSvg:u,accessibilityData:f}=t;a?(i.addMissingCanvas(t.id,o),w(o,xo,!0)):d&&i.imageManager.isValidId(d)?(w(o,Fe,d),h&&w(o,ie,h)):w(o,Bn,c),w(o,Ns,u);const[y,g]=o.pageDimensions;return o.width=(l[2]-l[0])/y,o.height=(l[3]-l[1])/g,f&&(o.altTextData=f),o._initialData=r,t.comment&&o.setCommentData(t),w(o,Wh,!!r),o}serialize(t=!1,s=null){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const i=Object.assign(super.serialize(t),{bitmapId:n(this,Fe),isSvg:n(this,Ns)});if(this.addComment(i),t)return i.bitmapUrl=E(this,Yh,mp).call(this,!0),i.accessibilityData=this.serializeAltText(!0),i.isCopy=!0,i;const{decorative:r,altText:a}=this.serializeAltText(!1);if(!r&&a&&(i.accessibilityData={type:"Figure",alt:a}),this.annotationElementId){const l=E(this,Im,rA).call(this,i);return l.isSame?null:(l.isSameAltText?delete i.accessibilityData:i.accessibilityData.structParent=this._initialData.structParent??-1,i.id=this.annotationElementId,delete i.bitmapId,i)}if(s===null)return i;s.stamps||(s.stamps=new Map);const o=n(this,Ns)?(i.rect[2]-i.rect[0])*(i.rect[3]-i.rect[1]):null;if(!s.stamps.has(n(this,Fe)))s.stamps.set(n(this,Fe),{area:o,serialized:i}),i.bitmap=E(this,Yh,mp).call(this,!1);else if(n(this,Ns)){const l=s.stamps.get(n(this,Fe));o>l.area&&(l.area=o,l.serialized.bitmap.close(),l.serialized.bitmap=E(this,Yh,mp).call(this,!1))}return i}renderAnnotationElement(t){return this.deleted?(t.hide(),null):(t.updateEdited({rect:this.getPDFRect(),popup:this.comment}),null)}}ie=new WeakMap,Fe=new WeakMap,zr=new WeakMap,Bn=new WeakMap,Ur=new WeakMap,Vh=new WeakMap,zn=new WeakMap,xo=new WeakMap,$i=new WeakMap,Ns=new WeakMap,Wh=new WeakMap,ko=new WeakSet,Cc=function(t,s=!1){if(!t){this.remove();return}w(this,ie,t.bitmap),s||(w(this,Fe,t.id),w(this,Ns,t.isSvg)),t.file&&w(this,Vh,t.file.name),E(this,Xh,pp).call(this)},To=new WeakSet,xc=function(){if(w(this,zr,null),this._uiManager.enableWaiting(!1),!!n(this,zn)){if(this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&n(this,ie)){this.addEditToolbar().then(()=>{this._editToolbar.hide(),this._uiManager.editAltText(this,!0)});return}if(!this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&n(this,ie)){this._reportTelemetry({action:"pdfjs.image.image_added",data:{alt_text_modal:!1,alt_text_type:"empty"}});try{this.mlGuessAltText()}catch{}}this.div.focus()}},Gh=new WeakSet,fp=function(){if(n(this,Fe)){this._uiManager.enableWaiting(!0),this._uiManager.imageManager.getFromId(n(this,Fe)).then(i=>E(this,ko,Cc).call(this,i,!0)).finally(()=>E(this,To,xc).call(this));return}if(n(this,Bn)){const i=n(this,Bn);w(this,Bn,null),this._uiManager.enableWaiting(!0),w(this,zr,this._uiManager.imageManager.getFromUrl(i).then(r=>E(this,ko,Cc).call(this,r)).finally(()=>E(this,To,xc).call(this)));return}if(n(this,Ur)){const i=n(this,Ur);w(this,Ur,null),this._uiManager.enableWaiting(!0),w(this,zr,this._uiManager.imageManager.getFromFile(i).then(r=>E(this,ko,Cc).call(this,r)).finally(()=>E(this,To,xc).call(this)));return}const t=document.createElement("input");t.type="file",t.accept=rb.join(",");const s=this._uiManager._signal;w(this,zr,new Promise(i=>{t.addEventListener("change",async()=>{if(!t.files||t.files.length===0)this.remove();else{this._uiManager.enableWaiting(!0);const r=await this._uiManager.imageManager.getFromFile(t.files[0]);this._reportTelemetry({action:"pdfjs.image.image_selected",data:{alt_text_modal:this._uiManager.useNewAltTextFlow}}),E(this,ko,Cc).call(this,r)}i()},{signal:s}),t.addEventListener("cancel",()=>{this.remove(),i()},{signal:s})}).finally(()=>E(this,To,xc).call(this))),t.click()},Xh=new WeakSet,pp=function(){var h;const{div:t}=this;let{width:s,height:i}=n(this,ie);const[r,a]=this.pageDimensions,o=.75;if(this.width)s=this.width*r,i=this.height*a;else if(s>o*r||i>o*a){const c=Math.min(o*r/s,o*a/i);s*=c,i*=c}this._uiManager.enableWaiting(!1);const l=w(this,zn,document.createElement("canvas"));l.setAttribute("role","img"),this.addContainer(l),this.width=s/r,this.height=i/a,this.setDims(),(h=this._initialOptions)!=null&&h.isCentered?this.center():this.fixAndSetPosition(),this._initialOptions=null,(!this._uiManager.useNewAltTextWhenAddingImage||!this._uiManager.useNewAltTextFlow||this.annotationElementId)&&(t.hidden=!1),E(this,ff,Sy).call(this),n(this,Wh)||(this.parent.addUndoableEditor(this),w(this,Wh,!0)),this._reportTelemetry({action:"inserted_image"}),n(this,Vh)&&this.div.setAttribute("aria-description",n(this,Vh)),this.annotationElementId||this._uiManager.a11yAlert("pdfjs-editor-stamp-added-alert")},$h=new WeakSet,gp=function(t,s){const{width:i,height:r}=n(this,ie);let a=i,o=r,l=n(this,ie);for(;a>2*t||o>2*s;){const h=a,c=o;a>2*t&&(a=a>=16384?Math.floor(a/2)-1:Math.ceil(a/2)),o>2*s&&(o=o>=16384?Math.floor(o/2)-1:Math.ceil(o/2));const d=new OffscreenCanvas(a,o);d.getContext("2d").drawImage(l,0,0,h,c,0,0,a,o),l=d.transferToImageBitmap()}return l},ff=new WeakSet,Sy=function(){const[t,s]=this.parentDimensions,{width:i,height:r}=this,a=new Ki,o=Math.ceil(i*t*a.sx),l=Math.ceil(r*s*a.sy),h=n(this,zn);if(!h||h.width===o&&h.height===l)return;h.width=o,h.height=l;const c=n(this,Ns)?n(this,ie):E(this,$h,gp).call(this,o,l),d=h.getContext("2d");d.filter=this._uiManager.hcmFilter,d.drawImage(c,0,0,c.width,c.height,0,0,o,l)},Yh=new WeakSet,mp=function(t){if(t){if(n(this,Ns)){const r=this._uiManager.imageManager.getSvgUrl(n(this,Fe));if(r)return r}const s=document.createElement("canvas");return{width:s.width,height:s.height}=n(this,ie),s.getContext("2d").drawImage(n(this,ie),0,0),s.toDataURL()}if(n(this,Ns)){const[s,i]=this.pageDimensions,r=Math.round(this.width*s*$r.PDF_TO_CSS_UNITS),a=Math.round(this.height*i*$r.PDF_TO_CSS_UNITS),o=new OffscreenCanvas(r,a);return o.getContext("2d").drawImage(n(this,ie),0,0,n(this,ie).width,n(this,ie).height,0,0,r,a),o.transferToImageBitmap()}return structuredClone(n(this,ie))},Im=new WeakSet,rA=function(t){var o;const{pageIndex:s,accessibilityData:{altText:i}}=this._initialData,r=t.pageIndex===s,a=(((o=t.accessibilityData)==null?void 0:o.alt)||"")===i;return{isSame:!this.hasEditedComment&&!this._hasBeenMoved&&!this._hasBeenResized&&r&&a,isSameAltText:a}},$(_y,"_type","stamp"),$(_y,"_editorType",Et.STAMP);var Po,qh,Hr,jr,Un,gs,Vr,Kh,Zh,yi,Hn,Oe,jn,Wr,Jh,gt,Gr,pf,Cy,Mm,aA,si,Ei,gf,xy,mf,ky,Qh,bp;const ri=class ri{constructor({uiManager:e,pageIndex:t,div:s,structTreeLayer:i,accessibilityManager:r,annotationLayer:a,drawLayer:o,textLayer:l,viewport:h,l10n:c}){m(this,pf);m(this,Mm);m(this,si);m(this,gf);m(this,mf);m(this,Qh);m(this,Po,void 0);m(this,qh,!1);m(this,Hr,null);m(this,jr,null);m(this,Un,null);m(this,gs,new Map);m(this,Vr,!1);m(this,Kh,!1);m(this,Zh,!1);m(this,yi,null);m(this,Hn,null);m(this,Oe,null);m(this,jn,null);m(this,Wr,null);m(this,Jh,-1);m(this,gt,void 0);const d=[...n(ri,Gr).values()];if(!ri._initialized){ri._initialized=!0;for(const u of d)u.initialize(c,e)}e.registerEditorTypes(d),w(this,gt,e),this.pageIndex=t,this.div=s,w(this,Po,r),w(this,Hr,a),this.viewport=h,w(this,Oe,l),this.drawLayer=o,this._structTree=i,n(this,gt).addLayer(this)}updatePageIndex(e){this.pageIndex=e}get isEmpty(){return n(this,gs).size===0}get isInvisible(){return this.isEmpty&&n(this,gt).getMode()===Et.NONE}updateToolbar(e){n(this,gt).updateToolbar(e)}updateMode(e=n(this,gt).getMode()){switch(E(this,Qh,bp).call(this),e){case Et.NONE:this.div.classList.toggle("nonEditing",!0),this.disableTextSelection(),this.togglePointerEvents(!1),this.toggleAnnotationLayerPointerEvents(!0),this.disableClick();return;case Et.INK:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick();break;case Et.HIGHLIGHT:this.enableTextSelection(),this.togglePointerEvents(!1),this.disableClick();break;default:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick()}this.toggleAnnotationLayerPointerEvents(!1);const{classList:t}=this.div;if(t.toggle("nonEditing",!1),e===Et.POPUP)t.toggle("commentEditing",!0);else{t.toggle("commentEditing",!1);for(const s of n(ri,Gr).values())t.toggle(`${s._type}Editing`,e===s._editorType)}this.div.hidden=!1}hasTextLayer(e){var t;return e===((t=n(this,Oe))==null?void 0:t.div)}setEditingState(e){n(this,gt).setEditingState(e)}addCommands(e){n(this,gt).addCommands(e)}cleanUndoStack(e){n(this,gt).cleanUndoStack(e)}toggleDrawing(e=!1){this.div.classList.toggle("drawing",!e)}togglePointerEvents(e=!1){this.div.classList.toggle("disabled",!e)}toggleAnnotationLayerPointerEvents(e=!1){var t;(t=n(this,Hr))==null||t.togglePointerEvents(e)}async enable(){var s;w(this,Zh,!0),this.div.tabIndex=0,this.togglePointerEvents(!0),this.div.classList.toggle("nonEditing",!1),(s=n(this,Wr))==null||s.abort(),w(this,Wr,null);const e=new Set;for(const i of n(this,pf,Cy))i.enableEditing(),i.show(!0),i.annotationElementId&&(n(this,gt).removeChangedExistingAnnotation(i),e.add(i.annotationElementId));const t=n(this,Hr);if(t)for(const i of t.getEditableAnnotations()){if(i.hide(),n(this,gt).isDeletedAnnotationElement(i.data.id)||e.has(i.data.id))continue;const r=await this.deserialize(i);r&&(this.addOrRebuild(r),r.enableEditing())}w(this,Zh,!1),n(this,gt)._eventBus.dispatch("editorsrendered",{source:this,pageNumber:this.pageIndex+1})}disable(){var i;if(w(this,Kh,!0),this.div.tabIndex=-1,this.togglePointerEvents(!1),this.div.classList.toggle("nonEditing",!0),n(this,Oe)&&!n(this,Wr)){w(this,Wr,new AbortController);const r=n(this,gt).combinedSignal(n(this,Wr));n(this,Oe).div.addEventListener("pointerdown",a=>{const{clientX:l,clientY:h,timeStamp:c}=a,d=n(this,Jh);if(c-d>500){w(this,Jh,c);return}w(this,Jh,-1);const{classList:u}=this.div;u.toggle("getElements",!0);const f=document.elementsFromPoint(l,h);if(u.toggle("getElements",!1),!this.div.contains(f[0]))return;let y;const g=new RegExp(`^${kc}[0-9]+$`);for(const b of f)if(g.test(b.id)){y=b.id;break}if(!y)return;const v=n(this,gs).get(y);(v==null?void 0:v.annotationElementId)===null&&(a.stopPropagation(),a.preventDefault(),v.dblclick(a))},{signal:r,capture:!0})}const e=n(this,Hr),t=[];if(e){const r=new Map,a=new Map;for(const l of n(this,pf,Cy)){if(l.disableEditing(),!l.annotationElementId){t.push(l);continue}if(l.serialize()!==null){r.set(l.annotationElementId,l);continue}else a.set(l.annotationElementId,l);(i=this.getEditableAnnotation(l.annotationElementId))==null||i.show(),l.remove()}const o=e.getEditableAnnotations();for(const l of o){const{id:h}=l.data;if(n(this,gt).isDeletedAnnotationElement(h)){l.updateEdited({deleted:!0});continue}let c=a.get(h);if(c){c.resetAnnotationElement(l),c.show(!1),l.show();continue}c=r.get(h),c&&(n(this,gt).addChangedExistingAnnotation(c),c.renderAnnotationElement(l)&&c.show(!1)),l.show()}}E(this,Qh,bp).call(this),this.isEmpty&&(this.div.hidden=!0);const{classList:s}=this.div;for(const r of n(ri,Gr).values())s.remove(`${r._type}Editing`);this.disableTextSelection(),this.toggleAnnotationLayerPointerEvents(!0),e==null||e.updateFakeAnnotations(t),w(this,Kh,!1)}getEditableAnnotation(e){var t;return((t=n(this,Hr))==null?void 0:t.getEditableAnnotation(e))||null}setActiveEditor(e){n(this,gt).getActive()!==e&&n(this,gt).setActiveEditor(e)}enableTextSelection(){var e;if(this.div.tabIndex=-1,(e=n(this,Oe))!=null&&e.div&&!n(this,jn)){w(this,jn,new AbortController);const t=n(this,gt).combinedSignal(n(this,jn));n(this,Oe).div.addEventListener("pointerdown",E(this,Mm,aA).bind(this),{signal:t}),n(this,Oe).div.classList.add("highlighting")}}disableTextSelection(){var e;this.div.tabIndex=0,(e=n(this,Oe))!=null&&e.div&&n(this,jn)&&(n(this,jn).abort(),w(this,jn,null),n(this,Oe).div.classList.remove("highlighting"))}enableClick(){if(n(this,jr))return;w(this,jr,new AbortController);const e=n(this,gt).combinedSignal(n(this,jr));this.div.addEventListener("pointerdown",this.pointerdown.bind(this),{signal:e});const t=this.pointerup.bind(this);this.div.addEventListener("pointerup",t,{signal:e}),this.div.addEventListener("pointercancel",t,{signal:e})}disableClick(){var e;(e=n(this,jr))==null||e.abort(),w(this,jr,null)}attach(e){n(this,gs).set(e.id,e);const{annotationElementId:t}=e;t&&n(this,gt).isDeletedAnnotationElement(t)&&n(this,gt).removeDeletedAnnotationElement(e)}detach(e){var t;n(this,gs).delete(e.id),(t=n(this,Po))==null||t.removePointerInTextLayer(e.contentDiv),!n(this,Kh)&&e.annotationElementId&&n(this,gt).addDeletedAnnotationElement(e)}remove(e){this.detach(e),n(this,gt).removeEditor(e),e.div.remove(),e.isAttachedToDOM=!1}changeParent(e){var t;e.parent!==this&&(e.parent&&e.annotationElementId&&(n(this,gt).addDeletedAnnotationElement(e),Qt.deleteAnnotationElement(e),e.annotationElementId=null),this.attach(e),(t=e.parent)==null||t.detach(e),e.setParent(this),e.div&&e.isAttachedToDOM&&(e.div.remove(),this.div.append(e.div)))}add(e){if(!(e.parent===this&&e.isAttachedToDOM)){if(this.changeParent(e),n(this,gt).addEditor(e),this.attach(e),!e.isAttachedToDOM){const t=e.render();this.div.append(t),e.isAttachedToDOM=!0}e.fixAndSetPosition(),e.onceAdded(!n(this,Zh)),n(this,gt).addToAnnotationStorage(e),e._reportTelemetry(e.telemetryInitialData)}}moveEditorInDOM(e){var s;if(!e.isAttachedToDOM)return;const{activeElement:t}=document;e.div.contains(t)&&!n(this,Un)&&(e._focusEventsAllowed=!1,w(this,Un,setTimeout(()=>{w(this,Un,null),e.div.contains(document.activeElement)?e._focusEventsAllowed=!0:(e.div.addEventListener("focusin",()=>{e._focusEventsAllowed=!0},{once:!0,signal:n(this,gt)._signal}),t.focus())},0))),e._structTreeParentId=(s=n(this,Po))==null?void 0:s.moveElementInDOM(this.div,e.div,e.contentDiv,!0)}addOrRebuild(e){e.needsToBeRebuilt()?(e.parent||(e.parent=this),e.rebuild(),e.show()):this.add(e)}addUndoableEditor(e){const t=()=>e._uiManager.rebuild(e),s=()=>{e.remove()};this.addCommands({cmd:t,undo:s,mustExec:!1})}getEditorByUID(e){for(const t of n(this,gs).values())if(t.uid===e)return t;return null}getNextId(){return n(this,gt).getId()}combinedSignal(e){return n(this,gt).combinedSignal(e)}canCreateNewEmptyEditor(){var e;return(e=n(this,si,Ei))==null?void 0:e.canCreateNewEmptyEditor()}async pasteEditor(e,t){this.updateToolbar(e),await n(this,gt).updateMode(e.mode);const{offsetX:s,offsetY:i}=E(this,mf,ky).call(this),r=this.getNextId(),a=E(this,gf,xy).call(this,{parent:this,id:r,x:s,y:i,uiManager:n(this,gt),isCentered:!0,...t});a&&this.add(a)}async deserialize(e){var t;return await((t=n(ri,Gr).get(e.annotationType??e.annotationEditorType))==null?void 0:t.deserialize(e,this,n(this,gt)))||null}createAndAddNewEditor(e,t,s={}){const i=this.getNextId(),r=E(this,gf,xy).call(this,{parent:this,id:i,x:e.offsetX,y:e.offsetY,uiManager:n(this,gt),isCentered:t,...s});return r&&this.add(r),r}get boundingClientRect(){return this.div.getBoundingClientRect()}addNewEditor(e={}){this.createAndAddNewEditor(E(this,mf,ky).call(this),!0,e)}setSelected(e){n(this,gt).setSelected(e)}toggleSelected(e){n(this,gt).toggleSelected(e)}unselect(e){n(this,gt).unselect(e)}pointerup(e){var i;const{isMac:t}=Te.platform;if(e.button!==0||e.ctrlKey&&t||e.target!==this.div||!n(this,Vr)||(w(this,Vr,!1),(i=n(this,si,Ei))!=null&&i.isDrawer&&n(this,si,Ei).supportMultipleDrawings))return;if(!n(this,qh)){w(this,qh,!0);return}const s=n(this,gt).getMode();if(s===Et.STAMP||s===Et.SIGNATURE){n(this,gt).unselectAll();return}this.createAndAddNewEditor(e,!1)}pointerdown(e){var i;if(n(this,gt).getMode()===Et.HIGHLIGHT&&this.enableTextSelection(),n(this,Vr)){w(this,Vr,!1);return}const{isMac:t}=Te.platform;if(e.button!==0||e.ctrlKey&&t||e.target!==this.div)return;if(w(this,Vr,!0),(i=n(this,si,Ei))!=null&&i.isDrawer){this.startDrawingSession(e);return}const s=n(this,gt).getActive();w(this,qh,!s||s.isEmpty())}startDrawingSession(e){if(this.div.focus({preventScroll:!0}),n(this,yi)){n(this,si,Ei).startDrawing(this,n(this,gt),!1,e);return}n(this,gt).setCurrentDrawingSession(this),w(this,yi,new AbortController);const t=n(this,gt).combinedSignal(n(this,yi));this.div.addEventListener("blur",({relatedTarget:s})=>{s&&!this.div.contains(s)&&(w(this,Hn,null),this.commitOrRemove())},{signal:t}),n(this,si,Ei).startDrawing(this,n(this,gt),!1,e)}pause(e){if(e){const{activeElement:t}=document;this.div.contains(t)&&w(this,Hn,t);return}n(this,Hn)&&setTimeout(()=>{var t;(t=n(this,Hn))==null||t.focus(),w(this,Hn,null)},0)}endDrawingSession(e=!1){return n(this,yi)?(n(this,gt).setCurrentDrawingSession(null),n(this,yi).abort(),w(this,yi,null),w(this,Hn,null),n(this,si,Ei).endDrawing(e)):null}findNewParent(e,t,s){const i=n(this,gt).findParent(t,s);return i===null||i===this?!1:(i.changeParent(e),!0)}commitOrRemove(){return n(this,yi)?(this.endDrawingSession(),!0):!1}onScaleChanging(){n(this,yi)&&n(this,si,Ei).onScaleChangingWhenDrawing(this)}destroy(){var e,t;this.commitOrRemove(),((e=n(this,gt).getActive())==null?void 0:e.parent)===this&&(n(this,gt).commitOrRemove(),n(this,gt).setActiveEditor(null)),n(this,Un)&&(clearTimeout(n(this,Un)),w(this,Un,null));for(const s of n(this,gs).values())(t=n(this,Po))==null||t.removePointerInTextLayer(s.contentDiv),s.setParent(null),s.isAttachedToDOM=!1,s.div.remove();this.div=null,n(this,gs).clear(),n(this,gt).removeLayer(this)}render({viewport:e}){this.viewport=e,Io(this.div,e);for(const t of n(this,gt).getEditors(this.pageIndex))this.add(t),t.rebuild();this.updateMode()}update({viewport:e}){n(this,gt).commitOrRemove(),E(this,Qh,bp).call(this);const t=this.viewport.rotation,s=e.rotation;if(this.viewport=e,Io(this.div,{rotation:s}),t!==s)for(const i of n(this,gs).values())i.rotate(s)}get pageDimensions(){const{pageWidth:e,pageHeight:t}=this.viewport.rawDims;return[e,t]}get scale(){return n(this,gt).viewParameters.realScale}};Po=new WeakMap,qh=new WeakMap,Hr=new WeakMap,jr=new WeakMap,Un=new WeakMap,gs=new WeakMap,Vr=new WeakMap,Kh=new WeakMap,Zh=new WeakMap,yi=new WeakMap,Hn=new WeakMap,Oe=new WeakMap,jn=new WeakMap,Wr=new WeakMap,Jh=new WeakMap,gt=new WeakMap,Gr=new WeakMap,pf=new WeakSet,Cy=function(){return n(this,gs).size!==0?n(this,gs).values():n(this,gt).getEditors(this.pageIndex)},Mm=new WeakSet,aA=function(e){n(this,gt).unselectAll();const{target:t}=e;if(t===n(this,Oe).div||(t.getAttribute("role")==="img"||t.classList.contains("endOfContent"))&&n(this,Oe).div.contains(t)){const{isMac:s}=Te.platform;if(e.button!==0||e.ctrlKey&&s)return;n(this,gt).showAllEditors("highlight",!0,!0),n(this,Oe).div.classList.add("free"),this.toggleDrawing(),Dp.startHighlighting(this,n(this,gt).direction==="ltr",{target:n(this,Oe).div,x:e.x,y:e.y}),n(this,Oe).div.addEventListener("pointerup",()=>{n(this,Oe).div.classList.remove("free"),this.toggleDrawing(!0)},{once:!0,signal:n(this,gt)._signal}),e.preventDefault()}},si=new WeakSet,Ei=function(){return n(ri,Gr).get(n(this,gt).getMode())},gf=new WeakSet,xy=function(e){const t=n(this,si,Ei);return t?new t.prototype.constructor(e):null},mf=new WeakSet,ky=function(){const{x:e,y:t,width:s,height:i}=this.boundingClientRect,r=Math.max(0,e),a=Math.max(0,t),o=Math.min(window.innerWidth,e+s),l=Math.min(window.innerHeight,t+i),h=(r+o)/2-e,c=(a+l)/2-t,[d,u]=this.viewport.rotation%180===0?[h,c]:[c,h];return{offsetX:d,offsetY:u}},Qh=new WeakSet,bp=function(){for(const e of n(this,gs).values())e.isEmpty()&&e.remove()},$(ri,"_initialized",!1),m(ri,Gr,new Map([ry,gy,_y,Dp,Ay].map(e=>[e._editorType,e])));let Ey=ri;var wi,ns,Do,bf,Rm,oA,yf,Py,Lm,lA,wf,Dy;const Se=class Se{constructor(){m(this,yf);m(this,Lm);m(this,wf);m(this,wi,null);m(this,ns,new Map);m(this,Do,new Map)}setParent(e){if(!n(this,wi)){w(this,wi,e);return}if(n(this,wi)!==e){if(n(this,ns).size>0)for(const t of n(this,ns).values())t.remove(),e.append(t);w(this,wi,e)}}static get _svgFactory(){return _t(this,"_svgFactory",new Tp)}draw(e,t=!1,s=!1){const i=Ae(Se,bf)._++,r=E(this,yf,Py).call(this),a=Se._svgFactory.createElement("defs");r.append(a);const o=Se._svgFactory.createElement("path");a.append(o);const l=`path_${i}`;o.setAttribute("id",l),o.setAttribute("vector-effect","non-scaling-stroke"),t&&n(this,Do).set(i,o);const h=s?E(this,Lm,lA).call(this,a,l):null,c=Se._svgFactory.createElement("use");return r.append(c),c.setAttribute("href",`#${l}`),this.updateProperties(r,e),n(this,ns).set(i,r),{id:i,clipPathId:`url(#${h})`}}drawOutline(e,t){const s=Ae(Se,bf)._++,i=E(this,yf,Py).call(this),r=Se._svgFactory.createElement("defs");i.append(r);const a=Se._svgFactory.createElement("path");r.append(a);const o=`path_${s}`;a.setAttribute("id",o),a.setAttribute("vector-effect","non-scaling-stroke");let l;if(t){const d=Se._svgFactory.createElement("mask");r.append(d),l=`mask_${s}`,d.setAttribute("id",l),d.setAttribute("maskUnits","objectBoundingBox");const u=Se._svgFactory.createElement("rect");d.append(u),u.setAttribute("width","1"),u.setAttribute("height","1"),u.setAttribute("fill","white");const f=Se._svgFactory.createElement("use");d.append(f),f.setAttribute("href",`#${o}`),f.setAttribute("stroke","none"),f.setAttribute("fill","black"),f.setAttribute("fill-rule","nonzero"),f.classList.add("mask")}const h=Se._svgFactory.createElement("use");i.append(h),h.setAttribute("href",`#${o}`),l&&h.setAttribute("mask",`url(#${l})`);const c=h.cloneNode();return i.append(c),h.classList.add("mainOutline"),c.classList.add("secondaryOutline"),this.updateProperties(i,e),n(this,ns).set(s,i),s}finalizeDraw(e,t){n(this,Do).delete(e),this.updateProperties(e,t)}updateProperties(e,t){var l;if(!t)return;const{root:s,bbox:i,rootClass:r,path:a}=t,o=typeof e=="number"?n(this,ns).get(e):e;if(o){if(s&&E(this,wf,Dy).call(this,o,s),i&&E(l=Se,Rm,oA).call(l,o,i),r){const{classList:h}=o;for(const[c,d]of Object.entries(r))h.toggle(c,d)}if(a){const c=o.firstElementChild.firstElementChild;E(this,wf,Dy).call(this,c,a)}}}updateParent(e,t){if(t===this)return;const s=n(this,ns).get(e);s&&(n(t,wi).append(s),n(this,ns).delete(e),n(t,ns).set(e,s))}remove(e){n(this,Do).delete(e),n(this,wi)!==null&&(n(this,ns).get(e).remove(),n(this,ns).delete(e))}destroy(){w(this,wi,null);for(const e of n(this,ns).values())e.remove();n(this,ns).clear(),n(this,Do).clear()}};wi=new WeakMap,ns=new WeakMap,Do=new WeakMap,bf=new WeakMap,Rm=new WeakSet,oA=function(e,[t,s,i,r]){const{style:a}=e;a.top=`${100*s}%`,a.left=`${100*t}%`,a.width=`${100*i}%`,a.height=`${100*r}%`},yf=new WeakSet,Py=function(){const e=Se._svgFactory.create(1,1,!0);return n(this,wi).append(e),e.setAttribute("aria-hidden",!0),e},Lm=new WeakSet,lA=function(e,t){const s=Se._svgFactory.createElement("clipPath");e.append(s);const i=`clip_${t}`;s.setAttribute("id",i),s.setAttribute("clipPathUnits","objectBoundingBox");const r=Se._svgFactory.createElement("use");return s.append(r),r.setAttribute("href",`#${t}`),r.classList.add("clip"),i},wf=new WeakSet,Dy=function(e,t){for(const[s,i]of Object.entries(t))i===null?e.removeAttribute(s):e.setAttribute(s,i)},m(Se,Rm),m(Se,bf,0);let Ty=Se;globalThis._pdfjsTestingUtils={HighlightOutliner:oy};globalThis.pdfjsLib={AbortException:Xr,AnnotationEditorLayer:Ey,AnnotationEditorParamsType:Mt,AnnotationEditorType:Et,AnnotationEditorUIManager:Mo,AnnotationLayer:iy,AnnotationMode:Gn,AnnotationType:be,applyOpacity:WA,build:K_,ColorPicker:xp,createValidAbsoluteUrl:z0,CSSConstants:VA,DOMSVGFactory:Tp,DrawLayer:Ty,FeatureTest:Te,fetchData:vf,findContrastColor:GA,getDocument:nv,getFilenameFromUrl:NA,getPdfFilenameFromUrl:BA,getRGB:_f,getUuid:H0,getXfaPageViewport:UA,GlobalWorkerOptions:qi,ImageKind:Nf,InvalidPDFException:ib,isDataScheme:zm,isPdfFile:Ry,isValidExplicitDest:s_,MathClamp:Ve,noContextMenu:ii,normalizeUnicode:FA,OPS:Tc,OutputScale:Ki,PagesMapper:Dc,PasswordResponses:CA,PDFDataRangeTransport:rv,PDFDateString:vp,PDFWorker:Mc,PermissionFlag:EA,PixelsPerInch:$r,RenderingCancelledException:My,renderRichText:V0,ResponseException:wp,setLayerDimensions:Io,shadow:_t,SignatureExtractor:Ce,stopEvent:ue,SupportedImageMimeTypes:rb,TextLayer:Ic,TouchManager:_p,updateUrlHash:U0,Util:ct,VerbosityLevel:Fm,version:hv,XfaLayer:j0};qi.workerSrc=`https://cdnjs.cloudflare.com/ajax/libs/pdf.js/${hv}/pdf.worker.min.js`;async function v1(p){try{const e=await p.arrayBuffer(),t=await nv({data:e}).promise;let s="";for(let i=1;i<=t.numPages;i++){const o=(await(await t.getPage(i)).getTextContent()).items.map(l=>l.str).join(" ");s+=o+`

`}return s.trim()}catch(e){throw console.error("Error extracting PDF text:",e),new Error("Failed to extract text from PDF. Please try a different file.")}}function A1(p){return p.type==="application/pdf"||p.name.toLowerCase().endsWith(".pdf")}function Of(p){throw new Error('Could not dynamically require "'+p+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var hA={exports:{}};/*!

JSZip v3.10.1 - A JavaScript class for generating and reading zip files
<http://stuartk.com/jszip>

(c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>
Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/main/LICENSE.markdown.

JSZip uses the library pako released under the MIT license :
https://github.com/nodeca/pako/blob/main/LICENSE
*/(function(p,e){(function(t){p.exports=t()})(function(){return function t(s,i,r){function a(h,c){if(!i[h]){if(!s[h]){var d=typeof Of=="function"&&Of;if(!c&&d)return d(h,!0);if(o)return o(h,!0);var u=new Error("Cannot find module '"+h+"'");throw u.code="MODULE_NOT_FOUND",u}var f=i[h]={exports:{}};s[h][0].call(f.exports,function(y){var g=s[h][1][y];return a(g||y)},f,f.exports,t,s,i,r)}return i[h].exports}for(var o=typeof Of=="function"&&Of,l=0;l<r.length;l++)a(r[l]);return a}({1:[function(t,s,i){var r=t("./utils"),a=t("./support"),o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";i.encode=function(l){for(var h,c,d,u,f,y,g,v=[],b=0,A=l.length,_=A,x=r.getTypeOf(l)!=="string";b<l.length;)_=A-b,d=x?(h=l[b++],c=b<A?l[b++]:0,b<A?l[b++]:0):(h=l.charCodeAt(b++),c=b<A?l.charCodeAt(b++):0,b<A?l.charCodeAt(b++):0),u=h>>2,f=(3&h)<<4|c>>4,y=1<_?(15&c)<<2|d>>6:64,g=2<_?63&d:64,v.push(o.charAt(u)+o.charAt(f)+o.charAt(y)+o.charAt(g));return v.join("")},i.decode=function(l){var h,c,d,u,f,y,g=0,v=0,b="data:";if(l.substr(0,b.length)===b)throw new Error("Invalid base64 input, it looks like a data url.");var A,_=3*(l=l.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(l.charAt(l.length-1)===o.charAt(64)&&_--,l.charAt(l.length-2)===o.charAt(64)&&_--,_%1!=0)throw new Error("Invalid base64 input, bad content length.");for(A=a.uint8array?new Uint8Array(0|_):new Array(0|_);g<l.length;)h=o.indexOf(l.charAt(g++))<<2|(u=o.indexOf(l.charAt(g++)))>>4,c=(15&u)<<4|(f=o.indexOf(l.charAt(g++)))>>2,d=(3&f)<<6|(y=o.indexOf(l.charAt(g++))),A[v++]=h,f!==64&&(A[v++]=c),y!==64&&(A[v++]=d);return A}},{"./support":30,"./utils":32}],2:[function(t,s,i){var r=t("./external"),a=t("./stream/DataWorker"),o=t("./stream/Crc32Probe"),l=t("./stream/DataLengthProbe");function h(c,d,u,f,y){this.compressedSize=c,this.uncompressedSize=d,this.crc32=u,this.compression=f,this.compressedContent=y}h.prototype={getContentWorker:function(){var c=new a(r.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new l("data_length")),d=this;return c.on("end",function(){if(this.streamInfo.data_length!==d.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),c},getCompressedWorker:function(){return new a(r.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},h.createWorkerFrom=function(c,d,u){return c.pipe(new o).pipe(new l("uncompressedSize")).pipe(d.compressWorker(u)).pipe(new l("compressedSize")).withStreamInfo("compression",d)},s.exports=h},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(t,s,i){var r=t("./stream/GenericWorker");i.STORE={magic:"\0\0",compressWorker:function(){return new r("STORE compression")},uncompressWorker:function(){return new r("STORE decompression")}},i.DEFLATE=t("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(t,s,i){var r=t("./utils"),a=function(){for(var o,l=[],h=0;h<256;h++){o=h;for(var c=0;c<8;c++)o=1&o?3988292384^o>>>1:o>>>1;l[h]=o}return l}();s.exports=function(o,l){return o!==void 0&&o.length?r.getTypeOf(o)!=="string"?function(h,c,d,u){var f=a,y=u+d;h^=-1;for(var g=u;g<y;g++)h=h>>>8^f[255&(h^c[g])];return-1^h}(0|l,o,o.length,0):function(h,c,d,u){var f=a,y=u+d;h^=-1;for(var g=u;g<y;g++)h=h>>>8^f[255&(h^c.charCodeAt(g))];return-1^h}(0|l,o,o.length,0):0}},{"./utils":32}],5:[function(t,s,i){i.base64=!1,i.binary=!1,i.dir=!1,i.createFolders=!0,i.date=null,i.compression=null,i.compressionOptions=null,i.comment=null,i.unixPermissions=null,i.dosPermissions=null},{}],6:[function(t,s,i){var r=null;r=typeof Promise<"u"?Promise:t("lie"),s.exports={Promise:r}},{lie:37}],7:[function(t,s,i){var r=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",a=t("pako"),o=t("./utils"),l=t("./stream/GenericWorker"),h=r?"uint8array":"array";function c(d,u){l.call(this,"FlateWorker/"+d),this._pako=null,this._pakoAction=d,this._pakoOptions=u,this.meta={}}i.magic="\b\0",o.inherits(c,l),c.prototype.processChunk=function(d){this.meta=d.meta,this._pako===null&&this._createPako(),this._pako.push(o.transformTo(h,d.data),!1)},c.prototype.flush=function(){l.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},c.prototype.cleanUp=function(){l.prototype.cleanUp.call(this),this._pako=null},c.prototype._createPako=function(){this._pako=new a[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var d=this;this._pako.onData=function(u){d.push({data:u,meta:d.meta})}},i.compressWorker=function(d){return new c("Deflate",d)},i.uncompressWorker=function(){return new c("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(t,s,i){function r(f,y){var g,v="";for(g=0;g<y;g++)v+=String.fromCharCode(255&f),f>>>=8;return v}function a(f,y,g,v,b,A){var _,x,k=f.file,T=f.compression,P=A!==h.utf8encode,F=o.transformTo("string",A(k.name)),R=o.transformTo("string",h.utf8encode(k.name)),B=k.comment,j=o.transformTo("string",A(B)),I=o.transformTo("string",h.utf8encode(B)),L=R.length!==k.name.length,S=I.length!==B.length,N="",G="",U="",it=k.dir,Y=k.date,lt={crc32:0,compressedSize:0,uncompressedSize:0};y&&!g||(lt.crc32=f.crc32,lt.compressedSize=f.compressedSize,lt.uncompressedSize=f.uncompressedSize);var H=0;y&&(H|=8),P||!L&&!S||(H|=2048);var O=0,Q=0;it&&(O|=16),b==="UNIX"?(Q=798,O|=function(J,bt){var pt=J;return J||(pt=bt?16893:33204),(65535&pt)<<16}(k.unixPermissions,it)):(Q=20,O|=function(J){return 63&(J||0)}(k.dosPermissions)),_=Y.getUTCHours(),_<<=6,_|=Y.getUTCMinutes(),_<<=5,_|=Y.getUTCSeconds()/2,x=Y.getUTCFullYear()-1980,x<<=4,x|=Y.getUTCMonth()+1,x<<=5,x|=Y.getUTCDate(),L&&(G=r(1,1)+r(c(F),4)+R,N+="up"+r(G.length,2)+G),S&&(U=r(1,1)+r(c(j),4)+I,N+="uc"+r(U.length,2)+U);var tt="";return tt+=`
\0`,tt+=r(H,2),tt+=T.magic,tt+=r(_,2),tt+=r(x,2),tt+=r(lt.crc32,4),tt+=r(lt.compressedSize,4),tt+=r(lt.uncompressedSize,4),tt+=r(F.length,2),tt+=r(N.length,2),{fileRecord:d.LOCAL_FILE_HEADER+tt+F+N,dirRecord:d.CENTRAL_FILE_HEADER+r(Q,2)+tt+r(j.length,2)+"\0\0\0\0"+r(O,4)+r(v,4)+F+N+j}}var o=t("../utils"),l=t("../stream/GenericWorker"),h=t("../utf8"),c=t("../crc32"),d=t("../signature");function u(f,y,g,v){l.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=y,this.zipPlatform=g,this.encodeFileName=v,this.streamFiles=f,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}o.inherits(u,l),u.prototype.push=function(f){var y=f.meta.percent||0,g=this.entriesCount,v=this._sources.length;this.accumulate?this.contentBuffer.push(f):(this.bytesWritten+=f.data.length,l.prototype.push.call(this,{data:f.data,meta:{currentFile:this.currentFile,percent:g?(y+100*(g-v-1))/g:100}}))},u.prototype.openedSource=function(f){this.currentSourceOffset=this.bytesWritten,this.currentFile=f.file.name;var y=this.streamFiles&&!f.file.dir;if(y){var g=a(f,y,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:g.fileRecord,meta:{percent:0}})}else this.accumulate=!0},u.prototype.closedSource=function(f){this.accumulate=!1;var y=this.streamFiles&&!f.file.dir,g=a(f,y,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(g.dirRecord),y)this.push({data:function(v){return d.DATA_DESCRIPTOR+r(v.crc32,4)+r(v.compressedSize,4)+r(v.uncompressedSize,4)}(f),meta:{percent:100}});else for(this.push({data:g.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},u.prototype.flush=function(){for(var f=this.bytesWritten,y=0;y<this.dirRecords.length;y++)this.push({data:this.dirRecords[y],meta:{percent:100}});var g=this.bytesWritten-f,v=function(b,A,_,x,k){var T=o.transformTo("string",k(x));return d.CENTRAL_DIRECTORY_END+"\0\0\0\0"+r(b,2)+r(b,2)+r(A,4)+r(_,4)+r(T.length,2)+T}(this.dirRecords.length,g,f,this.zipComment,this.encodeFileName);this.push({data:v,meta:{percent:100}})},u.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},u.prototype.registerPrevious=function(f){this._sources.push(f);var y=this;return f.on("data",function(g){y.processChunk(g)}),f.on("end",function(){y.closedSource(y.previous.streamInfo),y._sources.length?y.prepareNextSource():y.end()}),f.on("error",function(g){y.error(g)}),this},u.prototype.resume=function(){return!!l.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},u.prototype.error=function(f){var y=this._sources;if(!l.prototype.error.call(this,f))return!1;for(var g=0;g<y.length;g++)try{y[g].error(f)}catch{}return!0},u.prototype.lock=function(){l.prototype.lock.call(this);for(var f=this._sources,y=0;y<f.length;y++)f[y].lock()},s.exports=u},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(t,s,i){var r=t("../compressions"),a=t("./ZipFileWorker");i.generateWorker=function(o,l,h){var c=new a(l.streamFiles,h,l.platform,l.encodeFileName),d=0;try{o.forEach(function(u,f){d++;var y=function(A,_){var x=A||_,k=r[x];if(!k)throw new Error(x+" is not a valid compression method !");return k}(f.options.compression,l.compression),g=f.options.compressionOptions||l.compressionOptions||{},v=f.dir,b=f.date;f._compressWorker(y,g).withStreamInfo("file",{name:u,dir:v,date:b,comment:f.comment||"",unixPermissions:f.unixPermissions,dosPermissions:f.dosPermissions}).pipe(c)}),c.entriesCount=d}catch(u){c.error(u)}return c}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(t,s,i){function r(){if(!(this instanceof r))return new r;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var a=new r;for(var o in this)typeof this[o]!="function"&&(a[o]=this[o]);return a}}(r.prototype=t("./object")).loadAsync=t("./load"),r.support=t("./support"),r.defaults=t("./defaults"),r.version="3.10.1",r.loadAsync=function(a,o){return new r().loadAsync(a,o)},r.external=t("./external"),s.exports=r},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(t,s,i){var r=t("./utils"),a=t("./external"),o=t("./utf8"),l=t("./zipEntries"),h=t("./stream/Crc32Probe"),c=t("./nodejsUtils");function d(u){return new a.Promise(function(f,y){var g=u.decompressed.getContentWorker().pipe(new h);g.on("error",function(v){y(v)}).on("end",function(){g.streamInfo.crc32!==u.decompressed.crc32?y(new Error("Corrupted zip : CRC32 mismatch")):f()}).resume()})}s.exports=function(u,f){var y=this;return f=r.extend(f||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:o.utf8decode}),c.isNode&&c.isStream(u)?a.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):r.prepareContent("the loaded zip file",u,!0,f.optimizedBinaryString,f.base64).then(function(g){var v=new l(f);return v.load(g),v}).then(function(g){var v=[a.Promise.resolve(g)],b=g.files;if(f.checkCRC32)for(var A=0;A<b.length;A++)v.push(d(b[A]));return a.Promise.all(v)}).then(function(g){for(var v=g.shift(),b=v.files,A=0;A<b.length;A++){var _=b[A],x=_.fileNameStr,k=r.resolve(_.fileNameStr);y.file(k,_.decompressed,{binary:!0,optimizedBinaryString:!0,date:_.date,dir:_.dir,comment:_.fileCommentStr.length?_.fileCommentStr:null,unixPermissions:_.unixPermissions,dosPermissions:_.dosPermissions,createFolders:f.createFolders}),_.dir||(y.file(k).unsafeOriginalName=x)}return v.zipComment.length&&(y.comment=v.zipComment),y})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(t,s,i){var r=t("../utils"),a=t("../stream/GenericWorker");function o(l,h){a.call(this,"Nodejs stream input adapter for "+l),this._upstreamEnded=!1,this._bindStream(h)}r.inherits(o,a),o.prototype._bindStream=function(l){var h=this;(this._stream=l).pause(),l.on("data",function(c){h.push({data:c,meta:{percent:0}})}).on("error",function(c){h.isPaused?this.generatedError=c:h.error(c)}).on("end",function(){h.isPaused?h._upstreamEnded=!0:h.end()})},o.prototype.pause=function(){return!!a.prototype.pause.call(this)&&(this._stream.pause(),!0)},o.prototype.resume=function(){return!!a.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},s.exports=o},{"../stream/GenericWorker":28,"../utils":32}],13:[function(t,s,i){var r=t("readable-stream").Readable;function a(o,l,h){r.call(this,l),this._helper=o;var c=this;o.on("data",function(d,u){c.push(d)||c._helper.pause(),h&&h(u)}).on("error",function(d){c.emit("error",d)}).on("end",function(){c.push(null)})}t("../utils").inherits(a,r),a.prototype._read=function(){this._helper.resume()},s.exports=a},{"../utils":32,"readable-stream":16}],14:[function(t,s,i){s.exports={isNode:typeof Buffer<"u",newBufferFrom:function(r,a){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(r,a);if(typeof r=="number")throw new Error('The "data" argument must not be a number');return new Buffer(r,a)},allocBuffer:function(r){if(Buffer.alloc)return Buffer.alloc(r);var a=new Buffer(r);return a.fill(0),a},isBuffer:function(r){return Buffer.isBuffer(r)},isStream:function(r){return r&&typeof r.on=="function"&&typeof r.pause=="function"&&typeof r.resume=="function"}}},{}],15:[function(t,s,i){function r(k,T,P){var F,R=o.getTypeOf(T),B=o.extend(P||{},c);B.date=B.date||new Date,B.compression!==null&&(B.compression=B.compression.toUpperCase()),typeof B.unixPermissions=="string"&&(B.unixPermissions=parseInt(B.unixPermissions,8)),B.unixPermissions&&16384&B.unixPermissions&&(B.dir=!0),B.dosPermissions&&16&B.dosPermissions&&(B.dir=!0),B.dir&&(k=b(k)),B.createFolders&&(F=v(k))&&A.call(this,F,!0);var j=R==="string"&&B.binary===!1&&B.base64===!1;P&&P.binary!==void 0||(B.binary=!j),(T instanceof d&&T.uncompressedSize===0||B.dir||!T||T.length===0)&&(B.base64=!1,B.binary=!0,T="",B.compression="STORE",R="string");var I=null;I=T instanceof d||T instanceof l?T:y.isNode&&y.isStream(T)?new g(k,T):o.prepareContent(k,T,B.binary,B.optimizedBinaryString,B.base64);var L=new u(k,I,B);this.files[k]=L}var a=t("./utf8"),o=t("./utils"),l=t("./stream/GenericWorker"),h=t("./stream/StreamHelper"),c=t("./defaults"),d=t("./compressedObject"),u=t("./zipObject"),f=t("./generate"),y=t("./nodejsUtils"),g=t("./nodejs/NodejsStreamInputAdapter"),v=function(k){k.slice(-1)==="/"&&(k=k.substring(0,k.length-1));var T=k.lastIndexOf("/");return 0<T?k.substring(0,T):""},b=function(k){return k.slice(-1)!=="/"&&(k+="/"),k},A=function(k,T){return T=T!==void 0?T:c.createFolders,k=b(k),this.files[k]||r.call(this,k,null,{dir:!0,createFolders:T}),this.files[k]};function _(k){return Object.prototype.toString.call(k)==="[object RegExp]"}var x={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(k){var T,P,F;for(T in this.files)F=this.files[T],(P=T.slice(this.root.length,T.length))&&T.slice(0,this.root.length)===this.root&&k(P,F)},filter:function(k){var T=[];return this.forEach(function(P,F){k(P,F)&&T.push(F)}),T},file:function(k,T,P){if(arguments.length!==1)return k=this.root+k,r.call(this,k,T,P),this;if(_(k)){var F=k;return this.filter(function(B,j){return!j.dir&&F.test(B)})}var R=this.files[this.root+k];return R&&!R.dir?R:null},folder:function(k){if(!k)return this;if(_(k))return this.filter(function(R,B){return B.dir&&k.test(R)});var T=this.root+k,P=A.call(this,T),F=this.clone();return F.root=P.name,F},remove:function(k){k=this.root+k;var T=this.files[k];if(T||(k.slice(-1)!=="/"&&(k+="/"),T=this.files[k]),T&&!T.dir)delete this.files[k];else for(var P=this.filter(function(R,B){return B.name.slice(0,k.length)===k}),F=0;F<P.length;F++)delete this.files[P[F].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(k){var T,P={};try{if((P=o.extend(k||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:a.utf8encode})).type=P.type.toLowerCase(),P.compression=P.compression.toUpperCase(),P.type==="binarystring"&&(P.type="string"),!P.type)throw new Error("No output type specified.");o.checkSupport(P.type),P.platform!=="darwin"&&P.platform!=="freebsd"&&P.platform!=="linux"&&P.platform!=="sunos"||(P.platform="UNIX"),P.platform==="win32"&&(P.platform="DOS");var F=P.comment||this.comment||"";T=f.generateWorker(this,P,F)}catch(R){(T=new l("error")).error(R)}return new h(T,P.type||"string",P.mimeType)},generateAsync:function(k,T){return this.generateInternalStream(k).accumulate(T)},generateNodeStream:function(k,T){return(k=k||{}).type||(k.type="nodebuffer"),this.generateInternalStream(k).toNodejsStream(T)}};s.exports=x},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(t,s,i){s.exports=t("stream")},{stream:void 0}],17:[function(t,s,i){var r=t("./DataReader");function a(o){r.call(this,o);for(var l=0;l<this.data.length;l++)o[l]=255&o[l]}t("../utils").inherits(a,r),a.prototype.byteAt=function(o){return this.data[this.zero+o]},a.prototype.lastIndexOfSignature=function(o){for(var l=o.charCodeAt(0),h=o.charCodeAt(1),c=o.charCodeAt(2),d=o.charCodeAt(3),u=this.length-4;0<=u;--u)if(this.data[u]===l&&this.data[u+1]===h&&this.data[u+2]===c&&this.data[u+3]===d)return u-this.zero;return-1},a.prototype.readAndCheckSignature=function(o){var l=o.charCodeAt(0),h=o.charCodeAt(1),c=o.charCodeAt(2),d=o.charCodeAt(3),u=this.readData(4);return l===u[0]&&h===u[1]&&c===u[2]&&d===u[3]},a.prototype.readData=function(o){if(this.checkOffset(o),o===0)return[];var l=this.data.slice(this.zero+this.index,this.zero+this.index+o);return this.index+=o,l},s.exports=a},{"../utils":32,"./DataReader":18}],18:[function(t,s,i){var r=t("../utils");function a(o){this.data=o,this.length=o.length,this.index=0,this.zero=0}a.prototype={checkOffset:function(o){this.checkIndex(this.index+o)},checkIndex:function(o){if(this.length<this.zero+o||o<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+o+"). Corrupted zip ?")},setIndex:function(o){this.checkIndex(o),this.index=o},skip:function(o){this.setIndex(this.index+o)},byteAt:function(){},readInt:function(o){var l,h=0;for(this.checkOffset(o),l=this.index+o-1;l>=this.index;l--)h=(h<<8)+this.byteAt(l);return this.index+=o,h},readString:function(o){return r.transformTo("string",this.readData(o))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var o=this.readInt(4);return new Date(Date.UTC(1980+(o>>25&127),(o>>21&15)-1,o>>16&31,o>>11&31,o>>5&63,(31&o)<<1))}},s.exports=a},{"../utils":32}],19:[function(t,s,i){var r=t("./Uint8ArrayReader");function a(o){r.call(this,o)}t("../utils").inherits(a,r),a.prototype.readData=function(o){this.checkOffset(o);var l=this.data.slice(this.zero+this.index,this.zero+this.index+o);return this.index+=o,l},s.exports=a},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(t,s,i){var r=t("./DataReader");function a(o){r.call(this,o)}t("../utils").inherits(a,r),a.prototype.byteAt=function(o){return this.data.charCodeAt(this.zero+o)},a.prototype.lastIndexOfSignature=function(o){return this.data.lastIndexOf(o)-this.zero},a.prototype.readAndCheckSignature=function(o){return o===this.readData(4)},a.prototype.readData=function(o){this.checkOffset(o);var l=this.data.slice(this.zero+this.index,this.zero+this.index+o);return this.index+=o,l},s.exports=a},{"../utils":32,"./DataReader":18}],21:[function(t,s,i){var r=t("./ArrayReader");function a(o){r.call(this,o)}t("../utils").inherits(a,r),a.prototype.readData=function(o){if(this.checkOffset(o),o===0)return new Uint8Array(0);var l=this.data.subarray(this.zero+this.index,this.zero+this.index+o);return this.index+=o,l},s.exports=a},{"../utils":32,"./ArrayReader":17}],22:[function(t,s,i){var r=t("../utils"),a=t("../support"),o=t("./ArrayReader"),l=t("./StringReader"),h=t("./NodeBufferReader"),c=t("./Uint8ArrayReader");s.exports=function(d){var u=r.getTypeOf(d);return r.checkSupport(u),u!=="string"||a.uint8array?u==="nodebuffer"?new h(d):a.uint8array?new c(r.transformTo("uint8array",d)):new o(r.transformTo("array",d)):new l(d)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(t,s,i){i.LOCAL_FILE_HEADER="PK",i.CENTRAL_FILE_HEADER="PK",i.CENTRAL_DIRECTORY_END="PK",i.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",i.ZIP64_CENTRAL_DIRECTORY_END="PK",i.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(t,s,i){var r=t("./GenericWorker"),a=t("../utils");function o(l){r.call(this,"ConvertWorker to "+l),this.destType=l}a.inherits(o,r),o.prototype.processChunk=function(l){this.push({data:a.transformTo(this.destType,l.data),meta:l.meta})},s.exports=o},{"../utils":32,"./GenericWorker":28}],25:[function(t,s,i){var r=t("./GenericWorker"),a=t("../crc32");function o(){r.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}t("../utils").inherits(o,r),o.prototype.processChunk=function(l){this.streamInfo.crc32=a(l.data,this.streamInfo.crc32||0),this.push(l)},s.exports=o},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(t,s,i){var r=t("../utils"),a=t("./GenericWorker");function o(l){a.call(this,"DataLengthProbe for "+l),this.propName=l,this.withStreamInfo(l,0)}r.inherits(o,a),o.prototype.processChunk=function(l){if(l){var h=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=h+l.data.length}a.prototype.processChunk.call(this,l)},s.exports=o},{"../utils":32,"./GenericWorker":28}],27:[function(t,s,i){var r=t("../utils"),a=t("./GenericWorker");function o(l){a.call(this,"DataWorker");var h=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,l.then(function(c){h.dataIsReady=!0,h.data=c,h.max=c&&c.length||0,h.type=r.getTypeOf(c),h.isPaused||h._tickAndRepeat()},function(c){h.error(c)})}r.inherits(o,a),o.prototype.cleanUp=function(){a.prototype.cleanUp.call(this),this.data=null},o.prototype.resume=function(){return!!a.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,r.delay(this._tickAndRepeat,[],this)),!0)},o.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(r.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},o.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var l=null,h=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":l=this.data.substring(this.index,h);break;case"uint8array":l=this.data.subarray(this.index,h);break;case"array":case"nodebuffer":l=this.data.slice(this.index,h)}return this.index=h,this.push({data:l,meta:{percent:this.max?this.index/this.max*100:0}})},s.exports=o},{"../utils":32,"./GenericWorker":28}],28:[function(t,s,i){function r(a){this.name=a||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}r.prototype={push:function(a){this.emit("data",a)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(a){this.emit("error",a)}return!0},error:function(a){return!this.isFinished&&(this.isPaused?this.generatedError=a:(this.isFinished=!0,this.emit("error",a),this.previous&&this.previous.error(a),this.cleanUp()),!0)},on:function(a,o){return this._listeners[a].push(o),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(a,o){if(this._listeners[a])for(var l=0;l<this._listeners[a].length;l++)this._listeners[a][l].call(this,o)},pipe:function(a){return a.registerPrevious(this)},registerPrevious:function(a){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=a.streamInfo,this.mergeStreamInfo(),this.previous=a;var o=this;return a.on("data",function(l){o.processChunk(l)}),a.on("end",function(){o.end()}),a.on("error",function(l){o.error(l)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var a=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),a=!0),this.previous&&this.previous.resume(),!a},flush:function(){},processChunk:function(a){this.push(a)},withStreamInfo:function(a,o){return this.extraStreamInfo[a]=o,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var a in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,a)&&(this.streamInfo[a]=this.extraStreamInfo[a])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var a="Worker "+this.name;return this.previous?this.previous+" -> "+a:a}},s.exports=r},{}],29:[function(t,s,i){var r=t("../utils"),a=t("./ConvertWorker"),o=t("./GenericWorker"),l=t("../base64"),h=t("../support"),c=t("../external"),d=null;if(h.nodestream)try{d=t("../nodejs/NodejsStreamOutputAdapter")}catch{}function u(y,g){return new c.Promise(function(v,b){var A=[],_=y._internalType,x=y._outputType,k=y._mimeType;y.on("data",function(T,P){A.push(T),g&&g(P)}).on("error",function(T){A=[],b(T)}).on("end",function(){try{var T=function(P,F,R){switch(P){case"blob":return r.newBlob(r.transformTo("arraybuffer",F),R);case"base64":return l.encode(F);default:return r.transformTo(P,F)}}(x,function(P,F){var R,B=0,j=null,I=0;for(R=0;R<F.length;R++)I+=F[R].length;switch(P){case"string":return F.join("");case"array":return Array.prototype.concat.apply([],F);case"uint8array":for(j=new Uint8Array(I),R=0;R<F.length;R++)j.set(F[R],B),B+=F[R].length;return j;case"nodebuffer":return Buffer.concat(F);default:throw new Error("concat : unsupported type '"+P+"'")}}(_,A),k);v(T)}catch(P){b(P)}A=[]}).resume()})}function f(y,g,v){var b=g;switch(g){case"blob":case"arraybuffer":b="uint8array";break;case"base64":b="string"}try{this._internalType=b,this._outputType=g,this._mimeType=v,r.checkSupport(b),this._worker=y.pipe(new a(b)),y.lock()}catch(A){this._worker=new o("error"),this._worker.error(A)}}f.prototype={accumulate:function(y){return u(this,y)},on:function(y,g){var v=this;return y==="data"?this._worker.on(y,function(b){g.call(v,b.data,b.meta)}):this._worker.on(y,function(){r.delay(g,arguments,v)}),this},resume:function(){return r.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(y){if(r.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new d(this,{objectMode:this._outputType!=="nodebuffer"},y)}},s.exports=f},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(t,s,i){if(i.base64=!0,i.array=!0,i.string=!0,i.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",i.nodebuffer=typeof Buffer<"u",i.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")i.blob=!1;else{var r=new ArrayBuffer(0);try{i.blob=new Blob([r],{type:"application/zip"}).size===0}catch{try{var a=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);a.append(r),i.blob=a.getBlob("application/zip").size===0}catch{i.blob=!1}}}try{i.nodestream=!!t("readable-stream").Readable}catch{i.nodestream=!1}},{"readable-stream":16}],31:[function(t,s,i){for(var r=t("./utils"),a=t("./support"),o=t("./nodejsUtils"),l=t("./stream/GenericWorker"),h=new Array(256),c=0;c<256;c++)h[c]=252<=c?6:248<=c?5:240<=c?4:224<=c?3:192<=c?2:1;h[254]=h[254]=1;function d(){l.call(this,"utf-8 decode"),this.leftOver=null}function u(){l.call(this,"utf-8 encode")}i.utf8encode=function(f){return a.nodebuffer?o.newBufferFrom(f,"utf-8"):function(y){var g,v,b,A,_,x=y.length,k=0;for(A=0;A<x;A++)(64512&(v=y.charCodeAt(A)))==55296&&A+1<x&&(64512&(b=y.charCodeAt(A+1)))==56320&&(v=65536+(v-55296<<10)+(b-56320),A++),k+=v<128?1:v<2048?2:v<65536?3:4;for(g=a.uint8array?new Uint8Array(k):new Array(k),A=_=0;_<k;A++)(64512&(v=y.charCodeAt(A)))==55296&&A+1<x&&(64512&(b=y.charCodeAt(A+1)))==56320&&(v=65536+(v-55296<<10)+(b-56320),A++),v<128?g[_++]=v:(v<2048?g[_++]=192|v>>>6:(v<65536?g[_++]=224|v>>>12:(g[_++]=240|v>>>18,g[_++]=128|v>>>12&63),g[_++]=128|v>>>6&63),g[_++]=128|63&v);return g}(f)},i.utf8decode=function(f){return a.nodebuffer?r.transformTo("nodebuffer",f).toString("utf-8"):function(y){var g,v,b,A,_=y.length,x=new Array(2*_);for(g=v=0;g<_;)if((b=y[g++])<128)x[v++]=b;else if(4<(A=h[b]))x[v++]=65533,g+=A-1;else{for(b&=A===2?31:A===3?15:7;1<A&&g<_;)b=b<<6|63&y[g++],A--;1<A?x[v++]=65533:b<65536?x[v++]=b:(b-=65536,x[v++]=55296|b>>10&1023,x[v++]=56320|1023&b)}return x.length!==v&&(x.subarray?x=x.subarray(0,v):x.length=v),r.applyFromCharCode(x)}(f=r.transformTo(a.uint8array?"uint8array":"array",f))},r.inherits(d,l),d.prototype.processChunk=function(f){var y=r.transformTo(a.uint8array?"uint8array":"array",f.data);if(this.leftOver&&this.leftOver.length){if(a.uint8array){var g=y;(y=new Uint8Array(g.length+this.leftOver.length)).set(this.leftOver,0),y.set(g,this.leftOver.length)}else y=this.leftOver.concat(y);this.leftOver=null}var v=function(A,_){var x;for((_=_||A.length)>A.length&&(_=A.length),x=_-1;0<=x&&(192&A[x])==128;)x--;return x<0||x===0?_:x+h[A[x]]>_?x:_}(y),b=y;v!==y.length&&(a.uint8array?(b=y.subarray(0,v),this.leftOver=y.subarray(v,y.length)):(b=y.slice(0,v),this.leftOver=y.slice(v,y.length))),this.push({data:i.utf8decode(b),meta:f.meta})},d.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:i.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},i.Utf8DecodeWorker=d,r.inherits(u,l),u.prototype.processChunk=function(f){this.push({data:i.utf8encode(f.data),meta:f.meta})},i.Utf8EncodeWorker=u},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(t,s,i){var r=t("./support"),a=t("./base64"),o=t("./nodejsUtils"),l=t("./external");function h(g){return g}function c(g,v){for(var b=0;b<g.length;++b)v[b]=255&g.charCodeAt(b);return v}t("setimmediate"),i.newBlob=function(g,v){i.checkSupport("blob");try{return new Blob([g],{type:v})}catch{try{var b=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return b.append(g),b.getBlob(v)}catch{throw new Error("Bug : can't construct the Blob.")}}};var d={stringifyByChunk:function(g,v,b){var A=[],_=0,x=g.length;if(x<=b)return String.fromCharCode.apply(null,g);for(;_<x;)v==="array"||v==="nodebuffer"?A.push(String.fromCharCode.apply(null,g.slice(_,Math.min(_+b,x)))):A.push(String.fromCharCode.apply(null,g.subarray(_,Math.min(_+b,x)))),_+=b;return A.join("")},stringifyByChar:function(g){for(var v="",b=0;b<g.length;b++)v+=String.fromCharCode(g[b]);return v},applyCanBeUsed:{uint8array:function(){try{return r.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}}(),nodebuffer:function(){try{return r.nodebuffer&&String.fromCharCode.apply(null,o.allocBuffer(1)).length===1}catch{return!1}}()}};function u(g){var v=65536,b=i.getTypeOf(g),A=!0;if(b==="uint8array"?A=d.applyCanBeUsed.uint8array:b==="nodebuffer"&&(A=d.applyCanBeUsed.nodebuffer),A)for(;1<v;)try{return d.stringifyByChunk(g,b,v)}catch{v=Math.floor(v/2)}return d.stringifyByChar(g)}function f(g,v){for(var b=0;b<g.length;b++)v[b]=g[b];return v}i.applyFromCharCode=u;var y={};y.string={string:h,array:function(g){return c(g,new Array(g.length))},arraybuffer:function(g){return y.string.uint8array(g).buffer},uint8array:function(g){return c(g,new Uint8Array(g.length))},nodebuffer:function(g){return c(g,o.allocBuffer(g.length))}},y.array={string:u,array:h,arraybuffer:function(g){return new Uint8Array(g).buffer},uint8array:function(g){return new Uint8Array(g)},nodebuffer:function(g){return o.newBufferFrom(g)}},y.arraybuffer={string:function(g){return u(new Uint8Array(g))},array:function(g){return f(new Uint8Array(g),new Array(g.byteLength))},arraybuffer:h,uint8array:function(g){return new Uint8Array(g)},nodebuffer:function(g){return o.newBufferFrom(new Uint8Array(g))}},y.uint8array={string:u,array:function(g){return f(g,new Array(g.length))},arraybuffer:function(g){return g.buffer},uint8array:h,nodebuffer:function(g){return o.newBufferFrom(g)}},y.nodebuffer={string:u,array:function(g){return f(g,new Array(g.length))},arraybuffer:function(g){return y.nodebuffer.uint8array(g).buffer},uint8array:function(g){return f(g,new Uint8Array(g.length))},nodebuffer:h},i.transformTo=function(g,v){if(v=v||"",!g)return v;i.checkSupport(g);var b=i.getTypeOf(v);return y[b][g](v)},i.resolve=function(g){for(var v=g.split("/"),b=[],A=0;A<v.length;A++){var _=v[A];_==="."||_===""&&A!==0&&A!==v.length-1||(_===".."?b.pop():b.push(_))}return b.join("/")},i.getTypeOf=function(g){return typeof g=="string"?"string":Object.prototype.toString.call(g)==="[object Array]"?"array":r.nodebuffer&&o.isBuffer(g)?"nodebuffer":r.uint8array&&g instanceof Uint8Array?"uint8array":r.arraybuffer&&g instanceof ArrayBuffer?"arraybuffer":void 0},i.checkSupport=function(g){if(!r[g.toLowerCase()])throw new Error(g+" is not supported by this platform")},i.MAX_VALUE_16BITS=65535,i.MAX_VALUE_32BITS=-1,i.pretty=function(g){var v,b,A="";for(b=0;b<(g||"").length;b++)A+="\\x"+((v=g.charCodeAt(b))<16?"0":"")+v.toString(16).toUpperCase();return A},i.delay=function(g,v,b){setImmediate(function(){g.apply(b||null,v||[])})},i.inherits=function(g,v){function b(){}b.prototype=v.prototype,g.prototype=new b},i.extend=function(){var g,v,b={};for(g=0;g<arguments.length;g++)for(v in arguments[g])Object.prototype.hasOwnProperty.call(arguments[g],v)&&b[v]===void 0&&(b[v]=arguments[g][v]);return b},i.prepareContent=function(g,v,b,A,_){return l.Promise.resolve(v).then(function(x){return r.blob&&(x instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(x))!==-1)&&typeof FileReader<"u"?new l.Promise(function(k,T){var P=new FileReader;P.onload=function(F){k(F.target.result)},P.onerror=function(F){T(F.target.error)},P.readAsArrayBuffer(x)}):x}).then(function(x){var k=i.getTypeOf(x);return k?(k==="arraybuffer"?x=i.transformTo("uint8array",x):k==="string"&&(_?x=a.decode(x):b&&A!==!0&&(x=function(T){return c(T,r.uint8array?new Uint8Array(T.length):new Array(T.length))}(x))),x):l.Promise.reject(new Error("Can't read the data of '"+g+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(t,s,i){var r=t("./reader/readerFor"),a=t("./utils"),o=t("./signature"),l=t("./zipEntry"),h=t("./support");function c(d){this.files=[],this.loadOptions=d}c.prototype={checkSignature:function(d){if(!this.reader.readAndCheckSignature(d)){this.reader.index-=4;var u=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+a.pretty(u)+", expected "+a.pretty(d)+")")}},isSignature:function(d,u){var f=this.reader.index;this.reader.setIndex(d);var y=this.reader.readString(4)===u;return this.reader.setIndex(f),y},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var d=this.reader.readData(this.zipCommentLength),u=h.uint8array?"uint8array":"array",f=a.transformTo(u,d);this.zipComment=this.loadOptions.decodeFileName(f)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var d,u,f,y=this.zip64EndOfCentralSize-44;0<y;)d=this.reader.readInt(2),u=this.reader.readInt(4),f=this.reader.readData(u),this.zip64ExtensibleData[d]={id:d,length:u,value:f}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var d,u;for(d=0;d<this.files.length;d++)u=this.files[d],this.reader.setIndex(u.localHeaderOffset),this.checkSignature(o.LOCAL_FILE_HEADER),u.readLocalPart(this.reader),u.handleUTF8(),u.processAttributes()},readCentralDir:function(){var d;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(o.CENTRAL_FILE_HEADER);)(d=new l({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(d);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var d=this.reader.lastIndexOfSignature(o.CENTRAL_DIRECTORY_END);if(d<0)throw this.isSignature(0,o.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(d);var u=d;if(this.checkSignature(o.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===a.MAX_VALUE_16BITS||this.diskWithCentralDirStart===a.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===a.MAX_VALUE_16BITS||this.centralDirRecords===a.MAX_VALUE_16BITS||this.centralDirSize===a.MAX_VALUE_32BITS||this.centralDirOffset===a.MAX_VALUE_32BITS){if(this.zip64=!0,(d=this.reader.lastIndexOfSignature(o.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(d),this.checkSignature(o.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,o.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(o.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(o.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var f=this.centralDirOffset+this.centralDirSize;this.zip64&&(f+=20,f+=12+this.zip64EndOfCentralSize);var y=u-f;if(0<y)this.isSignature(u,o.CENTRAL_FILE_HEADER)||(this.reader.zero=y);else if(y<0)throw new Error("Corrupted zip: missing "+Math.abs(y)+" bytes.")},prepareReader:function(d){this.reader=r(d)},load:function(d){this.prepareReader(d),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},s.exports=c},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(t,s,i){var r=t("./reader/readerFor"),a=t("./utils"),o=t("./compressedObject"),l=t("./crc32"),h=t("./utf8"),c=t("./compressions"),d=t("./support");function u(f,y){this.options=f,this.loadOptions=y}u.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(f){var y,g;if(f.skip(22),this.fileNameLength=f.readInt(2),g=f.readInt(2),this.fileName=f.readData(this.fileNameLength),f.skip(g),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((y=function(v){for(var b in c)if(Object.prototype.hasOwnProperty.call(c,b)&&c[b].magic===v)return c[b];return null}(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+a.pretty(this.compressionMethod)+" unknown (inner file : "+a.transformTo("string",this.fileName)+")");this.decompressed=new o(this.compressedSize,this.uncompressedSize,this.crc32,y,f.readData(this.compressedSize))},readCentralPart:function(f){this.versionMadeBy=f.readInt(2),f.skip(2),this.bitFlag=f.readInt(2),this.compressionMethod=f.readString(2),this.date=f.readDate(),this.crc32=f.readInt(4),this.compressedSize=f.readInt(4),this.uncompressedSize=f.readInt(4);var y=f.readInt(2);if(this.extraFieldsLength=f.readInt(2),this.fileCommentLength=f.readInt(2),this.diskNumberStart=f.readInt(2),this.internalFileAttributes=f.readInt(2),this.externalFileAttributes=f.readInt(4),this.localHeaderOffset=f.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");f.skip(y),this.readExtraFields(f),this.parseZIP64ExtraField(f),this.fileComment=f.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var f=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),f==0&&(this.dosPermissions=63&this.externalFileAttributes),f==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var f=r(this.extraFields[1].value);this.uncompressedSize===a.MAX_VALUE_32BITS&&(this.uncompressedSize=f.readInt(8)),this.compressedSize===a.MAX_VALUE_32BITS&&(this.compressedSize=f.readInt(8)),this.localHeaderOffset===a.MAX_VALUE_32BITS&&(this.localHeaderOffset=f.readInt(8)),this.diskNumberStart===a.MAX_VALUE_32BITS&&(this.diskNumberStart=f.readInt(4))}},readExtraFields:function(f){var y,g,v,b=f.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});f.index+4<b;)y=f.readInt(2),g=f.readInt(2),v=f.readData(g),this.extraFields[y]={id:y,length:g,value:v};f.setIndex(b)},handleUTF8:function(){var f=d.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=h.utf8decode(this.fileName),this.fileCommentStr=h.utf8decode(this.fileComment);else{var y=this.findExtraFieldUnicodePath();if(y!==null)this.fileNameStr=y;else{var g=a.transformTo(f,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(g)}var v=this.findExtraFieldUnicodeComment();if(v!==null)this.fileCommentStr=v;else{var b=a.transformTo(f,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(b)}}},findExtraFieldUnicodePath:function(){var f=this.extraFields[28789];if(f){var y=r(f.value);return y.readInt(1)!==1||l(this.fileName)!==y.readInt(4)?null:h.utf8decode(y.readData(f.length-5))}return null},findExtraFieldUnicodeComment:function(){var f=this.extraFields[25461];if(f){var y=r(f.value);return y.readInt(1)!==1||l(this.fileComment)!==y.readInt(4)?null:h.utf8decode(y.readData(f.length-5))}return null}},s.exports=u},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(t,s,i){function r(y,g,v){this.name=y,this.dir=v.dir,this.date=v.date,this.comment=v.comment,this.unixPermissions=v.unixPermissions,this.dosPermissions=v.dosPermissions,this._data=g,this._dataBinary=v.binary,this.options={compression:v.compression,compressionOptions:v.compressionOptions}}var a=t("./stream/StreamHelper"),o=t("./stream/DataWorker"),l=t("./utf8"),h=t("./compressedObject"),c=t("./stream/GenericWorker");r.prototype={internalStream:function(y){var g=null,v="string";try{if(!y)throw new Error("No output type specified.");var b=(v=y.toLowerCase())==="string"||v==="text";v!=="binarystring"&&v!=="text"||(v="string"),g=this._decompressWorker();var A=!this._dataBinary;A&&!b&&(g=g.pipe(new l.Utf8EncodeWorker)),!A&&b&&(g=g.pipe(new l.Utf8DecodeWorker))}catch(_){(g=new c("error")).error(_)}return new a(g,v,"")},async:function(y,g){return this.internalStream(y).accumulate(g)},nodeStream:function(y,g){return this.internalStream(y||"nodebuffer").toNodejsStream(g)},_compressWorker:function(y,g){if(this._data instanceof h&&this._data.compression.magic===y.magic)return this._data.getCompressedWorker();var v=this._decompressWorker();return this._dataBinary||(v=v.pipe(new l.Utf8EncodeWorker)),h.createWorkerFrom(v,y,g)},_decompressWorker:function(){return this._data instanceof h?this._data.getContentWorker():this._data instanceof c?this._data:new o(this._data)}};for(var d=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],u=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},f=0;f<d.length;f++)r.prototype[d[f]]=u;s.exports=r},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(t,s,i){(function(r){var a,o,l=r.MutationObserver||r.WebKitMutationObserver;if(l){var h=0,c=new l(y),d=r.document.createTextNode("");c.observe(d,{characterData:!0}),a=function(){d.data=h=++h%2}}else if(r.setImmediate||r.MessageChannel===void 0)a="document"in r&&"onreadystatechange"in r.document.createElement("script")?function(){var g=r.document.createElement("script");g.onreadystatechange=function(){y(),g.onreadystatechange=null,g.parentNode.removeChild(g),g=null},r.document.documentElement.appendChild(g)}:function(){setTimeout(y,0)};else{var u=new r.MessageChannel;u.port1.onmessage=y,a=function(){u.port2.postMessage(0)}}var f=[];function y(){var g,v;o=!0;for(var b=f.length;b;){for(v=f,f=[],g=-1;++g<b;)v[g]();b=f.length}o=!1}s.exports=function(g){f.push(g)!==1||o||a()}}).call(this,typeof xf<"u"?xf:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(t,s,i){var r=t("immediate");function a(){}var o={},l=["REJECTED"],h=["FULFILLED"],c=["PENDING"];function d(b){if(typeof b!="function")throw new TypeError("resolver must be a function");this.state=c,this.queue=[],this.outcome=void 0,b!==a&&g(this,b)}function u(b,A,_){this.promise=b,typeof A=="function"&&(this.onFulfilled=A,this.callFulfilled=this.otherCallFulfilled),typeof _=="function"&&(this.onRejected=_,this.callRejected=this.otherCallRejected)}function f(b,A,_){r(function(){var x;try{x=A(_)}catch(k){return o.reject(b,k)}x===b?o.reject(b,new TypeError("Cannot resolve promise with itself")):o.resolve(b,x)})}function y(b){var A=b&&b.then;if(b&&(typeof b=="object"||typeof b=="function")&&typeof A=="function")return function(){A.apply(b,arguments)}}function g(b,A){var _=!1;function x(P){_||(_=!0,o.reject(b,P))}function k(P){_||(_=!0,o.resolve(b,P))}var T=v(function(){A(k,x)});T.status==="error"&&x(T.value)}function v(b,A){var _={};try{_.value=b(A),_.status="success"}catch(x){_.status="error",_.value=x}return _}(s.exports=d).prototype.finally=function(b){if(typeof b!="function")return this;var A=this.constructor;return this.then(function(_){return A.resolve(b()).then(function(){return _})},function(_){return A.resolve(b()).then(function(){throw _})})},d.prototype.catch=function(b){return this.then(null,b)},d.prototype.then=function(b,A){if(typeof b!="function"&&this.state===h||typeof A!="function"&&this.state===l)return this;var _=new this.constructor(a);return this.state!==c?f(_,this.state===h?b:A,this.outcome):this.queue.push(new u(_,b,A)),_},u.prototype.callFulfilled=function(b){o.resolve(this.promise,b)},u.prototype.otherCallFulfilled=function(b){f(this.promise,this.onFulfilled,b)},u.prototype.callRejected=function(b){o.reject(this.promise,b)},u.prototype.otherCallRejected=function(b){f(this.promise,this.onRejected,b)},o.resolve=function(b,A){var _=v(y,A);if(_.status==="error")return o.reject(b,_.value);var x=_.value;if(x)g(b,x);else{b.state=h,b.outcome=A;for(var k=-1,T=b.queue.length;++k<T;)b.queue[k].callFulfilled(A)}return b},o.reject=function(b,A){b.state=l,b.outcome=A;for(var _=-1,x=b.queue.length;++_<x;)b.queue[_].callRejected(A);return b},d.resolve=function(b){return b instanceof this?b:o.resolve(new this(a),b)},d.reject=function(b){var A=new this(a);return o.reject(A,b)},d.all=function(b){var A=this;if(Object.prototype.toString.call(b)!=="[object Array]")return this.reject(new TypeError("must be an array"));var _=b.length,x=!1;if(!_)return this.resolve([]);for(var k=new Array(_),T=0,P=-1,F=new this(a);++P<_;)R(b[P],P);return F;function R(B,j){A.resolve(B).then(function(I){k[j]=I,++T!==_||x||(x=!0,o.resolve(F,k))},function(I){x||(x=!0,o.reject(F,I))})}},d.race=function(b){var A=this;if(Object.prototype.toString.call(b)!=="[object Array]")return this.reject(new TypeError("must be an array"));var _=b.length,x=!1;if(!_)return this.resolve([]);for(var k=-1,T=new this(a);++k<_;)P=b[k],A.resolve(P).then(function(F){x||(x=!0,o.resolve(T,F))},function(F){x||(x=!0,o.reject(T,F))});var P;return T}},{immediate:36}],38:[function(t,s,i){var r={};(0,t("./lib/utils/common").assign)(r,t("./lib/deflate"),t("./lib/inflate"),t("./lib/zlib/constants")),s.exports=r},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(t,s,i){var r=t("./zlib/deflate"),a=t("./utils/common"),o=t("./utils/strings"),l=t("./zlib/messages"),h=t("./zlib/zstream"),c=Object.prototype.toString,d=0,u=-1,f=0,y=8;function g(b){if(!(this instanceof g))return new g(b);this.options=a.assign({level:u,method:y,chunkSize:16384,windowBits:15,memLevel:8,strategy:f,to:""},b||{});var A=this.options;A.raw&&0<A.windowBits?A.windowBits=-A.windowBits:A.gzip&&0<A.windowBits&&A.windowBits<16&&(A.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new h,this.strm.avail_out=0;var _=r.deflateInit2(this.strm,A.level,A.method,A.windowBits,A.memLevel,A.strategy);if(_!==d)throw new Error(l[_]);if(A.header&&r.deflateSetHeader(this.strm,A.header),A.dictionary){var x;if(x=typeof A.dictionary=="string"?o.string2buf(A.dictionary):c.call(A.dictionary)==="[object ArrayBuffer]"?new Uint8Array(A.dictionary):A.dictionary,(_=r.deflateSetDictionary(this.strm,x))!==d)throw new Error(l[_]);this._dict_set=!0}}function v(b,A){var _=new g(A);if(_.push(b,!0),_.err)throw _.msg||l[_.err];return _.result}g.prototype.push=function(b,A){var _,x,k=this.strm,T=this.options.chunkSize;if(this.ended)return!1;x=A===~~A?A:A===!0?4:0,typeof b=="string"?k.input=o.string2buf(b):c.call(b)==="[object ArrayBuffer]"?k.input=new Uint8Array(b):k.input=b,k.next_in=0,k.avail_in=k.input.length;do{if(k.avail_out===0&&(k.output=new a.Buf8(T),k.next_out=0,k.avail_out=T),(_=r.deflate(k,x))!==1&&_!==d)return this.onEnd(_),!(this.ended=!0);k.avail_out!==0&&(k.avail_in!==0||x!==4&&x!==2)||(this.options.to==="string"?this.onData(o.buf2binstring(a.shrinkBuf(k.output,k.next_out))):this.onData(a.shrinkBuf(k.output,k.next_out)))}while((0<k.avail_in||k.avail_out===0)&&_!==1);return x===4?(_=r.deflateEnd(this.strm),this.onEnd(_),this.ended=!0,_===d):x!==2||(this.onEnd(d),!(k.avail_out=0))},g.prototype.onData=function(b){this.chunks.push(b)},g.prototype.onEnd=function(b){b===d&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=a.flattenChunks(this.chunks)),this.chunks=[],this.err=b,this.msg=this.strm.msg},i.Deflate=g,i.deflate=v,i.deflateRaw=function(b,A){return(A=A||{}).raw=!0,v(b,A)},i.gzip=function(b,A){return(A=A||{}).gzip=!0,v(b,A)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(t,s,i){var r=t("./zlib/inflate"),a=t("./utils/common"),o=t("./utils/strings"),l=t("./zlib/constants"),h=t("./zlib/messages"),c=t("./zlib/zstream"),d=t("./zlib/gzheader"),u=Object.prototype.toString;function f(g){if(!(this instanceof f))return new f(g);this.options=a.assign({chunkSize:16384,windowBits:0,to:""},g||{});var v=this.options;v.raw&&0<=v.windowBits&&v.windowBits<16&&(v.windowBits=-v.windowBits,v.windowBits===0&&(v.windowBits=-15)),!(0<=v.windowBits&&v.windowBits<16)||g&&g.windowBits||(v.windowBits+=32),15<v.windowBits&&v.windowBits<48&&!(15&v.windowBits)&&(v.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new c,this.strm.avail_out=0;var b=r.inflateInit2(this.strm,v.windowBits);if(b!==l.Z_OK)throw new Error(h[b]);this.header=new d,r.inflateGetHeader(this.strm,this.header)}function y(g,v){var b=new f(v);if(b.push(g,!0),b.err)throw b.msg||h[b.err];return b.result}f.prototype.push=function(g,v){var b,A,_,x,k,T,P=this.strm,F=this.options.chunkSize,R=this.options.dictionary,B=!1;if(this.ended)return!1;A=v===~~v?v:v===!0?l.Z_FINISH:l.Z_NO_FLUSH,typeof g=="string"?P.input=o.binstring2buf(g):u.call(g)==="[object ArrayBuffer]"?P.input=new Uint8Array(g):P.input=g,P.next_in=0,P.avail_in=P.input.length;do{if(P.avail_out===0&&(P.output=new a.Buf8(F),P.next_out=0,P.avail_out=F),(b=r.inflate(P,l.Z_NO_FLUSH))===l.Z_NEED_DICT&&R&&(T=typeof R=="string"?o.string2buf(R):u.call(R)==="[object ArrayBuffer]"?new Uint8Array(R):R,b=r.inflateSetDictionary(this.strm,T)),b===l.Z_BUF_ERROR&&B===!0&&(b=l.Z_OK,B=!1),b!==l.Z_STREAM_END&&b!==l.Z_OK)return this.onEnd(b),!(this.ended=!0);P.next_out&&(P.avail_out!==0&&b!==l.Z_STREAM_END&&(P.avail_in!==0||A!==l.Z_FINISH&&A!==l.Z_SYNC_FLUSH)||(this.options.to==="string"?(_=o.utf8border(P.output,P.next_out),x=P.next_out-_,k=o.buf2string(P.output,_),P.next_out=x,P.avail_out=F-x,x&&a.arraySet(P.output,P.output,_,x,0),this.onData(k)):this.onData(a.shrinkBuf(P.output,P.next_out)))),P.avail_in===0&&P.avail_out===0&&(B=!0)}while((0<P.avail_in||P.avail_out===0)&&b!==l.Z_STREAM_END);return b===l.Z_STREAM_END&&(A=l.Z_FINISH),A===l.Z_FINISH?(b=r.inflateEnd(this.strm),this.onEnd(b),this.ended=!0,b===l.Z_OK):A!==l.Z_SYNC_FLUSH||(this.onEnd(l.Z_OK),!(P.avail_out=0))},f.prototype.onData=function(g){this.chunks.push(g)},f.prototype.onEnd=function(g){g===l.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=a.flattenChunks(this.chunks)),this.chunks=[],this.err=g,this.msg=this.strm.msg},i.Inflate=f,i.inflate=y,i.inflateRaw=function(g,v){return(v=v||{}).raw=!0,y(g,v)},i.ungzip=y},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(t,s,i){var r=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";i.assign=function(l){for(var h=Array.prototype.slice.call(arguments,1);h.length;){var c=h.shift();if(c){if(typeof c!="object")throw new TypeError(c+"must be non-object");for(var d in c)c.hasOwnProperty(d)&&(l[d]=c[d])}}return l},i.shrinkBuf=function(l,h){return l.length===h?l:l.subarray?l.subarray(0,h):(l.length=h,l)};var a={arraySet:function(l,h,c,d,u){if(h.subarray&&l.subarray)l.set(h.subarray(c,c+d),u);else for(var f=0;f<d;f++)l[u+f]=h[c+f]},flattenChunks:function(l){var h,c,d,u,f,y;for(h=d=0,c=l.length;h<c;h++)d+=l[h].length;for(y=new Uint8Array(d),h=u=0,c=l.length;h<c;h++)f=l[h],y.set(f,u),u+=f.length;return y}},o={arraySet:function(l,h,c,d,u){for(var f=0;f<d;f++)l[u+f]=h[c+f]},flattenChunks:function(l){return[].concat.apply([],l)}};i.setTyped=function(l){l?(i.Buf8=Uint8Array,i.Buf16=Uint16Array,i.Buf32=Int32Array,i.assign(i,a)):(i.Buf8=Array,i.Buf16=Array,i.Buf32=Array,i.assign(i,o))},i.setTyped(r)},{}],42:[function(t,s,i){var r=t("./common"),a=!0,o=!0;try{String.fromCharCode.apply(null,[0])}catch{a=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{o=!1}for(var l=new r.Buf8(256),h=0;h<256;h++)l[h]=252<=h?6:248<=h?5:240<=h?4:224<=h?3:192<=h?2:1;function c(d,u){if(u<65537&&(d.subarray&&o||!d.subarray&&a))return String.fromCharCode.apply(null,r.shrinkBuf(d,u));for(var f="",y=0;y<u;y++)f+=String.fromCharCode(d[y]);return f}l[254]=l[254]=1,i.string2buf=function(d){var u,f,y,g,v,b=d.length,A=0;for(g=0;g<b;g++)(64512&(f=d.charCodeAt(g)))==55296&&g+1<b&&(64512&(y=d.charCodeAt(g+1)))==56320&&(f=65536+(f-55296<<10)+(y-56320),g++),A+=f<128?1:f<2048?2:f<65536?3:4;for(u=new r.Buf8(A),g=v=0;v<A;g++)(64512&(f=d.charCodeAt(g)))==55296&&g+1<b&&(64512&(y=d.charCodeAt(g+1)))==56320&&(f=65536+(f-55296<<10)+(y-56320),g++),f<128?u[v++]=f:(f<2048?u[v++]=192|f>>>6:(f<65536?u[v++]=224|f>>>12:(u[v++]=240|f>>>18,u[v++]=128|f>>>12&63),u[v++]=128|f>>>6&63),u[v++]=128|63&f);return u},i.buf2binstring=function(d){return c(d,d.length)},i.binstring2buf=function(d){for(var u=new r.Buf8(d.length),f=0,y=u.length;f<y;f++)u[f]=d.charCodeAt(f);return u},i.buf2string=function(d,u){var f,y,g,v,b=u||d.length,A=new Array(2*b);for(f=y=0;f<b;)if((g=d[f++])<128)A[y++]=g;else if(4<(v=l[g]))A[y++]=65533,f+=v-1;else{for(g&=v===2?31:v===3?15:7;1<v&&f<b;)g=g<<6|63&d[f++],v--;1<v?A[y++]=65533:g<65536?A[y++]=g:(g-=65536,A[y++]=55296|g>>10&1023,A[y++]=56320|1023&g)}return c(A,y)},i.utf8border=function(d,u){var f;for((u=u||d.length)>d.length&&(u=d.length),f=u-1;0<=f&&(192&d[f])==128;)f--;return f<0||f===0?u:f+l[d[f]]>u?f:u}},{"./common":41}],43:[function(t,s,i){s.exports=function(r,a,o,l){for(var h=65535&r|0,c=r>>>16&65535|0,d=0;o!==0;){for(o-=d=2e3<o?2e3:o;c=c+(h=h+a[l++]|0)|0,--d;);h%=65521,c%=65521}return h|c<<16|0}},{}],44:[function(t,s,i){s.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(t,s,i){var r=function(){for(var a,o=[],l=0;l<256;l++){a=l;for(var h=0;h<8;h++)a=1&a?3988292384^a>>>1:a>>>1;o[l]=a}return o}();s.exports=function(a,o,l,h){var c=r,d=h+l;a^=-1;for(var u=h;u<d;u++)a=a>>>8^c[255&(a^o[u])];return-1^a}},{}],46:[function(t,s,i){var r,a=t("../utils/common"),o=t("./trees"),l=t("./adler32"),h=t("./crc32"),c=t("./messages"),d=0,u=4,f=0,y=-2,g=-1,v=4,b=2,A=8,_=9,x=286,k=30,T=19,P=2*x+1,F=15,R=3,B=258,j=B+R+1,I=42,L=113,S=1,N=2,G=3,U=4;function it(C,q){return C.msg=c[q],q}function Y(C){return(C<<1)-(4<C?9:0)}function lt(C){for(var q=C.length;0<=--q;)C[q]=0}function H(C){var q=C.state,W=q.pending;W>C.avail_out&&(W=C.avail_out),W!==0&&(a.arraySet(C.output,q.pending_buf,q.pending_out,W,C.next_out),C.next_out+=W,q.pending_out+=W,C.total_out+=W,C.avail_out-=W,q.pending-=W,q.pending===0&&(q.pending_out=0))}function O(C,q){o._tr_flush_block(C,0<=C.block_start?C.block_start:-1,C.strstart-C.block_start,q),C.block_start=C.strstart,H(C.strm)}function Q(C,q){C.pending_buf[C.pending++]=q}function tt(C,q){C.pending_buf[C.pending++]=q>>>8&255,C.pending_buf[C.pending++]=255&q}function J(C,q){var W,M,D=C.max_chain_length,z=C.strstart,Z=C.prev_length,et=C.nice_match,V=C.strstart>C.w_size-j?C.strstart-(C.w_size-j):0,st=C.window,ot=C.w_mask,K=C.prev,dt=C.strstart+B,Pt=st[z+Z-1],kt=st[z+Z];C.prev_length>=C.good_match&&(D>>=2),et>C.lookahead&&(et=C.lookahead);do if(st[(W=q)+Z]===kt&&st[W+Z-1]===Pt&&st[W]===st[z]&&st[++W]===st[z+1]){z+=2,W++;do;while(st[++z]===st[++W]&&st[++z]===st[++W]&&st[++z]===st[++W]&&st[++z]===st[++W]&&st[++z]===st[++W]&&st[++z]===st[++W]&&st[++z]===st[++W]&&st[++z]===st[++W]&&z<dt);if(M=B-(dt-z),z=dt-B,Z<M){if(C.match_start=q,et<=(Z=M))break;Pt=st[z+Z-1],kt=st[z+Z]}}while((q=K[q&ot])>V&&--D!=0);return Z<=C.lookahead?Z:C.lookahead}function bt(C){var q,W,M,D,z,Z,et,V,st,ot,K=C.w_size;do{if(D=C.window_size-C.lookahead-C.strstart,C.strstart>=K+(K-j)){for(a.arraySet(C.window,C.window,K,K,0),C.match_start-=K,C.strstart-=K,C.block_start-=K,q=W=C.hash_size;M=C.head[--q],C.head[q]=K<=M?M-K:0,--W;);for(q=W=K;M=C.prev[--q],C.prev[q]=K<=M?M-K:0,--W;);D+=K}if(C.strm.avail_in===0)break;if(Z=C.strm,et=C.window,V=C.strstart+C.lookahead,st=D,ot=void 0,ot=Z.avail_in,st<ot&&(ot=st),W=ot===0?0:(Z.avail_in-=ot,a.arraySet(et,Z.input,Z.next_in,ot,V),Z.state.wrap===1?Z.adler=l(Z.adler,et,ot,V):Z.state.wrap===2&&(Z.adler=h(Z.adler,et,ot,V)),Z.next_in+=ot,Z.total_in+=ot,ot),C.lookahead+=W,C.lookahead+C.insert>=R)for(z=C.strstart-C.insert,C.ins_h=C.window[z],C.ins_h=(C.ins_h<<C.hash_shift^C.window[z+1])&C.hash_mask;C.insert&&(C.ins_h=(C.ins_h<<C.hash_shift^C.window[z+R-1])&C.hash_mask,C.prev[z&C.w_mask]=C.head[C.ins_h],C.head[C.ins_h]=z,z++,C.insert--,!(C.lookahead+C.insert<R)););}while(C.lookahead<j&&C.strm.avail_in!==0)}function pt(C,q){for(var W,M;;){if(C.lookahead<j){if(bt(C),C.lookahead<j&&q===d)return S;if(C.lookahead===0)break}if(W=0,C.lookahead>=R&&(C.ins_h=(C.ins_h<<C.hash_shift^C.window[C.strstart+R-1])&C.hash_mask,W=C.prev[C.strstart&C.w_mask]=C.head[C.ins_h],C.head[C.ins_h]=C.strstart),W!==0&&C.strstart-W<=C.w_size-j&&(C.match_length=J(C,W)),C.match_length>=R)if(M=o._tr_tally(C,C.strstart-C.match_start,C.match_length-R),C.lookahead-=C.match_length,C.match_length<=C.max_lazy_match&&C.lookahead>=R){for(C.match_length--;C.strstart++,C.ins_h=(C.ins_h<<C.hash_shift^C.window[C.strstart+R-1])&C.hash_mask,W=C.prev[C.strstart&C.w_mask]=C.head[C.ins_h],C.head[C.ins_h]=C.strstart,--C.match_length!=0;);C.strstart++}else C.strstart+=C.match_length,C.match_length=0,C.ins_h=C.window[C.strstart],C.ins_h=(C.ins_h<<C.hash_shift^C.window[C.strstart+1])&C.hash_mask;else M=o._tr_tally(C,0,C.window[C.strstart]),C.lookahead--,C.strstart++;if(M&&(O(C,!1),C.strm.avail_out===0))return S}return C.insert=C.strstart<R-1?C.strstart:R-1,q===u?(O(C,!0),C.strm.avail_out===0?G:U):C.last_lit&&(O(C,!1),C.strm.avail_out===0)?S:N}function ft(C,q){for(var W,M,D;;){if(C.lookahead<j){if(bt(C),C.lookahead<j&&q===d)return S;if(C.lookahead===0)break}if(W=0,C.lookahead>=R&&(C.ins_h=(C.ins_h<<C.hash_shift^C.window[C.strstart+R-1])&C.hash_mask,W=C.prev[C.strstart&C.w_mask]=C.head[C.ins_h],C.head[C.ins_h]=C.strstart),C.prev_length=C.match_length,C.prev_match=C.match_start,C.match_length=R-1,W!==0&&C.prev_length<C.max_lazy_match&&C.strstart-W<=C.w_size-j&&(C.match_length=J(C,W),C.match_length<=5&&(C.strategy===1||C.match_length===R&&4096<C.strstart-C.match_start)&&(C.match_length=R-1)),C.prev_length>=R&&C.match_length<=C.prev_length){for(D=C.strstart+C.lookahead-R,M=o._tr_tally(C,C.strstart-1-C.prev_match,C.prev_length-R),C.lookahead-=C.prev_length-1,C.prev_length-=2;++C.strstart<=D&&(C.ins_h=(C.ins_h<<C.hash_shift^C.window[C.strstart+R-1])&C.hash_mask,W=C.prev[C.strstart&C.w_mask]=C.head[C.ins_h],C.head[C.ins_h]=C.strstart),--C.prev_length!=0;);if(C.match_available=0,C.match_length=R-1,C.strstart++,M&&(O(C,!1),C.strm.avail_out===0))return S}else if(C.match_available){if((M=o._tr_tally(C,0,C.window[C.strstart-1]))&&O(C,!1),C.strstart++,C.lookahead--,C.strm.avail_out===0)return S}else C.match_available=1,C.strstart++,C.lookahead--}return C.match_available&&(M=o._tr_tally(C,0,C.window[C.strstart-1]),C.match_available=0),C.insert=C.strstart<R-1?C.strstart:R-1,q===u?(O(C,!0),C.strm.avail_out===0?G:U):C.last_lit&&(O(C,!1),C.strm.avail_out===0)?S:N}function yt(C,q,W,M,D){this.good_length=C,this.max_lazy=q,this.nice_length=W,this.max_chain=M,this.func=D}function It(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=A,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new a.Buf16(2*P),this.dyn_dtree=new a.Buf16(2*(2*k+1)),this.bl_tree=new a.Buf16(2*(2*T+1)),lt(this.dyn_ltree),lt(this.dyn_dtree),lt(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new a.Buf16(F+1),this.heap=new a.Buf16(2*x+1),lt(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new a.Buf16(2*x+1),lt(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function xt(C){var q;return C&&C.state?(C.total_in=C.total_out=0,C.data_type=b,(q=C.state).pending=0,q.pending_out=0,q.wrap<0&&(q.wrap=-q.wrap),q.status=q.wrap?I:L,C.adler=q.wrap===2?0:1,q.last_flush=d,o._tr_init(q),f):it(C,y)}function qt(C){var q=xt(C);return q===f&&function(W){W.window_size=2*W.w_size,lt(W.head),W.max_lazy_match=r[W.level].max_lazy,W.good_match=r[W.level].good_length,W.nice_match=r[W.level].nice_length,W.max_chain_length=r[W.level].max_chain,W.strstart=0,W.block_start=0,W.lookahead=0,W.insert=0,W.match_length=W.prev_length=R-1,W.match_available=0,W.ins_h=0}(C.state),q}function te(C,q,W,M,D,z){if(!C)return y;var Z=1;if(q===g&&(q=6),M<0?(Z=0,M=-M):15<M&&(Z=2,M-=16),D<1||_<D||W!==A||M<8||15<M||q<0||9<q||z<0||v<z)return it(C,y);M===8&&(M=9);var et=new It;return(C.state=et).strm=C,et.wrap=Z,et.gzhead=null,et.w_bits=M,et.w_size=1<<et.w_bits,et.w_mask=et.w_size-1,et.hash_bits=D+7,et.hash_size=1<<et.hash_bits,et.hash_mask=et.hash_size-1,et.hash_shift=~~((et.hash_bits+R-1)/R),et.window=new a.Buf8(2*et.w_size),et.head=new a.Buf16(et.hash_size),et.prev=new a.Buf16(et.w_size),et.lit_bufsize=1<<D+6,et.pending_buf_size=4*et.lit_bufsize,et.pending_buf=new a.Buf8(et.pending_buf_size),et.d_buf=1*et.lit_bufsize,et.l_buf=3*et.lit_bufsize,et.level=q,et.strategy=z,et.method=W,qt(C)}r=[new yt(0,0,0,0,function(C,q){var W=65535;for(W>C.pending_buf_size-5&&(W=C.pending_buf_size-5);;){if(C.lookahead<=1){if(bt(C),C.lookahead===0&&q===d)return S;if(C.lookahead===0)break}C.strstart+=C.lookahead,C.lookahead=0;var M=C.block_start+W;if((C.strstart===0||C.strstart>=M)&&(C.lookahead=C.strstart-M,C.strstart=M,O(C,!1),C.strm.avail_out===0)||C.strstart-C.block_start>=C.w_size-j&&(O(C,!1),C.strm.avail_out===0))return S}return C.insert=0,q===u?(O(C,!0),C.strm.avail_out===0?G:U):(C.strstart>C.block_start&&(O(C,!1),C.strm.avail_out),S)}),new yt(4,4,8,4,pt),new yt(4,5,16,8,pt),new yt(4,6,32,32,pt),new yt(4,4,16,16,ft),new yt(8,16,32,32,ft),new yt(8,16,128,128,ft),new yt(8,32,128,256,ft),new yt(32,128,258,1024,ft),new yt(32,258,258,4096,ft)],i.deflateInit=function(C,q){return te(C,q,A,15,8,0)},i.deflateInit2=te,i.deflateReset=qt,i.deflateResetKeep=xt,i.deflateSetHeader=function(C,q){return C&&C.state?C.state.wrap!==2?y:(C.state.gzhead=q,f):y},i.deflate=function(C,q){var W,M,D,z;if(!C||!C.state||5<q||q<0)return C?it(C,y):y;if(M=C.state,!C.output||!C.input&&C.avail_in!==0||M.status===666&&q!==u)return it(C,C.avail_out===0?-5:y);if(M.strm=C,W=M.last_flush,M.last_flush=q,M.status===I)if(M.wrap===2)C.adler=0,Q(M,31),Q(M,139),Q(M,8),M.gzhead?(Q(M,(M.gzhead.text?1:0)+(M.gzhead.hcrc?2:0)+(M.gzhead.extra?4:0)+(M.gzhead.name?8:0)+(M.gzhead.comment?16:0)),Q(M,255&M.gzhead.time),Q(M,M.gzhead.time>>8&255),Q(M,M.gzhead.time>>16&255),Q(M,M.gzhead.time>>24&255),Q(M,M.level===9?2:2<=M.strategy||M.level<2?4:0),Q(M,255&M.gzhead.os),M.gzhead.extra&&M.gzhead.extra.length&&(Q(M,255&M.gzhead.extra.length),Q(M,M.gzhead.extra.length>>8&255)),M.gzhead.hcrc&&(C.adler=h(C.adler,M.pending_buf,M.pending,0)),M.gzindex=0,M.status=69):(Q(M,0),Q(M,0),Q(M,0),Q(M,0),Q(M,0),Q(M,M.level===9?2:2<=M.strategy||M.level<2?4:0),Q(M,3),M.status=L);else{var Z=A+(M.w_bits-8<<4)<<8;Z|=(2<=M.strategy||M.level<2?0:M.level<6?1:M.level===6?2:3)<<6,M.strstart!==0&&(Z|=32),Z+=31-Z%31,M.status=L,tt(M,Z),M.strstart!==0&&(tt(M,C.adler>>>16),tt(M,65535&C.adler)),C.adler=1}if(M.status===69)if(M.gzhead.extra){for(D=M.pending;M.gzindex<(65535&M.gzhead.extra.length)&&(M.pending!==M.pending_buf_size||(M.gzhead.hcrc&&M.pending>D&&(C.adler=h(C.adler,M.pending_buf,M.pending-D,D)),H(C),D=M.pending,M.pending!==M.pending_buf_size));)Q(M,255&M.gzhead.extra[M.gzindex]),M.gzindex++;M.gzhead.hcrc&&M.pending>D&&(C.adler=h(C.adler,M.pending_buf,M.pending-D,D)),M.gzindex===M.gzhead.extra.length&&(M.gzindex=0,M.status=73)}else M.status=73;if(M.status===73)if(M.gzhead.name){D=M.pending;do{if(M.pending===M.pending_buf_size&&(M.gzhead.hcrc&&M.pending>D&&(C.adler=h(C.adler,M.pending_buf,M.pending-D,D)),H(C),D=M.pending,M.pending===M.pending_buf_size)){z=1;break}z=M.gzindex<M.gzhead.name.length?255&M.gzhead.name.charCodeAt(M.gzindex++):0,Q(M,z)}while(z!==0);M.gzhead.hcrc&&M.pending>D&&(C.adler=h(C.adler,M.pending_buf,M.pending-D,D)),z===0&&(M.gzindex=0,M.status=91)}else M.status=91;if(M.status===91)if(M.gzhead.comment){D=M.pending;do{if(M.pending===M.pending_buf_size&&(M.gzhead.hcrc&&M.pending>D&&(C.adler=h(C.adler,M.pending_buf,M.pending-D,D)),H(C),D=M.pending,M.pending===M.pending_buf_size)){z=1;break}z=M.gzindex<M.gzhead.comment.length?255&M.gzhead.comment.charCodeAt(M.gzindex++):0,Q(M,z)}while(z!==0);M.gzhead.hcrc&&M.pending>D&&(C.adler=h(C.adler,M.pending_buf,M.pending-D,D)),z===0&&(M.status=103)}else M.status=103;if(M.status===103&&(M.gzhead.hcrc?(M.pending+2>M.pending_buf_size&&H(C),M.pending+2<=M.pending_buf_size&&(Q(M,255&C.adler),Q(M,C.adler>>8&255),C.adler=0,M.status=L)):M.status=L),M.pending!==0){if(H(C),C.avail_out===0)return M.last_flush=-1,f}else if(C.avail_in===0&&Y(q)<=Y(W)&&q!==u)return it(C,-5);if(M.status===666&&C.avail_in!==0)return it(C,-5);if(C.avail_in!==0||M.lookahead!==0||q!==d&&M.status!==666){var et=M.strategy===2?function(V,st){for(var ot;;){if(V.lookahead===0&&(bt(V),V.lookahead===0)){if(st===d)return S;break}if(V.match_length=0,ot=o._tr_tally(V,0,V.window[V.strstart]),V.lookahead--,V.strstart++,ot&&(O(V,!1),V.strm.avail_out===0))return S}return V.insert=0,st===u?(O(V,!0),V.strm.avail_out===0?G:U):V.last_lit&&(O(V,!1),V.strm.avail_out===0)?S:N}(M,q):M.strategy===3?function(V,st){for(var ot,K,dt,Pt,kt=V.window;;){if(V.lookahead<=B){if(bt(V),V.lookahead<=B&&st===d)return S;if(V.lookahead===0)break}if(V.match_length=0,V.lookahead>=R&&0<V.strstart&&(K=kt[dt=V.strstart-1])===kt[++dt]&&K===kt[++dt]&&K===kt[++dt]){Pt=V.strstart+B;do;while(K===kt[++dt]&&K===kt[++dt]&&K===kt[++dt]&&K===kt[++dt]&&K===kt[++dt]&&K===kt[++dt]&&K===kt[++dt]&&K===kt[++dt]&&dt<Pt);V.match_length=B-(Pt-dt),V.match_length>V.lookahead&&(V.match_length=V.lookahead)}if(V.match_length>=R?(ot=o._tr_tally(V,1,V.match_length-R),V.lookahead-=V.match_length,V.strstart+=V.match_length,V.match_length=0):(ot=o._tr_tally(V,0,V.window[V.strstart]),V.lookahead--,V.strstart++),ot&&(O(V,!1),V.strm.avail_out===0))return S}return V.insert=0,st===u?(O(V,!0),V.strm.avail_out===0?G:U):V.last_lit&&(O(V,!1),V.strm.avail_out===0)?S:N}(M,q):r[M.level].func(M,q);if(et!==G&&et!==U||(M.status=666),et===S||et===G)return C.avail_out===0&&(M.last_flush=-1),f;if(et===N&&(q===1?o._tr_align(M):q!==5&&(o._tr_stored_block(M,0,0,!1),q===3&&(lt(M.head),M.lookahead===0&&(M.strstart=0,M.block_start=0,M.insert=0))),H(C),C.avail_out===0))return M.last_flush=-1,f}return q!==u?f:M.wrap<=0?1:(M.wrap===2?(Q(M,255&C.adler),Q(M,C.adler>>8&255),Q(M,C.adler>>16&255),Q(M,C.adler>>24&255),Q(M,255&C.total_in),Q(M,C.total_in>>8&255),Q(M,C.total_in>>16&255),Q(M,C.total_in>>24&255)):(tt(M,C.adler>>>16),tt(M,65535&C.adler)),H(C),0<M.wrap&&(M.wrap=-M.wrap),M.pending!==0?f:1)},i.deflateEnd=function(C){var q;return C&&C.state?(q=C.state.status)!==I&&q!==69&&q!==73&&q!==91&&q!==103&&q!==L&&q!==666?it(C,y):(C.state=null,q===L?it(C,-3):f):y},i.deflateSetDictionary=function(C,q){var W,M,D,z,Z,et,V,st,ot=q.length;if(!C||!C.state||(z=(W=C.state).wrap)===2||z===1&&W.status!==I||W.lookahead)return y;for(z===1&&(C.adler=l(C.adler,q,ot,0)),W.wrap=0,ot>=W.w_size&&(z===0&&(lt(W.head),W.strstart=0,W.block_start=0,W.insert=0),st=new a.Buf8(W.w_size),a.arraySet(st,q,ot-W.w_size,W.w_size,0),q=st,ot=W.w_size),Z=C.avail_in,et=C.next_in,V=C.input,C.avail_in=ot,C.next_in=0,C.input=q,bt(W);W.lookahead>=R;){for(M=W.strstart,D=W.lookahead-(R-1);W.ins_h=(W.ins_h<<W.hash_shift^W.window[M+R-1])&W.hash_mask,W.prev[M&W.w_mask]=W.head[W.ins_h],W.head[W.ins_h]=M,M++,--D;);W.strstart=M,W.lookahead=R-1,bt(W)}return W.strstart+=W.lookahead,W.block_start=W.strstart,W.insert=W.lookahead,W.lookahead=0,W.match_length=W.prev_length=R-1,W.match_available=0,C.next_in=et,C.input=V,C.avail_in=Z,W.wrap=z,f},i.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(t,s,i){s.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(t,s,i){s.exports=function(r,a){var o,l,h,c,d,u,f,y,g,v,b,A,_,x,k,T,P,F,R,B,j,I,L,S,N;o=r.state,l=r.next_in,S=r.input,h=l+(r.avail_in-5),c=r.next_out,N=r.output,d=c-(a-r.avail_out),u=c+(r.avail_out-257),f=o.dmax,y=o.wsize,g=o.whave,v=o.wnext,b=o.window,A=o.hold,_=o.bits,x=o.lencode,k=o.distcode,T=(1<<o.lenbits)-1,P=(1<<o.distbits)-1;t:do{_<15&&(A+=S[l++]<<_,_+=8,A+=S[l++]<<_,_+=8),F=x[A&T];e:for(;;){if(A>>>=R=F>>>24,_-=R,(R=F>>>16&255)===0)N[c++]=65535&F;else{if(!(16&R)){if(!(64&R)){F=x[(65535&F)+(A&(1<<R)-1)];continue e}if(32&R){o.mode=12;break t}r.msg="invalid literal/length code",o.mode=30;break t}B=65535&F,(R&=15)&&(_<R&&(A+=S[l++]<<_,_+=8),B+=A&(1<<R)-1,A>>>=R,_-=R),_<15&&(A+=S[l++]<<_,_+=8,A+=S[l++]<<_,_+=8),F=k[A&P];s:for(;;){if(A>>>=R=F>>>24,_-=R,!(16&(R=F>>>16&255))){if(!(64&R)){F=k[(65535&F)+(A&(1<<R)-1)];continue s}r.msg="invalid distance code",o.mode=30;break t}if(j=65535&F,_<(R&=15)&&(A+=S[l++]<<_,(_+=8)<R&&(A+=S[l++]<<_,_+=8)),f<(j+=A&(1<<R)-1)){r.msg="invalid distance too far back",o.mode=30;break t}if(A>>>=R,_-=R,(R=c-d)<j){if(g<(R=j-R)&&o.sane){r.msg="invalid distance too far back",o.mode=30;break t}if(L=b,(I=0)===v){if(I+=y-R,R<B){for(B-=R;N[c++]=b[I++],--R;);I=c-j,L=N}}else if(v<R){if(I+=y+v-R,(R-=v)<B){for(B-=R;N[c++]=b[I++],--R;);if(I=0,v<B){for(B-=R=v;N[c++]=b[I++],--R;);I=c-j,L=N}}}else if(I+=v-R,R<B){for(B-=R;N[c++]=b[I++],--R;);I=c-j,L=N}for(;2<B;)N[c++]=L[I++],N[c++]=L[I++],N[c++]=L[I++],B-=3;B&&(N[c++]=L[I++],1<B&&(N[c++]=L[I++]))}else{for(I=c-j;N[c++]=N[I++],N[c++]=N[I++],N[c++]=N[I++],2<(B-=3););B&&(N[c++]=N[I++],1<B&&(N[c++]=N[I++]))}break}}break}}while(l<h&&c<u);l-=B=_>>3,A&=(1<<(_-=B<<3))-1,r.next_in=l,r.next_out=c,r.avail_in=l<h?h-l+5:5-(l-h),r.avail_out=c<u?u-c+257:257-(c-u),o.hold=A,o.bits=_}},{}],49:[function(t,s,i){var r=t("../utils/common"),a=t("./adler32"),o=t("./crc32"),l=t("./inffast"),h=t("./inftrees"),c=1,d=2,u=0,f=-2,y=1,g=852,v=592;function b(I){return(I>>>24&255)+(I>>>8&65280)+((65280&I)<<8)+((255&I)<<24)}function A(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new r.Buf16(320),this.work=new r.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function _(I){var L;return I&&I.state?(L=I.state,I.total_in=I.total_out=L.total=0,I.msg="",L.wrap&&(I.adler=1&L.wrap),L.mode=y,L.last=0,L.havedict=0,L.dmax=32768,L.head=null,L.hold=0,L.bits=0,L.lencode=L.lendyn=new r.Buf32(g),L.distcode=L.distdyn=new r.Buf32(v),L.sane=1,L.back=-1,u):f}function x(I){var L;return I&&I.state?((L=I.state).wsize=0,L.whave=0,L.wnext=0,_(I)):f}function k(I,L){var S,N;return I&&I.state?(N=I.state,L<0?(S=0,L=-L):(S=1+(L>>4),L<48&&(L&=15)),L&&(L<8||15<L)?f:(N.window!==null&&N.wbits!==L&&(N.window=null),N.wrap=S,N.wbits=L,x(I))):f}function T(I,L){var S,N;return I?(N=new A,(I.state=N).window=null,(S=k(I,L))!==u&&(I.state=null),S):f}var P,F,R=!0;function B(I){if(R){var L;for(P=new r.Buf32(512),F=new r.Buf32(32),L=0;L<144;)I.lens[L++]=8;for(;L<256;)I.lens[L++]=9;for(;L<280;)I.lens[L++]=7;for(;L<288;)I.lens[L++]=8;for(h(c,I.lens,0,288,P,0,I.work,{bits:9}),L=0;L<32;)I.lens[L++]=5;h(d,I.lens,0,32,F,0,I.work,{bits:5}),R=!1}I.lencode=P,I.lenbits=9,I.distcode=F,I.distbits=5}function j(I,L,S,N){var G,U=I.state;return U.window===null&&(U.wsize=1<<U.wbits,U.wnext=0,U.whave=0,U.window=new r.Buf8(U.wsize)),N>=U.wsize?(r.arraySet(U.window,L,S-U.wsize,U.wsize,0),U.wnext=0,U.whave=U.wsize):(N<(G=U.wsize-U.wnext)&&(G=N),r.arraySet(U.window,L,S-N,G,U.wnext),(N-=G)?(r.arraySet(U.window,L,S-N,N,0),U.wnext=N,U.whave=U.wsize):(U.wnext+=G,U.wnext===U.wsize&&(U.wnext=0),U.whave<U.wsize&&(U.whave+=G))),0}i.inflateReset=x,i.inflateReset2=k,i.inflateResetKeep=_,i.inflateInit=function(I){return T(I,15)},i.inflateInit2=T,i.inflate=function(I,L){var S,N,G,U,it,Y,lt,H,O,Q,tt,J,bt,pt,ft,yt,It,xt,qt,te,C,q,W,M,D=0,z=new r.Buf8(4),Z=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!I||!I.state||!I.output||!I.input&&I.avail_in!==0)return f;(S=I.state).mode===12&&(S.mode=13),it=I.next_out,G=I.output,lt=I.avail_out,U=I.next_in,N=I.input,Y=I.avail_in,H=S.hold,O=S.bits,Q=Y,tt=lt,q=u;t:for(;;)switch(S.mode){case y:if(S.wrap===0){S.mode=13;break}for(;O<16;){if(Y===0)break t;Y--,H+=N[U++]<<O,O+=8}if(2&S.wrap&&H===35615){z[S.check=0]=255&H,z[1]=H>>>8&255,S.check=o(S.check,z,2,0),O=H=0,S.mode=2;break}if(S.flags=0,S.head&&(S.head.done=!1),!(1&S.wrap)||(((255&H)<<8)+(H>>8))%31){I.msg="incorrect header check",S.mode=30;break}if((15&H)!=8){I.msg="unknown compression method",S.mode=30;break}if(O-=4,C=8+(15&(H>>>=4)),S.wbits===0)S.wbits=C;else if(C>S.wbits){I.msg="invalid window size",S.mode=30;break}S.dmax=1<<C,I.adler=S.check=1,S.mode=512&H?10:12,O=H=0;break;case 2:for(;O<16;){if(Y===0)break t;Y--,H+=N[U++]<<O,O+=8}if(S.flags=H,(255&S.flags)!=8){I.msg="unknown compression method",S.mode=30;break}if(57344&S.flags){I.msg="unknown header flags set",S.mode=30;break}S.head&&(S.head.text=H>>8&1),512&S.flags&&(z[0]=255&H,z[1]=H>>>8&255,S.check=o(S.check,z,2,0)),O=H=0,S.mode=3;case 3:for(;O<32;){if(Y===0)break t;Y--,H+=N[U++]<<O,O+=8}S.head&&(S.head.time=H),512&S.flags&&(z[0]=255&H,z[1]=H>>>8&255,z[2]=H>>>16&255,z[3]=H>>>24&255,S.check=o(S.check,z,4,0)),O=H=0,S.mode=4;case 4:for(;O<16;){if(Y===0)break t;Y--,H+=N[U++]<<O,O+=8}S.head&&(S.head.xflags=255&H,S.head.os=H>>8),512&S.flags&&(z[0]=255&H,z[1]=H>>>8&255,S.check=o(S.check,z,2,0)),O=H=0,S.mode=5;case 5:if(1024&S.flags){for(;O<16;){if(Y===0)break t;Y--,H+=N[U++]<<O,O+=8}S.length=H,S.head&&(S.head.extra_len=H),512&S.flags&&(z[0]=255&H,z[1]=H>>>8&255,S.check=o(S.check,z,2,0)),O=H=0}else S.head&&(S.head.extra=null);S.mode=6;case 6:if(1024&S.flags&&(Y<(J=S.length)&&(J=Y),J&&(S.head&&(C=S.head.extra_len-S.length,S.head.extra||(S.head.extra=new Array(S.head.extra_len)),r.arraySet(S.head.extra,N,U,J,C)),512&S.flags&&(S.check=o(S.check,N,J,U)),Y-=J,U+=J,S.length-=J),S.length))break t;S.length=0,S.mode=7;case 7:if(2048&S.flags){if(Y===0)break t;for(J=0;C=N[U+J++],S.head&&C&&S.length<65536&&(S.head.name+=String.fromCharCode(C)),C&&J<Y;);if(512&S.flags&&(S.check=o(S.check,N,J,U)),Y-=J,U+=J,C)break t}else S.head&&(S.head.name=null);S.length=0,S.mode=8;case 8:if(4096&S.flags){if(Y===0)break t;for(J=0;C=N[U+J++],S.head&&C&&S.length<65536&&(S.head.comment+=String.fromCharCode(C)),C&&J<Y;);if(512&S.flags&&(S.check=o(S.check,N,J,U)),Y-=J,U+=J,C)break t}else S.head&&(S.head.comment=null);S.mode=9;case 9:if(512&S.flags){for(;O<16;){if(Y===0)break t;Y--,H+=N[U++]<<O,O+=8}if(H!==(65535&S.check)){I.msg="header crc mismatch",S.mode=30;break}O=H=0}S.head&&(S.head.hcrc=S.flags>>9&1,S.head.done=!0),I.adler=S.check=0,S.mode=12;break;case 10:for(;O<32;){if(Y===0)break t;Y--,H+=N[U++]<<O,O+=8}I.adler=S.check=b(H),O=H=0,S.mode=11;case 11:if(S.havedict===0)return I.next_out=it,I.avail_out=lt,I.next_in=U,I.avail_in=Y,S.hold=H,S.bits=O,2;I.adler=S.check=1,S.mode=12;case 12:if(L===5||L===6)break t;case 13:if(S.last){H>>>=7&O,O-=7&O,S.mode=27;break}for(;O<3;){if(Y===0)break t;Y--,H+=N[U++]<<O,O+=8}switch(S.last=1&H,O-=1,3&(H>>>=1)){case 0:S.mode=14;break;case 1:if(B(S),S.mode=20,L!==6)break;H>>>=2,O-=2;break t;case 2:S.mode=17;break;case 3:I.msg="invalid block type",S.mode=30}H>>>=2,O-=2;break;case 14:for(H>>>=7&O,O-=7&O;O<32;){if(Y===0)break t;Y--,H+=N[U++]<<O,O+=8}if((65535&H)!=(H>>>16^65535)){I.msg="invalid stored block lengths",S.mode=30;break}if(S.length=65535&H,O=H=0,S.mode=15,L===6)break t;case 15:S.mode=16;case 16:if(J=S.length){if(Y<J&&(J=Y),lt<J&&(J=lt),J===0)break t;r.arraySet(G,N,U,J,it),Y-=J,U+=J,lt-=J,it+=J,S.length-=J;break}S.mode=12;break;case 17:for(;O<14;){if(Y===0)break t;Y--,H+=N[U++]<<O,O+=8}if(S.nlen=257+(31&H),H>>>=5,O-=5,S.ndist=1+(31&H),H>>>=5,O-=5,S.ncode=4+(15&H),H>>>=4,O-=4,286<S.nlen||30<S.ndist){I.msg="too many length or distance symbols",S.mode=30;break}S.have=0,S.mode=18;case 18:for(;S.have<S.ncode;){for(;O<3;){if(Y===0)break t;Y--,H+=N[U++]<<O,O+=8}S.lens[Z[S.have++]]=7&H,H>>>=3,O-=3}for(;S.have<19;)S.lens[Z[S.have++]]=0;if(S.lencode=S.lendyn,S.lenbits=7,W={bits:S.lenbits},q=h(0,S.lens,0,19,S.lencode,0,S.work,W),S.lenbits=W.bits,q){I.msg="invalid code lengths set",S.mode=30;break}S.have=0,S.mode=19;case 19:for(;S.have<S.nlen+S.ndist;){for(;yt=(D=S.lencode[H&(1<<S.lenbits)-1])>>>16&255,It=65535&D,!((ft=D>>>24)<=O);){if(Y===0)break t;Y--,H+=N[U++]<<O,O+=8}if(It<16)H>>>=ft,O-=ft,S.lens[S.have++]=It;else{if(It===16){for(M=ft+2;O<M;){if(Y===0)break t;Y--,H+=N[U++]<<O,O+=8}if(H>>>=ft,O-=ft,S.have===0){I.msg="invalid bit length repeat",S.mode=30;break}C=S.lens[S.have-1],J=3+(3&H),H>>>=2,O-=2}else if(It===17){for(M=ft+3;O<M;){if(Y===0)break t;Y--,H+=N[U++]<<O,O+=8}O-=ft,C=0,J=3+(7&(H>>>=ft)),H>>>=3,O-=3}else{for(M=ft+7;O<M;){if(Y===0)break t;Y--,H+=N[U++]<<O,O+=8}O-=ft,C=0,J=11+(127&(H>>>=ft)),H>>>=7,O-=7}if(S.have+J>S.nlen+S.ndist){I.msg="invalid bit length repeat",S.mode=30;break}for(;J--;)S.lens[S.have++]=C}}if(S.mode===30)break;if(S.lens[256]===0){I.msg="invalid code -- missing end-of-block",S.mode=30;break}if(S.lenbits=9,W={bits:S.lenbits},q=h(c,S.lens,0,S.nlen,S.lencode,0,S.work,W),S.lenbits=W.bits,q){I.msg="invalid literal/lengths set",S.mode=30;break}if(S.distbits=6,S.distcode=S.distdyn,W={bits:S.distbits},q=h(d,S.lens,S.nlen,S.ndist,S.distcode,0,S.work,W),S.distbits=W.bits,q){I.msg="invalid distances set",S.mode=30;break}if(S.mode=20,L===6)break t;case 20:S.mode=21;case 21:if(6<=Y&&258<=lt){I.next_out=it,I.avail_out=lt,I.next_in=U,I.avail_in=Y,S.hold=H,S.bits=O,l(I,tt),it=I.next_out,G=I.output,lt=I.avail_out,U=I.next_in,N=I.input,Y=I.avail_in,H=S.hold,O=S.bits,S.mode===12&&(S.back=-1);break}for(S.back=0;yt=(D=S.lencode[H&(1<<S.lenbits)-1])>>>16&255,It=65535&D,!((ft=D>>>24)<=O);){if(Y===0)break t;Y--,H+=N[U++]<<O,O+=8}if(yt&&!(240&yt)){for(xt=ft,qt=yt,te=It;yt=(D=S.lencode[te+((H&(1<<xt+qt)-1)>>xt)])>>>16&255,It=65535&D,!(xt+(ft=D>>>24)<=O);){if(Y===0)break t;Y--,H+=N[U++]<<O,O+=8}H>>>=xt,O-=xt,S.back+=xt}if(H>>>=ft,O-=ft,S.back+=ft,S.length=It,yt===0){S.mode=26;break}if(32&yt){S.back=-1,S.mode=12;break}if(64&yt){I.msg="invalid literal/length code",S.mode=30;break}S.extra=15&yt,S.mode=22;case 22:if(S.extra){for(M=S.extra;O<M;){if(Y===0)break t;Y--,H+=N[U++]<<O,O+=8}S.length+=H&(1<<S.extra)-1,H>>>=S.extra,O-=S.extra,S.back+=S.extra}S.was=S.length,S.mode=23;case 23:for(;yt=(D=S.distcode[H&(1<<S.distbits)-1])>>>16&255,It=65535&D,!((ft=D>>>24)<=O);){if(Y===0)break t;Y--,H+=N[U++]<<O,O+=8}if(!(240&yt)){for(xt=ft,qt=yt,te=It;yt=(D=S.distcode[te+((H&(1<<xt+qt)-1)>>xt)])>>>16&255,It=65535&D,!(xt+(ft=D>>>24)<=O);){if(Y===0)break t;Y--,H+=N[U++]<<O,O+=8}H>>>=xt,O-=xt,S.back+=xt}if(H>>>=ft,O-=ft,S.back+=ft,64&yt){I.msg="invalid distance code",S.mode=30;break}S.offset=It,S.extra=15&yt,S.mode=24;case 24:if(S.extra){for(M=S.extra;O<M;){if(Y===0)break t;Y--,H+=N[U++]<<O,O+=8}S.offset+=H&(1<<S.extra)-1,H>>>=S.extra,O-=S.extra,S.back+=S.extra}if(S.offset>S.dmax){I.msg="invalid distance too far back",S.mode=30;break}S.mode=25;case 25:if(lt===0)break t;if(J=tt-lt,S.offset>J){if((J=S.offset-J)>S.whave&&S.sane){I.msg="invalid distance too far back",S.mode=30;break}bt=J>S.wnext?(J-=S.wnext,S.wsize-J):S.wnext-J,J>S.length&&(J=S.length),pt=S.window}else pt=G,bt=it-S.offset,J=S.length;for(lt<J&&(J=lt),lt-=J,S.length-=J;G[it++]=pt[bt++],--J;);S.length===0&&(S.mode=21);break;case 26:if(lt===0)break t;G[it++]=S.length,lt--,S.mode=21;break;case 27:if(S.wrap){for(;O<32;){if(Y===0)break t;Y--,H|=N[U++]<<O,O+=8}if(tt-=lt,I.total_out+=tt,S.total+=tt,tt&&(I.adler=S.check=S.flags?o(S.check,G,tt,it-tt):a(S.check,G,tt,it-tt)),tt=lt,(S.flags?H:b(H))!==S.check){I.msg="incorrect data check",S.mode=30;break}O=H=0}S.mode=28;case 28:if(S.wrap&&S.flags){for(;O<32;){if(Y===0)break t;Y--,H+=N[U++]<<O,O+=8}if(H!==(4294967295&S.total)){I.msg="incorrect length check",S.mode=30;break}O=H=0}S.mode=29;case 29:q=1;break t;case 30:q=-3;break t;case 31:return-4;case 32:default:return f}return I.next_out=it,I.avail_out=lt,I.next_in=U,I.avail_in=Y,S.hold=H,S.bits=O,(S.wsize||tt!==I.avail_out&&S.mode<30&&(S.mode<27||L!==4))&&j(I,I.output,I.next_out,tt-I.avail_out)?(S.mode=31,-4):(Q-=I.avail_in,tt-=I.avail_out,I.total_in+=Q,I.total_out+=tt,S.total+=tt,S.wrap&&tt&&(I.adler=S.check=S.flags?o(S.check,G,tt,I.next_out-tt):a(S.check,G,tt,I.next_out-tt)),I.data_type=S.bits+(S.last?64:0)+(S.mode===12?128:0)+(S.mode===20||S.mode===15?256:0),(Q==0&&tt===0||L===4)&&q===u&&(q=-5),q)},i.inflateEnd=function(I){if(!I||!I.state)return f;var L=I.state;return L.window&&(L.window=null),I.state=null,u},i.inflateGetHeader=function(I,L){var S;return I&&I.state&&2&(S=I.state).wrap?((S.head=L).done=!1,u):f},i.inflateSetDictionary=function(I,L){var S,N=L.length;return I&&I.state?(S=I.state).wrap!==0&&S.mode!==11?f:S.mode===11&&a(1,L,N,0)!==S.check?-3:j(I,L,N,N)?(S.mode=31,-4):(S.havedict=1,u):f},i.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(t,s,i){var r=t("../utils/common"),a=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],o=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],l=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],h=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];s.exports=function(c,d,u,f,y,g,v,b){var A,_,x,k,T,P,F,R,B,j=b.bits,I=0,L=0,S=0,N=0,G=0,U=0,it=0,Y=0,lt=0,H=0,O=null,Q=0,tt=new r.Buf16(16),J=new r.Buf16(16),bt=null,pt=0;for(I=0;I<=15;I++)tt[I]=0;for(L=0;L<f;L++)tt[d[u+L]]++;for(G=j,N=15;1<=N&&tt[N]===0;N--);if(N<G&&(G=N),N===0)return y[g++]=20971520,y[g++]=20971520,b.bits=1,0;for(S=1;S<N&&tt[S]===0;S++);for(G<S&&(G=S),I=Y=1;I<=15;I++)if(Y<<=1,(Y-=tt[I])<0)return-1;if(0<Y&&(c===0||N!==1))return-1;for(J[1]=0,I=1;I<15;I++)J[I+1]=J[I]+tt[I];for(L=0;L<f;L++)d[u+L]!==0&&(v[J[d[u+L]]++]=L);if(P=c===0?(O=bt=v,19):c===1?(O=a,Q-=257,bt=o,pt-=257,256):(O=l,bt=h,-1),I=S,T=g,it=L=H=0,x=-1,k=(lt=1<<(U=G))-1,c===1&&852<lt||c===2&&592<lt)return 1;for(;;){for(F=I-it,B=v[L]<P?(R=0,v[L]):v[L]>P?(R=bt[pt+v[L]],O[Q+v[L]]):(R=96,0),A=1<<I-it,S=_=1<<U;y[T+(H>>it)+(_-=A)]=F<<24|R<<16|B|0,_!==0;);for(A=1<<I-1;H&A;)A>>=1;if(A!==0?(H&=A-1,H+=A):H=0,L++,--tt[I]==0){if(I===N)break;I=d[u+v[L]]}if(G<I&&(H&k)!==x){for(it===0&&(it=G),T+=S,Y=1<<(U=I-it);U+it<N&&!((Y-=tt[U+it])<=0);)U++,Y<<=1;if(lt+=1<<U,c===1&&852<lt||c===2&&592<lt)return 1;y[x=H&k]=G<<24|U<<16|T-g|0}}return H!==0&&(y[T+H]=I-it<<24|64<<16|0),b.bits=G,0}},{"../utils/common":41}],51:[function(t,s,i){s.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(t,s,i){var r=t("../utils/common"),a=0,o=1;function l(D){for(var z=D.length;0<=--z;)D[z]=0}var h=0,c=29,d=256,u=d+1+c,f=30,y=19,g=2*u+1,v=15,b=16,A=7,_=256,x=16,k=17,T=18,P=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],F=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],R=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],B=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],j=new Array(2*(u+2));l(j);var I=new Array(2*f);l(I);var L=new Array(512);l(L);var S=new Array(256);l(S);var N=new Array(c);l(N);var G,U,it,Y=new Array(f);function lt(D,z,Z,et,V){this.static_tree=D,this.extra_bits=z,this.extra_base=Z,this.elems=et,this.max_length=V,this.has_stree=D&&D.length}function H(D,z){this.dyn_tree=D,this.max_code=0,this.stat_desc=z}function O(D){return D<256?L[D]:L[256+(D>>>7)]}function Q(D,z){D.pending_buf[D.pending++]=255&z,D.pending_buf[D.pending++]=z>>>8&255}function tt(D,z,Z){D.bi_valid>b-Z?(D.bi_buf|=z<<D.bi_valid&65535,Q(D,D.bi_buf),D.bi_buf=z>>b-D.bi_valid,D.bi_valid+=Z-b):(D.bi_buf|=z<<D.bi_valid&65535,D.bi_valid+=Z)}function J(D,z,Z){tt(D,Z[2*z],Z[2*z+1])}function bt(D,z){for(var Z=0;Z|=1&D,D>>>=1,Z<<=1,0<--z;);return Z>>>1}function pt(D,z,Z){var et,V,st=new Array(v+1),ot=0;for(et=1;et<=v;et++)st[et]=ot=ot+Z[et-1]<<1;for(V=0;V<=z;V++){var K=D[2*V+1];K!==0&&(D[2*V]=bt(st[K]++,K))}}function ft(D){var z;for(z=0;z<u;z++)D.dyn_ltree[2*z]=0;for(z=0;z<f;z++)D.dyn_dtree[2*z]=0;for(z=0;z<y;z++)D.bl_tree[2*z]=0;D.dyn_ltree[2*_]=1,D.opt_len=D.static_len=0,D.last_lit=D.matches=0}function yt(D){8<D.bi_valid?Q(D,D.bi_buf):0<D.bi_valid&&(D.pending_buf[D.pending++]=D.bi_buf),D.bi_buf=0,D.bi_valid=0}function It(D,z,Z,et){var V=2*z,st=2*Z;return D[V]<D[st]||D[V]===D[st]&&et[z]<=et[Z]}function xt(D,z,Z){for(var et=D.heap[Z],V=Z<<1;V<=D.heap_len&&(V<D.heap_len&&It(z,D.heap[V+1],D.heap[V],D.depth)&&V++,!It(z,et,D.heap[V],D.depth));)D.heap[Z]=D.heap[V],Z=V,V<<=1;D.heap[Z]=et}function qt(D,z,Z){var et,V,st,ot,K=0;if(D.last_lit!==0)for(;et=D.pending_buf[D.d_buf+2*K]<<8|D.pending_buf[D.d_buf+2*K+1],V=D.pending_buf[D.l_buf+K],K++,et===0?J(D,V,z):(J(D,(st=S[V])+d+1,z),(ot=P[st])!==0&&tt(D,V-=N[st],ot),J(D,st=O(--et),Z),(ot=F[st])!==0&&tt(D,et-=Y[st],ot)),K<D.last_lit;);J(D,_,z)}function te(D,z){var Z,et,V,st=z.dyn_tree,ot=z.stat_desc.static_tree,K=z.stat_desc.has_stree,dt=z.stat_desc.elems,Pt=-1;for(D.heap_len=0,D.heap_max=g,Z=0;Z<dt;Z++)st[2*Z]!==0?(D.heap[++D.heap_len]=Pt=Z,D.depth[Z]=0):st[2*Z+1]=0;for(;D.heap_len<2;)st[2*(V=D.heap[++D.heap_len]=Pt<2?++Pt:0)]=1,D.depth[V]=0,D.opt_len--,K&&(D.static_len-=ot[2*V+1]);for(z.max_code=Pt,Z=D.heap_len>>1;1<=Z;Z--)xt(D,st,Z);for(V=dt;Z=D.heap[1],D.heap[1]=D.heap[D.heap_len--],xt(D,st,1),et=D.heap[1],D.heap[--D.heap_max]=Z,D.heap[--D.heap_max]=et,st[2*V]=st[2*Z]+st[2*et],D.depth[V]=(D.depth[Z]>=D.depth[et]?D.depth[Z]:D.depth[et])+1,st[2*Z+1]=st[2*et+1]=V,D.heap[1]=V++,xt(D,st,1),2<=D.heap_len;);D.heap[--D.heap_max]=D.heap[1],function(kt,ve){var Ge,Qe,Ai,Ft,Yr,Vn,Zi=ve.dyn_tree,$y=ve.max_code,cA=ve.stat_desc.static_tree,dA=ve.stat_desc.has_stree,uA=ve.stat_desc.extra_bits,Yy=ve.stat_desc.extra_base,tc=ve.stat_desc.max_length,Cf=0;for(Ft=0;Ft<=v;Ft++)kt.bl_count[Ft]=0;for(Zi[2*kt.heap[kt.heap_max]+1]=0,Ge=kt.heap_max+1;Ge<g;Ge++)tc<(Ft=Zi[2*Zi[2*(Qe=kt.heap[Ge])+1]+1]+1)&&(Ft=tc,Cf++),Zi[2*Qe+1]=Ft,$y<Qe||(kt.bl_count[Ft]++,Yr=0,Yy<=Qe&&(Yr=uA[Qe-Yy]),Vn=Zi[2*Qe],kt.opt_len+=Vn*(Ft+Yr),dA&&(kt.static_len+=Vn*(cA[2*Qe+1]+Yr)));if(Cf!==0){do{for(Ft=tc-1;kt.bl_count[Ft]===0;)Ft--;kt.bl_count[Ft]--,kt.bl_count[Ft+1]+=2,kt.bl_count[tc]--,Cf-=2}while(0<Cf);for(Ft=tc;Ft!==0;Ft--)for(Qe=kt.bl_count[Ft];Qe!==0;)$y<(Ai=kt.heap[--Ge])||(Zi[2*Ai+1]!==Ft&&(kt.opt_len+=(Ft-Zi[2*Ai+1])*Zi[2*Ai],Zi[2*Ai+1]=Ft),Qe--)}}(D,z),pt(st,Pt,D.bl_count)}function C(D,z,Z){var et,V,st=-1,ot=z[1],K=0,dt=7,Pt=4;for(ot===0&&(dt=138,Pt=3),z[2*(Z+1)+1]=65535,et=0;et<=Z;et++)V=ot,ot=z[2*(et+1)+1],++K<dt&&V===ot||(K<Pt?D.bl_tree[2*V]+=K:V!==0?(V!==st&&D.bl_tree[2*V]++,D.bl_tree[2*x]++):K<=10?D.bl_tree[2*k]++:D.bl_tree[2*T]++,st=V,Pt=(K=0)===ot?(dt=138,3):V===ot?(dt=6,3):(dt=7,4))}function q(D,z,Z){var et,V,st=-1,ot=z[1],K=0,dt=7,Pt=4;for(ot===0&&(dt=138,Pt=3),et=0;et<=Z;et++)if(V=ot,ot=z[2*(et+1)+1],!(++K<dt&&V===ot)){if(K<Pt)for(;J(D,V,D.bl_tree),--K!=0;);else V!==0?(V!==st&&(J(D,V,D.bl_tree),K--),J(D,x,D.bl_tree),tt(D,K-3,2)):K<=10?(J(D,k,D.bl_tree),tt(D,K-3,3)):(J(D,T,D.bl_tree),tt(D,K-11,7));st=V,Pt=(K=0)===ot?(dt=138,3):V===ot?(dt=6,3):(dt=7,4)}}l(Y);var W=!1;function M(D,z,Z,et){tt(D,(h<<1)+(et?1:0),3),function(V,st,ot,K){yt(V),Q(V,ot),Q(V,~ot),r.arraySet(V.pending_buf,V.window,st,ot,V.pending),V.pending+=ot}(D,z,Z)}i._tr_init=function(D){W||(function(){var z,Z,et,V,st,ot=new Array(v+1);for(V=et=0;V<c-1;V++)for(N[V]=et,z=0;z<1<<P[V];z++)S[et++]=V;for(S[et-1]=V,V=st=0;V<16;V++)for(Y[V]=st,z=0;z<1<<F[V];z++)L[st++]=V;for(st>>=7;V<f;V++)for(Y[V]=st<<7,z=0;z<1<<F[V]-7;z++)L[256+st++]=V;for(Z=0;Z<=v;Z++)ot[Z]=0;for(z=0;z<=143;)j[2*z+1]=8,z++,ot[8]++;for(;z<=255;)j[2*z+1]=9,z++,ot[9]++;for(;z<=279;)j[2*z+1]=7,z++,ot[7]++;for(;z<=287;)j[2*z+1]=8,z++,ot[8]++;for(pt(j,u+1,ot),z=0;z<f;z++)I[2*z+1]=5,I[2*z]=bt(z,5);G=new lt(j,P,d+1,u,v),U=new lt(I,F,0,f,v),it=new lt(new Array(0),R,0,y,A)}(),W=!0),D.l_desc=new H(D.dyn_ltree,G),D.d_desc=new H(D.dyn_dtree,U),D.bl_desc=new H(D.bl_tree,it),D.bi_buf=0,D.bi_valid=0,ft(D)},i._tr_stored_block=M,i._tr_flush_block=function(D,z,Z,et){var V,st,ot=0;0<D.level?(D.strm.data_type===2&&(D.strm.data_type=function(K){var dt,Pt=4093624447;for(dt=0;dt<=31;dt++,Pt>>>=1)if(1&Pt&&K.dyn_ltree[2*dt]!==0)return a;if(K.dyn_ltree[18]!==0||K.dyn_ltree[20]!==0||K.dyn_ltree[26]!==0)return o;for(dt=32;dt<d;dt++)if(K.dyn_ltree[2*dt]!==0)return o;return a}(D)),te(D,D.l_desc),te(D,D.d_desc),ot=function(K){var dt;for(C(K,K.dyn_ltree,K.l_desc.max_code),C(K,K.dyn_dtree,K.d_desc.max_code),te(K,K.bl_desc),dt=y-1;3<=dt&&K.bl_tree[2*B[dt]+1]===0;dt--);return K.opt_len+=3*(dt+1)+5+5+4,dt}(D),V=D.opt_len+3+7>>>3,(st=D.static_len+3+7>>>3)<=V&&(V=st)):V=st=Z+5,Z+4<=V&&z!==-1?M(D,z,Z,et):D.strategy===4||st===V?(tt(D,2+(et?1:0),3),qt(D,j,I)):(tt(D,4+(et?1:0),3),function(K,dt,Pt,kt){var ve;for(tt(K,dt-257,5),tt(K,Pt-1,5),tt(K,kt-4,4),ve=0;ve<kt;ve++)tt(K,K.bl_tree[2*B[ve]+1],3);q(K,K.dyn_ltree,dt-1),q(K,K.dyn_dtree,Pt-1)}(D,D.l_desc.max_code+1,D.d_desc.max_code+1,ot+1),qt(D,D.dyn_ltree,D.dyn_dtree)),ft(D),et&&yt(D)},i._tr_tally=function(D,z,Z){return D.pending_buf[D.d_buf+2*D.last_lit]=z>>>8&255,D.pending_buf[D.d_buf+2*D.last_lit+1]=255&z,D.pending_buf[D.l_buf+D.last_lit]=255&Z,D.last_lit++,z===0?D.dyn_ltree[2*Z]++:(D.matches++,z--,D.dyn_ltree[2*(S[Z]+d+1)]++,D.dyn_dtree[2*O(z)]++),D.last_lit===D.lit_bufsize-1},i._tr_align=function(D){tt(D,2,3),J(D,_,j),function(z){z.bi_valid===16?(Q(z,z.bi_buf),z.bi_buf=0,z.bi_valid=0):8<=z.bi_valid&&(z.pending_buf[z.pending++]=255&z.bi_buf,z.bi_buf>>=8,z.bi_valid-=8)}(D)}},{"../utils/common":41}],53:[function(t,s,i){s.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(t,s,i){(function(r){(function(a,o){if(!a.setImmediate){var l,h,c,d,u=1,f={},y=!1,g=a.document,v=Object.getPrototypeOf&&Object.getPrototypeOf(a);v=v&&v.setTimeout?v:a,l={}.toString.call(a.process)==="[object process]"?function(x){process.nextTick(function(){A(x)})}:function(){if(a.postMessage&&!a.importScripts){var x=!0,k=a.onmessage;return a.onmessage=function(){x=!1},a.postMessage("","*"),a.onmessage=k,x}}()?(d="setImmediate$"+Math.random()+"$",a.addEventListener?a.addEventListener("message",_,!1):a.attachEvent("onmessage",_),function(x){a.postMessage(d+x,"*")}):a.MessageChannel?((c=new MessageChannel).port1.onmessage=function(x){A(x.data)},function(x){c.port2.postMessage(x)}):g&&"onreadystatechange"in g.createElement("script")?(h=g.documentElement,function(x){var k=g.createElement("script");k.onreadystatechange=function(){A(x),k.onreadystatechange=null,h.removeChild(k),k=null},h.appendChild(k)}):function(x){setTimeout(A,0,x)},v.setImmediate=function(x){typeof x!="function"&&(x=new Function(""+x));for(var k=new Array(arguments.length-1),T=0;T<k.length;T++)k[T]=arguments[T+1];var P={callback:x,args:k};return f[u]=P,l(u),u++},v.clearImmediate=b}function b(x){delete f[x]}function A(x){if(y)setTimeout(A,0,x);else{var k=f[x];if(k){y=!0;try{(function(T){var P=T.callback,F=T.args;switch(F.length){case 0:P();break;case 1:P(F[0]);break;case 2:P(F[0],F[1]);break;case 3:P(F[0],F[1],F[2]);break;default:P.apply(o,F)}})(k)}finally{b(x),y=!1}}}}function _(x){x.source===a&&typeof x.data=="string"&&x.data.indexOf(d)===0&&A(+x.data.slice(d.length))}})(typeof self>"u"?r===void 0?this:r:self)}).call(this,typeof xf<"u"?xf:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(hA);var _1=hA.exports;const S1=SA(_1);function E1(p){return p.name.toLowerCase().endsWith(".docx")||p.type==="application/vnd.openxmlformats-officedocument.wordprocessingml.document"}async function C1(p){return new Promise((e,t)=>{const s=new FileReader;s.onload=async i=>{var r,a;try{const o=(r=i.target)==null?void 0:r.result,l=await S1.loadAsync(o);let h="";const c=await((a=l.file("word/document.xml"))==null?void 0:a.async("string"));c&&(h=x1(c));const d=await k1(l);e({textContent:h,visualStyle:d})}catch(o){t(new Error("Failed to parse DOCX file: "+o.message))}},s.onerror=()=>t(new Error("Failed to read file")),s.readAsArrayBuffer(p)})}function x1(p){const e=p.match(/<w:t[^>]*>([^<]*)<\/w:t>/g);return e?e.map(t=>t.replace(/<[^>]*>/g,"")).join(" ").trim():""}async function k1(p){var e,t;try{const s=await((e=p.file("word/styles.xml"))==null?void 0:e.async("string")),i=await((t=p.file("word/settings.xml"))==null?void 0:t.async("string"));if(!s)return null;const r=T1(s),a=P1(i);return{fonts:r,layout:a}}catch{return null}}function T1(p){p.match(/<w:rStyle[^>]*w:styleId="[^"]*"[^>]*>([^<]*)<\/w:rStyle>/),p.match(/<w:rStyle[^>]*w:styleId="[^"]*"[^>]*>([^<]*)<\/w:rStyle>/);const e=p.match(/<w:rFonts[^>]*w:ascii="([^"]*)"/),t=p.match(/<w:rFonts[^>]*w:ascii="([^"]*)"/);return{header:e?e[1]:"Calibri",body:t?t[1]:"Calibri"}}function P1(p){if(!p)return{orientation:"portrait",margins:{top:1,bottom:1,left:1,right:1},hasHeader:!1,hasFooter:!1};const e=p.includes('<w:orient w:val="landscape"/>')?"landscape":"portrait",t=p.includes("<w:headerReference"),s=p.includes("<w:footerReference");return{orientation:e,margins:{top:1,bottom:1,left:1,right:1},hasHeader:t,hasFooter:s}}function E0(p,e,t){const s=p.slice();return s[26]=e[t],s}function C0(p){let e,t;return{c(){e=at("div"),t=Nt(p[3]),this.h()},l(s){e=rt(s,"DIV",{class:!0});var i=mt(e);t=Ot(i,p[3]),i.forEach(ht),this.h()},h(){nt(e,"class","bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded mb-4")},m(s,i){ke(s,e,i),X(e,t)},p(s,i){i&8&&xe(t,s[3])},d(s){s&&ht(e)}}}function x0(p){let e,t;return{c(){e=at("div"),t=Nt(p[4]),this.h()},l(s){e=rt(s,"DIV",{class:!0});var i=mt(e);t=Ot(i,p[4]),i.forEach(ht),this.h()},h(){nt(e,"class","bg-green-50 border border-green-200 text-green-700 px-4 py-3 rounded mb-4")},m(s,i){ke(s,e,i),X(e,t)},p(s,i){i&16&&xe(t,s[4])},d(s){s&&ht(e)}}}function k0(p){let e,t="Processing document...";return{c(){e=at("p"),e.textContent=t,this.h()},l(s){e=rt(s,"P",{class:!0,"data-svelte-h":!0}),ne(e)!=="svelte-vyxchb"&&(e.textContent=t),this.h()},h(){nt(e,"class","text-sm text-forest-600 mt-2")},m(s,i){ke(s,e,i)},d(s){s&&ht(e)}}}function T0(p){let e,t;return{c(){e=at("p"),t=Nt(p[6]),this.h()},l(s){e=rt(s,"P",{class:!0});var i=mt(e);t=Ot(i,p[6]),i.forEach(ht),this.h()},h(){nt(e,"class","text-sm text-red-600 mt-2")},m(s,i){ke(s,e,i),X(e,t)},p(s,i){i&64&&xe(t,s[6])},d(s){s&&ht(e)}}}function P0(p){let e,t,s="Visual Style Detected",i,r,a,o,l,h=p[7].fonts.header+"",c,d,u,f,y,g=p[7].fonts.body+"",v,b,A,_,x,k=p[7].layout.orientation+"",T,P,F,R,B,j=p[7].layout.margins.top+"",I,L,S,N,G,U,it=p[7].layout.hasHeader?"Yes":"No",Y,lt,H,O,Q,tt=p[7].layout.hasFooter?"Yes":"No",J;return{c(){e=at("div"),t=at("h4"),t.textContent=s,i=vt(),r=at("div"),a=at("div"),o=Nt("Header Font: "),l=at("span"),c=Nt(h),d=vt(),u=at("div"),f=Nt("Body Font: "),y=at("span"),v=Nt(g),b=vt(),A=at("div"),_=Nt("Orientation: "),x=at("span"),T=Nt(k),P=vt(),F=at("div"),R=Nt("Margins: "),B=at("span"),I=Nt(j),L=Nt(" inches"),S=vt(),N=at("div"),G=Nt("Header: "),U=at("span"),Y=Nt(it),lt=vt(),H=at("div"),O=Nt("Footer: "),Q=at("span"),J=Nt(tt),this.h()},l(bt){e=rt(bt,"DIV",{class:!0});var pt=mt(e);t=rt(pt,"H4",{class:!0,"data-svelte-h":!0}),ne(t)!=="svelte-stay8v"&&(t.textContent=s),i=wt(pt),r=rt(pt,"DIV",{class:!0});var ft=mt(r);a=rt(ft,"DIV",{});var yt=mt(a);o=Ot(yt,"Header Font: "),l=rt(yt,"SPAN",{class:!0});var It=mt(l);c=Ot(It,h),It.forEach(ht),yt.forEach(ht),d=wt(ft),u=rt(ft,"DIV",{});var xt=mt(u);f=Ot(xt,"Body Font: "),y=rt(xt,"SPAN",{class:!0});var qt=mt(y);v=Ot(qt,g),qt.forEach(ht),xt.forEach(ht),b=wt(ft),A=rt(ft,"DIV",{});var te=mt(A);_=Ot(te,"Orientation: "),x=rt(te,"SPAN",{class:!0});var C=mt(x);T=Ot(C,k),C.forEach(ht),te.forEach(ht),P=wt(ft),F=rt(ft,"DIV",{});var q=mt(F);R=Ot(q,"Margins: "),B=rt(q,"SPAN",{class:!0});var W=mt(B);I=Ot(W,j),L=Ot(W," inches"),W.forEach(ht),q.forEach(ht),S=wt(ft),N=rt(ft,"DIV",{});var M=mt(N);G=Ot(M,"Header: "),U=rt(M,"SPAN",{class:!0});var D=mt(U);Y=Ot(D,it),D.forEach(ht),M.forEach(ht),lt=wt(ft),H=rt(ft,"DIV",{});var z=mt(H);O=Ot(z,"Footer: "),Q=rt(z,"SPAN",{class:!0});var Z=mt(Q);J=Ot(Z,tt),Z.forEach(ht),z.forEach(ht),ft.forEach(ht),pt.forEach(ht),this.h()},h(){nt(t,"class","font-medium text-blue-900 mb-2"),nt(l,"class","font-medium"),nt(y,"class","font-medium"),nt(x,"class","font-medium"),nt(B,"class","font-medium"),nt(U,"class","font-medium"),nt(Q,"class","font-medium"),nt(r,"class","grid grid-cols-2 gap-2 text-sm"),nt(e,"class","p-4 bg-blue-50 border border-blue-200 rounded-lg")},m(bt,pt){ke(bt,e,pt),X(e,t),X(e,i),X(e,r),X(r,a),X(a,o),X(a,l),X(l,c),X(r,d),X(r,u),X(u,f),X(u,y),X(y,v),X(r,b),X(r,A),X(A,_),X(A,x),X(x,T),X(r,P),X(r,F),X(F,R),X(F,B),X(B,I),X(B,L),X(r,S),X(r,N),X(N,G),X(N,U),X(U,Y),X(r,lt),X(r,H),X(H,O),X(H,Q),X(Q,J)},p(bt,pt){pt&128&&h!==(h=bt[7].fonts.header+"")&&xe(c,h),pt&128&&g!==(g=bt[7].fonts.body+"")&&xe(v,g),pt&128&&k!==(k=bt[7].layout.orientation+"")&&xe(T,k),pt&128&&j!==(j=bt[7].layout.margins.top+"")&&xe(I,j),pt&128&&it!==(it=bt[7].layout.hasHeader?"Yes":"No")&&xe(Y,it),pt&128&&tt!==(tt=bt[7].layout.hasFooter?"Yes":"No")&&xe(J,tt)},d(bt){bt&&ht(e)}}}function D0(p){let e,t,s,i="Style Analysis Results",r,a,o,l,h="Tone",c,d,u,f,y,g="Structure",v,b,A,_,x,k="Formatting Rules",T,P,F,R,B="Save Style Profile",j,I;return{c(){e=at("hr"),t=vt(),s=at("h3"),s.textContent=i,r=vt(),a=at("div"),o=at("div"),l=at("label"),l.textContent=h,c=vt(),d=at("textarea"),u=vt(),f=at("div"),y=at("label"),y.textContent=g,v=vt(),b=at("textarea"),A=vt(),_=at("div"),x=at("label"),x.textContent=k,T=vt(),P=at("textarea"),F=vt(),R=at("button"),R.textContent=B,this.h()},l(L){e=rt(L,"HR",{class:!0}),t=wt(L),s=rt(L,"H3",{class:!0,"data-svelte-h":!0}),ne(s)!=="svelte-1vve3r3"&&(s.textContent=i),r=wt(L),a=rt(L,"DIV",{class:!0});var S=mt(a);o=rt(S,"DIV",{});var N=mt(o);l=rt(N,"LABEL",{for:!0,class:!0,"data-svelte-h":!0}),ne(l)!=="svelte-1xy9c1r"&&(l.textContent=h),c=wt(N),d=rt(N,"TEXTAREA",{id:!0,rows:!0,class:!0}),mt(d).forEach(ht),N.forEach(ht),u=wt(S),f=rt(S,"DIV",{});var G=mt(f);y=rt(G,"LABEL",{for:!0,class:!0,"data-svelte-h":!0}),ne(y)!=="svelte-1lredx"&&(y.textContent=g),v=wt(G),b=rt(G,"TEXTAREA",{id:!0,rows:!0,class:!0}),mt(b).forEach(ht),G.forEach(ht),A=wt(S),_=rt(S,"DIV",{});var U=mt(_);x=rt(U,"LABEL",{for:!0,class:!0,"data-svelte-h":!0}),ne(x)!=="svelte-12oe3fc"&&(x.textContent=k),T=wt(U),P=rt(U,"TEXTAREA",{id:!0,rows:!0,class:!0}),mt(P).forEach(ht),U.forEach(ht),F=wt(S),R=rt(S,"BUTTON",{class:!0,"data-svelte-h":!0}),ne(R)!=="svelte-pdlixo"&&(R.textContent=B),S.forEach(ht),this.h()},h(){nt(e,"class","my-6"),nt(s,"class","font-semibold mb-4"),nt(l,"for","tone"),nt(l,"class","block text-sm font-medium text-gray-700 mb-1"),nt(d,"id","tone"),nt(d,"rows","2"),nt(d,"class","input w-full"),nt(y,"for","structure"),nt(y,"class","block text-sm font-medium text-gray-700 mb-1"),nt(b,"id","structure"),nt(b,"rows","2"),nt(b,"class","input w-full"),nt(x,"for","formatting"),nt(x,"class","block text-sm font-medium text-gray-700 mb-1"),nt(P,"id","formatting"),nt(P,"rows","2"),nt(P,"class","input w-full"),nt(R,"class","btn btn-primary w-full"),nt(a,"class","space-y-4")},m(L,S){ke(L,e,S),ke(L,t,S),ke(L,s,S),ke(L,r,S),ke(L,a,S),X(a,o),X(o,l),X(o,c),X(o,d),Yi(d,p[8].tone),X(a,u),X(a,f),X(f,y),X(f,v),X(f,b),Yi(b,p[8].structure),X(a,A),X(a,_),X(_,x),X(_,T),X(_,P),Yi(P,p[8].formattingRules),X(a,F),X(a,R),j||(I=[vi(d,"input",p[17]),vi(b,"input",p[18]),vi(P,"input",p[19]),vi(R,"click",p[11])],j=!0)},p(L,S){S&256&&Yi(d,L[8].tone),S&256&&Yi(b,L[8].structure),S&256&&Yi(P,L[8].formattingRules)},d(L){L&&(ht(e),ht(t),ht(s),ht(r),ht(a)),j=!1,Iy(I)}}}function D1(p){let e,t=qy(p[0]),s=[];for(let i=0;i<t.length;i+=1)s[i]=M0(E0(p,t,i));return{c(){e=at("div");for(let i=0;i<s.length;i+=1)s[i].c();this.h()},l(i){e=rt(i,"DIV",{class:!0});var r=mt(e);for(let a=0;a<s.length;a+=1)s[a].l(r);r.forEach(ht),this.h()},h(){nt(e,"class","space-y-3")},m(i,r){ke(i,e,r);for(let a=0;a<s.length;a+=1)s[a]&&s[a].m(e,null)},p(i,r){if(r&20481){t=qy(i[0]);let a;for(a=0;a<t.length;a+=1){const o=E0(i,t,a);s[a]?s[a].p(o,r):(s[a]=M0(o),s[a].c(),s[a].m(e,null))}for(;a<s.length;a+=1)s[a].d(1);s.length=t.length}},d(i){i&&ht(e),yA(s,i)}}}function I1(p){let e,t="No style profiles yet";return{c(){e=at("p"),e.textContent=t,this.h()},l(s){e=rt(s,"P",{class:!0,"data-svelte-h":!0}),ne(e)!=="svelte-ja3l66"&&(e.textContent=t),this.h()},h(){nt(e,"class","text-gray-500")},m(s,i){ke(s,e,i)},p:yp,d(s){s&&ht(e)}}}function M1(p){let e,t="Loading profiles...";return{c(){e=at("p"),e.textContent=t,this.h()},l(s){e=rt(s,"P",{class:!0,"data-svelte-h":!0}),ne(e)!=="svelte-nmylls"&&(e.textContent=t),this.h()},h(){nt(e,"class","text-gray-500")},m(s,i){ke(s,e,i)},p:yp,d(s){s&&ht(e)}}}function I0(p){let e,t="Visual Style";return{c(){e=at("span"),e.textContent=t,this.h()},l(s){e=rt(s,"SPAN",{class:!0,"data-svelte-h":!0}),ne(e)!=="svelte-vxerd3"&&(e.textContent=t),this.h()},h(){nt(e,"class","text-xs px-2 py-0.5 bg-blue-100 text-blue-800 rounded")},m(s,i){ke(s,e,i)},d(s){s&&ht(e)}}}function M0(p){let e,t,s,i=p[26].name+"",r,a,o,l,h="View",c,d,u="Delete",f,y,g,v,b;function A(){return p[20](p[26])}function _(){return p[21](p[26])}let x=p[26].visualStyle&&I0();return{c(){e=at("div"),t=at("div"),s=at("h3"),r=Nt(i),a=vt(),o=at("div"),l=at("button"),l.textContent=h,c=vt(),d=at("button"),d.textContent=u,f=vt(),y=at("div"),x&&x.c(),g=vt(),this.h()},l(k){e=rt(k,"DIV",{class:!0});var T=mt(e);t=rt(T,"DIV",{class:!0});var P=mt(t);s=rt(P,"H3",{class:!0});var F=mt(s);r=Ot(F,i),F.forEach(ht),a=wt(P),o=rt(P,"DIV",{class:!0});var R=mt(o);l=rt(R,"BUTTON",{class:!0,"data-svelte-h":!0}),ne(l)!=="svelte-6wnvl5"&&(l.textContent=h),c=wt(R),d=rt(R,"BUTTON",{class:!0,"data-svelte-h":!0}),ne(d)!=="svelte-50mqyf"&&(d.textContent=u),R.forEach(ht),P.forEach(ht),f=wt(T),y=rt(T,"DIV",{class:!0});var B=mt(y);x&&x.l(B),B.forEach(ht),g=wt(T),T.forEach(ht),this.h()},h(){nt(s,"class","font-medium text-gray-900"),nt(l,"class","text-sm text-forest-600 hover:underline"),nt(d,"class","text-sm text-red-600 hover:underline"),nt(o,"class","flex gap-2"),nt(t,"class","flex items-center justify-between mb-2"),nt(y,"class","flex gap-2"),nt(e,"class","border border-gray-200 rounded-lg p-4 hover:bg-gray-50")},m(k,T){ke(k,e,T),X(e,t),X(t,s),X(s,r),X(t,a),X(t,o),X(o,l),X(o,c),X(o,d),X(e,f),X(e,y),x&&x.m(y,null),X(e,g),v||(b=[vi(l,"click",A),vi(d,"click",_)],v=!0)},p(k,T){p=k,T&1&&i!==(i=p[26].name+"")&&xe(r,i),p[26].visualStyle?x||(x=I0(),x.c(),x.m(y,null)):x&&(x.d(1),x=null)},d(k){k&&ht(e),x&&x.d(),v=!1,Iy(b)}}}function R0(p){let e,t,s,i=p[9].name+"",r,a,o,l,h="Close",c,d,u,f,y,g="Tone",v,b,A=(p[9].tone||"Not specified")+"",_,x,k,T,P="Structure",F,R,B=(p[9].structure||"Not specified")+"",j,I,L,S,N="System Prompt",G,U,it=O0(p[9])+"",Y,lt,H,O=p[9].visualStyle&&L0(p);return{c(){e=at("div"),t=at("div"),s=at("h2"),r=Nt(i),a=Nt(" - Details"),o=vt(),l=at("button"),l.textContent=h,c=vt(),O&&O.c(),d=vt(),u=at("div"),f=at("div"),y=at("h3"),y.textContent=g,v=vt(),b=at("p"),_=Nt(A),x=vt(),k=at("div"),T=at("h3"),T.textContent=P,F=vt(),R=at("p"),j=Nt(B),I=vt(),L=at("div"),S=at("h3"),S.textContent=N,G=vt(),U=at("pre"),Y=Nt(it),this.h()},l(Q){e=rt(Q,"DIV",{class:!0});var tt=mt(e);t=rt(tt,"DIV",{class:!0});var J=mt(t);s=rt(J,"H2",{class:!0});var bt=mt(s);r=Ot(bt,i),a=Ot(bt," - Details"),bt.forEach(ht),o=wt(J),l=rt(J,"BUTTON",{class:!0,"data-svelte-h":!0}),ne(l)!=="svelte-1b6vhod"&&(l.textContent=h),J.forEach(ht),c=wt(tt),O&&O.l(tt),d=wt(tt),u=rt(tt,"DIV",{class:!0});var pt=mt(u);f=rt(pt,"DIV",{});var ft=mt(f);y=rt(ft,"H3",{class:!0,"data-svelte-h":!0}),ne(y)!=="svelte-ordm2v"&&(y.textContent=g),v=wt(ft),b=rt(ft,"P",{class:!0});var yt=mt(b);_=Ot(yt,A),yt.forEach(ht),ft.forEach(ht),x=wt(pt),k=rt(pt,"DIV",{});var It=mt(k);T=rt(It,"H3",{class:!0,"data-svelte-h":!0}),ne(T)!=="svelte-182su60"&&(T.textContent=P),F=wt(It),R=rt(It,"P",{class:!0});var xt=mt(R);j=Ot(xt,B),xt.forEach(ht),It.forEach(ht),pt.forEach(ht),I=wt(tt),L=rt(tt,"DIV",{class:!0});var qt=mt(L);S=rt(qt,"H3",{class:!0,"data-svelte-h":!0}),ne(S)!=="svelte-1s42pto"&&(S.textContent=N),G=wt(qt),U=rt(qt,"PRE",{class:!0});var te=mt(U);Y=Ot(te,it),te.forEach(ht),qt.forEach(ht),tt.forEach(ht),this.h()},h(){nt(s,"class","text-lg font-semibold"),nt(l,"class","text-gray-500 hover:text-gray-700"),nt(t,"class","flex items-center justify-between mb-4"),nt(y,"class","font-medium text-gray-700 mb-2"),nt(b,"class","text-gray-600 text-sm"),nt(T,"class","font-medium text-gray-700 mb-2"),nt(R,"class","text-gray-600 text-sm"),nt(u,"class","grid grid-cols-1 md:grid-cols-2 gap-4"),nt(S,"class","font-medium text-gray-700 mb-2"),nt(U,"class","text-xs text-gray-600 whitespace-pre-wrap"),nt(L,"class","mt-6 p-4 bg-gray-50 rounded-lg"),nt(e,"class","card p-6 mt-6")},m(Q,tt){ke(Q,e,tt),X(e,t),X(t,s),X(s,r),X(s,a),X(t,o),X(t,l),X(e,c),O&&O.m(e,null),X(e,d),X(e,u),X(u,f),X(f,y),X(f,v),X(f,b),X(b,_),X(u,x),X(u,k),X(k,T),X(k,F),X(k,R),X(R,j),X(e,I),X(e,L),X(L,S),X(L,G),X(L,U),X(U,Y),lt||(H=vi(l,"click",p[22]),lt=!0)},p(Q,tt){tt&512&&i!==(i=Q[9].name+"")&&xe(r,i),Q[9].visualStyle?O?O.p(Q,tt):(O=L0(Q),O.c(),O.m(e,d)):O&&(O.d(1),O=null),tt&512&&A!==(A=(Q[9].tone||"Not specified")+"")&&xe(_,A),tt&512&&B!==(B=(Q[9].structure||"Not specified")+"")&&xe(j,B),tt&512&&it!==(it=O0(Q[9])+"")&&xe(Y,it)},d(Q){Q&&ht(e),O&&O.d(),lt=!1,H()}}}function L0(p){let e,t,s="Visual Style",i,r,a,o,l,h=p[9].visualStyle.fonts.header+"",c,d,u,f,y,g=p[9].visualStyle.fonts.body+"",v,b,A,_,x,k=p[9].visualStyle.layout.orientation+"",T,P,F,R,B,j=N0(p[9].visualStyle.layout)+"",I;return{c(){e=at("div"),t=at("h3"),t.textContent=s,i=vt(),r=at("div"),a=at("div"),o=Nt("Header Font: "),l=at("span"),c=Nt(h),d=vt(),u=at("div"),f=Nt("Body Font: "),y=at("span"),v=Nt(g),b=vt(),A=at("div"),_=Nt("Orientation: "),x=at("span"),T=Nt(k),P=vt(),F=at("div"),R=Nt("Margins: "),B=at("span"),I=Nt(j),this.h()},l(L){e=rt(L,"DIV",{class:!0});var S=mt(e);t=rt(S,"H3",{class:!0,"data-svelte-h":!0}),ne(t)!=="svelte-1b0te2k"&&(t.textContent=s),i=wt(S),r=rt(S,"DIV",{class:!0});var N=mt(r);a=rt(N,"DIV",{});var G=mt(a);o=Ot(G,"Header Font: "),l=rt(G,"SPAN",{class:!0});var U=mt(l);c=Ot(U,h),U.forEach(ht),G.forEach(ht),d=wt(N),u=rt(N,"DIV",{});var it=mt(u);f=Ot(it,"Body Font: "),y=rt(it,"SPAN",{class:!0});var Y=mt(y);v=Ot(Y,g),Y.forEach(ht),it.forEach(ht),b=wt(N),A=rt(N,"DIV",{});var lt=mt(A);_=Ot(lt,"Orientation: "),x=rt(lt,"SPAN",{class:!0});var H=mt(x);T=Ot(H,k),H.forEach(ht),lt.forEach(ht),P=wt(N),F=rt(N,"DIV",{});var O=mt(F);R=Ot(O,"Margins: "),B=rt(O,"SPAN",{class:!0});var Q=mt(B);I=Ot(Q,j),Q.forEach(ht),O.forEach(ht),N.forEach(ht),S.forEach(ht),this.h()},h(){nt(t,"class","font-medium text-blue-900 mb-3"),nt(l,"class","font-medium"),nt(y,"class","font-medium"),nt(x,"class","font-medium"),nt(B,"class","font-medium"),nt(r,"class","grid grid-cols-2 md:grid-cols-4 gap-4 text-sm"),nt(e,"class","mb-6 p-4 bg-blue-50 rounded-lg")},m(L,S){ke(L,e,S),X(e,t),X(e,i),X(e,r),X(r,a),X(a,o),X(a,l),X(l,c),X(r,d),X(r,u),X(u,f),X(u,y),X(y,v),X(r,b),X(r,A),X(A,_),X(A,x),X(x,T),X(r,P),X(r,F),X(F,R),X(F,B),X(B,I)},p(L,S){S&512&&h!==(h=L[9].visualStyle.fonts.header+"")&&xe(c,h),S&512&&g!==(g=L[9].visualStyle.fonts.body+"")&&xe(v,g),S&512&&k!==(k=L[9].visualStyle.layout.orientation+"")&&xe(T,k),S&512&&j!==(j=N0(L[9].visualStyle.layout)+"")&&xe(I,j)},d(L){L&&ht(e)}}}function R1(p){let e,t,s,i='<h1 class="text-2xl font-bold text-gray-900 mb-2">Learn My Style</h1> <p class="text-gray-600">Train Oscar AI to write in your unique style based on your previous reports and documents.</p>',r,a,o,l,h,c,d="Create New Style Profile",u,f,y,g,v="Profile Name",b,A,_,x,k,T="Writing Samples",P,F,R,B,j,I="Or Import from Document",L,S,N,G,U="Upload PDF or Word (.docx) documents",it,Y,lt,H,O,Q=p[2]?"Analyzing Style...":"Analyze Style with AI",tt,J,bt,pt,ft,yt,It="Saved Style Profiles",xt,qt,te,C,q=p[3]&&C0(p),W=p[4]&&x0(p),M=p[5]&&k0(),D=p[6]&&T0(p),z=p[7]&&P0(p),Z=(p[4]||p[8].tone)&&D0(p);function et(K,dt){return K[1]?M1:K[0].length===0?I1:D1}let V=et(p),st=V(p),ot=p[9]&&R0(p);return{c(){e=vt(),t=at("div"),s=at("div"),s.innerHTML=i,r=vt(),q&&q.c(),a=vt(),W&&W.c(),o=vt(),l=at("div"),h=at("div"),c=at("h2"),c.textContent=d,u=vt(),f=at("div"),y=at("div"),g=at("label"),g.textContent=v,b=vt(),A=at("input"),_=vt(),x=at("div"),k=at("label"),k.textContent=T,P=vt(),F=at("textarea"),R=vt(),B=at("div"),j=at("label"),j.textContent=I,L=vt(),S=at("input"),N=vt(),G=at("p"),G.textContent=U,it=vt(),M&&M.c(),Y=vt(),D&&D.c(),lt=vt(),z&&z.c(),H=vt(),O=at("button"),tt=Nt(Q),bt=vt(),Z&&Z.c(),pt=vt(),ft=at("div"),yt=at("h2"),yt.textContent=It,xt=vt(),st.c(),qt=vt(),ot&&ot.c(),this.h()},l(K){mA("svelte-vz3i4w",document.head).forEach(ht),e=wt(K),t=rt(K,"DIV",{class:!0});var Pt=mt(t);s=rt(Pt,"DIV",{class:!0,"data-svelte-h":!0}),ne(s)!=="svelte-1lgfz2z"&&(s.innerHTML=i),r=wt(Pt),q&&q.l(Pt),a=wt(Pt),W&&W.l(Pt),o=wt(Pt),l=rt(Pt,"DIV",{class:!0});var kt=mt(l);h=rt(kt,"DIV",{class:!0});var ve=mt(h);c=rt(ve,"H2",{class:!0,"data-svelte-h":!0}),ne(c)!=="svelte-firrqb"&&(c.textContent=d),u=wt(ve),f=rt(ve,"DIV",{class:!0});var Ge=mt(f);y=rt(Ge,"DIV",{});var Qe=mt(y);g=rt(Qe,"LABEL",{for:!0,class:!0,"data-svelte-h":!0}),ne(g)!=="svelte-1uw91pj"&&(g.textContent=v),b=wt(Qe),A=rt(Qe,"INPUT",{id:!0,type:!0,placeholder:!0,class:!0}),Qe.forEach(ht),_=wt(Ge),x=rt(Ge,"DIV",{});var Ai=mt(x);k=rt(Ai,"LABEL",{for:!0,class:!0,"data-svelte-h":!0}),ne(k)!=="svelte-1a28a4d"&&(k.textContent=T),P=wt(Ai),F=rt(Ai,"TEXTAREA",{id:!0,placeholder:!0,rows:!0,class:!0}),mt(F).forEach(ht),Ai.forEach(ht),R=wt(Ge),B=rt(Ge,"DIV",{class:!0});var Ft=mt(B);j=rt(Ft,"LABEL",{for:!0,class:!0,"data-svelte-h":!0}),ne(j)!=="svelte-16fg1fc"&&(j.textContent=I),L=wt(Ft),S=rt(Ft,"INPUT",{id:!0,type:!0,accept:!0,class:!0}),N=wt(Ft),G=rt(Ft,"P",{class:!0,"data-svelte-h":!0}),ne(G)!=="svelte-6tc3j3"&&(G.textContent=U),it=wt(Ft),M&&M.l(Ft),Y=wt(Ft),D&&D.l(Ft),Ft.forEach(ht),lt=wt(Ge),z&&z.l(Ge),H=wt(Ge),O=rt(Ge,"BUTTON",{class:!0});var Yr=mt(O);tt=Ot(Yr,Q),Yr.forEach(ht),Ge.forEach(ht),bt=wt(ve),Z&&Z.l(ve),ve.forEach(ht),pt=wt(kt),ft=rt(kt,"DIV",{class:!0});var Vn=mt(ft);yt=rt(Vn,"H2",{class:!0,"data-svelte-h":!0}),ne(yt)!=="svelte-nspjq9"&&(yt.textContent=It),xt=wt(Vn),st.l(Vn),Vn.forEach(ht),kt.forEach(ht),qt=wt(Pt),ot&&ot.l(Pt),Pt.forEach(ht),this.h()},h(){document.title="Learn My Style - Oscar AI",nt(s,"class","mb-8"),nt(c,"class","text-lg font-semibold mb-4"),nt(g,"for","profileName"),nt(g,"class","block text-sm font-medium text-gray-700 mb-1"),nt(A,"id","profileName"),nt(A,"type","text"),nt(A,"placeholder","e.g., My BS5837 Reports"),nt(A,"class","input w-full"),nt(k,"for","samples"),nt(k,"class","block text-sm font-medium text-gray-700 mb-1"),nt(F,"id","samples"),nt(F,"placeholder","Paste examples of your previous reports..."),nt(F,"rows","8"),nt(F,"class","input w-full"),nt(j,"for","fileUpload"),nt(j,"class","block text-sm font-medium text-gray-700 mb-2"),nt(S,"id","fileUpload"),nt(S,"type","file"),nt(S,"accept",".pdf,.docx"),S.disabled=p[5],nt(S,"class","block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-forest-50 file:text-forest-700 hover:file:bg-forest-100 disabled:opacity-50"),nt(G,"class","text-xs text-gray-500 mt-1"),nt(B,"class","border-2 border-dashed border-gray-300 rounded-lg p-4"),O.disabled=J=p[2]||!p[8].name.trim()||!p[8].samples.trim(),nt(O,"class","btn btn-primary w-full"),nt(f,"class","space-y-4"),nt(h,"class","card p-6"),nt(yt,"class","text-lg font-semibold mb-4"),nt(ft,"class","card p-6"),nt(l,"class","grid grid-cols-1 lg:grid-cols-2 gap-6"),nt(t,"class","max-w-6xl mx-auto p-6")},m(K,dt){ke(K,e,dt),ke(K,t,dt),X(t,s),X(t,r),q&&q.m(t,null),X(t,a),W&&W.m(t,null),X(t,o),X(t,l),X(l,h),X(h,c),X(h,u),X(h,f),X(f,y),X(y,g),X(y,b),X(y,A),Yi(A,p[8].name),X(f,_),X(f,x),X(x,k),X(x,P),X(x,F),Yi(F,p[8].samples),X(f,R),X(f,B),X(B,j),X(B,L),X(B,S),X(B,N),X(B,G),X(B,it),M&&M.m(B,null),X(B,Y),D&&D.m(B,null),X(f,lt),z&&z.m(f,null),X(f,H),X(f,O),X(O,tt),X(h,bt),Z&&Z.m(h,null),X(l,pt),X(l,ft),X(ft,yt),X(ft,xt),st.m(ft,null),X(t,qt),ot&&ot.m(t,null),te||(C=[vi(A,"input",p[15]),vi(F,"input",p[16]),vi(S,"change",p[13]),vi(O,"click",p[10])],te=!0)},p(K,[dt]){K[3]?q?q.p(K,dt):(q=C0(K),q.c(),q.m(t,a)):q&&(q.d(1),q=null),K[4]?W?W.p(K,dt):(W=x0(K),W.c(),W.m(t,o)):W&&(W.d(1),W=null),dt&256&&A.value!==K[8].name&&Yi(A,K[8].name),dt&256&&Yi(F,K[8].samples),dt&32&&(S.disabled=K[5]),K[5]?M||(M=k0(),M.c(),M.m(B,Y)):M&&(M.d(1),M=null),K[6]?D?D.p(K,dt):(D=T0(K),D.c(),D.m(B,null)):D&&(D.d(1),D=null),K[7]?z?z.p(K,dt):(z=P0(K),z.c(),z.m(f,H)):z&&(z.d(1),z=null),dt&4&&Q!==(Q=K[2]?"Analyzing Style...":"Analyze Style with AI")&&xe(tt,Q),dt&260&&J!==(J=K[2]||!K[8].name.trim()||!K[8].samples.trim())&&(O.disabled=J),K[4]||K[8].tone?Z?Z.p(K,dt):(Z=D0(K),Z.c(),Z.m(h,null)):Z&&(Z.d(1),Z=null),V===(V=et(K))&&st?st.p(K,dt):(st.d(1),st=V(K),st&&(st.c(),st.m(ft,null))),K[9]?ot?ot.p(K,dt):(ot=R0(K),ot.c(),ot.m(t,null)):ot&&(ot.d(1),ot=null)},i:yp,o:yp,d(K){K&&(ht(e),ht(t)),q&&q.d(),W&&W.d(),M&&M.d(),D&&D.d(),z&&z.d(),Z&&Z.d(),st.d(),ot&&ot.d(),te=!1,Iy(C)}}}const F0="oscar_style_profiles";function O0(p){return"You are writing in the style of "+p.name+`.

TONE: `+p.tone+`
STRUCTURE: `+p.structure+`
FORMATTING: `+p.formattingRules+`
VOCABULARY: `+p.vocabulary+`
TYPICAL PHRASES: `+p.typicalPhrases+`
SECTION ORDER: `+p.sectionOrder+`
RECOMMENDATIONS STYLE: `+p.recommendationsStyle+`
DEFECTS STYLE: `+p.defectsStyle+`
DISCLAIMERS: `+p.disclaimers+`

Follow this style consistently in all your outputs.`}function N0(p){return!p||!p.margins?"1in":p.margins.top+"in / "+p.margins.bottom+"in"}function L1(p,e,t){let s=[],i=!0,r=!1,a="",o="",l=!1,h="",c=null,d={name:"",samples:"",tone:"",structure:"",formattingRules:"",vocabulary:"",typicalPhrases:"",sectionOrder:"",recommendationsStyle:"",defectsStyle:"",disclaimers:"",examples:""},u=null;bA(()=>{f()});function f(){try{const L=localStorage.getItem(F0);L&&t(0,s=JSON.parse(L))}catch(L){console.error("Failed to load style profiles:",L)}finally{t(1,i=!1)}}function y(){localStorage.setItem(F0,JSON.stringify(s))}async function g(){var S;if(!d.samples.trim()||!d.name.trim()){t(3,a="Please provide a name and at least one sample text");return}const L=AA.get();if(!L.groqApiKey){t(3,a="Please configure your Groq API key in Settings first.");return}t(2,r=!0),t(3,a=""),t(4,o="");try{const N=await fetch("https://api.groq.com/openai/v1/chat/completions",{method:"POST",headers:{Authorization:`Bearer ${L.groqApiKey}`,"Content-Type":"application/json"},body:JSON.stringify({model:"llama-3.1-8b-instant",messages:[{role:"system",content:`You are an expert at analyzing writing styles. Analyze the provided text samples and extract the following style characteristics. Return your analysis in a structured format.

Analyze these aspects:
1. TONE: What is the overall tone? (formal, technical, conversational, etc.)
2. STRUCTURE: How is the content organized? (headings, paragraphs, bullet points, etc.)
3. FORMATTING RULES: What formatting conventions are used?
4. VOCABULARY: What kind of vocabulary is used? Any technical terms?
5. TYPICAL PHRASES: What phrases or expressions are commonly used?
6. SECTION ORDER: How are sections typically ordered in reports?
7. RECOMMENDATIONS STYLE: How are recommendations presented?
8. DEFECTS STYLE: How are defects/issues described?
9. DISCLAIMERS: What disclaimers or caveats are typically included?

Return your analysis in a clear, structured format.`},{role:"user",content:`Analyze this writing sample(s) and extract the style characteristics:

${d.samples}`}],temperature:.5,max_tokens:2048})});if(!N.ok){const it=await N.json();throw new Error(((S=it.error)==null?void 0:S.message)||"Failed to analyze style")}const U=(await N.json()).choices[0].message.content;v(U),t(4,o="Style analysis complete! Review and save the profile.")}catch(N){t(3,a=N instanceof Error?N.message:"Failed to analyze style"),console.error(N)}finally{t(2,r=!1)}}function v(L){const S=L.split(`
`);let N="";for(const G of S){const U=G.toLowerCase();if(U.includes("tone:")||U.includes("1. tone"))N="tone",t(8,d.tone=G.replace(/^[^:]+:\s*/i,"").trim(),d);else if(U.includes("structure:")||U.includes("2. structure"))N="structure",t(8,d.structure=G.replace(/^[^:]+:\s*/i,"").trim(),d);else if(U.includes("formatting:")||U.includes("3. formatting"))N="formattingRules",t(8,d.formattingRules=G.replace(/^[^:]+:\s*/i,"").trim(),d);else if(U.includes("vocabulary:")||U.includes("4. vocabulary"))N="vocabulary",t(8,d.vocabulary=G.replace(/^[^:]+:\s*/i,"").trim(),d);else if(U.includes("phrases:")||U.includes("5. phrases"))N="typicalPhrases",t(8,d.typicalPhrases=G.replace(/^[^:]+:\s*/i,"").trim(),d);else if(U.includes("section")&&U.includes("order"))N="sectionOrder",t(8,d.sectionOrder=G.replace(/^[^:]+:\s*/i,"").trim(),d);else if(U.includes("recommendation"))N="recommendationsStyle",t(8,d.recommendationsStyle=G.replace(/^[^:]+:\s*/i,"").trim(),d);else if(U.includes("defect"))N="defectsStyle",t(8,d.defectsStyle=G.replace(/^[^:]+:\s*/i,"").trim(),d);else if(U.includes("disclaimer"))N="disclaimers",t(8,d.disclaimers=G.replace(/^[^:]+:\s*/i,"").trim(),d);else if(N&&G.trim()&&!G.match(/^[0-9]+\./))switch(N){case"tone":t(8,d.tone+=" "+G.trim(),d);break;case"structure":t(8,d.structure+=" "+G.trim(),d);break;case"formattingRules":t(8,d.formattingRules+=" "+G.trim(),d);break;case"vocabulary":t(8,d.vocabulary+=" "+G.trim(),d);break;case"typicalPhrases":t(8,d.typicalPhrases+=" "+G.trim(),d);break;case"sectionOrder":t(8,d.sectionOrder+=" "+G.trim(),d);break;case"recommendationsStyle":t(8,d.recommendationsStyle+=" "+G.trim(),d);break;case"defectsStyle":t(8,d.defectsStyle+=" "+G.trim(),d);break;case"disclaimers":t(8,d.disclaimers+=" "+G.trim(),d);break}}t(8,d.examples=d.samples,d)}function b(){if(!d.name.trim()){t(3,a="Please provide a name for this style profile");return}const L={id:crypto.randomUUID(),name:d.name.trim(),tone:d.tone,structure:d.structure,formattingRules:d.formattingRules,vocabulary:d.vocabulary,typicalPhrases:d.typicalPhrases,sectionOrder:d.sectionOrder,recommendationsStyle:d.recommendationsStyle,defectsStyle:d.defectsStyle,disclaimers:d.disclaimers,examples:d.examples,visualStyle:c||void 0,createdAt:new Date().toISOString()};t(0,s=[...s,L]),y(),t(8,d={name:"",samples:"",tone:"",structure:"",formattingRules:"",vocabulary:"",typicalPhrases:"",sectionOrder:"",recommendationsStyle:"",defectsStyle:"",disclaimers:"",examples:""}),t(7,c=null),t(4,o="Style profile saved successfully!"),t(3,a="")}function A(L){confirm("Are you sure you want to delete this style profile?")&&(t(0,s=s.filter(S=>S.id!==L)),y(),t(9,u=null))}async function _(L){const S=L.target,N=S.files;if(!N||N.length===0)return;const G=N[0],U=A1(G),it=E1(G);if(!U&&!it){t(6,h="Please select a valid PDF or Word (.docx) file");return}t(5,l=!0),t(6,h=""),t(7,c=null);try{if(it){const Y=await C1(G);d.samples?t(8,d.samples+=`

--- Document Content ---

`+Y.textContent,d):t(8,d.samples=Y.textContent,d),t(7,c=Y.visualStyle);let lt="Word document processed successfully";Y.visualStyle&&(lt+=". Visual style detected: "+Y.visualStyle.fonts.header+" font, "+Y.visualStyle.layout.orientation+" orientation"),t(4,o=lt)}else{const Y=await v1(G);d.samples?t(8,d.samples+=`

--- PDF Content ---

`+Y,d):t(8,d.samples=Y,d),t(4,o="PDF content extracted successfully")}}catch(Y){t(6,h=Y instanceof Error?Y.message:"Failed to extract content")}finally{t(5,l=!1),S.value=""}}function x(L){t(9,u=L)}function k(){d.name=this.value,t(8,d)}function T(){d.samples=this.value,t(8,d)}function P(){d.tone=this.value,t(8,d)}function F(){d.structure=this.value,t(8,d)}function R(){d.formattingRules=this.value,t(8,d)}return[s,i,r,a,o,l,h,c,d,u,g,b,A,_,x,k,T,P,F,R,L=>x(L),L=>L.id&&A(L.id),()=>t(9,u=null)]}class j1 extends wA{constructor(e){super(),vA(this,e,L1,R1,gA,{})}}export{j1 as component};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
