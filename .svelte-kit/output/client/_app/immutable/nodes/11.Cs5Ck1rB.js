import{s as ie,d as u,i as j,b as p,l as g,m as ce,g as V,c as T,e as x,o as L,j as G,h as w,k as de,p as ue,a as Z,f as U,t as F,n as K,v as pe,r as fe,q as X,u as Y,y as re,A as me}from"../chunks/scheduler.DKaqMhG1.js";import{S as he,i as _e,t as Q,a as W,c as be,d as ve,m as ge,b as ye,e as Ae,g as Ee}from"../chunks/index.DlqHU1Qv.js";import{e as se}from"../chunks/each.C2d3_RSt.js";import{p as Ce}from"../chunks/stores.BFoXjtDT.js";import{d as z}from"../chunks/index.BvaDNSI_.js";import{g as Ie}from"../chunks/settings.a3gRd5qY.js";import{M as Te}from"../chunks/MicButton.BEMi5Q8G.js";function oe(a,t,e){const o=a.slice();return o[21]=t[e],o}function ae(a){let t,e;return{c(){t=w("div"),e=F(a[3]),this.h()},l(o){t=T(o,"DIV",{class:!0});var f=x(t);e=U(f,a[3]),f.forEach(u),this.h()},h(){g(t,"class","bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded mb-4")},m(o,f){j(o,t,f),p(t,e)},p(o,f){f&8&&Z(e,o[3])},d(o){o&&u(t)}}}function we(a){let t,e,o="Select Report Type",f,h,m,n,i,_="Additional Notes (Optional)",l,A,y,k,r,c,b,E,R=a[2]?"Generating Report...":"Generate Report",B,O,P,q,H,d,v,D=se(a[6]),C=[];for(let s=0;s<D.length;s+=1)C[s]=le(oe(a,D,s));r=new Te({}),r.$on("transcript",a[12]);let S=a[1]&&ne(a);return{c(){t=w("div"),e=w("h2"),e.textContent=o,f=G(),h=w("div");for(let s=0;s<C.length;s+=1)C[s].c();m=G(),n=w("div"),i=w("h2"),i.textContent=_,l=G(),A=w("textarea"),y=G(),k=w("div"),Ae(r.$$.fragment),c=G(),b=w("div"),E=w("button"),B=F(R),P=G(),S&&S.c(),q=re(),this.h()},l(s){t=T(s,"DIV",{class:!0});var I=x(t);e=T(I,"H2",{class:!0,"data-svelte-h":!0}),L(e)!=="svelte-1qomas3"&&(e.textContent=o),f=V(I),h=T(I,"DIV",{class:!0});var N=x(h);for(let J=0;J<C.length;J+=1)C[J].l(N);N.forEach(u),I.forEach(u),m=V(s),n=T(s,"DIV",{class:!0});var M=x(n);i=T(M,"H2",{class:!0,"data-svelte-h":!0}),L(i)!=="svelte-1x2rv7a"&&(i.textContent=_),l=V(M),A=T(M,"TEXTAREA",{placeholder:!0,rows:!0,class:!0}),x(A).forEach(u),y=V(M),k=T(M,"DIV",{class:!0});var $=x(k);ye(r.$$.fragment,$),$.forEach(u),M.forEach(u),c=V(s),b=T(s,"DIV",{class:!0});var ee=x(b);E=T(ee,"BUTTON",{class:!0});var te=x(E);B=U(te,R),te.forEach(u),ee.forEach(u),P=V(s),S&&S.l(s),q=re(),this.h()},h(){g(e,"class","text-lg font-semibold mb-4"),g(h,"class","grid gap-3"),g(t,"class","card p-6 mb-6"),g(i,"class","text-lg font-semibold mb-4"),g(A,"placeholder","Any specific requirements or additional information..."),g(A,"rows","4"),g(A,"class","input w-full"),g(k,"class","mt-2"),g(n,"class","card p-6 mb-6"),E.disabled=O=!a[0]||a[2],g(E,"class","btn btn-primary w-full"),g(b,"class","mb-6")},m(s,I){j(s,t,I),p(t,e),p(t,f),p(t,h);for(let N=0;N<C.length;N+=1)C[N]&&C[N].m(h,null);j(s,m,I),j(s,n,I),p(n,i),p(n,l),p(n,A),X(A,a[4]),p(n,y),p(n,k),ge(r,k,null),j(s,c,I),j(s,b,I),p(b,E),p(E,B),j(s,P,I),S&&S.m(s,I),j(s,q,I),H=!0,d||(v=[Y(A,"input",a[11]),Y(E,"click",a[7])],d=!0)},p(s,I){if(I&65){D=se(s[6]);let N;for(N=0;N<D.length;N+=1){const M=oe(s,D,N);C[N]?C[N].p(M,I):(C[N]=le(M),C[N].c(),C[N].m(h,null))}for(;N<C.length;N+=1)C[N].d(1);C.length=D.length}I&16&&X(A,s[4]),(!H||I&4)&&R!==(R=s[2]?"Generating Report...":"Generate Report")&&Z(B,R),(!H||I&5&&O!==(O=!s[0]||s[2]))&&(E.disabled=O),s[1]?S?S.p(s,I):(S=ne(s),S.c(),S.m(q.parentNode,q)):S&&(S.d(1),S=null)},i(s){H||(W(r.$$.fragment,s),H=!0)},o(s){Q(r.$$.fragment,s),H=!1},d(s){s&&(u(t),u(m),u(n),u(c),u(b),u(P),u(q)),pe(C,s),ve(r),S&&S.d(s),d=!1,fe(v)}}}function ke(a){let t,e='<p class="text-gray-500">Loading...</p>';return{c(){t=w("div"),t.innerHTML=e,this.h()},l(o){t=T(o,"DIV",{class:!0,"data-svelte-h":!0}),L(t)!=="svelte-1xrscwp"&&(t.innerHTML=e),this.h()},h(){g(t,"class","text-center py-12")},m(o,f){j(o,t,f)},p:K,i:K,o:K,d(o){o&&u(t)}}}function le(a){let t,e,o,f,h,m=a[21].label+"",n,i,_,l=a[21].description+"",A,y,k,r,c,b;return r=me(a[10][0]),{c(){t=w("label"),e=w("input"),o=G(),f=w("div"),h=w("div"),n=F(m),i=G(),_=w("div"),A=F(l),y=G(),this.h()},l(E){t=T(E,"LABEL",{class:!0});var R=x(t);e=T(R,"INPUT",{type:!0,name:!0,class:!0}),o=V(R),f=T(R,"DIV",{});var B=x(f);h=T(B,"DIV",{class:!0});var O=x(h);n=U(O,m),O.forEach(u),i=V(B),_=T(B,"DIV",{class:!0});var P=x(_);A=U(P,l),P.forEach(u),B.forEach(u),y=V(R),R.forEach(u),this.h()},h(){g(e,"type","radio"),g(e,"name","reportType"),e.__value=a[21].value,X(e,e.__value),g(e,"class","mt-1"),g(h,"class","font-medium text-gray-900"),g(_,"class","text-sm text-gray-500"),g(t,"class",k="flex items-start gap-3 p-4 border rounded-lg cursor-pointer hover:bg-gray-50 transition-colors "+(a[0]===a[21].value?"border-forest-500 bg-forest-50":"border-gray-200")),r.p(e)},m(E,R){j(E,t,R),p(t,e),e.checked=e.__value===a[0],p(t,o),p(t,f),p(f,h),p(h,n),p(f,i),p(f,_),p(_,A),p(t,y),c||(b=Y(e,"change",a[9]),c=!0)},p(E,R){R&1&&(e.checked=e.__value===E[0]),R&1&&k!==(k="flex items-start gap-3 p-4 border rounded-lg cursor-pointer hover:bg-gray-50 transition-colors "+(E[0]===E[21].value?"border-forest-500 bg-forest-50":"border-gray-200"))&&g(t,"class",k)},d(E){E&&u(t),r.r(),c=!1,b()}}}function ne(a){let t,e,o,f="Generated Report",h,m,n="Copy to Clipboard",i,_,l,A,y,k;return{c(){t=w("div"),e=w("div"),o=w("h2"),o.textContent=f,h=G(),m=w("button"),m.textContent=n,i=G(),_=w("div"),l=w("pre"),A=F(a[1]),this.h()},l(r){t=T(r,"DIV",{class:!0});var c=x(t);e=T(c,"DIV",{class:!0});var b=x(e);o=T(b,"H2",{class:!0,"data-svelte-h":!0}),L(o)!=="svelte-1ej3riu"&&(o.textContent=f),h=V(b),m=T(b,"BUTTON",{class:!0,"data-svelte-h":!0}),L(m)!=="svelte-1n348fo"&&(m.textContent=n),b.forEach(u),i=V(c),_=T(c,"DIV",{class:!0});var E=x(_);l=T(E,"PRE",{class:!0});var R=x(l);A=U(R,a[1]),R.forEach(u),E.forEach(u),c.forEach(u),this.h()},h(){g(o,"class","text-lg font-semibold"),g(m,"class","btn btn-secondary text-sm"),g(e,"class","p-4 border-b border-gray-200 flex items-center justify-between"),g(l,"class","whitespace-pre-wrap font-sans text-sm text-gray-700"),g(_,"class","p-6"),g(t,"class","card")},m(r,c){j(r,t,c),p(t,e),p(e,o),p(e,h),p(e,m),p(t,i),p(t,_),p(_,l),p(l,A),y||(k=Y(m,"click",a[8]),y=!0)},p(r,c){c&2&&Z(A,r[1])},d(r){r&&u(t),y=!1,k()}}}function Ne(a){let t,e,o,f="Generate Reports",h,m,n,i,_,l=a[3]&&!a[1]&&ae(a);const A=[ke,we],y=[];function k(r,c){return r[5]?0:1}return n=k(a),i=y[n]=A[n](a),{c(){t=G(),e=w("div"),o=w("h1"),o.textContent=f,h=G(),l&&l.c(),m=G(),i.c(),this.h()},l(r){ce("svelte-n16fy2",document.head).forEach(u),t=V(r),e=T(r,"DIV",{class:!0});var b=x(e);o=T(b,"H1",{class:!0,"data-svelte-h":!0}),L(o)!=="svelte-p7pi6b"&&(o.textContent=f),h=V(b),l&&l.l(b),m=V(b),i.l(b),b.forEach(u),this.h()},h(){document.title="Reports - Oscar AI",g(o,"class","text-2xl font-bold text-gray-900 mb-6"),g(e,"class","max-w-4xl mx-auto")},m(r,c){j(r,t,c),j(r,e,c),p(e,o),p(e,h),l&&l.m(e,null),p(e,m),y[n].m(e,null),_=!0},p(r,[c]){r[3]&&!r[1]?l?l.p(r,c):(l=ae(r),l.c(),l.m(e,m)):l&&(l.d(1),l=null);let b=n;n=k(r),n===b?y[n].p(r,c):(Ee(),Q(y[b],1,1,()=>{y[b]=null}),be(),i=y[n],i?i.p(r,c):(i=y[n]=A[n](r),i.c()),W(i,1),i.m(e,null))},i(r){_||(W(i),_=!0)},o(r){Q(i),_=!1},d(r){r&&(u(t),u(e)),l&&l.d(),y[n].d()}}}function Re(a,t,e){let o;de(a,Ce,d=>e(19,o=d));let f="";Ie.subscribe(d=>{f=d});let h="",m,n=[],i=[],_="",l="",A=!1,y="",k="",r="",c=!0;const b=[{value:"BS5837",label:"BS5837:2012 Tree Survey",description:"Complete tree constraints survey with category assessment"},{value:"AIA",label:"Arboricultural Impact Assessment",description:"Assessment of development impacts on trees"},{value:"AMS",label:"Arboricultural Method Statement",description:"Detailed tree protection methodology"},{value:"TREE_CONDITION",label:"Tree Condition Report",description:"Visual Tree Assessment (VTA) report"}];ue(async()=>{var C;const d=new URLSearchParams(o.url.search);h=d.get("project")||"";const v=d.get("report"),D=d.get("mode");if(h?await E():e(5,c=!1),v&&D==="edit"){const S=localStorage.getItem("oscar_reports");if(S){const I=JSON.parse(S).find(N=>N.id===v);I&&(e(1,l=I.content||""),e(0,_=((C=I.type)==null?void 0:C.toUpperCase())||"BS5837"))}}});async function E(){try{if(m=await z.projects.get(h),!m){e(3,y="Project not found"),e(5,c=!1);return}n=await z.trees.where("projectId").equals(h).toArray(),i=await z.notes.where("projectId").equals(h).toArray();let d="PROJECT: "+m.name+`
`;m.clientName&&(d+="Client: "+m.clientName+`
`),m.siteAddress&&(d+="Site: "+m.siteAddress+`

`),d+=`TREES:
`,n.length>0?n.forEach(v=>{d+=`- ${v.number}: ${v.species} (${v.scientificName||"N/A"})
`,d+=`  DBH: ${v.DBH}mm, Height: ${v.height||"N/A"}m
`,d+=`  Category: ${v.category||"Not assessed"}, Condition: ${v.condition||"N/A"}
`,v.notes&&(d+=`  Notes: ${v.notes}
`),d+=`
`}):d+=`No trees recorded yet.

`,i.length>0&&(d+=`FIELD NOTES:
`,i.forEach(v=>{d+=`- ${new Date(v.createdAt).toLocaleString("en-GB")}: ${v.content}
`})),k=d}catch(d){e(3,y="Failed to load project"),console.error(d)}finally{e(5,c=!1)}}async function R(){var d;if(_){if(!f){e(3,y="Please configure your Groq API key in Settings first.");return}e(2,A=!0),e(3,y=""),e(1,l="");try{let v="",D="";switch(_){case"BS5837":v="You are an expert arboricultural consultant. Generate a professional BS5837:2012 tree survey report.",D=`Generate a BS5837:2012 tree survey report based on the following data:

${k}

Additional notes: ${r||"None"}`;break;case"AIA":v="You are an expert arboricultural consultant. Generate a professional Arboricultural Impact Assessment.",D=`Generate an Arboricultural Impact Assessment based on the following data:

${k}

Additional notes: ${r||"None"}`;break;case"AMS":v="You are an expert arboricultural consultant. Generate a professional Arboricultural Method Statement.",D=`Generate an Arboricultural Method Statement based on the following data:

${k}

Additional notes: ${r||"None"}`;break;case"TREE_CONDITION":v="You are an expert arboricultural consultant. Generate a professional Tree Condition Report.",D=`Generate a Tree Condition Report (Visual Tree Assessment) based on the following data:

${k}

Additional notes: ${r||"None"}`;break}const C=await fetch("https://api.groq.com/openai/v1/chat/completions",{method:"POST",headers:{Authorization:`Bearer ${f}`,"Content-Type":"application/json"},body:JSON.stringify({model:"llama-3.1-8b-instant",messages:[{role:"system",content:v},{role:"user",content:D}],temperature:.7,max_tokens:2048})});if(!C.ok){const s=await C.json();throw new Error(((d=s.error)==null?void 0:d.message)||"Failed to generate report")}const S=await C.json();e(1,l=S.choices[0].message.content)}catch(v){e(3,y=v instanceof Error?v.message:"Failed to generate report"),console.error(v)}finally{e(2,A=!1)}}}function B(){l&&(navigator.clipboard.writeText(l),alert("Report copied to clipboard!"))}const O=[[]];function P(){_=this.__value,e(0,_)}function q(){r=this.value,e(4,r)}return[_,l,A,y,r,c,b,R,B,P,O,q,d=>e(4,r+=d.detail.text)]}class Oe extends he{constructor(t){super(),_e(this,t,Re,Ne,ie,{})}}export{Oe as component};
