import{U as ee,s as $e,d as b,r as Re,i as B,b as h,u as te,l as y,m as Be,g as O,c as w,e as C,o as W,j as x,h as j,p as qe,a as Q,f as H,t as V,n as ae,v as oe,q as ce}from"../chunks/scheduler.DKaqMhG1.js";import{S as Fe,i as Le,t as re,a as Z,c as ne,d as Me,g as ie,m as Ne,b as Oe,e as xe}from"../chunks/index.DlqHU1Qv.js";import{e as se}from"../chunks/each.C2d3_RSt.js";import{s as Y,g as He}from"../chunks/settings.a3gRd5qY.js";import{ar as Ve}from"../chunks/MarkdownRenderer.SQseg6rb.js";import{M as Je}from"../chunks/MicButton.BEMi5Q8G.js";import{g as Ge}from"../chunks/entry.Be3j---l.js";import{d as z,b as Qe,f as Ue,e as Ke,g as ze,l as We,m as Xe,n as Ye,o as Ze,i as ue}from"../chunks/index.BvaDNSI_.js";async function de(){const r=ee(Y),e=await z.projects.orderBy("updatedAt").reverse().toArray(),t=r.currentProjectId||"";let s=null,o=[],a=[],n=[],i=[],l=[];if(t){s=await z.projects.get(t)||null,o=await z.trees.where("projectId").equals(t).toArray(),a=await z.notes.where("projectId").equals(t).toArray(),n=await z.reports.where("projectId").equals(t).toArray();const c=localStorage.getItem("oscar_diagrams");c&&(i=JSON.parse(c).filter(g=>g.projectId===t));const u=localStorage.getItem("oscar_blog_posts");u&&(l=JSON.parse(u).filter(g=>g.projectId===t))}return{currentProject:s,projects:e,selectedProjectId:t,trees:o,notes:a,reports:n,diagrams:i,blogPosts:l}}function et(r){let e="";return r.currentProject?(e+=`
CURRENT PROJECT: ${r.currentProject.name}`,e+=`
- Location: ${r.currentProject.location}`,e+=`
- Client: ${r.currentProject.client}`,e+=`
- Description: ${r.currentProject.description}`):e+=`
No project is currently selected.`,r.trees.length>0&&(e+=`

TREES IN PROJECT (${r.trees.length}):`,r.trees.slice(0,10).forEach(t=>{e+=`
- ${t.number}: ${t.species} (${t.category}) - DBH: ${t.DBH}mm`}),r.trees.length>10&&(e+=`
... and ${r.trees.length-10} more trees`)),r.notes.length>0&&(e+=`

NOTES (${r.notes.length}):`,r.notes.slice(0,5).forEach(t=>{e+=`
- ${t.title}: ${t.content.substring(0,100)}...`}),r.notes.length>5&&(e+=`
... and ${r.notes.length-5} more notes`)),r.reports.length>0&&(e+=`

REPORTS (${r.reports.length}):`,r.reports.forEach(t=>{e+=`
- ${t.title} (${t.type}) - ${new Date(t.generatedAt).toLocaleDateString()}`})),r.diagrams.length>0&&(e+=`

DIAGRAMS (${r.diagrams.length}):`,r.diagrams.forEach(t=>{e+=`
- ${t.title} (${t.type})`})),r.blogPosts.length>0&&(e+=`

BLOG POSTS (${r.blogPosts.length}):`,r.blogPosts.forEach(t=>{e+=`
- ${t.title}`})),r.projects.length>0&&(e+=`

AVAILABLE PROJECTS:`,r.projects.forEach(t=>{e+=`
- ${t.name} (${t.client})`})),e}function tt(r){const e=r.toLowerCase().trim(),t=[/\b(remember|remind me|remind to)\b/i,/\b(look into|look at|find out|find information about)\b/i,/\b(check|verify|confirm)\b/i,/\b(buy|purchase|get)\b/i,/\b(fix|repair|solve)\b/i,/\b(schedule|book|arrange)\b/i,/\b(follow up|followup)\b/i,/\b(research|investigate|explore)\b/i,/\b(do|perform|execute|carry out)\b/i,/\b(complete|finish|finish up|wrap up)\b/i,/\b(task|todo|to-do)\b/i];for(const g of t)if(g.test(e))return{type:"task",action:"createTask",data:fe(r),confidence:.9};const s=[/\b(under this|under that)\b/i,/\b(as part of|because of)\b/i,/\b(beneath this|beneath that)\b/i,/\b(subtask|sub-task)\b/i];for(const g of s)if(g.test(e))return{type:"subtask",action:"createSubtask",data:fe(r),confidence:.85};const o=[/\b(note to self|note:)\b/i,/\b(jot down|write down|put down)\b/i,/\b(write a note|make a note|create a note|take a note|add a note)\b/i,/\bnote about\b/i];for(const g of o)if(g.test(e))return{type:"note",action:"createNote",data:rt(r),confidence:.9};const a=[/\b(start a project|create a project|new project|make a project)\b/i];for(const g of a)if(g.test(e))return{type:"project",action:"createProject",data:st(r),confidence:.9};const n=[/\b(write a blog|create a blog|blog post|write about)\b/i];for(const g of n)if(g.test(e))return{type:"blog",action:"createBlogPost",data:at(r),confidence:.9};const i=[/\b(create a report|write a report|generate a report|make a report|bs5837)\b/i];for(const g of i)if(g.test(e))return{type:"report",action:"createReport",data:ot(r),confidence:.9};const l=[/\b(create a diagram|make a diagram|draw a|flowchart|mind map|gantt)\b/i];for(const g of l)if(g.test(e))return{type:"diagram",action:"createDiagram",data:nt(r),confidence:.9};const c=[/\b(add a tree|add tree|new tree|record a tree)\b/i];for(const g of c)if(g.test(e))return{type:"tree",action:"createTree",data:it(r),confidence:.9};const u=[/\b(show me|show|display|view)\b/i,/\b(list|list all|list all)\b/i,/\b(what are|what is|what's|where are)\b/i,/\b(summarise|summary|summarize)\b/i,/\b(find|search|look for)\b/i];for(const g of u)if(g.test(e))return{type:"query",action:"query",data:lt(r),confidence:.85};const d=[/\b(change|update|modify|edit)\b/i,/\b(rename|renamed)\b/i,/\b(add tags|add tag)\b/i,/\b(mark complete|mark done|mark as done)\b/i];for(const g of d)if(g.test(e))return{type:"update",action:"updateObject",data:ct(r),confidence:.8};return null}function fe(r){const t=ee(Y).currentProjectId;let s="New Task",o=r,a="medium",n=[];const i=[/(?:remember|remind me|remind to|task:?)\s*(.+)/i,/(?:to|that|about)\s*(.+)/i];for(const d of i){const g=r.match(d);if(g&&g[1]){s=g[1].trim();break}}/\b(urgent|asap|immediately|important|high priority|critical)\b/i.test(r)?a="high":/\b(low priority|whenever|when you can)\b/i.test(r)&&(a="low");const l=r.match(/#(\w+)/g);l&&(n=l.map(d=>d.replace("#","")));let c;return r.match(/(?:by|due|on)\s*(\d{1,2}[\/\-]\d{1,2}[\/\-]\d{2,4}|tomorrow|next week|monday|tuesday|wednesday|thursday|friday|saturday|sunday)/i)&&(c=new Date),{title:s,content:o,status:"todo",priority:a,projectId:t||void 0,tags:n,dueDate:c}}function rt(r){const t=ee(Y).currentProjectId;let s="Quick Note",o=r,a=[];const n=r.match(/(?:note about|note:|title:)\s*([^,.\n]+)/i);n&&(s=n[1].trim()),o=r.replace(/^(note to self|jot down|write a note|make a note|create a note|take a note|add a note|note about|note:)\s*/i,"").replace(/^title:[^\n]+\n?/i,"").trim(),o||(o=r);const i=r.match(/#(\w+)/g);return i&&(a=i.map(l=>l.replace("#",""))),{title:s,content:o,projectId:t||void 0,tags:a,type:"general"}}function st(r){let e="New Project",t="",s="",o="";const a=r.match(/(?:project|project called)\s*([^,.\n]+)/i);a&&(e=a[1].trim());const n=r.match(/(?:for|client:)\s*([^,.\n]+)/i);n&&(o=n[1].trim());const i=r.match(/(?:at|location:)\s*([^,.\n]+)/i);return i&&(s=i[1].trim()),{name:e,description:t,location:s,client:o}}function at(r){const t=ee(Y).currentProjectId;let s="New Blog Post",o="",a=r,n=[];const i=r.match(/(?:blog post|about|write about)\s*([^,.\n]+)/i);i&&(s=i[1].trim());const l=r.match(/#(\w+)/g);return l&&(n=l.map(c=>c.replace("#",""))),{title:s,subtitle:o,content:a,tags:n,projectId:t}}function ot(r){const t=ee(Y).currentProjectId;let s="New Report",o="bs5837";return/\bimpact\b/i.test(r)?(o="impact",s="Arboricultural Impact Assessment"):/\bmethod\b/i.test(r)?(o="method",s="Arboricultural Method Statement"):/\bbs5837\b/i.test(r)&&(o="bs5837",s="BS5837 Tree Survey"),{title:s,type:o,content:"",projectId:t}}function nt(r){const t=ee(Y).currentProjectId;let s="New Diagram",o="flowchart";return/\bmind\b/i.test(r)?(o="mindmap",s="Mind Map"):/\bgantt\b/i.test(r)&&(o="gantt",s="Gantt Chart"),{title:s,type:o,content:"",projectId:t}}function it(r){const t=ee(Y).currentProjectId;let s="1",o="Unknown",a=0,n=0,i="Mature",l="C",c="Good";const u=r.match(/(oak|ash|maple|beech|sycamore|pine|spruce|elm|birch|cherry|hawthorn|willow|poplar|lime|horse chestnut|rowan|alder|cedar|fir|hemlock)/i);u&&(o=u[0].charAt(0).toUpperCase()+u[0].slice(1).toLowerCase());const d=r.match(/(?:tree\s*#?|number)\s*(\d+)/i);d&&(s=d[1]);const g=r.match(/(?:dbh|stem|diameter)\s*(\d+)/i);return g&&(a=parseInt(g[1])),{number:s,species:o,DBH:a,height:n,age:i,category:l,condition:c,projectId:t}}function lt(r){const e=r.toLowerCase();let t="tasks",s,o="";return/\b(notes?|note)\b/i.test(e)?t="notes":/\b(projects?)\b/i.test(e)?t="projects":/\b(trees?)\b/i.test(e)?t="trees":/\b(reports?)\b/i.test(e)?t="reports":/\b(diagrams?|flows?|charts?)\b/i.test(e)?t="diagrams":/\b(blogs?|posts?)\b/i.test(e)&&(t="blogs"),/\b(active|current|ongoing)\b/i.test(e)?s="todo":/\b(complete|completed|done|finished)\b/i.test(e)?s="done":/\b(archived|archive)\b/i.test(e)&&(s="archived"),o=r.replace(/^(show me|list|what are|summarise|find|search|look for)\s*/i,"").trim(),{objectType:t,status:s,searchTerm:o}}function ct(r){return{message:r}}async function ut(r){try{switch(r.type){case"task":return await pe(r.data);case"note":return await dt(r.data);case"project":return await ft(r.data);case"blog":return await pt(r.data);case"report":return await ht(r.data);case"diagram":return await gt(r.data);case"tree":return await mt(r.data);case"query":return await bt(r.data);case"subtask":return await pe({...r.data,isSubtask:!0});default:return{success:!1,message:"Unknown intent type"}}}catch(e){return console.error("Error executing intent:",e),{success:!1,message:e instanceof Error?e.message:"Failed to execute action"}}}async function pe(r){const{title:e,content:t,status:s,priority:o,projectId:a,tags:n,dueDate:i,isSubtask:l}=r;try{const c=await Qe({title:e||"New Task",content:t||"",status:s||"todo",priority:o||"medium",projectId:a,tags:n||[],dueDate:i}),u=`Task Context:
${t||e}

Priority: ${o||"medium"}
Status: ${s||"todo"}`,d=await Ue({title:`Context: ${e}`,content:u,projectId:a,tags:n||[],type:"general"});return await Ke({sourceId:c,sourceType:"task",targetId:d,targetType:"note",relationType:"context"}),await z.tasks.update(c,{linkedNoteId:d}),{success:!0,message:`Task "${e}" created with linked context note`,action:"createTask",data:{taskId:c,noteId:d},redirectUrl:`/notes?note=${d}&mode=edit`,intentType:"task"}}catch(c){return console.error("Error creating task:",c),{success:!1,message:"Failed to create task. Please try again."}}}async function dt(r){const{title:e,content:t,projectId:s,tags:o,type:a}=r;try{const n=await Ue({title:e||"Quick Note",content:t||"",projectId:s,tags:o||[],type:a||"general"});return{success:!0,message:`Note "${e}" created successfully`,action:"createNote",data:{noteId:n},redirectUrl:`/notes?note=${n}&mode=edit`,intentType:"note"}}catch(n){return console.error("Error creating note:",n),{success:!1,message:"Failed to create note. Please try again."}}}async function ft(r){const{name:e,description:t,location:s,client:o}=r;try{const a=await z.projects.add({name:e||"New Project",description:t||"",location:s||"",client:o||"",createdAt:new Date,updatedAt:new Date}),n=ee(Y);return Y.set({...n,currentProjectId:a}),localStorage.setItem("oscar_settings",JSON.stringify({...n,currentProjectId:a})),{success:!0,message:`Project "${e}" created successfully`,action:"createProject",data:{projectId:a},redirectUrl:`/project/${a}`,intentType:"project"}}catch(a){return console.error("Error creating project:",a),{success:!1,message:"Failed to create project. Please try again."}}}async function pt(r){const{title:e,subtitle:t,content:s,tags:o,projectId:a}=r;if(!a)return{success:!1,message:"Please select a project first to create a blog post."};try{const n={id:crypto.randomUUID(),projectId:a,title:e||"New Blog Post",subtitle:t||"",bodyHTML:s||"",bodyContent:s||"",tags:o||[],createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},i=localStorage.getItem("oscar_blog_posts"),l=i?JSON.parse(i):[];return l.push(n),localStorage.setItem("oscar_blog_posts",JSON.stringify(l)),{success:!0,message:`Blog post "${e}" created successfully`,action:"createBlogPost",data:n,redirectUrl:`/blog?project=${a}&post=${n.id}&mode=edit`,intentType:"blog"}}catch(n){return console.error("Error creating blog post:",n),{success:!1,message:"Failed to create blog post. Please try again."}}}async function ht(r){const{title:e,type:t,content:s,projectId:o}=r;if(!o)return{success:!1,message:"Please select a project first to create a report."};try{const a={id:crypto.randomUUID(),projectId:o,title:e||"New Report",type:t||"bs5837",content:s||"",generatedAt:new Date().toISOString()},n=localStorage.getItem("oscar_reports"),i=n?JSON.parse(n):[];return i.push(a),localStorage.setItem("oscar_reports",JSON.stringify(i)),{success:!0,message:`Report "${e}" created successfully`,action:"createReport",data:a,redirectUrl:`/reports?project=${o}&report=${a.id}&mode=edit`,intentType:"report"}}catch(a){return console.error("Error creating report:",a),{success:!1,message:"Failed to create report. Please try again."}}}async function gt(r){const{title:e,type:t,content:s,projectId:o}=r;if(!o)return{success:!1,message:"Please select a project first to create a diagram."};try{const a={id:crypto.randomUUID(),projectId:o,title:e||"New Diagram",type:t||"flowchart",content:s||"",createdAt:new Date().toISOString()},n=localStorage.getItem("oscar_diagrams"),i=n?JSON.parse(n):[];return i.push(a),localStorage.setItem("oscar_diagrams",JSON.stringify(i)),{success:!0,message:`Diagram "${e}" created successfully`,action:"createDiagram",data:a,redirectUrl:`/diagrams?project=${o}&diagram=${a.id}&mode=edit`,intentType:"diagram"}}catch(a){return console.error("Error creating diagram:",a),{success:!1,message:"Failed to create diagram. Please try again."}}}async function mt(r){const{number:e,species:t,DBH:s,height:o,age:a,category:n,condition:i,projectId:l}=r;if(!l)return{success:!1,message:"Please select a project first to add a tree."};try{const c=await z.trees.add({projectId:l,number:e||"1",species:t||"Unknown",scientificName:"",DBH:s||0,height:o||0,age:a||"Mature",category:n||"C",condition:i||"Good",photos:[],createdAt:new Date,updatedAt:new Date});return{success:!0,message:`Tree ${e} (${t}) added successfully`,action:"createTree",data:{treeId:c},redirectUrl:`/project/${l}?tree=${c}`,intentType:"tree"}}catch(c){return console.error("Error adding tree:",c),{success:!1,message:"Failed to add tree. Please try again."}}}async function bt(r){const{objectType:e,status:t,searchTerm:s}=r,a=ee(Y).currentProjectId;try{let n=[],i="/";switch(e){case"tasks":t?n=await We(t):a?n=await Xe(a):n=await Ye(),i="/tasks";break;case"notes":a?n=await z.notes.where("projectId").equals(a).toArray():n=await ze(),i="/notes";break;case"projects":n=await z.projects.orderBy("updatedAt").reverse().toArray(),i="/workspace";break;case"trees":a&&(n=await z.trees.where("projectId").equals(a).toArray()),i=`/project/${a}`;break;case"reports":a&&(n=await z.reports.where("projectId").equals(a).toArray()),i="/reports";break;case"diagrams":if(a){const l=localStorage.getItem("oscar_diagrams");l&&(n=JSON.parse(l).filter(u=>u.projectId===a))}i="/diagrams";break;case"blogs":if(a){const l=localStorage.getItem("oscar_blog_posts");l&&(n=JSON.parse(l).filter(u=>u.projectId===a))}i="/blog";break}if(s&&n.length>0){const l=s.toLowerCase();n=n.filter(c=>{const u=(c.title||c.name||"").toLowerCase(),d=(c.content||c.description||"").toLowerCase();return u.includes(l)||d.includes(l)})}return{success:!0,message:`Found ${n.length} ${e}`,action:"query",data:{objectType:e,status:t,searchTerm:s},redirectUrl:i,intentType:"query",objects:n}}catch(n){return console.error("Error executing query:",n),{success:!1,message:"Failed to execute query. Please try again."}}}function he(r){Ge(r)}function ge(r,e,t){const s=r.slice();return s[22]=e[t],s}function me(r,e,t){const s=r.slice();return s[25]=e[t],s}function be(r,e,t){const s=r.slice();return s[28]=e[t],s}function ye(r){let e,t,s=r[5].currentProject.name+"",o;return{c(){e=j("p"),t=V("Project: "),o=V(s),this.h()},l(a){e=w(a,"P",{class:!0});var n=C(e);t=H(n,"Project: "),o=H(n,s),n.forEach(b),this.h()},h(){y(e,"class","text-xs text-green-700 mt-2 bg-green-50 inline-block px-2 py-1 rounded")},m(a,n){B(a,e,n),h(e,t),h(e,o)},p(a,n){n&32&&s!==(s=a[5].currentProject.name+"")&&Q(o,s)},d(a){a&&b(e)}}}function yt(r){let e,t,s,o,a,n,i,l,c,u,d,g,A=r[2]?"Sending...":"Send",E,P,D,T,q='Try: "remember to check the oak tree", "show me my tasks", "make a note about the site visit"',U,$,N;function J(p,S){if(p[6])return kt;if(p[4]&&p[0].length===0)return vt}let F=J(r),R=F&&F(r),v=se(r[0]),f=[];for(let p=0;p<v.length;p+=1)f[p]=De(ge(r,v,p));const I=p=>re(f[p],1,1,()=>{f[p]=null});let k=r[2]&&Ce(),_=r[3]&&r[0].length>0&&Ee(r);return u=new Je({}),u.$on("transcript",r[15]),{c(){e=j("div"),R&&R.c(),t=x();for(let p=0;p<f.length;p+=1)f[p].c();s=x(),k&&k.c(),o=x(),a=j("div"),_&&_.c(),n=x(),i=j("div"),l=j("textarea"),c=x(),xe(u.$$.fragment),d=x(),g=j("button"),E=V(A),D=x(),T=j("p"),T.textContent=q,this.h()},l(p){e=w(p,"DIV",{class:!0});var S=C(e);R&&R.l(S),t=O(S);for(let L=0;L<f.length;L+=1)f[L].l(S);s=O(S),k&&k.l(S),S.forEach(b),o=O(p),a=w(p,"DIV",{class:!0});var m=C(a);_&&_.l(m),n=O(m),i=w(m,"DIV",{class:!0});var M=C(i);l=w(M,"TEXTAREA",{placeholder:!0,rows:!0,class:!0}),C(l).forEach(b),c=O(M),Oe(u.$$.fragment,M),d=O(M),g=w(M,"BUTTON",{class:!0});var X=C(g);E=H(X,A),X.forEach(b),M.forEach(b),D=O(m),T=w(m,"P",{class:!0,"data-svelte-h":!0}),W(T)!=="svelte-1hhojsz"&&(T.textContent=q),m.forEach(b),this.h()},h(){y(e,"class","flex-1 overflow-y-auto p-6 space-y-4"),y(l,"placeholder","Ask to create tasks, notes, or ask questions..."),y(l,"rows","2"),y(l,"class","input flex-1 resize-none"),l.disabled=r[2],g.disabled=P=r[2]||!r[1].trim(),y(g,"class","btn btn-primary px-6"),y(i,"class","flex gap-2"),y(T,"class","text-xs text-gray-500 mt-2"),y(a,"class","bg-white border-t border-gray-200 p-4")},m(p,S){B(p,e,S),R&&R.m(e,null),h(e,t);for(let m=0;m<f.length;m+=1)f[m]&&f[m].m(e,null);h(e,s),k&&k.m(e,null),B(p,o,S),B(p,a,S),_&&_.m(a,null),h(a,n),h(a,i),h(i,l),ce(l,r[1]),h(i,c),Ne(u,i,null),h(i,d),h(i,g),h(g,E),h(a,D),h(a,T),U=!0,$||(N=[te(l,"input",r[19]),te(l,"keydown",r[11]),te(g,"click",r[10])],$=!0)},p(p,S){if(F===(F=J(p))&&R?R.p(p,S):(R&&R.d(1),R=F&&F(p),R&&(R.c(),R.m(e,t))),S&24577){v=se(p[0]);let m;for(m=0;m<v.length;m+=1){const M=ge(p,v,m);f[m]?(f[m].p(M,S),Z(f[m],1)):(f[m]=De(M),f[m].c(),Z(f[m],1),f[m].m(e,s))}for(ie(),m=v.length;m<f.length;m+=1)I(m);ne()}p[2]?k||(k=Ce(),k.c(),k.m(e,null)):k&&(k.d(1),k=null),p[3]&&p[0].length>0?_?_.p(p,S):(_=Ee(p),_.c(),_.m(a,n)):_&&(_.d(1),_=null),(!U||S&4)&&(l.disabled=p[2]),S&2&&ce(l,p[1]),(!U||S&4)&&A!==(A=p[2]?"Sending...":"Send")&&Q(E,A),(!U||S&6&&P!==(P=p[2]||!p[1].trim()))&&(g.disabled=P)},i(p){if(!U){for(let S=0;S<v.length;S+=1)Z(f[S]);Z(u.$$.fragment,p),U=!0}},o(p){f=f.filter(Boolean);for(let S=0;S<f.length;S+=1)re(f[S]);re(u.$$.fragment,p),U=!1},d(p){p&&(b(e),b(o),b(a)),R&&R.d(),oe(f,p),k&&k.d(),_&&_.d(),Me(u),$=!1,Re(N)}}}function _t(r){let e,t,s,o="ðŸŒ³",a,n,i,l,c,u="Go to Settings";return{c(){e=j("div"),t=j("div"),s=j("div"),s.textContent=o,a=x(),n=j("p"),i=V(r[3]),l=x(),c=j("a"),c.textContent=u,this.h()},l(d){e=w(d,"DIV",{class:!0});var g=C(e);t=w(g,"DIV",{class:!0});var A=C(t);s=w(A,"DIV",{class:!0,"data-svelte-h":!0}),W(s)!=="svelte-4361ou"&&(s.textContent=o),a=O(A),n=w(A,"P",{class:!0});var E=C(n);i=H(E,r[3]),E.forEach(b),l=O(A),c=w(A,"A",{href:!0,class:!0,"data-svelte-h":!0}),W(c)!=="svelte-c6fqsa"&&(c.textContent=u),A.forEach(b),g.forEach(b),this.h()},h(){y(s,"class","text-4xl mb-4"),y(n,"class","text-gray-600 mb-4"),y(c,"href","/settings"),y(c,"class","btn btn-primary"),y(t,"class","text-center"),y(e,"class","flex-1 flex items-center justify-center p-6")},m(d,g){B(d,e,g),h(e,t),h(t,s),h(t,a),h(t,n),h(n,i),h(t,l),h(t,c)},p(d,g){g&8&&Q(i,d[3])},i:ae,o:ae,d(d){d&&b(e)}}}function vt(r){let e,t,s="Quick Reference",o,a,n=se(r[7]),i=[];for(let l=0;l<n.length;l+=1)i[l]=_e(be(r,n,l));return{c(){e=j("div"),t=j("h2"),t.textContent=s,o=x(),a=j("div");for(let l=0;l<i.length;l+=1)i[l].c();this.h()},l(l){e=w(l,"DIV",{class:!0});var c=C(e);t=w(c,"H2",{class:!0,"data-svelte-h":!0}),W(t)!=="svelte-qnfqrr"&&(t.textContent=s),o=O(c),a=w(c,"DIV",{class:!0});var u=C(a);for(let d=0;d<i.length;d+=1)i[d].l(u);u.forEach(b),c.forEach(b),this.h()},h(){y(t,"class","text-sm font-semibold text-gray-700 mb-4"),y(a,"class","grid gap-2"),y(e,"class","bg-gray-50 rounded-lg p-6 mb-4")},m(l,c){B(l,e,c),h(e,t),h(e,o),h(e,a);for(let u=0;u<i.length;u+=1)i[u]&&i[u].m(a,null)},p(l,c){if(c&4224){n=se(l[7]);let u;for(u=0;u<n.length;u+=1){const d=be(l,n,u);i[u]?i[u].p(d,c):(i[u]=_e(d),i[u].c(),i[u].m(a,null))}for(;u<i.length;u+=1)i[u].d(1);i.length=n.length}},d(l){l&&b(e),oe(i,l)}}}function kt(r){let e,t='<div class="text-gray-500">Loading chat history...</div>';return{c(){e=j("div"),e.innerHTML=t,this.h()},l(s){e=w(s,"DIV",{class:!0,"data-svelte-h":!0}),W(e)!=="svelte-hkvk66"&&(e.innerHTML=t),this.h()},h(){y(e,"class","flex justify-center py-8")},m(s,o){B(s,e,o)},p:ae,d(s){s&&b(e)}}}function _e(r){let e,t,s=r[28].question+"",o,a,n,i;function l(){return r[16](r[28])}return{c(){e=j("button"),t=j("span"),o=V(s),a=x(),this.h()},l(c){e=w(c,"BUTTON",{class:!0});var u=C(e);t=w(u,"SPAN",{class:!0});var d=C(t);o=H(d,s),d.forEach(b),a=O(u),u.forEach(b),this.h()},h(){y(t,"class","text-gray-800 font-medium text-sm"),y(e,"class","text-left p-3 bg-white rounded-lg border border-gray-200 hover:border-gray-400 hover:bg-gray-50 transition-colors")},m(c,u){B(c,e,u),h(e,t),h(t,o),h(e,a),n||(i=te(e,"click",l),n=!0)},p(c,u){r=c},d(c){c&&b(e),n=!1,i()}}}function wt(r){let e,t=r[22].content+"",s;return{c(){e=j("p"),s=V(t),this.h()},l(o){e=w(o,"P",{class:!0});var a=C(e);s=H(a,t),a.forEach(b),this.h()},h(){y(e,"class","whitespace-pre-wrap")},m(o,a){B(o,e,a),h(e,s)},p(o,a){a&1&&t!==(t=o[22].content+"")&&Q(s,t)},i:ae,o:ae,d(o){o&&b(e)}}}function jt(r){let e,t;return e=new Ve({props:{content:r[22].content}}),{c(){xe(e.$$.fragment)},l(s){Oe(e.$$.fragment,s)},m(s,o){Ne(e,s,o),t=!0},p(s,o){const a={};o&1&&(a.content=s[22].content),e.$set(a)},i(s){t||(Z(e.$$.fragment,s),t=!0)},o(s){re(e.$$.fragment,s),t=!1},d(s){Me(e,s)}}}function ve(r){let e,t,s,o=r[22].actionResult.message+"",a,n,i=r[22].actionUrl&&ke(r);return{c(){e=j("div"),t=j("p"),s=V("âœ“ "),a=V(o),n=x(),i&&i.c(),this.h()},l(l){e=w(l,"DIV",{class:!0});var c=C(e);t=w(c,"P",{class:!0});var u=C(t);s=H(u,"âœ“ "),a=H(u,o),u.forEach(b),n=O(c),i&&i.l(c),c.forEach(b),this.h()},h(){y(t,"class","text-green-800 font-medium text-sm"),y(e,"class","mt-4 p-3 bg-green-50 border border-green-200 rounded-lg")},m(l,c){B(l,e,c),h(e,t),h(t,s),h(t,a),h(e,n),i&&i.m(e,null)},p(l,c){c&1&&o!==(o=l[22].actionResult.message+"")&&Q(a,o),l[22].actionUrl?i?i.p(l,c):(i=ke(l),i.c(),i.m(e,null)):i&&(i.d(1),i=null)},d(l){l&&b(e),i&&i.d()}}}function ke(r){let e,t='<span>Open</span> <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path></svg>',s,o;function a(){return r[17](r[22])}return{c(){e=j("button"),e.innerHTML=t,this.h()},l(n){e=w(n,"BUTTON",{class:!0,"data-svelte-h":!0}),W(e)!=="svelte-7nr1jt"&&(e.innerHTML=t),this.h()},h(){y(e,"class","mt-2 inline-flex items-center gap-2 px-4 py-2 bg-green-700 text-white rounded-lg hover:bg-green-800 transition-colors text-sm")},m(n,i){B(n,e,i),s||(o=te(e,"click",a),s=!0)},p(n,i){r=n},d(n){n&&b(e),s=!1,o()}}}function we(r){let e,t,s,o=r[22].actionResult.message+"",a;return{c(){e=j("div"),t=j("p"),s=V("âœ— "),a=V(o),this.h()},l(n){e=w(n,"DIV",{class:!0});var i=C(e);t=w(i,"P",{class:!0});var l=C(t);s=H(l,"âœ— "),a=H(l,o),l.forEach(b),i.forEach(b),this.h()},h(){y(t,"class","text-red-800 text-sm"),y(e,"class","mt-4 p-3 bg-red-50 border border-red-200 rounded-lg")},m(n,i){B(n,e,i),h(e,t),h(t,s),h(t,a)},p(n,i){i&1&&o!==(o=n[22].actionResult.message+"")&&Q(a,o)},d(n){n&&b(e)}}}function je(r){var g,A,E;let e,t,s=Ae((A=(g=r[22].actionResult)==null?void 0:g.data)==null?void 0:A.objectType)+"",o,a,n=((E=r[22].actionResult)==null?void 0:E.message)+"",i,l,c,u=se(r[22].objects),d=[];for(let P=0;P<u.length;P+=1)d[P]=Pe(me(r,u,P));return{c(){e=j("div"),t=j("p"),o=V(s),a=x(),i=V(n),l=x(),c=j("div");for(let P=0;P<d.length;P+=1)d[P].c();this.h()},l(P){e=w(P,"DIV",{class:!0});var D=C(e);t=w(D,"P",{class:!0});var T=C(t);o=H(T,s),a=O(T),i=H(T,n),T.forEach(b),l=O(D),c=w(D,"DIV",{class:!0});var q=C(c);for(let U=0;U<d.length;U+=1)d[U].l(q);q.forEach(b),D.forEach(b),this.h()},h(){y(t,"class","text-blue-800 font-medium mb-2 text-sm"),y(c,"class","space-y-2 max-h-60 overflow-y-auto"),y(e,"class","mt-4 p-3 bg-blue-50 border border-blue-200 rounded-lg")},m(P,D){B(P,e,D),h(e,t),h(t,o),h(t,a),h(t,i),h(e,l),h(e,c);for(let T=0;T<d.length;T+=1)d[T]&&d[T].m(c,null)},p(P,D){var T,q,U;if(D&1&&s!==(s=Ae((q=(T=P[22].actionResult)==null?void 0:T.data)==null?void 0:q.objectType)+"")&&Q(o,s),D&1&&n!==(n=((U=P[22].actionResult)==null?void 0:U.message)+"")&&Q(i,n),D&16385){u=se(P[22].objects);let $;for($=0;$<u.length;$+=1){const N=me(P,u,$);d[$]?d[$].p(N,D):(d[$]=Pe(N),d[$].c(),d[$].m(c,null))}for(;$<d.length;$+=1)d[$].d(1);d.length=u.length}},d(P){P&&b(e),oe(d,P)}}}function Ie(r){var o,a;let e,t=(((o=r[25].content)==null?void 0:o.substring(0,80))||((a=r[25].description)==null?void 0:a.substring(0,80))||"")+"",s;return{c(){e=j("p"),s=V(t),this.h()},l(n){e=w(n,"P",{class:!0});var i=C(e);s=H(i,t),i.forEach(b),this.h()},h(){y(e,"class","text-xs text-gray-500 truncate")},m(n,i){B(n,e,i),h(e,s)},p(n,i){var l,c;i&1&&t!==(t=(((l=n[25].content)==null?void 0:l.substring(0,80))||((c=n[25].description)==null?void 0:c.substring(0,80))||"")+"")&&Q(s,t)},d(n){n&&b(e)}}}function Te(r){let e,t=r[25].status+"",s,o;return{c(){e=j("span"),s=V(t),this.h()},l(a){e=w(a,"SPAN",{class:!0});var n=C(e);s=H(n,t),n.forEach(b),this.h()},h(){y(e,"class",o="text-xs px-2 py-0.5 rounded-full "+(r[25].status==="done"?"bg-green-100 text-green-800":"bg-yellow-100 text-yellow-800"))},m(a,n){B(a,e,n),h(e,s)},p(a,n){n&1&&t!==(t=a[25].status+"")&&Q(s,t),n&1&&o!==(o="text-xs px-2 py-0.5 rounded-full "+(a[25].status==="done"?"bg-green-100 text-green-800":"bg-yellow-100 text-yellow-800"))&&y(e,"class",o)},d(a){a&&b(e)}}}function Pe(r){let e,t,s=(r[25].title||r[25].name||"Untitled")+"",o,a,n,i,l,c,u=(r[25].content||r[25].description)&&Ie(r),d=r[25].status&&Te(r);function g(){return r[18](r[25],r[22])}return{c(){e=j("button"),t=j("p"),o=V(s),a=x(),u&&u.c(),n=x(),d&&d.c(),i=x(),this.h()},l(A){e=w(A,"BUTTON",{class:!0});var E=C(e);t=w(E,"P",{class:!0});var P=C(t);o=H(P,s),P.forEach(b),a=O(E),u&&u.l(E),n=O(E),d&&d.l(E),i=O(E),E.forEach(b),this.h()},h(){y(t,"class","font-medium text-gray-900 text-sm"),y(e,"class","w-full text-left p-2 bg-white rounded border border-blue-100 hover:border-blue-300 hover:bg-blue-50 transition-colors")},m(A,E){B(A,e,E),h(e,t),h(t,o),h(e,a),u&&u.m(e,null),h(e,n),d&&d.m(e,null),h(e,i),l||(c=te(e,"click",g),l=!0)},p(A,E){r=A,E&1&&s!==(s=(r[25].title||r[25].name||"Untitled")+"")&&Q(o,s),r[25].content||r[25].description?u?u.p(r,E):(u=Ie(r),u.c(),u.m(e,n)):u&&(u.d(1),u=null),r[25].status?d?d.p(r,E):(d=Te(r),d.c(),d.m(e,i)):d&&(d.d(1),d=null)},d(A){A&&b(e),u&&u.d(),d&&d.d(),l=!1,c()}}}function Se(r){let e,t='<p class="text-gray-600 text-sm">No items found.</p>';return{c(){e=j("div"),e.innerHTML=t,this.h()},l(s){e=w(s,"DIV",{class:!0,"data-svelte-h":!0}),W(e)!=="svelte-11g9gl6"&&(e.innerHTML=t),this.h()},h(){y(e,"class","mt-4 p-3 bg-gray-50 border border-gray-200 rounded-lg")},m(s,o){B(s,e,o)},d(s){s&&b(e)}}}function De(r){var p,S;let e,t,s,o,a=r[22].role==="user"?"ðŸ‘¤":"ðŸŒ³",n,i,l,c,u,d,g,A,E,P,D,T=new Date(r[22].timestamp).toLocaleTimeString()+"",q,U,$,N,J;const F=[jt,wt],R=[];function v(m,M){return m[22].role==="oscar"?0:1}c=v(r),u=R[c]=F[c](r);let f=((p=r[22].actionResult)==null?void 0:p.success)&&r[22].actionResult.intentType!=="query"&&ve(r),I=r[22].actionResult&&!r[22].actionResult.success&&we(r),k=r[22].objects&&r[22].objects.length>0&&je(r),_=((S=r[22].actionResult)==null?void 0:S.intentType)==="query"&&r[22].actionResult.success&&(!r[22].objects||r[22].objects.length===0)&&Se();return{c(){e=j("div"),t=j("div"),s=j("div"),o=j("span"),n=V(a),i=x(),l=j("div"),u.c(),d=x(),f&&f.c(),g=x(),I&&I.c(),A=x(),k&&k.c(),E=x(),_&&_.c(),P=x(),D=j("p"),q=V(T),this.h()},l(m){e=w(m,"DIV",{class:!0});var M=C(e);t=w(M,"DIV",{class:!0});var X=C(t);s=w(X,"DIV",{class:!0});var L=C(s);o=w(L,"SPAN",{class:!0});var G=C(o);n=H(G,a),G.forEach(b),i=O(L),l=w(L,"DIV",{class:!0});var K=C(l);u.l(K),d=O(K),f&&f.l(K),g=O(K),I&&I.l(K),A=O(K),k&&k.l(K),E=O(K),_&&_.l(K),P=O(K),D=w(K,"P",{class:!0});var le=C(D);q=H(le,T),le.forEach(b),K.forEach(b),L.forEach(b),X.forEach(b),M.forEach(b),this.h()},h(){y(o,"class","text-xl"),y(D,"class",U="text-xs "+(r[22].role==="user"?"text-green-200":"text-gray-400")+" mt-2"),y(l,"class","flex-1 min-w-0"),y(s,"class","flex items-start gap-3"),y(t,"class",$="max-w-3xl "+(r[22].role==="user"?"bg-green-700 text-white":"bg-gray-100 text-gray-900")+" rounded-lg p-4"),y(e,"class",N="flex "+(r[22].role==="user"?"justify-end":"justify-start"))},m(m,M){B(m,e,M),h(e,t),h(t,s),h(s,o),h(o,n),h(s,i),h(s,l),R[c].m(l,null),h(l,d),f&&f.m(l,null),h(l,g),I&&I.m(l,null),h(l,A),k&&k.m(l,null),h(l,E),_&&_.m(l,null),h(l,P),h(l,D),h(D,q),J=!0},p(m,M){var L,G;(!J||M&1)&&a!==(a=m[22].role==="user"?"ðŸ‘¤":"ðŸŒ³")&&Q(n,a);let X=c;c=v(m),c===X?R[c].p(m,M):(ie(),re(R[X],1,1,()=>{R[X]=null}),ne(),u=R[c],u?u.p(m,M):(u=R[c]=F[c](m),u.c()),Z(u,1),u.m(l,d)),(L=m[22].actionResult)!=null&&L.success&&m[22].actionResult.intentType!=="query"?f?f.p(m,M):(f=ve(m),f.c(),f.m(l,g)):f&&(f.d(1),f=null),m[22].actionResult&&!m[22].actionResult.success?I?I.p(m,M):(I=we(m),I.c(),I.m(l,A)):I&&(I.d(1),I=null),m[22].objects&&m[22].objects.length>0?k?k.p(m,M):(k=je(m),k.c(),k.m(l,E)):k&&(k.d(1),k=null),((G=m[22].actionResult)==null?void 0:G.intentType)==="query"&&m[22].actionResult.success&&(!m[22].objects||m[22].objects.length===0)?_||(_=Se(),_.c(),_.m(l,P)):_&&(_.d(1),_=null),(!J||M&1)&&T!==(T=new Date(m[22].timestamp).toLocaleTimeString()+"")&&Q(q,T),(!J||M&1&&U!==(U="text-xs "+(m[22].role==="user"?"text-green-200":"text-gray-400")+" mt-2"))&&y(D,"class",U),(!J||M&1&&$!==($="max-w-3xl "+(m[22].role==="user"?"bg-green-700 text-white":"bg-gray-100 text-gray-900")+" rounded-lg p-4"))&&y(t,"class",$),(!J||M&1&&N!==(N="flex "+(m[22].role==="user"?"justify-end":"justify-start")))&&y(e,"class",N)},i(m){J||(Z(u),J=!0)},o(m){re(u),J=!1},d(m){m&&b(e),R[c].d(),f&&f.d(),I&&I.d(),k&&k.d(),_&&_.d()}}}function Ce(r){let e,t='<div class="bg-gray-100 rounded-lg p-4"><div class="flex items-center gap-3"><span class="text-xl">ðŸŒ³</span> <div class="flex items-center gap-1"><span class="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style="animation-delay: 0ms;"></span> <span class="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style="animation-delay: 150ms;"></span> <span class="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style="animation-delay: 300ms;"></span></div></div></div>';return{c(){e=j("div"),e.innerHTML=t,this.h()},l(s){e=w(s,"DIV",{class:!0,"data-svelte-h":!0}),W(e)!=="svelte-r251wy"&&(e.innerHTML=t),this.h()},h(){y(e,"class","flex justify-start")},m(s,o){B(s,e,o)},d(s){s&&b(e)}}}function Ee(r){let e,t;return{c(){e=j("div"),t=V(r[3]),this.h()},l(s){e=w(s,"DIV",{class:!0});var o=C(e);t=H(o,r[3]),o.forEach(b),this.h()},h(){y(e,"class","mb-2 text-red-600 text-sm")},m(s,o){B(s,e,o),h(e,t)},p(s,o){o&8&&Q(t,s[3])},d(s){s&&b(e)}}}function It(r){var v;let e,t,s,o,a,n='<h1 class="text-xl font-bold text-gray-900">Oscar AI</h1> <p class="text-sm text-gray-600">Tree Consultant Assistant</p>',i,l,c,u=`<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg>
					Refresh`,d,g,A=`<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4"></path></svg>
					Save &amp; Refresh`,E,P,D,T,q,U,$,N=((v=r[5])==null?void 0:v.currentProject)&&ye(r);const J=[_t,yt],F=[];function R(f,I){return f[3]&&!f[0].length?0:1}return D=R(r),T=F[D]=J[D](r),{c(){e=x(),t=j("div"),s=j("div"),o=j("div"),a=j("div"),a.innerHTML=n,i=x(),l=j("div"),c=j("button"),c.innerHTML=u,d=x(),g=j("button"),g.innerHTML=A,E=x(),N&&N.c(),P=x(),T.c(),this.h()},l(f){Be("svelte-1kk1g6u",document.head).forEach(b),e=O(f),t=w(f,"DIV",{class:!0});var k=C(t);s=w(k,"DIV",{class:!0});var _=C(s);o=w(_,"DIV",{class:!0});var p=C(o);a=w(p,"DIV",{"data-svelte-h":!0}),W(a)!=="svelte-1g7ujao"&&(a.innerHTML=n),i=O(p),l=w(p,"DIV",{class:!0});var S=C(l);c=w(S,"BUTTON",{class:!0,title:!0,"data-svelte-h":!0}),W(c)!=="svelte-dmb555"&&(c.innerHTML=u),d=O(S),g=w(S,"BUTTON",{class:!0,title:!0,"data-svelte-h":!0}),W(g)!=="svelte-1n27d1j"&&(g.innerHTML=A),S.forEach(b),p.forEach(b),E=O(_),N&&N.l(_),_.forEach(b),P=O(k),T.l(k),k.forEach(b),this.h()},h(){document.title="Oscar AI Assistant",y(c,"class","px-3 py-1.5 text-sm text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-colors flex items-center gap-1.5"),y(c,"title","Refresh chat"),y(g,"class","px-3 py-1.5 text-sm text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-colors flex items-center gap-1.5"),y(g,"title","Save transcript and refresh"),y(l,"class","flex gap-2"),y(o,"class","flex items-center justify-between"),y(s,"class","bg-white border-b border-gray-200 px-6 py-4"),y(t,"class","max-w-4xl mx-auto h-full flex flex-col")},m(f,I){B(f,e,I),B(f,t,I),h(t,s),h(s,o),h(o,a),h(o,i),h(o,l),h(l,c),h(l,d),h(l,g),h(s,E),N&&N.m(s,null),h(t,P),F[D].m(t,null),q=!0,U||($=[te(c,"click",r[8]),te(g,"click",r[9])],U=!0)},p(f,[I]){var _;(_=f[5])!=null&&_.currentProject?N?N.p(f,I):(N=ye(f),N.c(),N.m(s,null)):N&&(N.d(1),N=null);let k=D;D=R(f),D===k?F[D].p(f,I):(ie(),re(F[k],1,1,()=>{F[k]=null}),ne(),T=F[D],T?T.p(f,I):(T=F[D]=J[D](f),T.c()),Z(T,1),T.m(t,null))},i(f){q||(Z(T),q=!0)},o(f){re(T),q=!1},d(f){f&&(b(e),b(t)),N&&N.d(),F[D].d(),U=!1,Re($)}}}function Ae(r){switch(r){case"task":return"ðŸ“‹";case"tasks":return"ðŸ“‹";case"note":return"ðŸ“";case"notes":return"ðŸ“";case"project":return"ðŸ“";case"projects":return"ðŸ“";case"tree":return"ðŸŒ³";case"trees":return"ðŸŒ³";case"report":return"ðŸ“„";case"reports":return"ðŸ“„";case"blog":return"ðŸ“°";case"blogs":return"ðŸ“°";case"diagram":return"ðŸ“Š";case"diagrams":return"ðŸ“Š";default:return"ðŸ“‹"}}function Tt(r,e,t){let s="";He.subscribe(v=>{s=v});let o=[],a="",n=!1,i="",l=!0,c=null,u=!1;const d=[{question:"Root Protection Area calculation",answer:"Single-stem: RPA radius = DBH (mm) Ã— 12. Multi-stemmed: stem diameter at 1.5m Ã— 6."},{question:"BS5837 tree categories",answer:"A: High quality (conservation, appearance, riparian). B: Moderate quality. C: Low quality (10+ years life). U: Unsuitable for retention."},{question:"Tree Constraints Plan",answer:"Shows all trees, canopy spreads, RPAs, and constraints. Based on topographical survey, drawn to scale."},{question:"Preliminary Arboricultural Assessment",answer:"Desk-based study identifying trees, preliminary categories, and potential development constraints. First step before full BS5837 survey."}];qe(async()=>{s||t(3,i="Please configure your Groq API key in Settings first."),t(5,c=await de()),await g()});async function g(){t(6,u=!0);try{const v=await Ze(100);v.length>0&&(t(0,o=v.map(f=>({role:f.role,content:f.content,timestamp:f.timestamp.toISOString(),actionUrl:f.actionUrl,actionType:f.actionType,actionResult:f.actionResult,objects:f.objects,id:f.id}))),t(4,l=!1))}catch(v){console.error("Failed to load chat history:",v)}finally{t(6,u=!1)}}async function A(){t(0,o=[]),t(4,l=!0),t(1,a=""),t(3,i="")}async function E(){await A()}async function P(){var k;if(!a.trim()||n)return;if(!s){t(3,i="Please configure your Groq API key in Settings first.");return}t(2,n=!0),t(3,i=""),t(5,c=await de());const v=et(c),f=a.trim(),I={role:"user",content:f,timestamp:new Date().toISOString()};t(0,o=[...o,I]);try{const _=await ue({role:"user",content:f,actionUrl:I.actionUrl,actionType:I.actionType,actionResult:I.actionResult,objects:I.objects});I.id=_}catch(_){console.error("Failed to save user message:",_)}t(1,a="");try{const _=tt(f);let p=null;_&&_.type!=="chat"&&(console.log("Intent detected:",_.type,_.data),p=await ut(_),console.log("Action result:",p));let S="";p&&(p.success?S=`

ACTION COMPLETED: ${p.message}`:S=`

ACTION FAILED: ${p.message}`);const m=`You are Oscar, a professional Tree Consultant assistant. The user is an expert in arboriculture. Do not teach or lecture them.

IMPORTANT CONTEXT:
${v}
${S}

When the user asks to CREATE, MAKE, WRITE, ADD, START, or PERFORM tasks, the action has already been executed. Acknowledge what was done briefly.

IMPORTANT:
- Never invent fictional data unless explicitly asked
- Only use real data from the context
- Be concise - provide options, not explanations
- Never explain basic arboricultural concepts
- Act like a professional helper, not a tutor

Provide concise, accurate guidance.`,M=await fetch("https://api.groq.com/openai/v1/chat/completions",{method:"POST",headers:{Authorization:`Bearer ${s}`,"Content-Type":"application/json"},body:JSON.stringify({model:"llama-3.1-8b-instant",messages:[{role:"system",content:m},...o.map(G=>({role:G.role==="oscar"?"assistant":G.role,content:G.content}))],temperature:.7,max_tokens:1024})});if(!M.ok){const G=await M.json();throw new Error(((k=G.error)==null?void 0:k.message)||"Failed to get response from AI")}const L={role:"oscar",content:(await M.json()).choices[0].message.content,timestamp:new Date().toISOString(),actionUrl:p!=null&&p.success?p.redirectUrl:void 0,actionType:p==null?void 0:p.intentType,actionResult:p||void 0,objects:p==null?void 0:p.objects};try{const G=await ue({role:"oscar",content:L.content,actionUrl:L.actionUrl,actionType:L.actionType,actionResult:L.actionResult,objects:L.objects});L.id=G}catch(G){console.error("Failed to save assistant message:",G)}t(0,o=[...o,L])}catch(_){t(3,i=_ instanceof Error?_.message:"Failed to send message"),console.error(_)}finally{t(2,n=!1)}}function D(v){v.key==="Enter"&&!v.shiftKey&&(v.preventDefault(),P())}function T(v){t(4,l=!1),t(1,a=v.question)}function q(v){he(v)}function U(v,f){let I="/";switch(f){case"tasks":case"task":I=`/notes?note=${v.linkedNoteId||""}&mode=edit`;break;case"notes":case"note":I=`/notes?note=${v.id}&mode=edit`;break;case"projects":case"project":I=`/project/${v.id}`;break;case"trees":case"tree":I=`/project/${v.projectId}?tree=${v.id}`;break;case"reports":case"report":I=`/reports?report=${v.id}&mode=edit`;break;case"blogs":case"blog":I=`/blog?post=${v.id}&mode=edit`;break;case"diagrams":case"diagram":I=`/diagrams?diagram=${v.id}&mode=edit`;break}he(I)}function $(v){const f=v.detail.text;f&&t(1,a+=(a?" ":"")+f)}const N=v=>T(v),J=v=>q(v.actionUrl),F=(v,f)=>{var I,k;return U(v,(k=(I=f.actionResult)==null?void 0:I.data)==null?void 0:k.objectType)};function R(){a=this.value,t(1,a)}return[o,a,n,i,l,c,u,d,A,E,P,D,T,q,U,$,N,J,F,R]}class Nt extends Fe{constructor(e){super(),Le(this,e,Tt,It,$e,{})}}export{Nt as component};
